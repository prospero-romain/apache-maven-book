<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<meta name="author" content="Nicolas De loof, Arnaud HÃ©ritier">
<title>Apache Maven</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Apache Maven</h1>
<div class="details">
<span id="author" class="author">Nicolas De loof, Arnaud HÃ©ritier</span><br>
<span id="revnumber">version 3.0,</span>
<span id="revdate">2014</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table des matiÃ¨res</div>
<ul class="sectlevel1">
<li><a href="#Preface_de_la_troisieme_edition">PrÃ©face de la troisiÃ¨me Ã©dition</a></li>
<li><a href="#Preface_de_la_seconde_edition">PrÃ©face de la seconde Ã©dition</a></li>
<li><a href="#_avant_propos">Avant-propos</a>
<ul class="sectlevel2">
<li><a href="#_contenu">Contenu</a></li>
</ul>
</li>
<li><a href="#_partie_1">Partie 1</a>
<ul class="sectlevel1">
<li><a href="#_chapitre_1_introduction">Chapitre 1 : Introduction</a>
<ul class="sectlevel2">
<li><a href="#_prologue">Prologue</a></li>
<li><a href="#_partageons">Partageons !</a></li>
<li><a href="#Les_fourmis_a_la_rescousse">Les fourmis Ã  la rescousse</a></li>
<li><a href="#Et_Maven_dans_tout_ca">Et Maven dans tout Ã§a ?</a></li>
<li><a href="#_que_fait_maven">Que fait MavenÂ ?</a></li>
<li><a href="#La_cle_du_mystere">La clÃ© du mystÃ¨re</a></li>
<li><a href="#_la_force_de_maven">La force de Maven</a></li>
</ul>
</li>
<li><a href="#Au_dela_de_java.lang">Chapitre 2 : Au-delÃ  de java.lang</a>
<ul class="sectlevel2">
<li><a href="#_des_jar_sous_cvs">Des JAR sous CVS</a></li>
<li><a href="#Avis_aux_amateurs_de_casse_tete">Avis aux amateurs de casse-tÃªte</a></li>
<li><a href="#_testons_un_peu">Testons un peu</a></li>
<li><a href="#Une_arme_a_double_tranchant">Une arme Ã  double tranchant</a></li>
<li><a href="#_conclusion">Conclusion</a></li>
</ul>
</li>
<li><a href="#_chapitre_3_un_peu_plus_que_compiler">Chapitre 3Â : Un peu plus que compiler</a>
<ul class="sectlevel2">
<li><a href="#Etes_vous_pret_pour_Java_7">Ãtes-vous prÃªt pour Java 7Â ?</a></li>
<li><a href="#_plugins">Plugins</a></li>
<li><a href="#Proprietes">PropriÃ©tÃ©s</a></li>
<li><a href="#_quand_java_ne_suffit_plus">Quand Java ne suffit plus</a></li>
<li><a href="#_compiler_en_javascript">Compilerâ¦ en JavaScript</a></li>
<li><a href="#Generer_du_code">GÃ©nÃ©rer du code</a></li>
<li><a href="#_produire_autre_chose_quun_jar">Produire autre chose qu&#8217;un JAR</a></li>
<li><a href="#_des_plugins_pour_tout">Des plugins pour toutÂ ?</a></li>
<li><a href="#_conclusion_2">Conclusion</a></li>
</ul>
</li>
<li><a href="#_chapitre_4mettre_en_place_des_tests_unitaires">Chapitre 4Â :Â Mettre en place des tests unitaires</a>
<ul class="sectlevel2">
<li><a href="#_tester_pour_quoi_faire">Tester ? Pour quoi faire ?</a></li>
<li><a href="#_les_tests_sous_maven">Les tests sous Maven</a></li>
</ul>
</li>
<li><a href="#Mettre_en_place_des_tests_d_integration">Chapitre 5Â :Â Mettre en place des tests d&#8217;intÃ©gration</a>
<ul class="sectlevel2">
<li><a href="#_des_tests_unitaires_de_moins_en_moins_unitaires">Des tests unitairesâ¦ de moins en moins unitaires</a></li>
<li><a href="#_les_profils">Les profils</a></li>
<li><a href="#Tester_l_acces_a_une_base_de_donnees">Tester l&#8217;accÃ¨s Ã  une base de donnÃ©es</a></li>
<li><a href="#_utiliser_des_tests_fonctionnels">Utiliser des tests fonctionnels</a></li>
<li><a href="#_tester_la_charge_et_les_performances">Tester la charge et les performances</a></li>
<li><a href="#_profils_et_effets_de_bords">Profils et effets de bords</a></li>
<li><a href="#_conclusion_4">Conclusion</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_partie_2">Partie 2</a>
<ul class="sectlevel1">
<li><a href="#Gestion_avancee_des_dependances">Chapitre 6Â : Gestion avancÃ©e des dÃ©pendances</a>
<ul class="sectlevel2">
<li><a href="#_oracle_quand_tu_nous_tiens">Oracle, quand tu nous tiens</a></li>
<li><a href="#Creer_son_propre_depot">CrÃ©er son propre dÃ©pÃ´t</a></li>
<li><a href="#Gerer_son_depot_prive">GÃ©rer son dÃ©pÃ´t privÃ©</a></li>
<li><a href="#Metadonnees">MÃ©tadonnÃ©es</a></li>
<li><a href="#Passer_a_un_veritable_gestionnaire_de_depot">Passer Ã  un Â«Â vÃ©ritableÂ Â» gestionnaire de dÃ©pÃ´t</a></li>
</ul>
</li>
<li><a href="#_chapitre7_quand_le_projet_devient_trop_lourd">ChapitreÂ 7 : Quand le projet devient trop lourd</a>
<ul class="sectlevel2">
<li><a href="#_un_projet_un_artefact">Un projet â un artefact</a></li>
<li><a href="#_mutualiser">Mutualiser</a></li>
<li><a href="#Diviser_pour_regner">Diviser pour rÃ©gner</a></li>
<li><a href="#_conclusion_6">Conclusion</a></li>
</ul>
</li>
<li><a href="#_chapitre_8_maven_et_javaee">Chapitre 8Â : Maven et JavaEE</a>
<ul class="sectlevel2">
<li><a href="#_java_entreprise_edition">Java Entreprise Edition</a></li>
<li><a href="#_tester">Tester</a></li>
<li><a href="#_arquillian">Arquillian</a></li>
<li><a href="#_soyons_pragmatiques_soyons_productifs">Soyons pragmatiques, soyons productifs</a></li>
<li><a href="#_javaee6">JavaEE6</a></li>
<li><a href="#_conclusion_7">Conclusion</a></li>
</ul>
</li>
<li><a href="#_chapitre_9maven_et_les_ide">Chapitre 9Â :Â Maven et les IDE</a>
<ul class="sectlevel2">
<li><a href="#_un_plugin_maven_pour_eclipse">Un plugin Maven pour Eclipse</a></li>
<li><a href="#_maven_vu_depuis_lide">Maven vu depuis l&#8217;IDE</a></li>
<li><a href="#_eclipse">Eclipse</a></li>
<li><a href="#_intellij_idea">Intellij Idea</a></li>
<li><a href="#_netbeans">NetBeans</a></li>
<li><a href="#Deliberation_du_jury">DÃ©libÃ©ration du jury</a></li>
<li><a href="#_conclusion_8">Conclusion</a></li>
</ul>
</li>
<li><a href="#_chapitre_10le_jour_jla_livraison">Chapitre 10Â :Â Le jour JÂ :Â la livraison</a>
<ul class="sectlevel2">
<li><a href="#Strategie_de_livraison">StratÃ©gie de livraison</a></li>
<li><a href="#_le_plugin_release">Le plugin <em>release</em></a></li>
<li><a href="#_tester_des_candidats">Tester des candidats</a></li>
<li><a href="#_urgence">UrgenceÂ !</a></li>
<li><a href="#_vis_ma_vie">Vis ma vie</a></li>
<li><a href="#Au_dela_de_l_integration_continue">Au-delÃ  de l&#8217;intÃ©gration continue</a></li>
<li><a href="#_conclusion_9">Conclusion</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_partie_3">Partie 3</a>
<ul class="sectlevel1">
<li><a href="#Utiliser_un_outil_non_supporte">Chapitre 11Â : Utiliser un outil non supportÃ©</a>
<ul class="sectlevel2">
<li><a href="#_un_outil_maison">Un outil maison</a></li>
<li><a href="#Creer_un_plugin">CrÃ©er un plugin</a></li>
<li><a href="#_tester_notre_plugin">Tester notre plugin</a></li>
<li><a href="#_conclusion_10">Conclusion</a></li>
</ul>
</li>
<li><a href="#L_assurance_qualite">Chapitre 12Â : L&#8217;assurance qualitÃ©</a>
<ul class="sectlevel2">
<li><a href="#_audit_de_code">Audit de code</a></li>
<li><a href="#_les_rapports_maven">Les rapports Maven</a></li>
<li><a href="#_exploiter_notre_gestion_documentaire">Exploiter notre gestion documentaire</a></li>
<li><a href="#_conclusion_11">Conclusion</a></li>
</ul>
</li>
<li><a href="#_chapitre_13respecter_un_format_de_distribution">Chapitre 13Â :Â Respecter un format de distribution</a>
<ul class="sectlevel2">
<li><a href="#D_ou_vient_ce_jar">D&#8217;oÃ¹ vient ce JARÂ ?</a></li>
<li><a href="#La_confiance_regne">La confiance rÃ¨gneâ¦</a></li>
<li><a href="#_lear_ne_suffit_pas">L&#8217;EAR ne suffit pas</a></li>
<li><a href="#_conclusion_12">Conclusion</a></li>
</ul>
</li>
<li><a href="#Un_nouveau_projet_demarre">Chapitre 14 : Un nouveau projet dÃ©marre</a>
<ul class="sectlevel2">
<li><a href="#_mutualiser_2">Mutualiser</a></li>
<li><a href="#_copier_et_mutualiser">Copier et mutualiser !</a></li>
<li><a href="#Gerer_un_projet_de_reference">GÃ©rer un projet de rÃ©fÃ©rence</a></li>
<li><a href="#_conclusion_13">Conclusion</a></li>
</ul>
</li>
<li><a href="#_chapitre_15_avons_nous_fait_le_bon_choix">Chapitre 15 : Avons-nous fait le bon choix ?</a>
<ul class="sectlevel2">
<li><a href="#_les_limites">Les limites</a></li>
<li><a href="#_la_concurrence">La concurrence</a></li>
<li><a href="#_un_outil_reconnu">Un outil reconnu</a></li>
<li><a href="#_lavenir_de_maven">L&#8217;avenir de Maven</a></li>
<li><a href="#a_qui_appartient_maven">Ã qui appartient Maven ?</a></li>
<li><a href="#_conclusion_14">Conclusion</a></li>
</ul>
</li>
<li><a href="#Au_dela_de_Maven">Chapitre 16 : Au delÃ  de Maven</a>
<ul class="sectlevel2">
<li><a href="#_osgi">OSGi</a></li>
<li><a href="#_java_modules">Java Modules</a></li>
<li><a href="#_conclusion_15">Conclusion</a></li>
</ul>
</li>
<li><a href="#_chapitre_17_nos_recommandations">Chapitre 17 : Nos recommandations</a>
<ul class="sectlevel2">
<li><a href="#_les_bonnes_bases">Les bonnes bases</a></li>
<li><a href="#_conclusion_16">Conclusion</a></li>
</ul>
</li>
<li><a href="#Epilogue">Chapitre 18 : Ãpilogue</a>
<ul class="sectlevel2">
<li><a href="#Recapitulons">RÃ©capitulons</a></li>
<li><a href="#_sortez_de_lamateurisme">Sortez de l&#8217;amateurisme</a></li>
<li><a href="#_le_mot_de_la_fin">Le mot de la fin</a></li>
<li><a href="#_qui_est_qui">Qui est qui ?</a></li>
</ul>
</li>
<li><a href="#_chapitre_19_lexique">Chapitre 19 : Lexique</a>
<ul class="sectlevel2">
<li><a href="#_le_petit_monde_open_source">Le petit monde open-source</a></li>
<li><a href="#_les_concepts_maven">Les concepts Maven</a></li>
<li><a href="#_ceux_qui_font_tourner_maven">Ceux qui font tourner Maven</a></li>
<li><a href="#_et_tout_ce_qui_tourne_autour">Et tout ce qui tourne autourâ¦</a></li>
<li><a href="#_liens_utiles">Liens utiles</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="Preface_de_la_troisieme_edition">PrÃ©face de la troisiÃ¨me Ã©dition</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaNicolas.png" alt="MangaNicolas"></span></p>
</div>
<div class="paragraph">
<p>Ãcrire un bouquin pour un Ã©diteur est un travail Ã©puisant. La rÃ©daction
elle-mÃªme n&#8217;est qu&#8217;une toute petite partie du travail, dÃ©jÃ  prenante, et
il faut y ajouter les relations Ã©diteur par email et la phase de relecture
puis de mise en page, sans parler des questions des Ã©quipes marketing pour
la promotion du livre.</p>
</div>
<div class="paragraph">
<p>Pour la premiÃ¨re Ã©dition de ce livre, je dÃ©couvrais le monde de l&#8217;Ã©dition et j&#8217;Ã©tais
super motivÃ©. Nous avons nous-mÃªmes choisi nos relecteurs dans la communautÃ©
Maven francophone et utilisÃ© un DropBox, nettement plus pratique que le
process d&#8217;envoi des chapitres par email proposÃ© par l&#8217;Ã©diteur.</p>
</div>
<div class="paragraph">
<p>Il a fallu aussi s&#8217;adapter au template Word de Pearson, qui s&#8217;est avÃ©rÃ© pas
si mal fait que Ã§a aprÃ¨s avoir Ã©tÃ© confrontÃ© Ã  celui d&#8217;autres Ã©diteurs !
Finalement, la masse de travail, toutes les tÃ¢ches non prÃ©vues, pour quelques
euros rÃ©coltÃ©s (8% Ã  se partager) n&#8217;est pas du tout rentable. Si cela restait
du plaisir - aprÃ¨s tout, Ã©crire du code OSS n&#8217;est pas trÃ¨s rentable non plus -
la pilule pourrait passer, mais en plus il faut subir les contraintes de la
chaÃ®ne d&#8217;Ã©dition.</p>
</div>
<div class="paragraph">
<p>Pearson nous a annoncÃ© dÃ©but dÃ©cembre 2013 que le livre serait arrÃªtÃ©, faute de
rentabilitÃ©. Pas vraiment une surprise,
un livre technique, qui plus est en FranÃ§ais, n&#8217;a pas un auditoire Ã©norme
- ou alors, peut Ãªtre que tout le monde fait du gradle aujourd&#8217;hui -
en tout cas nous en avons vendu environ 2000 exemplaires, ce qui est un beau
succÃ¨s pour un marchÃ© aussi limitÃ©.</p>
</div>
<div class="paragraph">
<p>Aussi, aprÃ¨s avoir rÃ©cupÃ©rÃ© nos droits sur le texte nous avons dÃ©cidÃ© de
le convertir en AsciiDoc pour ne plus subir Word et le template editeur,
et surtout de <em>l&#8217;open-sourcer</em>, sous licence Creative Commons 4.0 afin que
tout le monde en profite et que d&#8217;Ã©ventuels contributeurs puissent nous aider
Ã  corriger les boulettes inÃ©vitables qui s&#8217;y sont glissÃ©es.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="illustrations/license.png" alt="license"></span>
Â«<em>Attribution - Pas dâUtilisation Commerciale - Partage dans les MÃªmes Conditions</em>Â»</p>
</div>
<div class="paragraph">
<p><em>Nicolas de Loof</em></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Preface_de_la_seconde_edition">PrÃ©face de la seconde Ã©dition</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaNicolas.png" alt="MangaNicolas"></span></p>
</div>
<div class="paragraph">
<p>La rÃ©daction de la premiÃ¨re Ã©dition d&#8217;Apache Maven a Ã©tÃ© un exercice
difficile mais trÃ¨s enrichissant. Avec Arnaud, nous avons trouvÃ© un
rythme et un ton qui nous permettait de prendre du plaisir sans
accumuler trop de retard - un petit mois Ã  peine - sur le planning de
Pearson. Nous en avons retirÃ© une grande fiertÃ©, surtout avec le trÃ¨s
bon accueil du public.</p>
</div>
<div class="paragraph">
<p>MalgrÃ© cela, nous avons rapidement identifiÃ© des manques et des sujets
que nous aurions aimÃ© approfondir. Au cours de la rÃ©daction, les
nouvelles versions de plugins et l&#8217;avancement des dÃ©veloppements de
Maven 3 rendaient certaines de nos remarques obsolÃ¨tes ou moins
pertinentes. La liste des Ã©lÃ©ments de notre Erratum, que nous n&#8217;avons
jamais publiÃ©e d&#8217;ailleurs faute de l&#8217;organiser correctement, a commencÃ© Ã 
s&#8217;allonger. Il Ã©tait hors de question d&#8217;en rester lÃ  !</p>
</div>
<div class="paragraph">
<p>Ã l&#8217;heure oÃ¹ nous reprenons la plume (enfin, le clavier), Maven 3 enfin
sorti en version 3.0 finale, est pleinement utilisable sur un projet.
Les versions suivantes apporteront encore de nouvelles fonctionnalitÃ©s
et amÃ©liorations. Dans le mÃªme temps, de nombreux projets vont continuer
d&#8217;utiliser Maven 2 pendant encore un long moment. Il n&#8217;est pas question
de laisser ces utilisateurs sur le carreau juste parce que la nouvelle
version de Maven est plus belle, plus grande, plus forte.</p>
</div>
<div class="paragraph">
<p>Nous avons donc choisi de donner Ã  cette seconde Ã©dition une double
lecture : le corps du texte a Ã©tÃ© revu pour correspondre Ã  l&#8217;Ã©tat de
l&#8217;art, Ã  savoir Maven 3. De nouveaux chapitres viennent en dÃ©crire les
avancÃ©es et les outils associÃ©s. C&#8217;est seulement lorsqu&#8217;une rupture
significative avec les versions prÃ©cÃ©dentes existe que nous ajoutons un
encart. Ces encarts sont reconnaissables au logo :</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="illustrations/Maven3.png" alt="Maven3"></span></p>
</div>
<div class="paragraph">
<p>Vous constaterez rapidement qu&#8217;ils sont assez peu nombreux : Maven 3 est
avant tout conÃ§u pour remplacer son prÃ©dÃ©cesseur sans heurts. MÃªme avec
ces rÃ©serves, les grandes idÃ©es prÃ©sentÃ©es dans le livre sont
applicables aux deux versions. Nous espÃ©rons donc que vous en tirerez le
meilleur parti.</p>
</div>
<div class="paragraph">
<p>Quoi quâil en soit, nous avons utilisÃ© Maven 3.0 dans ses diverses
prÃ©versions et nous vous encourageons Ã  migrer vers cette nouvelle
Ã©dition de lâoutil phare du dÃ©veloppement Java. Les prochaines versions
sont une large promesse de fonctionnalitÃ©s innovantes, et Â« au pire Â»
vous bÃ©nÃ©ficierez dâune amÃ©lioration des performances et dâune rÃ©duction
dâoccupation mÃ©moire ! Si vous utiliser m2eclipse pour intÃ©grer votre
projet Maven dans Eclipse, vous Ãªtes dÃ©jÃ  des utilisateurs de Maven 3
sans mÃªme le savoir, alors laissez vos derniÃ¨res hÃ©sitations de cÃ´tÃ© et
en avant toute.</p>
</div>
<div class="paragraph">
<p>Nous espÃ©rons que les pages qui suivent vous aideront Ã  prendre en main
Maven et Ã  en comprendre la richesse et la philosophie, qui en font un
outil sans Ã©quivalent.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_avant_propos">Avant-propos</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaNicolas.png" alt="MangaNicolas"></span></p>
</div>
<div class="paragraph">
<p>L&#8217;Ã©criture d&#8217;un ouvrage technique n&#8217;est pas une tÃ¢che triviale, car il
est facile de perdre le lecteur dans une avalanche de concepts
thÃ©oriques ou de s&#8217;Ã©garer dans des dÃ©tails non fondamentaux. DÃ©crire un
outil comme Maven, ou tout simplement le dÃ©finir clairement, tout en
restant accessible Ã  tous, est encore plus dÃ©licat : soit on reste trop
vague, et le lecteur n&#8217;a plus qu&#8217;Ã  attendre le Chapitre 5 pour commencer
Ã  apprendre quelque chose de concret, soit on s&#8217;embarque dans de longues
explications de principes et de concepts et le lecteur n&#8217;attendra jamais
ce mÃªme Chapitre 5.</p>
</div>
<div class="paragraph">
<p>Pour Ãªtre honnÃªte, je dois dire que les premiÃ¨res Ã©bauches de cet
ouvrage sont immanquablement tombÃ©es dans ces travers, ce qui annonÃ§ait
un livre bien peu pertinent pour les utilisateurs, qu&#8217;ils soient novices
ou dÃ©jÃ  expÃ©rimentÃ©s. Lorsque j&#8217;ai soumis les premiers extraits de ce
projet Ã  Arnaud, il m&#8217;en a rapidement fait la remarque et nous nous
sommes accordÃ©s sur la forme que nous voulions donner Ã  ce livre.</p>
</div>
<div class="paragraph">
<p>Mon objectif est de communiquer ma passion autour de ce projet
Open Source qu&#8217;est Maven, lequel rÃ©unit des dÃ©veloppeurs aux parcours
trÃ¨s diffÃ©rents. Les rencontres que j&#8217;ai faites dans cette communautÃ©
ont forgÃ© mon approche de l&#8217;informatique. Avec cette motivation, Ã©tablir
un dictionnaire impersonnel Maven-FranÃ§ais Ã©tait exclu ; aussi j&#8217;ai
rapidement choisi, en accord avec Arnaud, de privilÃ©gier une approche
aussi didactique que possible, bÃ¢tie sur des exemples concrets issus de
ma propre expÃ©rience du terrain.</p>
</div>
<div class="paragraph">
<p>Il est difficile de sensibiliser les utilisateurs aux enjeux que Maven
tente de gÃ©rer, alors qu&#8217;ils y sont pourtant confrontÃ©s en permanence.
Situation intÃ©ressante oÃ¹ tout le monde rencontre un problÃ¨me, mais,
faute de mettre un nom dessus et d&#8217;en Ã©valuer l&#8217;importance, celui-ci
reste latent tout au long de la vie du projet, amenant parfois Ã  des
situations critiques. Nous allons suivre ensemble la vie d&#8217;un projet
fictif, bien que largement inspirÃ© de situations rÃ©elles. Il passera par
toutes les phases, du prototype Ã©crit sur un coin de table Ã 
l&#8217;application stratÃ©gique d&#8217;entreprise de grande envergure, ce qui nous
permettra de couvrir un trÃ¨s large Ã©ventail de situations.</p>
</div>
<div class="paragraph">
<p>PlutÃ´t que de dÃ©crire le rÃ´le de Maven sur un projet, ou de vous
accabler par un long exposÃ© thÃ©orique sur ses concepts, je prÃ©fÃ¨re au
travers de cette dÃ©monstration un peu romancÃ©e vous montrer les
difficultÃ©s concrÃ¨tes auxquelles Maven s&#8217;attaque. Sur la base de ces
exemples, parfois volontairement excessifs, je souhaite vous dÃ©montrer
de maniÃ¨re ludique les avantages que Maven peut apporter Ã  vos projets.
MalgrÃ© les caricatures proposÃ©es, de nombreuses situations vous
sembleront familiÃ¨res. DerriÃ¨re la fiction se cachent des cas bien
rÃ©els, que je n&#8217;ai fait qu&#8217;amplifier, et beaucoup auront des points
communs avec vos propres difficultÃ©s. Ce parallÃ¨le vous donnera une
image rÃ©aliste de Maven et des conseils applicables dans les meilleurs
dÃ©lais.</p>
</div>
<div class="paragraph">
<p>J&#8217;espÃ¨re que vous apprÃ©cierez ce choix et que vous tirerez un
enseignement pratique du texte qui suit. En particulier, j&#8217;aimerais
qu&#8217;arrivÃ© au bout de votre lecture vous soyez conscient des objectifs
visÃ©s par Maven, de sa philosophie et des raisons pour lesquelles il
devient un Ã©lÃ©ment clÃ© de la boÃ®te Ã  outils du dÃ©veloppeur. Enfin, je
souhaite rÃ©ussir Ã  vous transmettre mon enthousiasme pour ce projet
libre, auquel vous pouvez participer en rejoignant le forum pour y
exposer vos interrogations, apporter de nouvelles idÃ©es, proposer des
contributions de toutes sortes et participer Ã  l&#8217;amÃ©lioration gÃ©nÃ©rale
de cet outil. Arnaud et moi avons commencÃ© de cette faÃ§on avant de
passer Â« de l&#8217;autre cÃ´tÃ© du miroir Â», mais au quotidien nous restons comme
vous, avant tout, des utilisateurs de Maven, soucieux de disposer d&#8217;un
outil pertinent et productif.</p>
</div>
<div class="paragraph">
<p><em>Nicolas de Loof</em></p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaArnaud.png" alt="MangaArnaud"></span></p>
</div>
<div class="paragraph">
<p>Lorsque Nicolas m&#8217;a contactÃ© pour Ã©crire un ouvrage sur Maven en
franÃ§ais, j&#8217;ai commencÃ© par me demander si cela en valait la peine.
Certes, la documentation du produit est critiquable. Elle est trÃ¨s
dispersÃ©e, et il est souvent difficile de trouver l&#8217;information utile
lorsqu&#8217;on ne sait pas oÃ¹ la chercher entre le site web du
projet <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>, ses nombreux plugins et son
wiki <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup>. Pourtant, il existe dÃ©sormais deux ouvrages en
anglais disponibles gratuitement sur la Toile pour combler ces manques :
<em>Better Builds with Maven</em> <sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup>, publiÃ© en 2006, et <em>Maven : The Definitive Guide</em> <sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup>, publiÃ© en 2007 et rÃ©guliÃ¨rement
mis Ã  jour. Alors qu&#8217;apporter de plus qu&#8217;une simple traduction en
franÃ§ais de ces ouvragesÂ ?</p>
</div>
<div class="paragraph">
<p>AprÃ¨s de nombreuses annÃ©es Ã  utiliser et Ã  prÃ©coniser Maven dans des
contextes variÃ©s, j&#8217;avais envie de partager tout ce que j&#8217;avais pu
emmagasiner comme bonnes pratiques et pointer sur les mauvaises que
j&#8217;avais pu rencontrer. C&#8217;est sur ce principe que nous avons commencÃ©
avec Nicolas Ã  bÃ¢tir le squelette de cet ouvrage. FondÃ© sur un projet
fictif, il retrace nos expÃ©riences ainsi que celles des personnes que
nous avions croisÃ©es sur notre chemin et permet d&#8217;expliquer les enjeux
de Maven dans un projet et dans une entreprise. MÃªme si nous n&#8217;avons pas
recherchÃ© l&#8217;exhaustivitÃ© dans les cas traitÃ©s, tellement ils peuvent
Ãªtre nombreux, nous avons essayÃ© de faire apparaÃ®tre les plus frÃ©quents
ou les plus Ã©pineux que nous ayons eus Ã  rÃ©soudre. Nous avons axÃ© nos
efforts sur la prÃ©sentation et la comprÃ©hension des concepts plutÃ´t que
sur le dÃ©tail du paramÃ©trage, lequel peut Ã©voluer pÃ©riodiquement.</p>
</div>
<div class="paragraph">
<p>J&#8217;espÃ¨re que cet ouvrage saura autant vous divertir que vous former sur
cet outil complet afin qu&#8217;il ne soit plus jamais complexe Ã  vos yeux.</p>
</div>
<div class="paragraph">
<p><em>Arnaud HÃ©ritier</em></p>
</div>
<div class="sect2">
<h3 id="_contenu">Contenu</h3>
<div class="paragraph">
<p>Cet ouvrage se compose de quatre parties :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>La premiÃ¨re, du Chapitre 1 au Chapitre 5, aborde les concepts
fondamentaux de Maven et leur mise en Åuvre pratique. Nous avons choisi
de mettre en scÃ¨ne de maniÃ¨re trÃ¨s explicite et souvent exagÃ©rÃ©e les
problÃ¨mes que Maven tente de prendre en charge, afin que cette premiÃ¨re
partie soit aussi didactique que possible.</p>
</li>
<li>
<p>La deuxiÃ¨me, du Chapitre 6 au Chapitre 10, exploite des
fonctionnalitÃ©s plus avancÃ©es de Maven pour traiter des besoins orientÃ©s
Â« gros projets d&#8217;entreprise Â» mais tout aussi dÃ©licats. Cette partie
s&#8217;adresse typiquement aux dÃ©veloppeurs intervenant sur des projets
JavaEE (<em>Java Enterprise Edition</em>) en entreprise.</p>
</li>
<li>
<p>La troisiÃ¨me regroupe les Chapitres 11 Ã  15 et couvre des facettes
plus spÃ©cialisÃ©es et moins mises en avant de Maven, mais que nous
considÃ©rons comme tout aussi essentielles. Vous verrez alors que Maven
ne se rÃ©sume pas comme on le lit souvent Ã  Â« un outil de compilation Â».</p>
</li>
<li>
<p>Pour terminer cet ouvrage le Chapitre 16 sera l&#8217;occasion de
rÃ©sumer les Ã©lÃ©ments clÃ©s prÃ©sentÃ©s, de vous donner nos recommandations,
bonnes et mauvaises pratiques Ã  connaÃ®tre pour tirer le meilleur de
Maven. Par ailleurs, nous nous essayerons Ã  l&#8217;exercice acrobatique de la
boule de cristal en vous prÃ©sentant l&#8217;avenir du projet Maven. Nous
indiquerons comment aller au-delÃ  de ce livre en participant Ã  la
communautÃ© qui Ã©paule ce projet Open Source. Le Chapitre 17 conclura le
rÃ©cit de notre histoire et vous prÃ©sentera les personnes qui nous ont
inspirÃ© les diffÃ©rents protagonistes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Un dix-huitiÃ¨me chapitre vous propose un lexique qui Ã©claircit les mots
quelque peu abscons utilisÃ©s dans cet ouvrage.</p>
</div>
</div>
</div>
</div>
<h1 id="_partie_1" class="sect0">Partie 1</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>Premiers pas avec Maven</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chapitre_1_introduction">Chapitre 1 : Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>CommenÃ§ons donc notre rÃ©cit par l&#8217;inÃ©vitable mise en garde : toute
ressemblance avec des personnes ou des situations existantes ou ayant
existÃ© ne serait que fortuiteâ¦</p>
</div>
<div class="sect2">
<h3 id="_prologue">Prologue</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaNicolas.png" alt="MangaNicolas"></span> <span class="image" style="float: right"><img src="illustrations/MangaArnaud.png" alt="MangaArnaud"></span></p>
</div>
<div class="paragraph">
<p>Nicolas et Arnaud se sont rencontrÃ©s au cours d&#8217;une confÃ©rence organisÃ©e
par un Java User Group (si vous ne participez pas Ã  un JUG &#8230;&#8203; et bien vous avez tort).
Faisant connaissance autour d&#8217;un verre, ils
Ã©voquent les souvenirs de leurs premiers pas avec Java, devenu depuis
leur plateforme de prÃ©dilection. Un Java Development Kit dans une
version qui fait sourire aujourd&#8217;hui, et les bons vieux Â« Hello World Â»
qui initient tout dÃ©veloppeur Ã  un nouveau langage. De nombreux
souvenirs qui rappellent qu&#8217;on a tous dÃ©butÃ© un jour, rencontrÃ© les
mÃªmes problÃ¨mes et commis les mÃªmes erreurs idiotes que l&#8217;on dÃ©nonce
aujourd&#8217;hui.</p>
</div>
<div class="paragraph">
<p>La premiÃ¨re application un peu intÃ©ressante de Nicolas Ã©tait un
splendide outil de gestion de sa liste de courses. D&#8217;un naturel assez
dÃ©sorganisÃ©, Nicolas n&#8217;a jamais rÃ©ussi Ã  mÃ©moriser toute la liste. Il
lui est mÃªme dÃ©jÃ  arrivÃ© de l&#8217;oublier ou pire, d&#8217;oublier tout simplement
de faire les courses. Son application Ã©tait donc un extraordinaire
pense-bÃªte, qu&#8217;il lanÃ§ait Ã  l&#8217;avance et qui lui envoyait fiÃ¨rement, dix
minutes avant son dÃ©part du bureau, un message de rappel avec la liste
des courses. Autrement dit, un outil de rÃªve totalement indispensable, Ã 
tel point que le code de ce monument de l&#8217;informatique est
respectueusement conservÃ© quelque part.</p>
</div>
<div class="paragraph">
<p>Arnaud, confrontÃ© au mÃªme souci et amusÃ© par cette solution de pur geek,
lui demande s&#8217;il a toujours son programme et s&#8217;il peut en faire une
copie pour satisfaire sa curiositÃ© â la geekitude est dangereusement
contagieuse !</p>
</div>
</div>
<div class="sect2">
<h3 id="_partageons">Partageons !</h3>
<div class="paragraph">
<p>De retour Ã  la maison, Nicolas fouille dans ses archives et en retire
une vieille disquette (vous savez, ces carrÃ©s de plastique qu&#8217;on
utilisait Â« dans le temps Â», avant que la clÃ© USB et Internet ne les
fassent disparaÃ®tre). Il envoie donc le trÃ©sor tant convoitÃ© Ã  Arnaud.</p>
</div>
<div class="paragraph">
<p>Pour vous faire une meilleure idÃ©e de cette exceptionnelle construction
logicielle, voici les fichiers qui la constituent :</p>
</div>
<div class="paragraph">
<div class="title">Figure 01-01</div>
<p><span class="image"><img src="illustrations/01-01.png" alt="Figure 1"></span></p>
</div>
<div class="paragraph">
<p>La structure originale du projet Â« noubliepaslalistedescourses Â».</p>
</div>
<div class="paragraph">
<p>Arnaud, qui, semble-t-il, n&#8217;a vraiment que cela Ã  faire de son temps
libre, se jette sur cette magnifique relique des annÃ©es Java 1.1 et
tente de le compiler. Seulement, Arnaud est un utilisateur Mac. Le
fichier BAT qui compile et assemble le logiciel en une archive Java JAR
est inexploitable sur son systÃ¨me. Arnaud n&#8217;est pas du genre Ã  se
dÃ©courager si facilement, aussi Ã©crit-il un fichier de compilation
adaptÃ© Ã  son environnement afin de pouvoir tester ce chef-d&#8217;Åuvre de
l&#8217;informatique.</p>
</div>
<div class="paragraph">
<p>Deux jours plus tard, profitant d&#8217;un peu de rangement, Nicolas retrouve
une autre disquette contenant une version plus avancÃ©e de son logiciel,
qui utilise les fonctions d&#8217;une bibliothÃ¨que utilitaire pour lire le
fichier contenant la liste des courses. Il l&#8217;envoie donc Ã  Arnaud, qui
une nouvelle fois doit Ã©crire son propre fichier de compilation.</p>
</div>
<div class="paragraph">
<p>Le Â« projet Â» Ã©tant trivial, la traduction du build.bat en build.sh est
rapide. Voici pour comparaison les deux fichiers utilisÃ©s respectivement
par Nicolas et Arnaud. Les diffÃ©rences sont minimes , mais nÃ©cessitent une
reprise manuelle Ã  chaque modification, pouvant introduire des
disparitÃ©s, voire des incompatibilitÃ©s entre les environnements de nos
deux compÃ¨res, qui peuvent leur faire perdre un temps prÃ©cieux.</p>
</div>
<div class="paragraph">
<p>Listing 1.1 : Les fichiers de compilation utilisÃ©s respectivement par Nicolas et par Arnaud</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image" style="float: center"><img src="illustrations/MangaNicolas.png" alt="MangaNicolas"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image" style="float: center"><img src="illustrations/MangaArnaud.png" alt="MangaArnaud"></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="title">build.bat</div>
<div class="content">
<pre>@echo off
set JAVA_HOME=C:\jdk1.3
set PATH=%JAVA_HOME%\bin
set CLASSPATH=lib\mail.jar;lib\activation.jar

mkdir build
javac -d build src\*.java
jar cf noubliepaslalistedescourses.jar build\*.class</pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="title">build.sh</div>
<div class="content">
<pre>#!/bin/bash
export JAVA_HOME=/opt/jdk1.3
export PATH=$JAVA_HOME/bin
export CLASSPATH=lib/mail.jar:lib/activation.jar

mkdir build
javac -d build src/*.java
jar cf noubliepaslalistedescourses.jar build/*.class</pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>De nombreux projets industriels ou communautaires sont confrontÃ©s Ã  ce
mÃªme problÃ¨me et sont obligÃ©s de maintenir deux versions (ou plus) du
script de construction du logiciel, soit parce que l&#8217;Ã©quipe n&#8217;est pas
homogÃ¨ne, soit parce que l&#8217;environnement de test ou de production n&#8217;est
pas Ã©quivalent Ã  celui de dÃ©veloppement. MÃªme sur des systÃ¨mes
d&#8217;exploitation identiques, les outils peuvent Ãªtre installÃ©s Ã  des
emplacements diffÃ©rents, ce qui oblige Ã  prÃ©voir dans le script un
ensemble de propriÃ©tÃ©s que chacun devra renseigner en fonction de sa
configuration.</p>
</div>
<div class="paragraph">
<p>Sur Unix, ce problÃ¨me a Ã©tÃ© traitÃ© depuis longtemps par l&#8217;outil make.
Cependant, celui-ci n&#8217;est pas facilement exploitable sur les machines
Windows, omniprÃ©sentes comme postes de dÃ©veloppement.</p>
</div>
<div class="paragraph">
<p>Arnaud raconte ses dÃ©boires Ã  son collÃ¨gue Olivier. Ce dernier,
utilisateur du systÃ¨me Solaris, s&#8217;est souvent trouvÃ© face Ã  ce
problÃ¨me ; il lui propose d&#8217;utiliser un fichier de commande universel,
basÃ© sur l&#8217;outil Apache Ant.</p>
</div>
</div>
<div class="sect2">
<h3 id="Les_fourmis_a_la_rescousse">Les fourmis Ã  la rescousse</h3>
<div class="paragraph">
<p>Qu&#8217;est-ce que c&#8217;est que ce Â« Ant Â» ? Faisons un dÃ©tour par WikipÃ©dia pour
nous en faire une idÃ©e :</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ant <sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup> est un projet Open Source de la fondation Apache, Ã©crit en Java, qui
vise le dÃ©veloppement d&#8217;un logiciel d&#8217;automatisation des opÃ©rations
rÃ©pÃ©titives tout au long du cycle de dÃ©veloppement logiciel, Ã  l&#8217;instar
des logiciels Make.</p>
</div>
<div class="paragraph">
<p>Le nom est un acronyme pour <em>Another Neat Tool</em> (un autre chouette
outil).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ant est principalement utilisÃ© pour automatiser la construction de
projets en langage Java, mais il peut l&#8217;Ãªtre pour tout autre type
d&#8217;automatisation dans n&#8217;importe quel langage.</p>
</div>
<div class="paragraph">
<p>Parmi les tÃ¢ches les plus courantes, citons la compilation, la
gÃ©nÃ©ration de pages HTML de document (Javadoc), la gÃ©nÃ©ration de
rapports, l&#8217;exÃ©cution d&#8217;outils annexes (checkstyle, findbugs, etc.),
l&#8217;archivage sous forme distribuable (JAR, etc.).</p>
</div>
<div class="paragraph">
<p>Ant a connu un succÃ¨s exceptionnel et occupe une place de choix dans la
panoplie de tout dÃ©veloppeur. Aucun logiciel dÃ©diÃ© Ã  Java ne peut
aujourd&#8217;hui se permettre de ne pas fournir des tÃ¢ches Ant. Le choix de
cette solution semble donc la meilleure marche Ã  suivre !</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaOlivier.png" alt="MangaOlivier"></span></p>
</div>
<div class="paragraph">
<p>Pour lui faciliter la tÃ¢che, Olivier envoie Ã  Arnaud un script Ant,
appelÃ© avec beaucoup d&#8217;originalitÃ© build.xml, qu&#8217;il utilise lui-mÃªme sur
la plupart de ses projets, et qui est donc rodÃ© et bourrÃ© d&#8217;options et
de paramÃ¨tres indispensables permettant de le plier Ã  tous les besoins
courants.</p>
</div>
<div class="paragraph">
<p>Aurait-on trouvÃ© avec Ant la solution miracle, rassemblant tous les
suffrages ?</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaFabrice.png" alt="MangaFabrice"></span></p>
</div>
<div class="paragraph">
<p>Pas si simple : Nicolas, de son cÃ´tÃ©, dÃ©solÃ© d&#8217;avoir causÃ© tant de
soucis Ã  Arnaud, a reÃ§u le mÃªme conseil de Fabrice, qui lui aussi a
proposÃ© un script de commandes Ant Ã  tout faire, Ã©prouvÃ© par de
nombreuses annÃ©es d&#8217;utilisation. Le fichier d&#8217;Olivier suppose que les
fichiers sources java sont stockÃ©s dans un rÃ©pertoire sources et que les
bibliothÃ¨ques java sont placÃ©es sous libraries. Celui de Fabrice fait
des choix diffÃ©rents, respectivement java et libs. De plus, la commande
de compilation pour le fichier d&#8217;Olivier est ant package alors que celle
de Fabrice est ant jar. La fusion de ces deux fichiers, chacun apportant
des options intÃ©ressantes, est un vÃ©ritable casse-tÃªte. Rapidement, les
quatre compÃ¨res, qui commencent Ã  se prendre au sÃ©rieux avec leur liste
de courses, font appel Ã  des connaissances spÃ©cialistes d&#8217;Ant pour les
assister dans cette lourde tÃ¢che.</p>
</div>
<div class="paragraph">
<p>Ant a donc crÃ©Ã© un nouveau mÃ©tier dans le microcosme informatique :
expert en script Ant ! Certains projets semblent jouer pour le concours
du script le plus inutilement tordu, mixant des paramÃ¨tres Ã  n&#8217;en plus
finir (que personne n&#8217;a d&#8217;ailleurs jamais eu besoin de modifier) et
prenant en charge des cas de figure qui tiennent de l&#8217;expression
artistique, le tout en important d&#8217;autres fichiers de script pour Ã©viter
l&#8217;ignoble copier-coller. S&#8217;ils sont fonctionnels, de tels scripts sont
un enfer Ã  maintenir et traduisent une organisation suspecte du projet,
qui pourrait bien avoir laissÃ© passer un Ã©lÃ©ment de complexitÃ© inutile.</p>
</div>
<div class="paragraph">
<p>Pris au jeu, nos quatre amis â qui ont trouvÃ© un boulot en or pour avoir
autant de temps libre â ne s&#8217;avouent pas vaincus et veulent poursuivre
ensemble le dÃ©veloppement de ce projet. Des complications commencent Ã 
Ã©merger. Notre petite Ã©quipe provenant d&#8217;horizons diffÃ©rents, chacun a
ses habitudes Â« maison Â» et ses bonnes pratiques et voudrait les voir
appliquÃ©es.</p>
</div>
</div>
<div class="sect2">
<h3 id="Et_Maven_dans_tout_ca">Et Maven dans tout Ã§a ?</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaJason.png" alt="MangaJason"></span></p>
</div>
<div class="paragraph">
<p>Au hasard d&#8217;un de ces appels au secours, Jason les prend Ã  contre-pied
et leur rÃ©pond : Â« Et pourquoi ne pas utiliser plutÃ´t Apache Maven ? Â»
Surpris, et quelque peu incrÃ©dules devant cette proposition, ils mettent
Jason au dÃ©fi de compiler ce fameux logiciel avec son outil miracle, lÃ 
oÃ¹ nos deux scripts Ant, pourtant irrÃ©prochables, pris sÃ©parÃ©ment
refusent obstinÃ©ment la fusion. Et dix minutes plus tard, Jason envoie
un fichier de quelques lignes, d&#8217;une simplicitÃ© surprenante, et les
instructions de base pour installer Maven. Ã leur grande surprise,
chacun arrive Ã  compiler le projet sur son environnement, quelle que
soit sa singularitÃ©.</p>
</div>
<div class="paragraph">
<p>Voici le fichier envoyÃ© par Jason :</p>
</div>
<div class="listingblock">
<div class="title">Listing 1.2 : pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;project&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;fr.noubliepaslalistedescourses&lt;/groupId&gt;
  &lt;artifactId&gt;noubliepaslalistedescourses&lt;/artifactId&gt;
  &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
  &lt;build&gt;
    &lt;sourceDirectory&gt;src&lt;/sourceDirectory&gt;
  &lt;/build&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;javax.mail&lt;/groupId&gt;
      &lt;artifactId&gt;mail&lt;/artifactId&gt;
      &lt;version&gt;1.4&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;commons-io&lt;/groupId&gt;
      &lt;artifactId&gt;commons-io&lt;/artifactId&gt;
      &lt;version&gt;1.4&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>ComparÃ© aux fichiers Ant testÃ©s jusqu&#8217;ici, ce fichier Â« pom.xml Â» â quel
drÃ´le de nom â ne ressemble Ã  rien de connu. Pas de directive de
compilation, pas d&#8217;indication d&#8217;ordre dans les tÃ¢ches, pas de commande
d&#8217;assemblage du JAR. OÃ¹ est le secretÂ ?</p>
</div>
</div>
<div class="sect2">
<h3 id="_que_fait_maven">Que fait MavenÂ ?</h3>
<div class="paragraph">
<p>Ãpluchons point par point les consignes de Jason et voyons.</p>
</div>
<div class="paragraph">
<p>L&#8217;installation de Maven Ã  proprement parler se rÃ©sume Ã  dÃ©sarchiver un
fichier ZIP et Ã  dÃ©finir la variable PATH pour y ajouter le chemin vers
le rÃ©pertoire apache-maven/bin. Il faut aussi s&#8217;assurer d&#8217;avoir la
variable d&#8217;environnement JAVA_HOME qui indique l&#8217;emplacement du JDK
(<em>Java Development Kit</em>), ce qui est gÃ©nÃ©ralement le cas sur le poste de
travail des bons dÃ©veloppeurs. La construction du projet s&#8217;effectue
ensuite <em>via</em> la commande <code>mvn package</code> depuis la ligne de commande. Rien
de bien rÃ©volutionnaire donc par rapport au script Ant que nous avions
envisagÃ©.</p>
</div>
<div class="paragraph">
<p>Jason nous a indiquÃ© que Maven nÃ©cessitait une connexion Ã  Internet.
L&#8217;installation n&#8217;est donc pas complÃ¨te, et Maven va rechercher sur le
rÃ©seau les Ã©lÃ©ments manquants. Effectivement, la premiÃ¨re exÃ©cution de
Maven se traduit dans la console par une sÃ©rie de messages de
tÃ©lÃ©chargements divers :</p>
</div>
<div class="listingblock">
<div class="title">Listing 1.3 : PremiÃ¨re exÃ©cution de Maven</div>
<div class="content">
<pre>D:\noubliepaslalistedescourses&gt;mvn package
[INFO] Scanning for projects...
[INFO] ------------------------------------------------------------------------
[INFO] Building Unnamed - fr.noubliepaslalistedescourses:noubliepaslalistedescourses:jar:0.0.1-SNAPSHOT
[INFO]    task-segment: [package]
[INFO] ------------------------------------------------------------------------
Downloading: http://repo1.maven.org/maven2/org/apache/maven/plugins/maven-resources-plugin/2.2/maven-resources-plugin-2.2.pom
1K downloaded
Downloading: http://repo1.maven.org/maven2/org/apache/maven/plugins/maven-plugins/1/maven-plugins-1.pom
3K downloaded
Downloading: http://repo1.maven.org/maven2/org/apache/maven/maven-parent/1/maven-parent-1.pom
6K downloaded
Downloading: http://repo1.maven.org/maven2/org/apache/apache/1/apache-1.pom
3K downloaded
...</pre>
</div>
</div>
<div class="paragraph">
<p>Cette liste de messages semble mÃªme interminable et avoir Ã©tÃ© conÃ§ue
pour favoriser le dÃ©veloppement d&#8217;Internet Ã  haut dÃ©bit. Tout Ã§a pour
notre projet composÃ© de trois classesÂ ? Jason nous a prÃ©venus qu&#8217;Ã  la
premiÃ¨re utilisation, Maven semble tÃ©lÃ©charger tout Internet, mais il
nous a promis des explications ! Mise en garde quelque peu surprenante,
mais laissons-lui le bÃ©nÃ©fice du doute.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>La mise en garde de Jason est judicieuse, car de nombreux utilisateurs
sont surpris par ce comportement de Maven et sa dÃ©pendance Ã  une
connexion Internet. Nous verrons par la suite ce qui impose ce mode de
fonctionnement et en quoi cela sert les utilisateurs plutÃ´t que de les
contraindre.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Poursuivons l&#8217;analyse des messages que Maven trace dans la console, en
ignorant les lignes liÃ©es Ã  ces tÃ©lÃ©chargements Ã©tranges mais
apparemment nÃ©cessaires :</p>
</div>
<div class="listingblock">
<div class="title">Listing 1.4 : Seconde exÃ©cution de Mavenâ¦ sans tÃ©lÃ©chargement cette fois</div>
<div class="content">
<pre>D:\noubliepaslalistedescourses&gt;mvn package
[INFO] Scanning for projects...
[INFO] ------------------------------------------------------------------------
[INFO] Building Unnamed - fr.maven:noubliepaslalistedescourses:jar:0.0.1-SNAPSHOT
[INFO]    task-segment: [package]
[INFO] ------------------------------------------------------------------------
[INFO] [resources:resources]
[INFO] Using default encoding to copy filtered resources.
[INFO] [compiler:compile]
[INFO] Compiling 3 source files to D:\java\workspace\malistedecourses\target\classes
[INFO] [resources:testResources]
[INFO] Using default encoding to copy filtered resources.
[INFO] [compiler:testCompile]
[INFO] Nothing to compile - all classes are up to date
[INFO] [surefire:test]
[INFO] Surefire report directory: D:\java\workspace\malistedecourses\target\surefire-reports
-------------------------------------------------------
 T E S T S
-------------------------------------------------------
There are no tests to run.

Results :
Tests run: 0, Failures: 0, Errors: 0, Skipped: 0

[INFO] [jar:jar]
[INFO] Building jar:
D:\java\workspace\malistedecourses\target\malistedecourses-0.0.1-SNAPSHOT.jar
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 15 seconds
[INFO] Finished at: Fri Jan 02 17:02:09 CET 2009
[INFO] Final Memory: 6M/13M
[INFO] ------------------------------------------------------------------------</pre>
</div>
</div>
<div class="paragraph">
<p>Nous constatons que Maven a compilÃ© nos trois fichiers sources et
construit un fichier JAR, ce qu&#8217;on attendait de lui, mais il a Ã©galement
tentÃ© de copier des Â« ressources Â» et d&#8217;exÃ©cuter des tests, ensemble de
traitements que nous n&#8217;avons spÃ©cifiÃ©s nulle part !</p>
</div>
</div>
<div class="sect2">
<h3 id="La_cle_du_mystere">La clÃ© du mystÃ¨re</h3>
<div class="paragraph">
<p>InterrogÃ© sur le sujet, Jason nous livre la clÃ© du mystÃ¨re : Ant, make
et bon nombre d&#8217;outils similaires sâappuient sur une approche
procÃ©durale, pour laquelle on dÃ©crit les opÃ©rations Ã  accomplir pour
construire le logiciel ou exÃ©cuter des tÃ¢ches annexes. Cela se traduit
donc par une suite de commandes, qui prendra d&#8217;une faÃ§on ou d&#8217;une autre
la forme dÃ©crite Ã  la Figure 01-02.</p>
</div>
<div class="paragraph">
<div class="title">Figure 01-02</div>
<p><span class="image"><img src="illustrations/01-02.png" alt="Figure 2"></span></p>
</div>
<div class="paragraph">
<p>Les Ã©tapes Ã©lÃ©mentaires de construction d&#8217;un projet.</p>
</div>
<div class="paragraph">
<p>Cette approche fonctionne trÃ¨s bien et permet de faire Ã  peu prÃ¨s tout
ce qu&#8217;on veut, mais elle nÃ©cessite :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>de rÃ©pÃ©ter pour chaque nouveau projet une liste de tÃ¢ches trÃ¨s
similaires*, ce qui se traduit souvent par la copie d&#8217;un fichier de
configuration considÃ©rÃ© comme Â« faisant rÃ©fÃ©rence Â» ;</p>
</li>
<li>
<p>de gÃ©rer une liste de dÃ©pendances entre les Ã©tapes clÃ©s*, comme,
dans notre exemple, Â« compiler Â» lorsqu&#8217;on dÃ©sire assembler le JAR.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Maven choisit une approche diffÃ©rente, fondÃ©e sur le constat suivant :
tous les projets Java vont suivre peu ou prou le mÃªme schÃ©ma. Les
dÃ©veloppeurs de Maven considÃ¨rent alors qu&#8217;il est plus simple de dÃ©crire
en quoi un projet est diffÃ©rent de ce Â« scÃ©nario type Â» que de rÃ©pÃ©ter
invariablement des commandes trÃ¨s comparables d&#8217;un projet Ã  l&#8217;autre.
Maven exploite donc le concept trÃ¨s structurant de conventions.</p>
</div>
<div class="sect3">
<h4 id="convention_plutot_que_configuration">Convention plutÃ´t que configuration</h4>
<div class="paragraph">
<p>Notre pseudoexemple rÃ©unissant les Ã©tapes Â« initialiser Â», Â« compiler Â»,
Â« assembler Â» semble s&#8217;appliquer Ã  n&#8217;importe quel projet informatique,
alors pourquoi devons-nous rÃ©pÃ©ter cette dÃ©claration pour chaque
projetÂ ? C&#8217;est exactement la question que soulÃ¨ve Maven et Ã  laquelle il
rÃ©pond simplement : tout projet Java passe par une phase de prÃ©paration,
de compilation puis d&#8217;assemblage. Ces trois phases ne sont pas propres Ã 
un projet, mais liÃ©es au dÃ©veloppement informatique et s&#8217;appliquent Ã 
tous.</p>
</div>
<div class="paragraph">
<p>Maven dÃ©finit donc un scÃ©nario type de construction d&#8217;un projet Java,
avec des Ã©tapes clÃ©s prÃ©dÃ©finies et dont l&#8217;ordre est immuable. Ce Â« cycle
de vie Â» est suffisamment large et consensuel pour Ãªtre applicable Ã 
quasiment tous les projets. En admettant que le nÃ´tre n&#8217;ait rien de
particulier comparÃ© Ã  tous ceux que pilote Maven, nous comprenons mieux
comment celui-ci a Â« devinÃ© Â» les opÃ©rations nÃ©cessaires Ã  sa
construction.</p>
</div>
<div class="paragraph">
<p>Java Entreprise Edition suit Ã©galement cette piste en proposant un
environnement standardisÃ© et un format de livraison commun pour les
applications, mÃªme s&#8217;il existe de nombreux serveurs d&#8217;applications ayant
des caractÃ©ristiques trÃ¨s variÃ©es. Construire une application web Java
consiste Ã  assembler une archive WAR (<em>Web Application Archive</em>), que
l&#8217;on ait choisi JBoss, Webpshere, Tomcat ou Jetty pour l&#8217;exÃ©cuter. Le
comportement par Â« convention Â» d&#8217;une application web est dÃ©fini par une
norme, chaque serveur proposant des options de configuration pour
bÃ©nÃ©ficier d&#8217;un comportement personnalisÃ© lorsque c&#8217;est nÃ©cessaire. Une
convention a, bien sÃ»r, un statut infÃ©rieur Ã  une norme comme JavaEE,
mais elle apporte la mÃªme simplification.</p>
</div>
<div class="paragraph">
<p>La force des conventions est d&#8217;offrir Ã  ceux qui les suivent un outil
directement exploitable, sans configuration complÃ©mentaire. Une
convention de Maven concerne par exemple l&#8217;emplacement des fichiers
sources Java Ã  compiler. Notre fichier pom.xml contient effectivement
une indication sourceDirectory que nous faisons pointer sur le
rÃ©pertoire src. Cette indication n&#8217;aurait pas Ã©tÃ© nÃ©cessaire si nous
avions suivi la convention. Il nous suffit de l&#8217;adopter pour allÃ©ger
d&#8217;autant notre configuration Maven.</p>
</div>
<div class="paragraph">
<p>Nous verrons en dÃ©tail plus loin les diverses conventions prÃ©conisÃ©es
par Maven. Certains trouveront cette structure inutilement complexe, peu
pratique, ou au contraire parfaitement adaptÃ©e Ã  leurs habitudes.
L&#8217;essentiel n&#8217;est pas lÃ , mais dans le fait que Maven propose une
organisation par dÃ©faut, qui peut fonctionner sans plus d&#8217;indications
pour tout projet qui la respecte. La force de Maven est de prÃ©senter une
structure conventionnelle, qui Ã©vite Ã  chacun un travail rÃ©barbatif de
configuration.</p>
</div>
<div class="paragraph">
<p>Maven reposant sur un scÃ©nario type de construction de projet Java, nous
n&#8217;avons plus besoin d&#8217;indiquer la moindre commande. Il nous suffit de
dÃ©crire en quoi notre projet est diffÃ©rent de ce cas stÃ©rÃ©otypÃ©. Nous
passons d&#8217;une approche programmatique Ã  une solution dÃ©clarative.</p>
</div>
</div>
<div class="sect3">
<h4 id="Decrire_plutot_que_programmer">DÃ©crire plutÃ´t que programmer</h4>
<div class="paragraph">
<p>Notre fichier pom.xml de Maven ne compte aucune commande de compilation
et, pourtant, il se traduit finalement par l&#8217;exÃ©cution des outils de
compilation et d&#8217;assemblage du JDK. Maven fait le choix d&#8217;une approche
dÃ©clarative, dans laquelle on indique les particularitÃ©s du projet et
non la maniÃ¨re de le construire. On prÃ©cise l&#8217;emplacement des fichiers
sources, les bibliothÃ¨ques qui sont nÃ©cessaires, plutÃ´t que la ligne de
commande du compilateur.</p>
</div>
<div class="paragraph">
<p>La diffÃ©rence est trÃ¨s significative, car il ne s&#8217;agit plus de dÃ©finir
les options de javac, mais de dÃ©crire une structure plus gÃ©nÃ©rale du
projet, qui pourra Ãªtre exploitÃ©e dans un autre contexte. Elle sera, par
exemple, utilisÃ©e pour s&#8217;intÃ©grer dans un IDE (<em>Integrated Development
Environment</em>) comme Eclipse ou par les outils d&#8217;analyse de code.</p>
</div>
</div>
<div class="sect3">
<h4 id="_pom">POM</h4>
<div class="paragraph">
<p>Avec ces explications, revenons Ã  prÃ©sent sur le fichier pom.xml que
Jason nous a Ã©crit.</p>
</div>
<div class="paragraph">
<p>Tout d&#8217;abord, pourquoi ce nomÂ ? Nous avons vu que ce fichier ne dÃ©crit
pas la procÃ©dure de construction du projet mais qu&#8217;il rassemble des
Ã©lÃ©ments descriptifs. Il est donc logique qu&#8217;il ne s&#8217;appelle pas
build.xml (en dehors du conflit que cela introduirait avec les
utilisateurs d&#8217;Ant).</p>
</div>
<div class="paragraph">
<p>Les trois lettres POM sont en fait l&#8217;acronyme de <em>Project Object Model</em>.
Sa reprÃ©sentation XML est traduite par Maven en une structure de donnÃ©es
riche qui reprÃ©sente le modÃ¨le du projet. Ces dÃ©clarations sont
complÃ©tÃ©es avec l&#8217;ensemble des conventions qui viennent ainsi former un
modÃ¨le complet du projet utilisÃ© par Maven pour exÃ©cuter des
traitements.</p>
</div>
<div class="paragraph">
<p>La premiÃ¨re partie du POM permet d&#8217;identifier le projet lui-mÃªme.</p>
</div>
<div class="listingblock">
<div class="title">Listing 1.5 : L&#8217;en-tÃªte du fichier POM</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;fr.noubliepaslalistedescourses&lt;/groupId&gt;
    &lt;artifactId&gt;noubliepaslalistedescourses&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>L&#8217;Ã©lÃ©ment modelVersion permet de savoir quelle version de la structure
de donnÃ©es Â« modÃ¨le de projet Â» est reprÃ©sentÃ©e dans le fichier XML.
Â« 4.0.0 Â» correspond Ã  la version utilisÃ©e par Maven 2.x dans toutes ses
variantes.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="illustrations/Maven3.png" alt="Maven3"></span></p>
</div>
<div class="paragraph">
<p>Les futures versions de Maven 3 pourront exploiter des versions
diffÃ©rentes de modÃ¨les et introduire des Ã©volutions dans le format de ce
fichier. Entre autres, sont envisagÃ©s :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>lâimport partiel dâautres fichiers POM (Â« mixins Â») permettant de
construire un projet par agrÃ©gation de bonnes pratiques,</p>
</li>
<li>
<p>des mÃ©canismes avancÃ©s de gestion de dÃ©pendance,</p>
</li>
<li>
<p>et tout ce qui pourra sâavÃ©rer utile pour rendre Maven 3.x plus
puissant et encore plus universel !</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>L&#8217;identifiant de groupe (groupId) permet de connaÃ®tre l&#8217;organisation,
l&#8217;entreprise, l&#8217;entitÃ© ou la communautÃ© qui gÃ¨re le projet. Par
convention, on utilise le nom de domaine Internet inversÃ©, selon la mÃªme
logique que celle gÃ©nÃ©ralement recommandÃ©e pour les noms de package
Java.</p>
</div>
<div class="paragraph">
<p>L&#8217;identifiant de composant (artifactId) est le nom unique du projet au
sein du groupe qui le dÃ©veloppe. En pratique et pour Ã©viter des
confusions, il est bon d&#8217;avoir un artifactId unique indÃ©pendamment de
son groupId.</p>
</div>
<div class="paragraph">
<p>Enfin, on prÃ©cise quelle version du projet est considÃ©rÃ©e. La plupart
des projets utilisent la formule &lt;Version Majeure&gt;.&lt;Version
Mineure&gt;.&lt;Correctif&gt;, mÃªme s&#8217;il est difficile d&#8217;obtenir un consensus sur
la signification exacte de ces numÃ©ros et sur leur emploi. Vous pouvez
utiliser une chaÃ®ne arbitraire, mais la syntaxe numÃ©rique permet de
faire des comparaisons de versions et de trier celles-ci pour identifier
automatiquement la plus rÃ©cente. SNAPSHOT est un mot clÃ© rÃ©servÃ© de
Maven, dont nous dÃ©crirons la fonction par la suite.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Le numÃ©ro de version est un concept dÃ©licat et changeant selon les
organisations et la sensibilitÃ© de chacun. Nous vous recommandons une
notation purement numÃ©rique qui facilite les comparaisons, selon la
logique Majeur.Mineur.Correctif. Seules deux versions majeures peuvent
ne pas assurer de compatibilitÃ©, une nouvelle version mineure peut
apporter des fonctionnalitÃ©s inÃ©dites, mais s&#8217;interdit de ne pas
respecter le mode de fonctionnement existant ; enfin, une version
corrective n&#8217;apporte aucune fonctionnalitÃ© nouvelle mais Ã©limine
certains problÃ¨mes.</p>
</div>
<div class="paragraph">
<p>Certains enrichissent cette numÃ©rotation d&#8217;un dernier Ã©lÃ©ment qui
indique le degrÃ© de confiance dans une version donnÃ©e : Â« RC Â» pour une
Release Candidate (version quasi finale), Â« GA Â» pour General Availability
pour une version diffusÃ©e au public. Cet usage peut porter prÃ©judice au
projet car dans la comparaison purement alphabÃ©tique, Â« GA Â» est infÃ©rieur
Ã  Â« RC Â» !</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La deuxiÃ¨me partie du POM concerne la construction du projet :</p>
</div>
<div class="listingblock">
<div class="title">Listing 1.6 : Le bloc build du fichier POM</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;build&gt;
        &lt;sourceDirectory&gt;src&lt;/sourceDirectory&gt;
    &lt;/build&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>L&#8217;approche dÃ©clarative utilisÃ©e par Maven permet de dÃ©finir
l&#8217;emplacement de nos fichiers sources. Le projet Ã©tant Ã  la fois trÃ¨s
simple et trÃ¨s banal, aucune autre dÃ©claration n&#8217;est nÃ©cessaire. Si nous
avions utilisÃ© le rÃ©pertoire conventionnel de Maven pour les fichiers
sources Java, nous n&#8217;aurions mÃªme pas eu besoin de ce bloc &lt;build&gt; !</p>
</div>
<div class="paragraph">
<p>La troisiÃ¨me partie de POM concerne les bibliothÃ¨ques dont dÃ©pend le
projet :</p>
</div>
<div class="listingblock">
<div class="title">Listing 1.7 : Le bloc dependencies du fichier POM</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.mail&lt;/groupId&gt;
            &lt;artifactId&gt;mail&lt;/artifactId&gt;
            &lt;version&gt;1.4&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;commons-io&lt;/groupId&gt;
            &lt;artifactId&gt;commons-io&lt;/artifactId&gt;
            &lt;version&gt;1.4&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Une nouvelle fois, l&#8217;approche dÃ©clarative prend le dessus : nous
n&#8217;indiquons pas l&#8217;emplacement physique de ces bibliothÃ¨ques, Ã  savoir
/lib pour notre projet, mais des identifiants groupId + artifactId<br>
version. Il s&#8217;agit des mÃªmes identifiants de groupe, de composant et de
version, que nous venons de rencontrer, appliquÃ©s Ã  une bibliothÃ¨que.
Nous indiquons, par exemple, que nous utilisons l&#8217;API standard JavaMail
en version 1.4.</p>
</div>
<div class="paragraph">
<p>Nous avons ici une rÃ©ponse partielle Ã  notre question sur la nÃ©cessitÃ©
d&#8217;un accÃ¨s Internet : Maven va tÃ©lÃ©charger les bibliothÃ¨ques indiquÃ©es,
Ã  partir d&#8217;une source fiable, plutÃ´t que de se contenter des fichiers
JAR prÃ©sents dans le rÃ©pertoire /lib et dont la version et l&#8217;origine
sont incertaines. L&#8217;espace contenant l&#8217;ensemble des bibliothÃ¨ques
tÃ©lÃ©chargÃ©es est un dÃ©pÃ´t d&#8217;archives local (<em>local repository</em>) et
respecte une convention. Nous verrons en dÃ©tail au Chapitre 2 les
raisons de cette approche et ses avantages.</p>
</div>
</div>
<div class="sect3">
<h4 id="_pourquoi_adopter_ces_conventions">Pourquoi adopter ces conventionsÂ ?</h4>
<div class="paragraph">
<p>Nous venons de le voir, Maven propose un ensemble de conventions qui
permettent d&#8217;outiller le projet avec peu de configuration. Il ne nous
interdit cependant pas de choisir nos propres conventions, comme le
rÃ©pertoire src pour les sources du logiciel.</p>
</div>
<div class="paragraph">
<p>Dans ce cas, pourquoi adopter les conventions de Maven, alors qu&#8217;il
suffit de quelques lignes de dÃ©claration supplÃ©mentaires pour Â« plier Â»
Maven Ã  nos habitudesÂ ? Hostiles au changement, comme une grande
majoritÃ© des Ãªtres humains, nous prÃ©fÃ©rons cette option.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaEmmanuel.png" alt="MangaEmmanuel"></span></p>
</div>
<div class="paragraph">
<p>C&#8217;est Ã  ce moment qu&#8217;Emmanuel se propose de nous rejoindre, lui aussi Ã 
temps perdu grÃ¢ce Ã  son boulot en or, pour enrichir notre projet d&#8217;un
grand nombre de nouvelles fonctionnalitÃ©s. Emmanuel est dÃ©jÃ  habituÃ© Ã 
Maven et peut donc Ãªtre rapidement productif et nous aider Ã  le
configurer correctement. Seulement, les choses ne se passent pas aussi
simplement que prÃ©vu, car malgrÃ© son expÃ©rience de l&#8217;outil, Emmanuel ne
retrouve pas ses petits : pour ajouter des tests Ã  notre architecture,
il doit crÃ©er un nouveau rÃ©pertoire de sources, indÃ©pendant de celles du
projet. Or notre rÃ©pertoire src n&#8217;a qu&#8217;un seul niveau et ne permet pas
de diffÃ©rencier le livrable des tests. Il est donc obligÃ© de dÃ©clarer
une nouvelle dÃ©rogation aux conventions de Maven.</p>
</div>
<div class="paragraph">
<p>Par ailleurs, mÃªme si les diffÃ©rences sont minimes, il est contraint
d&#8217;adapter toutes ses petites habitudes Ã  notre structure de rÃ©pertoire,
qui n&#8217;est pas Â« strictement conforme Maven Â».</p>
</div>
<div class="paragraph">
<p>Les conventions de Maven ne sont pas obligatoires, cependant
rÃ©flÃ©chissez Ã  deux fois avant de vouloir en imposer d&#8217;autres pour votre
projet. D&#8217;une part, vous allez vous compliquer inutilement la tÃ¢che en
ne profitant pas du comportement par dÃ©faut que propose Maven, et chaque
nouvelle option activÃ©e pourra se traduire par une nouvelle phase de
configuration. Ã moins d&#8217;Ãªtre passionnÃ©s par l&#8217;Ã©diteur XML, peu de
dÃ©veloppeurs prennent du plaisir Ã  perdre un temps prÃ©cieux dans des
fichiers de configuration, Maven ou autres.</p>
</div>
<div class="paragraph">
<p>Ensuite, pensez Ã  la gestion de vos Ã©quipes et Ã  l&#8217;intÃ©gration de
nouveaux dÃ©veloppeurs. Maven offre l&#8217;occasion de dÃ©finir une fois pour
toutes la structure de tous vos projets Java, de maniÃ¨re homogÃ¨ne. Un
dÃ©veloppeur pourra passer d&#8217;un projet Ã  un autre sans perdre son temps Ã 
apprendre les petites habitudes locales : oÃ¹ sont les fichiers de
configurationÂ ? Dans quel rÃ©pertoire place-t-on les donnÃ©es de test ?
Tous les projets qui se conforment aux conventions Maven seront
identiques de ce point de vue, et le dÃ©veloppeur sera plus rapidement
productif.</p>
</div>
<div class="paragraph">
<p>Enfin, contrairement Ã  une politique Â« maison Â» qui aurait pu Ã©tablir ce
type de conventions, celles de Maven sont partagÃ©es par la majoritÃ© des
dÃ©veloppeurs qui ont adoptÃ© ce logiciel. Tout nouveau membre de votre
Ã©quipe qui a dÃ©jÃ  travaillÃ© sur un projet Maven trouvera rapidement ses
repÃ¨res. Maven et ses conventions deviennent au fil des annÃ©es le
standard <em>de facto</em> dans le monde professionnel Java, car un dÃ©veloppeur
trouve immÃ©diatement ses marques lorsqu&#8217;il aborde un nouveau projet.</p>
</div>
<div class="paragraph">
<p>La force des conventions de Maven n&#8217;est pas dans le nom des rÃ©pertoires
qui ont Ã©tÃ© choisis, mais dans le fait qu&#8217;il offre Ã  la communautÃ© des
dÃ©veloppeurs Java tout entiÃ¨re une base commune.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_la_force_de_maven">La force de Maven</h3>
<div class="paragraph">
<p>Revenons un peu en arriÃ¨re : le projet initial, que nous pouvons
considÃ©rer comme un prototype, Ã©tait difficilement exportable en dehors
de l&#8217;environnement de son crÃ©ateur. Il nÃ©cessitait un script de
compilation Ã  la fois indispensable et sans grande valeur ajoutÃ©e, Ã©tant
d&#8217;une grande banalitÃ©.</p>
</div>
<div class="paragraph">
<p>L&#8217;adoption d&#8217;Ant aurait pu partiellement rÃ©soudre le problÃ¨me, mais pour
tirer parti de la richesse des outils qui peuvent lui Ãªtre greffÃ©s, il
aurait fallu que tous les scripts Ant adoptent une structure de base
commune. En l&#8217;absence d&#8217;une convention dans la communautÃ© Ant pour les
Ã©lÃ©ments principaux qui gouvernent un projet Java, il peut Ãªtre
extrÃªmement dÃ©licat de rÃ©utiliser et de fusionner des Ã©lÃ©ments provenant
de sources indÃ©pendantes. Enfin, tout ce travail aurait Ã©tÃ© rÃ©alisÃ© par
des copier-coller qu&#8217;il aurait fallu rÃ©pÃ©ter pour notre prochain projet.</p>
</div>
<div class="paragraph">
<p>Maven propose de passer Ã  une approche dÃ©clarative, dans laquelle nous
considÃ©rerons notre projet comme une variation sur un thÃ¨me commun. Nous
ne nous soucions plus de savoir quelle opÃ©ration doit suivre quelle
autre lors de la construction du logiciel. Nous dÃ©clarons juste les
quelques Ã©lÃ©ments spÃ©cifiques qui font de notre projet quelque chose
d&#8217;unique.</p>
</div>
<div class="paragraph">
<p>En adoptant des conventions, nous rÃ©duisons Ã  quelques lignes les
informations que nous devons dÃ©clarer pour que le projet soit pris en
charge par Maven. La maintenance et l&#8217;ajout de nouvelles tÃ¢ches au cours
de la construction du projet s&#8217;en trouvent simplifiÃ©s. Un dÃ©veloppeur,
issu d&#8217;un contexte trÃ¨s diffÃ©rent mais dÃ©jÃ  utilisateur de l&#8217;outil, peut
prendre le projet en main sans difficultÃ© particuliÃ¨re.</p>
</div>
<div class="paragraph">
<p>La combinaison de conventions et d&#8217;une approche innovante fondÃ©e sur la
description du projet fait de Maven un outil Ã  part, trÃ¨s diffÃ©rent
d&#8217;Ant ou de ses Ã©quivalents. Au cours des chapitres qui suivent, nous
allons voir en quoi cette approche se gÃ©nÃ©ralise Ã  toutes les tÃ¢ches qui
accompagnent la vie d&#8217;un projet.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Au_dela_de_java.lang">Chapitre 2 : Au-delÃ  de java.lang</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_des_jar_sous_cvs">Des JAR sous CVS</h3>
<div class="paragraph">
<p>Avec une Ã©quipe qui se compose dÃ©sormais de cinq dÃ©veloppeurs motivÃ©s,
il n&#8217;est plus question de s&#8217;envoyer par e-mail des archives du projet
pour transmettre aux autres les nouvelles fonctions que l&#8217;on vient de
dÃ©velopper. Un projet en mode collaboratif utilise un outil de gestion
de sources pour partager le code, synchroniser les dÃ©veloppements et
gÃ©rer les conflits lorsque deux personnes travaillent sur le mÃªme
fichier. Ce gestionnaire de sources (SCM â <em>Source Control Management</em>)
est typiquement CVS (<em>Concurrent Version System</em>), Subversion ou, plus
rÃ©cemment, Git.</p>
</div>
<div class="paragraph">
<p>Comme son nom l&#8217;indique, cet outil est prÃ©vu pour contenir des fichiers
sources et non des binaires issus d&#8217;une compilation. Pourtant, de
nombreux projets placent les bibliothÃ¨ques et les outils nÃ©cessaires au
projet dans leur gestionnaire de sources. L&#8217;idÃ©e peut sembler bonne <em>a
priori</em>, car elle vise Ã  gÃ©rer avec un unique outil et, de maniÃ¨re
homogÃ¨ne, tous les Ã©lÃ©ments nÃ©cessaires au dÃ©veloppement du projet.
Sauvegarder les bibliothÃ¨ques Java dans le SCM est donc une garantie de
retrouver Ã  tout moment la version exacte qui est utilisÃ©e par le
projet.</p>
</div>
<div class="paragraph">
<p>Notre prototype ne dÃ©roge pas Ã  cette Â«Â bonne idÃ©eÂ Â» et possÃ¨de comme tant
d&#8217;autres un rÃ©pertoire lib avec l&#8217;ensemble des bibliothÃ¨ques utilisÃ©es.</p>
</div>
<div class="sect3">
<h4 id="Quand_le_repertoire_lib_explose">Quand le rÃ©pertoire lib explose</h4>
<div class="paragraph">
<p>La croissance de l&#8217;Ã©quipe nous permet de rapidement amÃ©liorer notre
prototype. Le nombre de bibliothÃ¨ques nÃ©cessaires au projet augmente.
Nous commenÃ§ons par introduire Spring pour rendre le code plus Ã©volutif
avec l&#8217;utilisation des concepts de l&#8217;injection de dÃ©pendances. Ensuite,
nous remplaÃ§ons tout le code Ã©crit en JDBC par Hibernate et Java
Persistence API. Nous dÃ©veloppons une interface web sympathique basÃ©e
sur Wicket et, enfin, nous faisons appel Ã  Apache CXF pour exposer nos
services Ã  d&#8217;autres applications sous forme de services web.</p>
</div>
<div class="paragraph">
<p>Le nombre de bibliothÃ¨ques croÃ®t exponentiellement car, au-delÃ  de la
gestion de celles que nous utilisons explicitement au sein du projet, il
faut gÃ©rer toutes les bibliothÃ¨ques qui leur sont nÃ©cessaires.
Rapidement, le rÃ©pertoire lib se retrouve chargÃ© de dizaines de fichiers
JAR avec des noms plus ou moins hÃ©tÃ©roclites.</p>
</div>
<div class="paragraph">
<p>Les choses se compliquent alors significativement et la moindre mise Ã 
jour d&#8217;une bibliothÃ¨que relÃ¨ve d&#8217;un casse-tÃªte chinois.</p>
</div>
<div class="paragraph">
<p>D&#8217;une part, cette pratique encourage Ã  utiliser ces bibliothÃ¨ques telles
quelles, sans chercher Ã  s&#8217;assurer de leur origine ou de la fiabilitÃ© de
leur tÃ©lÃ©chargement. Comme il est dÃ©licat de comparer deux versions d&#8217;un
fichier binaire, il nous est impossible de savoir en quoi notre fichier
util.jar diffÃ¨re de celui utilisÃ© sur un autre projet comparable, dont
nous voulons importer des classes intÃ©ressantes. MÃªme si ces deux
fichiers portent le mÃªme nom et ont la mÃªme taille, cela ne signifie pas
qu&#8217;ils soient identiques. Seule une comparaison binaire pourrait nous en
assurer.</p>
</div>
<div class="paragraph">
<p>Autant dire qu&#8217;avec les dizaines de bibliothÃ¨ques embarquÃ©es dans notre
projet, plus personne ne fait scrupuleusement cette vÃ©rification, et nous
nous contentons de lire le nom de l&#8217;archive mail-1.2.jar pour identifier
la bibliothÃ¨que JavaMail.</p>
</div>
<div class="paragraph">
<p>Cela nous amÃ¨ne Ã  un second problÃ¨me possible. Supposons que cette
bibliothÃ¨que ait Ã©tÃ© corrompue lors de son tÃ©lÃ©chargement depuis le site
de SUN qui la diffuse ou de son enregistrement dans notre SCM. Un
transfert rÃ©seau n&#8217;est jamais 100 % garanti, et un seul bit modifiÃ© peut
rendre la bibliothÃ¨que inutilisable, sans parler de ces charmants petits
virus qui peuvent traÃ®ner un peu partout. L&#8217;identification du problÃ¨me
peut Ãªtre extrÃªmement complexe, car la remise en cause de la
bibliothÃ¨que sera probablement la toute derniÃ¨re hypothÃ¨se que nous
Ã©voquerons pour justifier un dysfonctionnement.</p>
</div>
<div class="sect4">
<h5 id="Un_bogue_est_detecte">Un bogue est dÃ©tectÃ©</h5>
<div class="paragraph">
<p>AprÃ¨s quelques heures de tests et de recherche d&#8217;informations sur
Internet, nous devons nous rendre Ã  l&#8217;Ã©vidence, nous rencontrons un
bogue connu de la bibliothÃ¨que JavaMail utilisÃ©e sur le projet. Seule
solution viableÂ :Â la mise Ã  jour de cette bibliothÃ¨que dans une version
plus rÃ©cente.</p>
</div>
<div class="paragraph">
<p>Le tÃ©lÃ©chargement de la distribution JavaMail depuis le site de
SUN <sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnotedef_6" title="View footnote.">6</a>]</sup> donne un fichier ZIP contenant Ã  la fois les
binaires et la documentation de cette APIÂ ;Â les**binaires, car JavaMail
regroupe en fait plusieurs archives JAR, Ã  savoir mail.jar, mais aussi
mailapi.jar. La premiÃ¨re contient l&#8217;ensemble du code public JavaMail
alors que la seconde ne comprend que les API de programmation, et pas la
gestion des protocoles de transfert de messages (pop, smtp, imapâ¦) qui
sont optionnels. Lequel utilisons-nous actuellementÂ ? Par quoi le
remplacerÂ ?</p>
</div>
<div class="paragraph">
<p>En supposant que nous sachions rÃ©pondre sans ambiguÃ¯tÃ© Ã  cette question,
nous devons supprimer le mail-1.2.jar utilisÃ© jusqu&#8217;ici et ajouter le
nouveau mail-1.4.1.jar. Cela nous impose de modifier tous nos scripts de
gestion du projet (scripts de compilation et de lancement, fichiers de
configuration Eclipse, NetBeans ou IntelliJ Ideaâ¦) pour tenir compte de
ce changement, avec le risque d&#8217;introduire, par mÃ©garde, des erreurs. Ce
simple changement nous oblige donc Ã  la fois Ã  faire preuve de beaucoup
de soin et Ã  vÃ©rifier le fonctionnement de nos scripts.</p>
</div>
<div class="paragraph">
<p>Pour Ã©viter ces risques, une seconde option consiste Ã  ne pas indiquer
de numÃ©ro de version pour les bibliothÃ¨ques. Nous utilisons le nom de
fichier mail.jar et le remplaÃ§ons purement et simplement par le nouveau
fichier en cas de mise Ã  jour. Ayons alors une pensÃ©e compatissante pour
les Ã©quipes de maintenance qui, dans quelques annÃ©es, devront deviner la
version exacte des bibliothÃ¨ques utilisÃ©es sur notre projet, dont
certaines seront devenues plus ou moins obsolÃ¨tes et connues pour
certains bogues graves. Le problÃ¨me devient encore plus complexe
lorsqu&#8217;on doit utiliser une version modifiÃ©e d&#8217;une bibliothÃ¨que, par
exemple parce qu&#8217;on y a intÃ©grÃ© un correctif qui n&#8217;est pas encore pris
en compte dans une version officielle.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Le format d&#8217;archive JAR prÃ©voit un fichier de mÃ©tadonnÃ©es,
META-INF/MANIFEST.MF, dÃ©crivant thÃ©oriquement la bibliothÃ¨que, et en
particulier sa version prÃ©cise. Celle-ci est cependant rÃ©guliÃ¨rement non
documentÃ©e lorsque ce fichier MANIFEST n&#8217;est pas tout simplement absent
ou quasiment vide.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_lib_jar">lib/*.jar</h5>
<div class="paragraph">
<p>Pour ne plus rencontrer ce problÃ¨me, nous dÃ©cidons Â«Â d&#8217;assouplirÂ Â» nos
scripts de compilation en utilisant l&#8217;intÃ©gralitÃ© du rÃ©pertoire lib
comme chemin d&#8217;accÃ¨s aux classes, plutÃ´t qu&#8217;une liste explicite de
bibliothÃ¨ques. Placer une nouvelle bibliothÃ¨que dans ce rÃ©pertoire ou en
remplacer une par une autre version ne nÃ©cessitera alors aucune
modification des scripts.</p>
</div>
<div class="paragraph">
<p>Ce qui pourrait ressembler Ã  la solution miracle n&#8217;est pas aussi parfait
qu&#8217;il y paraÃ®t. D&#8217;abord, cela ne rÃ©sout pas la configuration de notre
environnement de dÃ©veloppement qui continue de rÃ©clamer une liste
prÃ©cise de bibliothÃ¨ques Ã  inclure dans le ClassPath. Ensuite, une
manipulation malheureuse de nos fichiers JAR ne se verra pas
immÃ©diatement â un glisser-dÃ©poser est si vite arrivÃ©Â ! Il faudra
attendre qu&#8217;elle ait un impact visible pour devoir ensuite remonter Ã 
l&#8217;origine du problÃ¨me.</p>
</div>
<div class="paragraph">
<p>Enfin, ce n&#8217;est pas une solution d&#8217;une grande Ã©lÃ©gance. Pour Ã©viter de
devoir traiter le problÃ¨me, nous avons ouvert les portes en grand Ã  tout
ce qui passe. Difficile de parler de Â«Â maÃ®triseÂ Â» de nos bibliothÃ¨ques
dans de telles conditions.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_identification_univoque">Identification univoque</h4>
<div class="paragraph">
<p>Maven propose une approche Ã  l&#8217;opposÃ© de ces pratiques hasardeuses. Il
se focalise sur l&#8217;identification exacte des bibliothÃ¨ques utilisÃ©es. Des
rÃ©fÃ©rentiels de bibliothÃ¨ques sur Internet lui sont dÃ©diÃ©s et permettent
de tÃ©lÃ©charger les bibliothÃ¨ques prÃ©cises, utilisÃ©es dans le projet,
sans ambiguÃ¯tÃ©. Les risques d&#8217;erreur de transfert sont Ã©liminÃ©s par un
contrÃ´le automatique basÃ© sur des fonctions de hachage (une sorte
d&#8217;empreinte digitale du binaire, qui sera invalidÃ©e au moindre bit
diffÃ©rent).</p>
</div>
<div class="paragraph">
<p>L&#8217;identification d&#8217;une bibliothÃ¨que utilisÃ©e par un projet sâappuie sur
un triplet (identifiant de groupe, identifiant d&#8217;artefact,
version prÃ©cise), lequel est construit sur le mÃªme principe que celui
que nous avons dÃ©clarÃ© pour notre projet. Dans le fichier POM de Jason,
nous rÃ©fÃ©renÃ§ons l&#8217;artefact mail de la bibliothÃ¨que standard javaMail
dans sa version 1.4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;dependency&gt;
      &lt;groupId&gt;javax.mail&lt;/groupId&gt;
      &lt;artifactId&gt;mail&lt;/artifactId&gt;
      &lt;version&gt;1.4&lt;/version&gt;
    &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Il n&#8217;y a ici aucune Ã©quivoque possible. Toute autre variante de JavaMail
possÃ©dera dans le dÃ©pÃ´t Maven un numÃ©ro de version diffÃ©rent. Si nous
devions nous-mÃªmes appliquer un correctif, nous devrions utiliser un
numÃ©ro de version adÃ©quat, comme 1.4-patch-1234. Dans ce cas, cette
bibliothÃ¨que modifiÃ©e serait placÃ©e dans notre dÃ©pÃ´t privÃ©, comme nous
le verrons au Chapitre 6.</p>
</div>
<div class="paragraph">
<p>Notre projet inclut Ã©galement une mystÃ©rieuse bibliothÃ¨que util.jar.
Nicolas ne se souvient pas du tout de l&#8217;origine de ce fichier. Les
Ã©quipes de maintenance, confrontÃ©es Ã  ce cas de figure, auraient du fil
Ã  retordre. Comment gÃ©rer une mise Ã  niveau ou un bogue rencontrÃ© dans
la bibliothÃ¨que considÃ©rÃ©e si on est incapable de l&#8217;identifier avec
prÃ©cisionÂ ?</p>
</div>
<div class="paragraph">
<p>Dans le contenu de cette archive Java, les packages utilisÃ©s,
org.apache.commons.io, nous mettent sur la piste, et c&#8217;est ce qui a
inspirÃ© Ã  Jason la dÃ©claration d&#8217;une dÃ©pendance vers Apache Commons-io.
Cependant, il pourrait s&#8217;agir d&#8217;une version modifiÃ©e, pour une
quelconque raison, avec je ne sais quel impact possible sur
l&#8217;application.</p>
</div>
<div class="paragraph">
<p>L&#8217;identification exacte rÃ©clamÃ©e par Maven oblige Ã  prÃ©ciser quelle
version est utilisÃ©e et Ã  dÃ©finir des numÃ©ros de version pour chaque
variante de la bibliothÃ¨que ou version modifiÃ©e que l&#8217;on voudrait
utiliser.</p>
</div>
<div class="paragraph">
<p>Ajouter une bibliothÃ¨que Ã  un projet Maven se traduit simplement par
l&#8217;ajout d&#8217;un bloc &lt;dependency&gt; comparable Ã  notre exemple, identifiant
sans Ã©quivoque notre intention. Pas de script Ã  Ã©diter, pas de fichier
JAR Ã  tÃ©lÃ©charger et donc pas de validation du fichier tÃ©lÃ©chargÃ©Â ;Â pas
de rÃ©pertoire de bibliothÃ¨ques Ã  modifier, avec les risques d&#8217;erreur de
synchronisation qui en dÃ©couleraient. Mettre Ã  jour une bibliothÃ¨que
consiste tout simplement Ã  modifier l&#8217;information de version qui lui est
associÃ©e.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Les bibliothÃ¨ques standard de Java sont hÃ©bergÃ©es par SUN et devraient
donc Ãªtre placÃ©es sous le groupe com.sun.java. Elles ne peuvent
cependant pas Ãªtre considÃ©rÃ©es comme des fournitures appartenant Ã  cet
Ã©diteur. Aussi, la convention pour ce cas particulier veut qu&#8217;on utilise
le nom de package javax.* qui caractÃ©rise ces API. Par ailleurs, il
existe de nombreuses exceptions pour des raisons historiques liÃ©es Ã  la
premiÃ¨re mouture de Maven.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Depot_de_bibliotheques">DÃ©pÃ´t de bibliothÃ¨ques</h4>
<div class="paragraph">
<p>La configuration par dÃ©faut de Maven utilise le dÃ©pÃ´t (ou <em>rÃ©fÃ©rentiel</em>)
de bibliothÃ¨ques <a href="http://repo1.maven.org/maven2/" class="bare">http://repo1.maven.org/maven2/</a>. Ce site, maintenu par
la communautÃ© Maven, compte plusieurs dizaines de gigaoctets de
bibliothÃ¨ques libres de diffusion, et il est mis Ã  jour plusieurs fois par
jour. Nous verrons au fil des prochains chapitres comment utiliser
d&#8217;autres dÃ©pÃ´ts et en construire un pour nos besoins propres.</p>
</div>
<div class="paragraph">
<p>Ã partir de notre dÃ©claration de dÃ©pendance, Maven va construire l&#8217;URL
du sous-rÃ©pertoire dÃ©diÃ© Ã  la bibliothÃ¨que indiquÃ©eÂ :</p>
</div>
<div class="paragraph">
<p>&lt;URL du dÃ©pÃ´t&gt; / &lt;groupId en tant que chemin&gt; / &lt;artifactId&gt; / &lt;version&gt;</p>
</div>
<div class="paragraph">
<p>Pour notre dÃ©pendance Ã  JavaMail, nous obtenonsÂ :Â <a href="http://repo1.maven.org/maven2/javax/mail/mail/1.4/" class="bare">http://repo1.maven.org/maven2/javax/mail/mail/1.4/</a>.</p>
</div>
<div class="paragraph">
<div class="title">Figure 02-01</div>
<p><span class="image"><img src="illustrations/02-01.png" alt="02 01"></span></p>
</div>
<div class="paragraph">
<p>Le sous-rÃ©pertoire dÃ©diÃ© Ã  JavaMail 1.4 sur le dÃ©pÃ´t de bibliothÃ¨ques.</p>
</div>
<div class="paragraph">
<p>En plus du fichier JAR de la bibliothÃ¨que attendue, nous trouvons de
nombreux autres fichiers dans ce rÃ©pertoireÂ :Â </p>
</div>
<div class="ulist">
<ul>
<li>
<p>chaque fichier prÃ©sent est accompagnÃ© de deux partenaires, avec
respectivement l&#8217;extension .md5 et .sha. Il s&#8217;agit des empreintes de
contrÃ´le associÃ©es au fichier, que Maven exploitera pour s&#8217;assurer que
le fichier n&#8217;a subi aucune altÃ©ration au cours du tÃ©lÃ©chargementÂ ;</p>
</li>
<li>
<p>un fichier porte le mÃªme nom que la bibliothÃ¨que avec le suffixe
-sources. Il s&#8217;agit, comme on pourrait s&#8217;en douter, d&#8217;une archive des
sources Java de la bibliothÃ¨que, ce qui pourra se montrer fort utile
depuis votre environnement de dÃ©veloppement intÃ©grÃ© prÃ©fÃ©rÃ© pour
utiliser un dÃ©bogueur et parcourir le code de cette bibliothÃ¨que. Il
pourrait Ã©galement y avoir un autre fichier avec le suffixe -javadoc
contenant la documentation technique de la bibliothÃ¨queÂ ;</p>
</li>
<li>
<p>un autre fichier ayant le mÃªme nom que la bibliothÃ¨que avec
l&#8217;extension .pom. Il s&#8217;agit bien de l&#8217;acronyme du <em>Project Object Model</em>
que nous connaissons dÃ©jÃ . Chaque bibliothÃ¨que dans le dÃ©pÃ´t Maven
possÃ¨de un fichier de ce type. Soit parce que la bibliothÃ¨que a Ã©tÃ©
dÃ©veloppÃ©e en utilisant Maven, soit parce qu&#8217;un fichier minimal a Ã©tÃ©
Ã©crit pour fournir une description de la bibliothÃ¨que aux utilisateurs
de MavenÂ ;</p>
</li>
<li>
<p>un fichier de mÃ©tadonnÃ©es, propre Ã  Maven comme son nom l&#8217;indique
clairement.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Avis_aux_amateurs_de_casse_tete">Avis aux amateurs de casse-tÃªte</h3>
<div class="paragraph">
<p>Notre projet, issu d&#8217;un code antÃ©diluvien auquel chacun est venu
apporter sa contribution, est constituÃ© de bric et de broc. Le
rÃ©pertoire lib devient un sacrÃ© fourre-tout, et c&#8217;est rÃ©ellement
compliquÃ© de savoir pour quelle raison nous avons dÃ» introduire
commons-net-1.3.jar dans le projet. Aucune de nos classes ne fait
rÃ©fÃ©rence Ã  ce packageÂ !</p>
</div>
<div class="paragraph">
<p>Lorsqu&#8217;on fait appel Ã  une bibliothÃ¨que pour prendre en charge certaines
fonctions techniques, il est rare qu&#8217;elle se suffise Ã  elle-mÃªme. Au
mÃªme titre que notre projet, elle fait appel Ã  d&#8217;autres bibliothÃ¨ques
spÃ©cialisÃ©es pour lui fournir des composants de haut niveau qui lui
facilitent la tÃ¢che. Sa documentation prÃ©cise, bien Ã©videmment, les
prÃ©requis, ce qui nous a permis lors de son introduction dans le projet
de connaÃ®tre la liste de bibliothÃ¨ques Ã  ajouter pour avoir un ensemble
fonctionnel. Certaines Ã©taient dÃ©jÃ  intÃ©grÃ©es, et il a fallu nous
assurer que la version demandÃ©e Ã©tait compatible avec celle que nous
utilisions et, Ã©ventuellement, faire la mise Ã  jour qui s&#8217;imposait.</p>
</div>
<div class="paragraph">
<p>Les bibliothÃ¨ques de haut niveau, telles que le framework Spring,
introduisent dans le projet un nombre important de bibliothÃ¨ques. Les
choses se compliquent lorsqu&#8217;on dÃ©sire changer de version pour profiter
de nouvelles fonctionnalitÃ©s ou d&#8217;un correctif. Nous devons retracer Ã 
la main la chaÃ®ne complÃ¨te des bibliothÃ¨ques pour identifier ce qui a
changÃ©, en nous fondant sur la documentation respective de chaque
bibliothÃ¨que rencontrÃ©e pour connaÃ®tre ses prÃ©requis et ses Ã©ventuelles
incompatibilitÃ©s.</p>
</div>
<div class="paragraph">
<p>Pour nous Ã©pargner une migraine, les dÃ©veloppeurs de bibliothÃ¨ques ont
heureusement pris la bonne habitude de ne jamais briser la compatibilitÃ©
avec les versions prÃ©cÃ©dentes sans un avertissement visible. La pratique
la plus courante consiste Ã  utiliser le numÃ©ro de version et Ã  passer Ã 
une version Â«Â majeureÂ Â» supÃ©rieure. Entre la version 1.4 et la
version 2.0, il est assez probable que des modifications lourdes ont Ã©tÃ©
apportÃ©es, limitant fortement la compatibilitÃ©, ce qui justifie le
changement de version. Par contre, nous pouvons Ãªtre plus confiants dans
une migration vers une 1.4.2 ou une 1.5, et relÃ¢cher (dans la limite du
raisonnable) notre surveillance pour passer d&#8217;une 1.4.2 Ã  une 1.4.3.</p>
</div>
<div class="paragraph">
<p>MalgrÃ© cette pratique courante, la gestion de la chaÃ®ne de dÃ©pendances
entre bibliothÃ¨ques peut devenir rÃ©ellement complexe, si on ne veut
oublier personne en route. L&#8217;absence d&#8217;une bibliothÃ¨que peut provoquer
des erreurs non Ã©videntes et qui n&#8217;apparaÃ®tront pas nÃ©cessairement au
premier dÃ©marrage de l&#8217;application. Quant Ã  lire attentivement la
documentation de chaque bibliothÃ¨que, aucun dÃ©veloppeur ne trouve le
courage de le faire systÃ©matiquement.</p>
</div>
<div class="paragraph">
<p>La plupart du temps, on se contente donc de prendre la distribution
binaire de la bibliothÃ¨que et de fusionner son rÃ©pertoire lib avec celui
du projet, en tentant d&#8217;identifier les doublons. MÃªme si cela fonctionne
relativement bien dans de nombreux cas, il est certain qu&#8217;on part au
petit bonheur la chance en espÃ©rant ne rien laisser traÃ®ner en route.</p>
</div>
<div class="sect3">
<h4 id="_lami_de_mon_ami">L&#8217;ami de mon amiâ¦</h4>
<div class="paragraph">
<p>Que propose Maven pour cette situationÂ ? Nous avons vu qu&#8217;il nous demande de
dÃ©clarer les dÃ©pendances plutÃ´t que de fournir nous-mÃªmes les binairesÂ ;
aussi, notre derniÃ¨re option â prendre la distribution telle quelle et
la fusionner avec notre rÃ©pertoire lib â n&#8217;est pas applicable. Maven
va-t-il nous obliger Ã  Ã©plucher la documentation de chaque bibliothÃ¨que
utilisÃ©eÂ ?</p>
</div>
<div class="paragraph">
<p>Maven est autrement plus subtilÂ :Â jetez un coup d&#8217;Åil quelques pages en
arriÃ¨re, sur le contenu du rÃ©pertoire lib de notre projet initialÂ :Â </p>
</div>
<div class="listingblock">
<div class="content">
<pre>    \lib
       \mail.jar
       \activation.jar
       \util.jar</pre>
</div>
</div>
<div class="paragraph">
<p>Nous utilisons trois bibliothÃ¨ques, la premiÃ¨re est l&#8217;API JavaMail, la
deuxiÃ¨me le Bean Activation Framework, nÃ©cessaire au bon fonctionnement
de JavaMail, et enfin le mystÃ©rieux util.jar qui s&#8217;est avÃ©rÃ© Ãªtre Apache
commons-io. Le fichier POM.xml ne compte que deux entrÃ©es &lt;dependency&gt;,
lÃ  oÃ¹ notre projet nÃ©cessite trois bibliothÃ¨ques. Jason aurait-il Ã©tÃ© un
peu trop viteÂ ?</p>
</div>
<div class="paragraph">
<p>Si vous jetez Ã  nouveau un Åil aux traces de tÃ©lÃ©chargement dont Maven
nous a abreuvÃ© au premier lancement, vous constaterez qu&#8217;il tÃ©lÃ©charge
Ã  la fois des fichiers POM et des fichiers JAR â comme s&#8217;il ne
tÃ©lÃ©chargeait pas dÃ©jÃ  assez de chosesÂ !</p>
</div>
<div class="paragraph">
<p>Ces fichiers POM, au mÃªme titre que celui de notre projet, dÃ©crivent les
bibliothÃ¨ques auxquelles ils sont associÃ©s. Pour JavaMail, l&#8217;archive
mail-1.4.jar est ainsi accompagnÃ©e d&#8217;un mail-1.4.pom. Il s&#8217;agit bien
d&#8217;un fichier Project Object Model, au mÃªme format XML que pour notre
projet et qui comprend des dÃ©clarations comparables, en particulier des
dÃ©pendances. C&#8217;est ici qu&#8217;est indiquÃ© le lien entre JavaMail et le Bean
Activation Framework. Cela permet Ã  Maven de savoir que tout projet qui
utilisera l&#8217;API JavaMail aura nÃ©cessairement besoin du JAR Activation.
Si celui-ci a aussi des dÃ©pendances, la chaÃ®ne se poursuivra, jusqu&#8217;Ã  ce
qu&#8217;un graphe complet de bibliothÃ¨ques interdÃ©pendantes soit construit.</p>
</div>
<div class="paragraph">
<p>On parle, pour ces donnÃ©es qui dÃ©crivent la bibliothÃ¨que, de
Â«Â mÃ©tadonnÃ©esÂ Â». Il s&#8217;agit d&#8217;une version compacte et normalisÃ©e au format
POM des informations que nous aurions pu obtenir en lisant la
documentation de la bibliothÃ¨queÂ : sa licence, le site web qui
l&#8217;hÃ©berge, et ses prÃ©requis. L&#8217;exploitation automatisÃ©e de ces donnÃ©es
permet Ã  Maven de construire l&#8217;arbre des dÃ©pendances du projet, chaque
nouvelle feuille pouvant, par ses propres mÃ©tadonnÃ©es, introduire de
nouvelles branches.</p>
</div>
<div class="paragraph">
<div class="title">Figure 02-02</div>
<p><span class="image"><img src="illustrations/02-02.png" alt="02 02"></span></p>
</div>
<div class="paragraph">
<p>Arbre de dÃ©pendances transitives.</p>
</div>
<div class="paragraph">
<p>Cet arbre, extrÃªmement difficile Ã  construire Ã  la main et douloureux Ã 
maintenir, est analysÃ© automatiquement par Maven Ã  chaque exÃ©cution. Il
s&#8217;assure que l&#8217;ensemble des bibliothÃ¨ques nÃ©cessaires est prÃ©sent et il
construit ainsi le chemin de classes utilisÃ© par le compilateur. Maven
va Ã©galement gÃ©rer les problÃ¨mes de conflit de versions, lorsque l&#8217;arbre
fait apparaÃ®tre plusieurs fois la mÃªme bibliothÃ¨que dans des versions
diffÃ©rentes. Le mÃ©canisme utilisÃ© est cependant limitÃ© par la libertÃ©
laissÃ©e aux numÃ©ros de versions qui rend dÃ©licate une comparaison 100 %
dÃ©terministe.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>L&#8217;algorithme de rÃ©solution des conflits se fonde sur le principe de
Â«Â proximitÃ©Â Â»Â : Maven compte, dans l&#8217;arbre des dÃ©pendances, combien de
branches sÃ©parent la bibliothÃ¨que du projetÂ ; celle qui est dÃ©clarÃ©e au
plus prÃ¨s gagne. En cas d&#8217;Ã©galitÃ©, lâordre de dÃ©claration des dÃ©pendances
dÃ©termine le vainqueurÂ :Â la premiÃ¨re dÃ©claration dans lâordre du POM
gagne. Ce comportement a Ã©tÃ© figÃ© avec Maven 2.0.9 (les versions
prÃ©cÃ©dentes Ã©taient non dÃ©terministes sur ce point, si vous les utilisez
encore, mettez Ã  jour en urgence votre boite Ã  outilsÂ !</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Cette derniÃ¨re fonctionnalitÃ© finit par nous convaincre dÃ©finitivement.
Aussi, nous abandonnons nos diffÃ©rents scripts et adoptons les
conventions de Maven pour la suite du dÃ©veloppement de
<em>noubliepaslalistedescourses</em>. Les dÃ©veloppeurs sont nombreux Ã  choisir
Maven pour sa gestion des dÃ©pendances. N&#8217;oubliez pas, cependant, tous
les points que nous avons dÃ©jÃ  vus, et en quoi cela diffÃ©rencie Maven
d&#8217;autres outils de construction de projet. Maven n&#8217;est pas juste un
outil de gestion des dÃ©pendances, pour lequel il existe d&#8217;autres
trÃ¨s bons outils comme Apache Ivy qui sont utilisables depuis un script
Ant.</p>
</div>
<div class="paragraph">
<p>Ayez bien en tÃªte les points forts et la philosophie de Maven, si vous
envisagez de convertir un projet existant, car vous devrez probablement
en repenser l&#8217;organisation, et pas juste Ã©crire quelques fichiers POM
pour dÃ©clarer vos dÃ©pendances.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testons_un_peu">Testons un peu</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaVincentM.png" alt="MangaVincentM"></span></p>
</div>
<div class="paragraph">
<p>Vincent est un fanatique de la qualitÃ© logicielle, aussi a-t-il fait un
gros travail d&#8217;Ã©vangÃ©lisation pour nous convaincre d&#8217;outiller notre
projet de tests automatisÃ©s (nous en reparlerons au Chapitre 4). Ceux-ci
permettent de contrÃ´ler Ã  tout moment que les fonctionnalitÃ©s de notre
projet ne sont pas impactÃ©es par une modification, ce qui constitue une
sÃ©curitÃ© et un gain de temps apprÃ©ciables.</p>
</div>
<div class="paragraph">
<p>Nous Ã©tions sur le point de dÃ©cerner Ã  Vincent le prix trÃ¨s convoitÃ© de
Â«Â dÃ©veloppeur du moisÂ Â», quand nous avons rencontrÃ© un bogue Ã©trange sur
l&#8217;application, signalant l&#8217;absence de la classe org.junit.Assert dans
l&#8217;environnement d&#8217;exÃ©cution. VoilÃ  un problÃ¨me bien curieux.</p>
</div>
<div class="paragraph">
<p>AprÃ¨s une rapide recherche, nous constatons qu&#8217;une erreur d&#8217;import dans
une classe a fait utiliser org.junit.Assert#assertNotNull() Ã  la place
de la classe similaire de Spring
org.springframework.util.Assert#notNull(). La gestion automatique des
imports par notre environnement de dÃ©veloppement intÃ©grÃ© est bien
pratique mais elle peut parfois avoir des effets
pervers <sup class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnotedef_7" title="View footnote.">7</a>]</sup>. Comment se fait-il que cette erreur
d&#8217;Ã©tourderie soit passÃ©e au travers des mailles de notre (excellent)
suivi qualitÃ©Â ? Ou plutÃ´t, comment se fait-il que notre outillage
qualitÃ© ait pu ajouter des bogues Ã  notre applicationÂ ?</p>
</div>
<div class="paragraph">
<p>La rÃ©ponse tient en un motÂ : dÃ©pendances. Notre gestion des dÃ©pendances
Ã  la hussarde, avec un rÃ©pertoire lib dont nous utilisons tous les JAR
sans distinction, ne sait pas diffÃ©rencier les bibliothÃ¨ques nÃ©cessaires
Ã  la compilation de celles utilisÃ©es par les outils de test.</p>
</div>
<div class="paragraph">
<p>Nous pourrions fiabiliser les choses en sÃ©parant nos bibliothÃ¨ques en
/lib/runtime et /lib/test, mais Jason nous arrÃªte netÂ : que penser des
API servlet, que nous utilisons pour compiler notre interface de gestion
web (l&#8217;application a pas mal Ã©voluÃ© depuis le prototype en ligne de
commandeÂ !). Ces bibliothÃ¨ques sont nÃ©cessaires pour compiler, mais elles
ne doivent pas Ãªtre intÃ©grÃ©es Ã  l&#8217;application pour respecter les rÃ¨gles
JavaEE, car elles sont dÃ©jÃ  prÃ©sentes dans notre serveur d&#8217;application.</p>
</div>
<div class="paragraph">
<p>Cela se complique. Peut-Ãªtre qu&#8217;avec un troisiÃ¨me sous-rÃ©pertoire dans
/libâ¦ StopÂ ! Fini de jouer, interrompt Jason, avant de nous expliquer
comment Maven traite de maniÃ¨re globale ce problÃ¨me.</p>
</div>
<div class="sect3">
<h4 id="_les_scopes">Les Â«Â scopesÂ Â»</h4>
<div class="paragraph">
<p>Notre problÃ¨me vient de la nÃ©cessitÃ© d&#8217;associer Ã  chaque dÃ©pendance du
projet le contexte dans lequel elle doit intervenir. S&#8217;agit-il d&#8217;un
Ã©lÃ©ment indispensable Ã  l&#8217;exÃ©cution du logicielÂ ? Est-il utilisÃ©
uniquement Ã  des fins de testÂ ? Doit-il Ãªtre inclus dans l&#8217;application
ou est-il intÃ©grÃ© dans l&#8217;environnement d&#8217;exÃ©cutionÂ ?</p>
</div>
<div class="paragraph">
<p>La dÃ©claration d&#8217;une dÃ©pendance Maven permet de dÃ©finir un Ã©lÃ©ment
supplÃ©mentaire, le Â«Â scopeÂ Â» dans lequel la dÃ©pendance devra s&#8217;appliquer.
Nous pouvons ainsi prÃ©ciser que la bibliothÃ¨que jUnit n&#8217;est utilisÃ©e que
durant la phase de test et que l&#8217;API servlet ne doit pas Ãªtre intÃ©grÃ©e
dans notre archive web.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;dependency&gt;
      &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
      &lt;artifactId&gt;servlet&lt;/artifactId&gt;
      &lt;version&gt;2.3&lt;/version&gt;
      &lt;scope&gt;provided&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;junit&lt;/groupId&gt;
      &lt;artifactId&gt;junit&lt;/artifactId&gt;
      &lt;version&gt;4.7&lt;/version&gt;
      &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Maven exploite ces donnÃ©es supplÃ©mentaires lorsqu&#8217;il exÃ©cute les
commandes de construction du projet. Avec cette prÃ©cision, jUnit ne sera
pas inclus sur la liste des bibliothÃ¨ques rÃ©fÃ©rencÃ©es par la commande de
compilation. Maven aurait ainsi identifiÃ© notre bogue immÃ©diatement.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Une_arme_a_double_tranchant">Une arme Ã  double tranchant</h3>
<div class="paragraph">
<p>La facilitÃ© avec laquelle Maven permet de marier les bibliothÃ¨ques,
gÃ©rant dÃ©pendances et conflits, nous retire une (autre) sacrÃ©e Ã©pine du
pied. Nous pouvons ainsi nous focaliser sur le dÃ©veloppement du logiciel
sans Ãªtre freinÃ©s par d&#8217;ennuyeux problÃ¨mes techniques liÃ©s aux
bibliothÃ¨ques.</p>
</div>
<div class="paragraph">
<p>Notre application de gestion de liste de courses s&#8217;Ã©toffe donc
rapidement. Elle contient dÃ©sormais des frameworks de toutes sortes
comme Spring, Hibernate, Apache CXF ou Wicket pour prendre en charge les
diffÃ©rents aspects de notre architecture. Maven construit pour nous
l&#8217;archive web WAR de l&#8217;application que nous pouvons dÃ©ployer sur notre
serveur de test.</p>
</div>
<div class="paragraph">
<p>Un coup d&#8217;Åil au rÃ©pertoire WEB-INF/lib de l&#8217;application web nous fait
cependant dÃ©chanterÂ : plus de quarante bibliothÃ¨ques s&#8217;y trouvent (qui a
demandÃ© tout Ã§aÂ ?). Il y a, par exemple, la bibliothÃ¨que Avalon, un
framework ancien que plus personne n&#8217;utilise. Plus grave, nous trouvons
dans ce rÃ©pertoire des bibliothÃ¨ques redondantes, comme un
commons-logging-1.0.4 et un commons-logging-api-1.1. VoilÃ  qui est bien
troublant. Maven se serait-il emmÃªlÃ© les pinceaux dans ses dÃ©pendancesÂ ?</p>
</div>
<div class="paragraph">
<p>La rÃ©ponse Ã  nos interrogations est cependant simpleÂ : Maven n&#8217;est pas
un magicien et il ne peut gÃ©rer les dÃ©pendances entre bibliothÃ¨ques que
grÃ¢ce aux mÃ©tadonnÃ©es qu&#8217;il extrait des fichiers POM de chacune. La
qualitÃ© de ces informations est dÃ©terminante pour obtenir une gestion
fine et sans accrocs des dÃ©pendances. Il arrive malheureusement qu&#8217;une
bibliothÃ¨que dÃ©clare des dÃ©pendances qui ne sont pas indispensables Ã 
son fonctionnement, ou bien propose plusieurs variantes. Dans ce cas,
Maven a bien du mal Ã  s&#8217;y retrouver.</p>
</div>
<div class="paragraph">
<p>La bibliothÃ¨que commons-logging en est une bonne illustration. Il s&#8217;agit
d&#8217;une bibliothÃ¨que qui sert de faÃ§ade pour passer de maniÃ¨re
transparente d&#8217;un outil de log Ã  un autre, par exemple de log4j au
mÃ©canisme intÃ©grÃ© dans Java Ã  partir de la version 1.4, ou encore Ã 
logkit, un autre outil comparable.</p>
</div>
<div class="paragraph">
<p>Le fichier POM de commons-logging dÃ©clare donc des dÃ©pendances vers
toutes les bibliothÃ¨ques de log qu&#8217;il supporte. La dÃ©claration Maven
correcte devrait ÃªtreÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;dependency&gt;
      &lt;groupId&gt;log4j&lt;/groupId&gt;
      &lt;artifactId&gt;log4j&lt;/artifactId&gt;
      &lt;version&gt;1.2.12&lt;/version&gt;
      &lt;optional&gt;true&lt;/optional&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;logkit&lt;/groupId&gt;
      &lt;artifactId&gt;logkit&lt;/artifactId&gt;
      &lt;version&gt;1.0.1&lt;/version&gt;
      &lt;optional&gt;true&lt;/optional&gt;
    &lt;/dependency&gt;
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>L&#8217;Ã©lÃ©ment &lt;optional&gt; permet de prÃ©ciser la version de la bibliothÃ¨que
pour laquelle le projet a Ã©tÃ© conÃ§u, mais dont l&#8217;utilisation n&#8217;est pas
nÃ©cessaire et ne correspond qu&#8217;Ã  un cas particulier. Pour le malheur de
nombreux utilisateurs, les dÃ©veloppeurs de commons-logging ont cependant
Â«Â oubliÃ©Â Â» de prÃ©ciser ce caractÃ¨re optionnel jusqu&#8217;Ã  la version 1.1.1.
C&#8217;est pour cette raison que nous retrouvons avalon-framework-4.1.3.jar
dans nos bibliothÃ¨ques.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>La qualitÃ© des mÃ©tadonnÃ©es a longtemps Ã©tÃ© un point faible de Maven, qui
se corrige heureusement avec le temps et les nouvelles versions des
bibliothÃ¨ques incriminÃ©es. Les projets, mÃªme ceux qui n&#8217;utilisent pas
Maven pour leurs propres besoins, sont aujourd&#8217;hui sensibilisÃ©s Ã  ce
besoin et prennent plus de soin Ã  dÃ©finir des dÃ©pendances fiables.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Pour les versions anciennes cependant, une mise Ã  jour n&#8217;est pas
possible, car la politique de l&#8217;Ã©quipe qui gÃ¨re le dÃ©pÃ´t de
bibliothÃ¨ques de rÃ©fÃ©rence est de ne jamais modifier un POM qui a Ã©tÃ©
publiÃ©, en raison du grand nombre de miroirs et de caches utilisÃ© par
la communautÃ©Â : un fichier modifiÃ© signifierait qu&#8217;un miroir pourrait ne
pas fournir la mÃªme version que le dÃ©pÃ´t de rÃ©fÃ©rence, ce qui pourrait
introduire des bogues insurmontables dans les projets. Sans compter que
chaque utilisateur devrait manuellement purger son dÃ©pÃ´t local pour
forcer Maven Ã  rÃ©cupÃ©rer la version corrigÃ©eÂ !</p>
</div>
<div class="paragraph">
<p>Maven possÃ¨de heureusement une solution de contournement. Lorsque nous
dÃ©finissons une dÃ©pendance, nous pouvons exclure certains Ã©lÃ©ments de la
transitivitÃ©. Ainsi, si nous voulons empÃªcher Spring â qui utilise
commons-logging â d&#8217;introduire sur notre projet ce fameux JAR
avalon-framework, nous pouvons Ã©crireÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;spring-beans&lt;/artifactId&gt;
      &lt;version&gt;2.5.6&lt;/version&gt;
      &lt;exclusions&gt;
          &lt;exclusion&gt;
              &lt;groupId&gt;avalon-framework&lt;/groupId&gt;
              &lt;artifactId&gt;avalon-framework&lt;/artifactId&gt;
          &lt;/exclusion&gt;
      &lt;/exclusions&gt;
    &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Un autre problÃ¨me que nous avons identifiÃ© est ce doublon
commons-logging + commons-logging-api. Ce cas est plus subtil. Les
dÃ©veloppeurs de commons-logging proposent Ã  leurs utilisateurs une sÃ©rie
de classes qui masquent d&#8217;autres outils de log. Leur projet est donc
sÃ©parÃ© en une API et des adaptateurs vers chaque outil supportÃ©. Pour
Ã©viter Ã  certains d&#8217;utiliser par mÃ©garde une classe d&#8217;un adaptateur et
pas seulement celles de l&#8217;API, ils ont mis Ã  disposition une archive JAR
ne contenant que les classes utilisables par les dÃ©veloppeursÂ :
commons-logging-api.</p>
</div>
<div class="paragraph">
<p>LÃ  oÃ¹ les choses se corsent, c&#8217;est que ces mÃªmes classes se retrouvent
dans le commons-logging classique, et Maven n&#8217;est pas en mesure de le
deviner. Aussi, de son point de vue, il s&#8217;agit de deux dÃ©pendances
indÃ©pendantes pour lesquelles aucune rÃ¨gle de conflit ne peut
s&#8217;appliquer.</p>
</div>
<div class="paragraph">
<p>Il n&#8217;existe malheureusement aucune solution miracle pour indiquer qu&#8217;une
bibliothÃ¨que donnÃ©e est en rÃ©alitÃ© un sous-ensemble d&#8217;une autre, et pour gÃ©rer
des conflits de version entre elles. Une gestion propre du dÃ©veloppement
de la bibliothÃ¨que aurait dÃ» aboutir Ã  la sÃ©paration de
commons-logging-api et d&#8217;un second artefact complÃ©mentaire, mais pas
redondant. Ã vouloir rÃ©pondre aux demandes contradictoires des
utilisateurs (un seul JAR avec tout le nÃ©cessaire, des JAR focalisÃ©s sur
un aspect donnÃ©â¦) le projet perd en cohÃ©sion et les utilisateurs
rencontrent finalement des difficultÃ©s qu&#8217;on aurait dÃ» leur Ã©pargner.</p>
</div>
<div class="paragraph">
<p>Nous avons vu que les &lt;exclusions&gt; permettent de corriger ces erreurs de
mÃ©tadonnÃ©es. Reste Ã  faire le tri dans nos dÃ©pendances pour trouver ces
erreurs. Dans notre cas, nous voulons conserver commons-logging et
exclure commons-logging-api, mais aucune solution automatique n&#8217;est
possible.</p>
</div>
<div class="sect3">
<h4 id="L_analyse_des_dependances">L&#8217;analyse des dÃ©pendances</h4>
<div class="paragraph">
<p>Avec le nombre de frameworks que nous avons intÃ©grÃ©s Ã  l&#8217;application, il
devient difficile de savoir lequel introduit quelle dÃ©pendance. MÃªme si les
exclusions peuvent permettre de corriger le tir, encore faut-il savoir
sur quelles dÃ©pendances les dÃ©clarer.</p>
</div>
<div class="paragraph">
<p>Maven propose un outillage complet pour analyser nos dÃ©pendances, <em>via</em>
les plugins dependency et project-info-reports.</p>
</div>
<div class="paragraph">
<p>La commande <code>mvn dependency:list</code> permet d&#8217;Ã©tablir la liste des
dÃ©pendances du projet, soit l&#8217;Ã©quivalent de notre rÃ©pertoire
WEB-INF/lib. Elle sera utile pour vÃ©rifier l&#8217;impact de nos exclusions au
fur et Ã  mesure que nous les dÃ©clarerons.</p>
</div>
<div class="paragraph">
<p>La commande project-info-reports:dependencies est analogue Ã  la
prÃ©cÃ©dente mais elle gÃ©nÃ¨re un fichier HTML contenant la liste des
dÃ©pendances.</p>
</div>
<div class="paragraph">
<p>Plus intÃ©ressante, <code>mvn dependency:tree</code> trace un arbre, oÃ¹ chaque branche
est une dÃ©pendance qui introduit par transitivitÃ© d&#8217;autres dÃ©pendances.</p>
</div>
<div class="listingblock">
<div class="title">Listing 2.1 : ExÃ©cution de mvn dependency:tree</div>
<div class="content">
<pre>[INFO] [dependency:tree]
[INFO] fr.noubliepaslalistedescourses:noubliepaslalistedescourses:war:1.0.0-SNAPSHOT
[INFO] +- org.apache.cxf:cxf-rt-frontend-jaxws:jar:2.1.4:compile
[INFO] |  +- org.apache.geronimo.specs:geronimo-jaxws_2.1_spec:jar:1.0:compile
[INFO] |  +- org.apache.geronimo.specs:geronimo-ws-metadata_2.0_spec:jar:1.1.2:compile
[INFO] |  +- asm:asm:jar:2.2.3:compile
[INFO] |  +- org.apache.cxf:cxf-rt-bindings-xml:jar:2.1.4:compile
[INFO] |  +- org.apache.cxf:cxf-rt-frontend-simple:jar:2.1.4:compile
[INFO] |  +- org.apache.cxf:cxf-rt-ws-addr:jar:2.1.4:compile
[INFO] |  +- javax.xml.soap:saaj-api:jar:1.3:compile
[INFO] |  \- com.sun.xml.messaging.saaj:saaj-impl:jar:1.3.2:compile
[INFO] |  \- javax.xml.ws:jaxws-api:jar:2.1:compile
[INFO] |     +- javax.annotation:jsr250-api:jar:1.0:compile
[INFO] |     \- javax.jws:jsr181-api:jar:1.0-MR1:compile
[INFO] +- org.springframework:spring-aspects:jar:2.5.6:compile
[INFO] |  \- org.aspectj:aspectjweaver:jar:1.6.2:compile
[INFO] +- org.hibernate:hibernate-annotations:jar:3.4.0.GA:compile
[INFO] |  \- org.hibernate:ejb3-persistence:jar:1.0.2.GA:compile
...</pre>
</div>
</div>
<div class="paragraph">
<p>L&#8217;analyse de cet arbre permet d&#8217;identifier les bibliothÃ¨ques qui font
appel Ã  commons-logging-api et d&#8217;exclure cet intrus de notre projet.</p>
</div>
<div class="paragraph">
<p>Ces commandes bien pratiques restent assez spartiates, cantonnÃ©es dans
la console. L&#8217;intÃ©gration de Maven dans les environnements de
dÃ©veloppement en offre une version nettement plus ergonomique. La
Figure 02-03 prÃ©sente le plugin Maven pour Eclipse (m2eclipse) et sa
fenÃªtre d&#8217;analyse des dÃ©pendances. Si on sÃ©lectionne une dÃ©pendance dans
la zone de droite, il nous indique tous les chemins de dÃ©pendance qui y
mÃ¨nent. Un simple clic permet de placer les exclusions qui s&#8217;imposent
sans Ã©diter manuellement le fichier POM.</p>
</div>
<div class="paragraph">
<div class="title">Figure 02-03</div>
<p><span class="image"><img src="illustrations/02-03.png" alt="02 03"></span></p>
</div>
<div class="paragraph">
<p>Plugin Maven pour Eclipse.</p>
</div>
</div>
<div class="sect3">
<h4 id="Depots_et_dependances">DÃ©pÃ´ts et dÃ©pendances</h4>
<div class="paragraph">
<p><span class="image"><img src="illustrations/Maven3.png" alt="Maven3"></span></p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaEmmanuel.png" alt="MangaEmmanuel"></span></p>
</div>
<div class="paragraph">
<p>En rejoignant le projet, Emmanuel apporte dans sa musette bon nombre
dâidÃ©es innovantes et de petites expÃ©riences amusantes Ã  nous prÃ©senter.
Entre autre, Emmanuel a testÃ© un outil rigolo, une implÃ©mentation de JCR
sur la base NoSQL Cassandra. Rien que lâassemblage que cela reprÃ©sente
attise notre curiositÃ©. Place Ã  la dÃ©mo !</p>
</div>
<div class="paragraph">
<p>Oups :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[INFO] ------------------------------------------------------------------------
[INFO] Building demo dÃ©mo 1
[INFO] ------------------------------------------------------------------------
Downloading: http://repo1.maven.org/maven2/org/geeks/jcr-on-cassandra/1.8.0.10/jcr-on-cassandra-1.8.0.10.pom
[WARNING] The POM for org.geeks:jcr-on-cassandra:jar:1.8.0.10 is missing, no dependency information available
Downloading: http://repo1.maven.org/maven2/org/geeks/jcr-on-cassandra/1.8.0.10/jcr-on-cassandra-1.8.0.10.jar
[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------</pre>
</div>
</div>
<div class="paragraph">
<p>Â«Â WTF ?Â Â» comme on dit outre-Atlantique <sup class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnotedef_8" title="View footnote.">8</a>]</sup>, ce que nous ne
traduirons pas ici par respect pour nos lecteurs et la qualitÃ© de ce
rÃ©cit. Maven sâacharne â et Ã©choue â Ã  tÃ©lÃ©charge la bibliothÃ¨que
jcr-on-cassandraÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ERROR] Failed to execute goal on project demo:
+ Could not resolve dependencies for project demo:demo:jar:1: Could not find artifact org.geeks:jcr-on-cassandra:jar:1.8.0.10 in central</pre>
</div>
</div>
<div class="paragraph">
<p>Emmanuel vÃ©rifie trois fois, la bibliothÃ¨que jcr-on-cassandra dont il
veut nous montrer le potentiel est bien dans son dÃ©pÃ´t local, pourtant â
rien Ã  faire â Maven fait la sourde oreille. Il est temps de faire appel
Ã  nos expertsâ¦</p>
</div>
<div class="sect4">
<h5 id="_les_experts">LES EXPERTS</h5>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaArnaud.png" alt="MangaArnaud"></span></p>
</div>
<div class="paragraph">
<p>Arnaud vient faire un prÃ©lÃ¨vement ADN dans le projet dâexemple qui a
inspirÃ© Emmanuel pour sa dÃ©mo. Il en extrait une dÃ©claration de
dÃ©pÃ´t <a href="http://repository.geek.org/" class="bare">http://repository.geek.org/</a> quâil place sous scellÃ©s pour la
suite de lâenquÃªte.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">  &lt;repository&gt;
    &lt;id&gt;geeks.org&lt;/id&gt;
    &lt;url&gt;http://repository.geeks.org&lt;/url&gt;
  &lt;repository&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaNicolas.png" alt="MangaNicolas"></span></p>
</div>
<div class="paragraph">
<p>Nicolas fouille le dÃ©pÃ´t local dâEmmanuel Ã  la recherche dâindices. Sous
sa lampe Ã  ultraviolet, le Luminol met en Ã©vidence des traces de
mÃ©tadonnÃ©es. Un Ã©chantillon est prÃ©levÃ© pour analyse.</p>
</div>
<div class="paragraph">
<p>Figure 02-04</p>
</div>
<div class="paragraph">
<p>Contenu du dÃ©pÃ´t local pour la bibliothÃ¨que jcr-on-cassandra.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaVincentM.png" alt="MangaVincentM"></span></p>
</div>
<div class="paragraph">
<p>Au labo, Vincent analyse nos indices. Le fichier__maven.repositories
attire particuliÃ¨rement son attentionÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#NOTE: This is an internal implementation file, its format can be changed without prior notice.
#Mon Mar 07 16:16:01 CET 2011
jcr-on-cassandra-1.8.0.10.jar&gt;geek.org=
jcr-on-cassandra-1.8.0.10.pom&gt;geek.org=</pre>
</div>
</div>
<div class="paragraph">
<p>Le compte-rendu de nos experts fournit lâexplication.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Depots_et_dependances_2">DÃ©pÃ´ts et dÃ©pendances</h4>
<div class="paragraph">
<p>Maven utilise par dÃ©faut un dÃ©pÃ´t nommÃ© <em>central</em>, qui hÃ©berge un vaste
choix de bibliothÃ¨ques Open Source. Pour une grande majoritÃ© de
dÃ©veloppements, ce dÃ©pÃ´t sera suffisant pour nous fournir toutes les
dÃ©pendances nÃ©cessaires. Il arrive cependant rÃ©guliÃ¨rement quâun projet
ne contribue pas Ã  ce dÃ©pÃ´t et prÃ©fÃ¨re hÃ©berger son propre dÃ©pÃ´t
interne, souvent en prÃ©textant plus de simplicitÃ© de mise en Åuvre ou
une meilleure maÃ®trise de ses infrastructures.</p>
</div>
<div class="paragraph">
<p>Pour accÃ©der Ã  un dÃ©pÃ´t de ce type, Maven nous demande de lâajouter
explicitement Ã  notre POM, sous forme dâun bloc &lt;repository&gt; comme celui
quâArnaud a identifiÃ© dans le projet dâexemple de jcr-on-cassandraÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;repository&gt;
    &lt;id&gt;identifiant unique du dÃ©pÃ´t&lt;/id&gt;
    &lt;url&gt;emplacement du dÃ©pÃ´t, en gÃ©nÃ©ral via http&lt;/url&gt;
    &lt;layout&gt;format du dÃ©pÃ´t, Â«Â legacyÂ Â» pour les dÃ©pÃ´ts maven1 antÃ©diluviens, non supportÃ©s par Maven 3&lt;/url&gt;
&lt;/repository&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Le dÃ©pÃ´t local de Maven 3 n&#8217;est pas juste un cache d&#8217;accÃ¨s Ã  Internet.
Il permet aussi Ã  Maven de tracer l&#8217;origine de chaque dÃ©pendance, Ã 
savoir dâoÃ¹ elle a Ã©tÃ© tÃ©lÃ©chargÃ©e. Notre projet ne dÃ©clarant pas lâURL
geek.org, les bibliothÃ¨ques associÃ©es ne sont pas accessibles pour notre
build, mÃªme si elles sont prÃ©sentes physiquement.</p>
</div>
<div class="paragraph">
<p>AprÃ¨s avoir ajoutÃ© la dÃ©claration de dÃ©pÃ´t manquante, Emmanuel peut
enfin lancer sa dÃ©mo et nous prÃ©senter toutes ses idÃ©es.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Maven2 ne comporte pas ce mÃ©canisme et n&#8217;aurait pas bronchÃ©. Cela aurait
Ã©vitÃ© Ã  Emmanuel des soucis pendant sa dÃ©monstration, mais le problÃ¨me
serait apparu plus tard lorsqu&#8217;il aurait partagÃ© son projet avec le
reste de l&#8217;Ã©quipe. Maven 3 est globalement plus strict, pour le bien de
chacun sur le long terme.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion">Conclusion</h3>
<div class="paragraph">
<p>La gestion des bibliothÃ¨ques et de leurs dÃ©pendances est une
fonctionnalitÃ© de Maven trÃ¨s rÃ©guliÃ¨rement mise en avant. Manuellement,
cette gestion peut en effet devenir un rÃ©el casse-tÃªte, et la rÃ©ponse
apportÃ©e par Maven est Ã  la fois Ã©lÃ©gante et Ã©volutive. Sur de gros
projets, nous avons vu que celle-ci peut cependant dÃ©raper et introduire
involontairement des bibliothÃ¨ques inutiles ou redondantes mais,
heureusement, Maven permet de corriger ces problÃ¨mes. La qualitÃ© des
mÃ©tadonnÃ©es est donc primordiale, pensez-y si vous participez Ã  un
projet qui diffuse ses binaires sur un dÃ©pÃ´t Maven.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chapitre_3_un_peu_plus_que_compiler">Chapitre 3Â : Un peu plus que compiler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jusqu&#8217;Ã  prÃ©sent, Maven s&#8217;est montrÃ© plutÃ´t efficace pour traiter les
difficultÃ©s d&#8217;organisation de notre projet, en proposant des conventions
et des mÃ©canismes automatisÃ©s qui nous Ã©vitent de prendre des chemins
hasardeux. Nous allons voir maintenant comment il poursuit cet effort
lorsque notre projet Â«Â dÃ©vieÂ Â» progressivement de l&#8217;exemple si simple que
nous avons utilisÃ© pour l&#8217;instant.</p>
</div>
<div class="sect2">
<h3 id="Etes_vous_pret_pour_Java_7">Ãtes-vous prÃªt pour Java 7Â ?</h3>
<div class="paragraph">
<p>Le prototype Ã  l&#8217;origine de notre projet a Ã©tÃ© Ã©crit il y a belle
lurette et utilise la syntaxe Java 1.2. Maven n&#8217;a pas de grande
difficultÃ© pour le compiler, ce qui aurait Ã©tÃ© un comble. Nous sommes
cependant au xxi<sup>e</sup> siÃ¨cle, et utilisons Java 7 comme environnement
d&#8217;exÃ©cution. Nous avons donc tous un OpenJDK 7 Ã  jour installÃ© sur nos
postes de dÃ©veloppement.</p>
</div>
<div class="paragraph">
<p>Confiants dans Maven qui, pour l&#8217;instant, nous apporte entiÃ¨re
satisfaction, nous retravaillons un peu le code historique de gestion
des listes de courses pour bÃ©nÃ©ficier d&#8217;une syntaxe moderne, alliant
annotations, gÃ©nÃ©ricitÃ©, <em>autoboxing</em> et arguments variables. Devant un
code qui semble nettement plus moderne, nous lanÃ§ons fiÃ¨rement la
compilation par Maven, avant de tomber sur un message d&#8217;erreur fort
dÃ©sagrÃ©ableÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[INFO] -------------------------------------------------------------
[ERROR] COMPILATION ERROR :
[INFO] -------------------------------------------------------------
[ERROR] D:\noubliepaslalistedescources\src\main\java\org\noubliepaslalistedescources\model\MesCourses.java:[3,66] diamond operator is not supported in -source 1.5
[INFO] 1 error</pre>
</div>
</div>
<div class="paragraph">
<p>Le Â«Â diamond operatorÂ Â» <sup class="footnote">[<a id="_footnoteref_9" class="footnote" href="#_footnotedef_9" title="View footnote.">9</a>]</sup>, c&#8217;est en effet une Ã©volution du
langage Java proposÃ©e par Java 7. Maven ne serait-il compatible qu&#8217;avec
Java 5Â ? Les choses sont mÃªme bien pires que cela si on essaie de
compiler notre projet avec Maven 2Â :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[INFO] Compilation failure
D:\noubliepaslalistedescources\src\main\java\org\noubliepaslalistedescources\model\MesCourses.java:[57,5] annotations are not supported in -source 1.3 (use -source 5 or higher to enable annotations)</pre>
</div>
</div>
<div class="paragraph">
<p>PardonÂ ? Maven2 est compatible uniquement avec Java 1.3Â ? Pas de
panique, les choses sont plus subtiles que cela et, heureusement pour
nous, moins dÃ©finitives. Gardez Ã  l&#8217;esprit que Maven est un projet qui a
dÃ©jÃ  de nombreuses annÃ©es et une trÃ¨s large base d&#8217;utilisateurs. L&#8217;une
des prÃ©occupations majeures des dÃ©veloppeurs est d&#8217;assurer une
construction de projet qui soit totalement reproductible, quel que soit
l&#8217;environnement de dÃ©veloppement. Cette exigence est essentielle pour
que vous puissiez bÃ¢tir vos projets sur une base irrÃ©prochable.</p>
</div>
<div class="paragraph">
<p>Maven a Ã©tÃ© conÃ§u sur la base de la plateforme Java 1.4, version
Â«Â moderneÂ Â» de l&#8217;Ã©poque. Sur ce JDK, les valeurs par dÃ©faut des options
<em>source</em> et <em>target</em> du compilateur sont respectivement 1.3 et
1.2 <sup class="footnote">[<a id="_footnoteref_10" class="footnote" href="#_footnotedef_10" title="View footnote.">10</a>]</sup>. Par contre, sur le JDK Java 6, cette valeur par
dÃ©faut est Â«Â 1.6Â Â» <sup class="footnote">[<a id="_footnoteref_11" class="footnote" href="#_footnotedef_11" title="View footnote.">11</a>]</sup> pour les deux, et source 1.6, target
1.7 pour le JDK 7Â ; autant dire que le JDK utilisÃ© peut fortement
influencer le rÃ©sultat de notre compilationÂ !</p>
</div>
<div class="paragraph">
<p>PlutÃ´t que de laisser cette option sans valeur dÃ©terministe, ce qui
aurait rendu la construction du projet dÃ©pendante de l&#8217;environnement
utilisÃ© par un dÃ©veloppeur, le compilateur utilisÃ© par Maven2 est
configurÃ©, par dÃ©faut, pour cette valeur 1.3, et pour Maven3 par dÃ©faut Ã 
1.5 (voir notre note un peu plus loin).</p>
</div>
<div class="paragraph">
<p>Notre code Java 7 n&#8217;a donc aucune chance d&#8217;Ãªtre acceptÃ© par le
compilateur. Le choix de Maven a Ã©tÃ© de s&#8217;assurer que le projet sera
construit de la mÃªme faÃ§on quel que soit le JDK utilisÃ©, sur la base de
son exigence minimale qui est le JDK 1.4. Ce choix peut sembler
archaÃ¯que, mais câest la seule faÃ§on de gommer les diffÃ©rences qui
existent entre les versions de Java.</p>
</div>
<div class="paragraph">
<p>Comment modifier ce comportement protecteur mais pÃ©nalisant, qui vise
juste Ã  nous Ã©viter des dÃ©convenues dues aux inconsistances entre
versions du JDKÂ ? Nous avons vu que Maven associe Ã  tout projet un
<em>patron de rÃ©fÃ©rence</em>, regroupant les Ã©tapes applicables Ã  la trÃ¨s
grande majoritÃ© des projets, dont la compilation des sources .java.
Cette convention nous Ã©vite de devoir explicitement indiquer Ã  Maven
quand et comment effectuer la compilation. Allons-nous devoir faire
machine arriÃ¨reÂ ? Non, car Maven prÃ©voit Ã©galement la possibilitÃ© de
reconfigurer ces Ã©tapes standard, lorsque leur fonctionnement par dÃ©faut
ne suffit plus.</p>
</div>
</div>
<div class="sect2">
<h3 id="_plugins">Plugins</h3>
<div class="paragraph">
<p>Maven confie chaque opÃ©ration Ã©lÃ©mentaire de la construction du projet Ã 
un <em>plugin</em>, un fragment de logiciel qui se spÃ©cialise dans une tÃ¢che
donnÃ©e. La compilation est un exemple de plugin, mais pensez aussi Ã 
l&#8217;assemblage sous forme d&#8217;un JAR ou Ã  l&#8217;inclusion de fichiers de
ressources, etc. Chaque plugin propose un certain nombre d&#8217;options et de
paramÃ¨tres qui permettent d&#8217;ajuster son fonctionnement, avec des valeurs
par dÃ©faut qui sont choisies pour coller au mieux aux conventions de
Maven et Ã  une utilisation standard. Le plugin de compilation (compiler)
utilise les options source et target avec comme valeurs par dÃ©faut 1.3
et 1.2, correspondant Ã  la plateforme Java de rÃ©fÃ©rence utilisÃ©e par
Maven.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Plus prÃ©cisÃ©ment, la version du plugin <em>compiler</em> qui est utilisÃ©e par
Maven sans indication de votre part utilise les options source=1.3 et
target=1.2 par dÃ©faut. Ã partir de la version 2.3, le plugin <em>compiler</em>
prend pour valeurs par dÃ©faut source=1.5 et target=1.5, ce qui est le
cas si vous utilisez Maven3.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Cependant, afin que votre EDI dÃ©tecte correctement cette configuration,
nous vous encourageons Ã  toujours dÃ©finir explicitement ces valeurs.</p>
</div>
<div class="paragraph">
<p>La modification des options par dÃ©faut d&#8217;un plugin s&#8217;effectue dans le
fichier POM du projet, au sein de son bloc &lt;build&gt;Â :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
            &lt;version&gt;2.3.2&lt;/version&gt;
            &lt;configuration&gt;
                &lt;source&gt;7&lt;/source&gt;
                &lt;target&gt;7&lt;/target&gt;
            &lt;/configuration&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Chaque plugin peut ainsi Ãªtre reconfigurÃ©. Un plugin, comme tout
artefact manipulÃ© par Maven, est identifiÃ© par le triplet [identifiant
de groupe, identifiant d&#8217;artefact, version]. Nous indiquons ici le
plugin de compilation dont nous dÃ©sirons ajuster le fonctionnement. Le
bloc &lt;configuration&gt; permet de lui passer des valeurs qui vont remplacer
celles par dÃ©faut. Chaque plugin ayant son propre paramÃ©trage, nous
devons consulter la documentation du plugin <sup class="footnote">[<a id="_footnoteref_12" class="footnote" href="#_footnotedef_12" title="View footnote.">12</a>]</sup> pour
connaÃ®tre toutes les options disponibles (voir Figure 03-01).</p>
</div>
<div class="paragraph">
<p>Figure 03-01
<span class="image"><img src="illustrations/03-01.png" alt="03 01"></span></p>
</div>
<div class="paragraph">
<p>Le site de documentation du plugin <em>compiler</em>.</p>
</div>
<div class="paragraph">
<p>Comme vous pouvez le constater, le plugin dispose d&#8217;un grand nombre de
paramÃ¨tres, qui lui permettent de rÃ©pondre sans difficultÃ© aux cas de
figure les plus dÃ©licats. En plus des options Â«Â standardÂ Â» de JavaC, vous
pouvez par exemple utiliser un compilateur alternatif comme celui
d&#8217;Eclipse JDT si votre projet nÃ©cessite cette option pour une raison
quelconque. Dans notre cas, seuls les paramÃ¨tres <em>source</em> et <em>target</em> sont
nÃ©cessaires pour obtenir le rÃ©sultat attendu, les autres paramÃ¨tres
pouvant conserver leur valeur par dÃ©faut.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Chaque plugin Maven dispose d&#8217;un site de documentation, en particulier
les plugins standard, sur <a href="http://maven.apache.org/plugins/" class="bare">http://maven.apache.org/plugins/</a>. La
documentation fournit une description de chaque option, les valeurs par
dÃ©faut utilisÃ©es et, dans la plupart des cas, quelques exemples de
configuration pour les utilisations les plus frÃ©quentes. Ces sites
documentaires sont gÃ©nÃ©rÃ©s Ã  partir du code source du plugin et diffusÃ©s
en mÃªme temps que lui. Ils sont donc toujours synchrones avec la version
courante du plugin.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Attention cependant, car le site web gÃ©nÃ©rÃ© correspond gÃ©nÃ©ralement Ã  la
version en cours de dÃ©veloppement du plugin, aussi soyez attentif Ã 
l&#8217;indication Â«Â @sinceÂ Â» ajoutÃ©e Ã  certains paramÃ¨tres.</p>
</div>
</div>
<div class="sect2">
<h3 id="Proprietes">PropriÃ©tÃ©s</h3>
<div class="paragraph">
<p>La modification du fonctionnement du plugin de compilation nous permet
enfin de valider la syntaxe Java 7 que nous avons introduite dans le
projet. Ce besoin tout simple a cependant nÃ©cessitÃ© une configuration
significative, ce qui peut vous laisser perplexeÂ : pas moins de
10 lignes dans le fichier POM.xml, lÃ  ou deux attributs suffisent dans
un script AntÂ !</p>
</div>
<div class="paragraph">
<p>Ce principe de reconfiguration des plugins est la version Â«Â lourdeÂ Â» de la
solution, mÃªme si elle a l&#8217;avantage de nous ouvrir les portes de toutes
les options de configuration. Il existe cependant une autre voie, plus
lÃ©gÃ¨re bien qu&#8217;ayant certaines limites. La consultation de la page
documentaire du plugin de compilation rÃ©vÃ¨le que les paramÃ¨tres <em>source</em>
et <em>target</em> sont associÃ©s Ã  une expression, respectivement
maven.compiler.source et maven.compiler.target. De quoi s&#8217;agit-ilÂ ?</p>
</div>
<div class="paragraph">
<p>Les valeurs par dÃ©faut utilisÃ©es par un plugin peuvent Ãªtre modifiÃ©es
<em>via</em> un Ã©lÃ©ment &lt;plugin&gt; dans le POM, mais aussi par lâexploitation
dâun mÃ©canisme de Maven appelÃ© Â«Â interpolationÂ Â», qui consiste Ã  Ã©valuer
au moment de l&#8217;exÃ©cution les valeurs Ã  utiliser en se fondant sur des
Â«Â expressionsÂ Â». Celles-ci peuvent Ãªtre comparÃ©es aux mÃ©canismes utilisÃ©s
dans les applications par l'<em>expression language</em> des JSP. La chaÃ®ne
maven.compiler.source est Ã©valuÃ©e juste avant que Maven n&#8217;utilise le
plugin, en fonction de l&#8217;environnement dans lequel il s&#8217;exÃ©cute. En
particulier, cette notion d'Â«Â environnementÂ Â» inclut les variables systÃ¨me
passÃ©es sur la ligne de commande avec l&#8217;option -D. Nous pouvons donc
activer la compilation Java 7 en lanÃ§ant la commandeÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mvn compile -Dmaven.compiler.source=7 -Dmaven.compiler.target=7</pre>
</div>
</div>
<div class="paragraph">
<p>Nous savons donc comment modifier Ã  la demande la configuration utilisÃ©e
par le plugin de compilation sans modifier le fichier POM. Cela peut
Ãªtre trÃ¨s utile, en particulier pour modifier trÃ¨s ponctuellement le
comportement de Maven sans toucher Ã  la configuration. Mais pour notre
problÃ¨me de compilation Java 7, le prix Ã  payer est lourdÂ : la ligne de
commande que nous devons taper dans une console s&#8217;allonge
dangereusementÂ !</p>
</div>
<div class="paragraph">
<p>Comme les dÃ©veloppeurs de Maven sont un peu fainÃ©ants comme tout bon
dÃ©veloppeur, ils ont pensÃ© Ã  une solution intermÃ©diaire pour nous Ã©viter
de telles lignes de commande, sans pour autant devoir ajouter des
dizaines de lignes Ã  notre fichier POMÂ : les propriÃ©tÃ©s. Il s&#8217;agit tout
simplement de figer les variables d&#8217;environnement dans le fichier POM, Ã 
l&#8217;intÃ©rieur d&#8217;un bloc &lt;properties&gt;. La valeur indiquÃ©e sera prise en
charge exactement de la mÃªme maniÃ¨re par l&#8217;interpolation, tout en Ã©tant
encore modifiable <em>via</em> le -D sur la ligne de commande. Cela permet de
dÃ©finir en quelque sorte des valeurs par dÃ©faut applicables sur le
projet et sur lui seulÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;properties&gt;
    &lt;maven.compiler.source&gt;7&lt;/maven.compiler.source&gt;
    &lt;maven.compiler.target&gt;7&lt;/maven.compiler.target&gt;
&lt;/properties&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>La plupart des plugins Maven proposent cette option pour leurs
principaux paramÃ¨tres de configurationÂ ; cependant, cette pratique n&#8217;est
pas gÃ©nÃ©ralisÃ©e Ã  tous les paramÃ¨tres ni Ã  tous les plugins. Il s&#8217;agit
plus d&#8217;une bonne pratique que les dÃ©veloppeurs de plugins devraient
connaÃ®tre pour satisfaire au mieux leurs utilisateurs. Dans le cas
contraire, seule l&#8217;option Â«Â lourdeÂ Â» reste envisageable.</p>
</div>
</div>
<div class="sect2">
<h3 id="_quand_java_ne_suffit_plus">Quand Java ne suffit plus</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaArnaud.png" alt="MangaArnaud"></span></p>
</div>
<div class="paragraph">
<p>Bien que nous ayons introduit la syntaxe Java 7 dans notre code, Arnaud
est loin d&#8217;Ãªtre satisfait par sa lisibilitÃ©. Selon lui, de nombreux
passages techniques pourraient Ãªtre nettement plus simples si nousâ¦
renoncions Ã  la syntaxe JavaÂ ! AprÃ¨s vÃ©rification du contenu de sa tasse
de cafÃ©, nous comprenons qu&#8217;Arnaud est tout Ã  fait Ã  jeun (il faut dire
qu&#8217;il est tout juste 9 heures du matin) et tout Ã  fait sÃ©rieux. Il
Ã©voque, en fait, avec un savant effet de suspens, la possibilitÃ©
d&#8217;utiliser le langage Groovy pour coder notre application, ou tout du
moins certains composants qui s&#8217;y prÃªtent trÃ¨s bien.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Groovy est un langage dynamique qui s&#8217;exÃ©cute sur la machine virtuelle
Java, au mÃªme titre que jRuby ou Jython par exemple. L&#8217;environnement
d&#8217;exÃ©cution Java actuel ne se limite plus au seul langage de
programmation Java et accueille un nombre croissant de langages <em>via</em>
des interprÃ©teurs ou des compilateurs spÃ©cialisÃ©s. Vous pouvez par
exemple dÃ©velopper une application en PHP et l&#8217;exÃ©cuter sur un serveur
JavaÂ ! Ce qui pourrait sembler <em>a priori</em> un mariage contre nature ouvre
en rÃ©alitÃ© des perspectives Ã©tonnantes, en fonction des points forts de
certains langages dans des domaines prÃ©cis, ou tout simplement des
dÃ©veloppeurs dont vous disposez.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Quelques exemples bien choisis (Arnaud a bien prÃ©parÃ© son coup) nous
convainquent rapidement des amÃ©liorations que Groovy apporterait Ã  notre
projet. Reste un petit Ã©cueilÂ : le Â«Â projet typeÂ Â» utilisÃ© par Maven pour
dÃ©finir les tÃ¢ches exÃ©cutÃ©es lors de la construction d&#8217;un projet
n&#8217;inclut certainement pas l&#8217;exÃ©cution du compilateur GroovyÂ ! La grande
majoritÃ© des projets Java n&#8217;utilisent pas ce langage aujourd&#8217;hui. Il n&#8217;y
a donc aucune raison pour que Maven en ait tenu compte nativement.</p>
</div>
<div class="paragraph">
<p>En consultant la documentation en ligne de Groovy <sup class="footnote">[<a id="_footnoteref_13" class="footnote" href="#_footnotedef_13" title="View footnote.">13</a>]</sup>,
nous constatons cependant qu&#8217;un plugin Maven a Ã©tÃ© dÃ©veloppÃ©. Il suffit
de le dÃ©clarer dans le POM du projet pour obtenir cette nouvelle Ã©tape
dans la construction de notre binaire. La notion de plugin (greffon)
prend alors tout son sensÂ : pour prendre en charge le besoin X, il
suffit d&#8217;ajouter au projet le plugin X. L&#8217;approche dÃ©clarative de Maven
Ã©conomise la dÃ©claration des opÃ©rations rÃ©alisÃ©es par le plugin et la
faÃ§on dont elles s&#8217;intÃ¨grent dans le projet.</p>
</div>
<div class="sect3">
<h4 id="Ou_placer_les_source">OÃ¹ placer les sources</h4>
<div class="paragraph">
<p>Nous l&#8217;avons dÃ©jÃ  dit, les conventions de Maven sont un Ã©lÃ©ment dÃ©cisif
dans sa capacitÃ© Ã  prendre en charge de maniÃ¨re automatisÃ©e le projet.
En particulier, la structure type d&#8217;un projet Maven est la suivante
(voir Figure 03-02)Â :</p>
</div>
<div class="paragraph">
<div class="title">Figure 03-02</div>
<p><span class="image"><img src="illustrations/03-02.png" alt="03 02"></span></p>
</div>
<div class="paragraph">
<p>La structure de base d&#8217;un projet Maven.</p>
</div>
<div class="paragraph">
<p>La logique est plutÃ´t simpleÂ : Ã  la racine, on trouve le fichier POM qui
gouverne toute la gestion Maven du projet. L&#8217;ensemble des sources est
placÃ© dans un rÃ©pertoire src, tandis qu&#8217;un rÃ©pertoire target sert de
zone temporaire pour toutes les opÃ©rations rÃ©alisÃ©es sur le projet. Cela
a au moins l&#8217;avantage de faciliter grandement la configuration de votre
gestionnaire de code sourceÂ ! Il suffit d&#8217;exclure target (en plus des
fichiers spÃ©cifiques de votre EDI) et vous Ãªtes sÃ»r de ne pas inclure
par mÃ©garde des fichiers de travail qui n&#8217;ont pas Ã  Ãªtre partagÃ©s.</p>
</div>
<div class="paragraph">
<p>Sous le rÃ©pertoire des sources, Maven effectue un dÃ©coupage explicite
entre ce qui fait partie du projet â ce que vos utilisateurs vont
utiliser â et ce qui sert d&#8217;outillage de test. Deux sous-rÃ©pertoires,
<em>main</em> et <em>test</em>, marquent cette distinction.</p>
</div>
<div class="paragraph">
<p>Enfin, dans chacune de ces branches, un dernier niveau de rÃ©pertoire
sÃ©pare les fichiers sources par langageÂ : Java pour le code source de
vos classes java, <em>resources</em> pour les fichiers de ressources
(configuration XML ou fichiers de propriÃ©tÃ©sâ¦), webapp pour les fichiers
statiques d&#8217;une application web.</p>
</div>
<div class="paragraph">
<p>Le plugin Groovy ajoute son lot de conventions qui viennent complÃ©ter
celles dÃ©jÃ  dÃ©finies par Maven. Les fichiers source Groovy ont ainsi
leur propre rÃ©pertoire de code source sous src/main/groovy. Il en est de
mÃªme pour les tests Ã©crits dans ce langage avec src/test/groovy. Ces
conventions sont alignÃ©es sur celles de Maven pour obtenir un ensemble
cohÃ©rent. D&#8217;autres plugins qui apportent le support de langages autres
que Java suivront la mÃªme logique.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ajouter_un_plugin">Ajouter un plugin</h4>
<div class="paragraph">
<p>Ces rÃ©pertoires crÃ©Ã©s pour accueillir le code, il nous reste Ã  dÃ©clarer
le plugin Groovy dans notre POM. Sur l&#8217;exemple du plugin <em>compiler</em>, nous
ajoutonsÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.codehaus.groovy.maven&lt;/groupId&gt;
            &lt;artifactId&gt;gmaven-plugin&lt;/artifactId&gt;
            &lt;version&gt;1.0&lt;/version&gt;
            &lt;configuration&gt;
                &lt;!-- les valeurs par dÃ©faut nous conviennent trÃ¨s bien :) --&gt;
            &lt;/configuration&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Vous constaterez, si vous utilisez un Ã©diteur XML, que l&#8217;Ã©lÃ©ment version
n&#8217;est pas obligatoire pour les plugins. Le comportement de Maven
consiste alors Ã  prendre la Â«Â derniÃ¨re version stable disponibleÂ Â». Câest
une fausse bonne idÃ©eÂ ! En effet, si vous reprenez une version de votre
projet d&#8217;il y a six mois pour une correction urgente, vous risquez de ne
pas utiliser le mÃªme plugin que prÃ©vu initialement. Si la compatibilitÃ©
ascendante n&#8217;est pas parfaite, attention Ã  la casse. Pour cette raison,
il est fortement recommandÃ© de toujours spÃ©cifier la version de vos
plugins. Ã partir de Maven 2.0.9, ceux qui sont utilisÃ©s par dÃ©faut dans
le <em>build</em> Maven ont une version prÃ©dÃ©finie en interne pour Ã©viter ce
piÃ¨ge.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Au lancement de Maven, nous constatons avec plaisir le tÃ©lÃ©chargement de
fichiers POM et JAR associÃ©s au plugin Groovy. Voici une autre
explication de la dÃ©pendance de Maven Ã  un accÃ¨s InternetÂ : les plugins,
comme les bibliothÃ¨ques, sont tÃ©lÃ©chargÃ©s Ã  la demande depuis un dÃ©pÃ´t
de bibliothÃ¨ques. L&#8217;installation de Maven est ainsi limitÃ©e Ã  un noyau
et tous les plugins qui lui permettent d&#8217;exÃ©cuter des tÃ¢ches sont
obtenus au moment de sa connexion au rÃ©seau, d&#8217;oÃ¹ les interminables
tÃ©lÃ©chargements lors de la premiÃ¨re exÃ©cutionÂ !</p>
</div>
<div class="paragraph">
<p>Cependant, nos sources Groovy ne sont pas prises en compte, et les
traces d&#8217;exÃ©cution de la console ne laissent entendre aucun traitement
particulier de ce langage. Nous avons dÃ» brÃ»ler une Ã©tapeâ¦</p>
</div>
</div>
<div class="sect3">
<h4 id="Plugin_et_taches">Plugin et tÃ¢ches</h4>
<div class="paragraph">
<p>La notion de plugin permet Ã  Maven d&#8217;isoler, dans un sous-projet dÃ©diÃ©
la gestion, des opÃ©rations Ã©lÃ©mentaires qui sont utilisÃ©es pour
construire divers projets. Cela ne signifie pas pour autant qu&#8217;un plugin
nâest concernÃ© que par un seul traitement. Si l&#8217;on reprend l&#8217;exemple du
plugin de compilation, celui-ci doit compiler le code source Java de
l&#8217;application, mais aussi le code source des tests. Un plugin regroupe
donc des tÃ¢ches Ã©lÃ©mentaires qui partagent un mÃªme domaine.</p>
</div>
<div class="paragraph">
<p>Chaque plugin dÃ©finit ainsi plusieurs tÃ¢ches (ou <em>goals</em>) et il ne
suffit pas de dÃ©clarer un plugin pour ajouter un traitement Ã  notre
projetÂ ; nous devons Ã©galement prÃ©ciser lequel (ou lesquels) de ces
traitements unitaires nous souhaitons intÃ©grer Ã  la construction du
projet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.codehaus.groovy.maven&lt;/groupId&gt;
            &lt;artifactId&gt;gmaven-plugin&lt;/artifactId&gt;
            &lt;version&gt;1.0&lt;/version&gt;
            &lt;executions&gt;
                &lt;execution&gt;
                    &lt;goals&gt;
                        &lt;goal&gt;compile&lt;/goal&gt;
                    &lt;/goals&gt;
                &lt;/execution&gt;
             &lt;/executions&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Un Ã©lÃ©ment &lt;execution&gt; permet de dÃ©finir les tÃ¢ches dÃ©finies par le
plugin considÃ©rÃ© que Maven devra exÃ©cuter.</p>
</div>
<div class="paragraph">
<div class="title">Figure 03-03</div>
<p><span class="image"><img src="illustrations/03-03.png" alt="03 03"></span></p>
</div>
<div class="paragraph">
<p>Le cycle de vie du projet et les plugins qui viennent s&#8217;y greffer.</p>
</div>
<div class="paragraph">
<p>Miracle, nous pouvons compiler notre code source Groovy. Sortez la boule
Ã  facettesÂ !</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compiler_en_javascript">Compilerâ¦ en JavaScript</h3>
<div class="paragraph">
<p>Avec ce putsch de Groovy sur le projet, Arnaud a rÃ©ussi un tour de
force. Pour ne pas le laisser s&#8217;endormir sur ses lauriers, Nicolas
relÃ¨ve le dÃ©fi de secouer une nouvelle fois nos petites habitudes.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaNicolas.png" alt="MangaNicolas"></span></p>
</div>
<div class="paragraph">
<p>Notre application dispose d&#8217;une interface web qui permet de saisir sa
liste de courses depuis n&#8217;importe quel navigateur. C&#8217;est le cas de trÃ¨s
nombreuses applications J2EE, qui exploitent le navigateur comme
environnement universel pour exÃ©cuter une application sans que vous
deviez rien installer sur votre ordinateur. Il est d&#8217;ailleurs trÃ¨s
probable que vous consultiez le solde de votre compte bancaire de cette
faÃ§onÂ !</p>
</div>
<div class="paragraph">
<p>Les premiers jets de cette Â«Â application webÂ Â» fonctionnent mais sont
assez peu sexy. Rien Ã  voir avec ces sites hauts en couleur et en effets
visuels qui parsÃ¨ment le Web et qui rÃ©volutionnent notre utilisation
d&#8217;Internet. Nicolas s&#8217;attarde donc quelques instants sur le tableau
blanc que nous utilisons pour griffonner nos derniÃ¨res idÃ©esâ¦ et le
tableau est rapidement noir de petits croquis, de flÃ¨ches en tout genre
et de notes sur le comportement idÃ©al de notre site web.</p>
</div>
<div class="paragraph">
<div class="title">Figure 03-04</div>
<p><span class="image"><img src="illustrations/03-04.png" alt="03 04"></span></p>
</div>
<div class="paragraph">
<p>Notre document officiel de spÃ©cifications pour l&#8217;application web.</p>
</div>
<div class="paragraph">
<p>Les rÃ©actions ne tardent pasÂ : c&#8217;est bien joli, mais qui se sent les
Ã©paules de faire tout Ã§aÂ ? Et avec quel outilÂ ? Nous n&#8217;y connaissons
rien en JavaScript, le langage utilisÃ© sur les navigateurs web pour
animer les pages. Avant que la surprise ne laisse la place Ã  une
rÃ©action Ã©pidermique face Ã  l&#8217;ampleur de la tÃ¢che, Nicolas lÃ¢che son
arme secrÃ¨teÂ : GWT.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Google Web Toolkit (GWT) est un outil dÃ©veloppÃ© par Google pour offrir
aux dÃ©veloppeurs Java les portes du Web. Capable de traduire en
JavaScript du code source Java, il permet Ã  ces derniers de conserver le
confort de leur langage prÃ©fÃ©rÃ© et de leur outillage habituel, tout en
dÃ©veloppant des applications web qui rÃ©agissent au moindre mouvement de
souris. La prouesse technique est impressionnante, et les portes que
cela ouvre aux dÃ©veloppeurs Java ne font encore que s&#8217;entrouvrir.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Une petite dÃ©monstration sur le PC portable qui traÃ®nait comme par
hasard sur un coin de table fait taire les derniers incrÃ©dules.
Effectivement, dÃ©velopper pour le Web n&#8217;est finalement pas si compliquÃ©
que Ã§a. Reste Ã  faire tourner cet ovni issu de la galaxie Google dans un
projet MavenÂ ! Heureusement pour nous, d&#8217;autres ont eu le mÃªme souci et
un plugin est disponible pour marier GWT avec notre projet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;gwt-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.2.0&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;goals&gt;
              &lt;goal&gt;compile&lt;/goal&gt;
              &lt;goal&gt;generateAsync&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
        &lt;configuration&gt;
          &lt;extraJvmArgs&gt;-Xmx512M&lt;/extraJvmArgs&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Comme pour l&#8217;intÃ©gration de Groovy, nous n&#8217;avons au niveau du projet
Maven qu&#8217;Ã  ajouter l&#8217;identifiant exact du plugin utilisÃ©, dÃ©finir une
Ã©ventuelle configuration si les valeurs par dÃ©faut ne nous conviennent
pas, et prÃ©ciser dans une &lt;execution&gt; quelles tÃ¢ches doivent Ãªtre
exÃ©cutÃ©es lors de la construction du projet.</p>
</div>
<div class="paragraph">
<p>En consultant la documentation du plugin GWT <sup class="footnote">[<a id="_footnoteref_14" class="footnote" href="#_footnotedef_14" title="View footnote.">14</a>]</sup>, nous
dÃ©couvrons quelque chose qui nous intÃ©resseÂ : la tÃ¢che Eclipse du plugin
propose de gÃ©nÃ©rer automatiquement des scripts de lancement pour
exÃ©cuter directement l&#8217;application web depuis notre environnement de
dÃ©veloppement â au moins pour ceux d&#8217;entre nous qui utilisent EclipseÂ !</p>
</div>
<div class="paragraph">
<p>Nous ajoutons cette tÃ¢che Ã  notre <em>execution</em>, et nous lanÃ§ons en toute
confiance un <code>mvn install</code>Â :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>...
[INFO] -----------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] -----------------------------------------------------------------
[INFO] Total time: 50 seconds</pre>
</div>
</div>
<div class="paragraph">
<p>VoilÃ  qui est encourageantâ¦ mais pas grand-chose de visible concernant
notre application webÂ ! Rien d&#8217;Ã©tonnant Ã  celaÂ : le lancement du serveur
web pour faire une dÃ©mo de notre IHM n&#8217;est pas une Ã©tape standard de la
construction d&#8217;un projet. Comment Maven pourrait-il connaÃ®tre notre
intention et dÃ©terminer les Ã©tapes nÃ©cessaires Ã  la construction du
projetÂ ?</p>
</div>
<div class="sect3">
<h4 id="_invoquer_un_plugin">Invoquer un plugin</h4>
<div class="paragraph">
<p>Les commandes que nous avons passÃ©es jusqu&#8217;ici Ã©taient de la forme mvn
xxx, avec pour xxx la phase de construction du projet que nous
dÃ©sirerions atteindre, par exemple <em>compile</em>. Maven permet Ã©galement
d&#8217;invoquer directement un plugin, et lui seul, <em>via</em> une forme
diffÃ©rente de la ligne de commandeÂ :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mvn gwt:run</pre>
</div>
</div>
<div class="paragraph">
<p>Ici, nous ne demandons pas la construction du projet, mais l&#8217;exÃ©cution
isolÃ©e de la tÃ¢che <em>run</em> du plugin GWT. Il s&#8217;agit d&#8217;ailleurs d&#8217;une version
contractÃ©e de la commande complÃ¨teÂ :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mvn org.codehaus.mojo:gwt-maven-plugin:2.2.0:run</pre>
</div>
</div>
<div class="paragraph">
<p>Le raccourci est apprÃ©ciable, mais il vaut mieux garder en tÃªte cette
syntaxe qui pourra parfois se rÃ©vÃ©ler indispensable.</p>
</div>
<div class="paragraph">
<p>L&#8217;invocation directe d&#8217;un plugin n&#8217;est gÃ©nÃ©ralement utile que pour des
tÃ¢ches annexes du projet, comme ici le lancement du serveur web de
dÃ©veloppement de GWT. La plupart des plugins et des tÃ¢ches qu&#8217;ils
dÃ©finissent sont prÃ©vus pour se greffer dans le cycle de construction du
projet. Il est donc inutile d&#8217;invoquer directement une tÃ¢che d&#8217;un plugin
qui n&#8217;a pas Ã©tÃ© prÃ©vu dans ce sensÂ ; dâailleurs, cela aboutirait dans la
majoritÃ© des cas Ã  une erreur.</p>
</div>
<div class="paragraph">
<p>Cette nouvelle dÃ©couverte nous amÃ¨ne Ã  nous demander ce qui diffÃ©rencie
dans ce plugin GWT la tÃ¢che <em>run</em> de la tÃ¢che <em>compile</em>. La premiÃ¨re
s&#8217;exÃ©cute seule par invocation directe, la seconde sait se greffer dans
le cycle de construction du projet. Mais comment fait Maven pour
dÃ©terminer quand l&#8217;exÃ©cuterÂ ?</p>
</div>
</div>
<div class="sect3">
<h4 id="_cycle_de_vie">Cycle de vie</h4>
<div class="paragraph">
<p>Ce que nous avons jusqu&#8217;ici qualifiÃ© de Â«Â projet typeÂ Â» utilisÃ© par Maven
pour identifier et enchaÃ®ner les tÃ¢ches de base d&#8217;un projet Java est en
rÃ©alitÃ© composÃ© de deux Ã©lÃ©mentsÂ : le cycle de vie d&#8217;un cÃ´tÃ©, et les
plugins et tÃ¢ches qui y sont attachÃ©s de l&#8217;autre.</p>
</div>
<div class="paragraph">
<p>Le cycle de vie est une sÃ©rie de phases ordonnÃ©es qui doit couvrir les
besoins de tout projet. Ces phases sont purement symboliques et ne sont
associÃ©es Ã  aucun traitement particulier, mais elles permettent de
dÃ©finir les Ã©tapes clÃ©s de la construction du projet. On retrouve
ainsiÂ :</p>
</div>
<div class="paragraph">
<p>Tableau 3.1Â : Le cycle de vie dÃ©fini par Maven</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Phase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">validation du projet Maven</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initialize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">initialisation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">generate-sources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gÃ©nÃ©ration de code source</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">process-resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">traitement des fichiers de ressources</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">compile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">compilation des fichiers sources</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">process-classes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Posttraitement des fichiers binaires compilÃ©s</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">test-compile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">compilation des tests</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exÃ©cution des tests</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">assemblage du projet sous forme d&#8217;archive Java</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">install</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mise Ã  disposition de l&#8217;archive sur la machine locale pour d&#8217;autres projets</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mise Ã  disposition publique de l&#8217;archive java</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Il s&#8217;agit d&#8217;une liste simplifiÃ©eÂ : le cycle complet dÃ©finit de
nombreuses phases intermÃ©diaires, dont vous trouverez la description
complÃ¨te dans la documentation en ligne de Maven <sup class="footnote">[<a id="_footnoteref_15" class="footnote" href="#_footnotedef_15" title="View footnote.">15</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>Quels que soient le projet et ses particularitÃ©s, tout traitement
rÃ©alisÃ© pour le Â«Â construireÂ Â» viendra naturellement se greffer sur l&#8217;une
de ces Ã©tapes.</p>
</div>
<div class="paragraph">
<p>Pour un projet standard (sans indication de &lt;packaging&gt;), Maven
considÃ¨re que le binaire Ã  construire est une archive JAR. Chaque plugin
propose des tÃ¢ches qui correspondent Ã  un traitement unitaire. Maven
associe un certain nombre de tÃ¢ches Ã  ces phases du cycle de vie. La
tÃ¢che compile du plugin de compilation, par exemple, est associÃ©e Ã  la
phase <em>compile</em>, et la tÃ¢che jar du plugin d&#8217;archivage Ã  la phase package.
L&#8217;invocation de la commande <code>mvn deploy</code> va alors dÃ©rouler une Ã  une les
Ã©tapes du cycle de vie jusqu&#8217;Ã  la phase demandÃ©e (deploy), et exÃ©cuter
pour chacune d&#8217;elles les tÃ¢ches des plugins qui lui sont associÃ©sÂ :</p>
</div>
<div class="paragraph">
<p>Tableau 3.2Â : Les plugins et les tÃ¢ches associÃ©s par dÃ©faut au cycle de
vie d&#8217;un projet JAR</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 34%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Phase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Plugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TÃ¢che</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">process-resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maven-resources-plugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">compile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maven-compiler-plugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">process-test-resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maven-resources-plugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">testResources</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">test-compile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maven-compiler-plugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">testCompile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maven-surefire-plugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maven-jar-plugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">install</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maven-install-plugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Install</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maven-deploy-plugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deploy</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Maven fournit un moyen pour venir greffer d&#8217;autres plugins Ã  ce cycle,
en plus de ceux qu&#8217;il aura associÃ©s par dÃ©faut.</p>
</div>
<div class="paragraph">
<div class="title">Figure 03-05</div>
<p><span class="image"><img src="illustrations/03-05.png" alt="03 05"></span></p>
</div>
<div class="paragraph">
<p>Cycle de vie du projet et plugins exÃ©cutÃ©s pour chaque phase.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Generer_du_code">GÃ©nÃ©rer du code</h3>
<div class="paragraph">
<p>Suite aux nombreuses Ã©volutions que nous avons apportÃ©es, notre projet
est aujourd&#8217;hui capable d&#8217;invoquer des services Web SOAP pour s&#8217;intÃ©grer
avec d&#8217;autres applications. Ce code a Ã©tÃ© dÃ©veloppÃ© <em>via</em> l&#8217;un des
nombreux assistants qui peuplent les environnements de dÃ©veloppement
intÃ©grÃ© modernes. Nous lui avons fait ingurgiter le WSDL du systÃ¨me
partenaire et il a gÃ©nÃ©rÃ© pour nous un squelette de code que nous
n&#8217;avons eu qu&#8217;Ã  complÃ©ter.</p>
</div>
<div class="paragraph">
<p>L&#8217;intÃ©gration de gÃ©nÃ©rateurs de code dans les environnements de
dÃ©veloppement, masquÃ©s derriÃ¨re des interfaces graphiques colorÃ©es et
des barres de progression, nous ferait presque oublier la complexitÃ©
technique de ces outils. Nous allons pourtant Ãªtre rapidement rappelÃ©s Ã 
l&#8217;ordre.</p>
</div>
<div class="paragraph">
<p>AprÃ¨s une migration technique importante, notre partenaire nous transmet
la nouvelle version de son contrat de service web, un nouveau fichier
WSDL. Seulement Fabrice, responsable de la mise en Åuvre de ce service
web, est en congÃ© aux CaraÃ¯bes pour un mois. Il va donc falloir se
dÃ©brouiller sans lui.</p>
</div>
<div class="paragraph">
<p>PremiÃ¨re questionÂ : comment utilise-t-on ce fameux assistant de crÃ©ation
de service webÂ ? Les options sont nombreuses et, sans un bon bagage
technique, il nous est difficile de savoir lesquelles choisir. La
stratÃ©gie du Â«Â tout par dÃ©fautÂ Â» ne nous garantit pas la pertinence du
rÃ©sultat.</p>
</div>
<div class="paragraph">
<p>Seconde interrogationÂ : les classes prÃ©cÃ©demment gÃ©nÃ©rÃ©es avaient-elles
Ã©tÃ© modifiÃ©esÂ ? Nous pourrions Ã©craser purement et simplement le package
Java correspondant au code gÃ©nÃ©rÃ©, mais sommes-nous sÃ»rs que Fabrice n&#8217;y
a pas fait des adaptationsÂ ?</p>
</div>
<div class="paragraph">
<p>En fouillant dans les notes de Fabrice, nous trouvons heureusement le
petit guide du dÃ©veloppeur de service web qui rÃ©pond Ã  nos questions (et
donc pas besoin de le dÃ©ranger d&#8217;urgence durant ses vacances bien
mÃ©ritÃ©es).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Nous ne doutons pas que, sur vos projets, vous disposiez d&#8217;une
documentation trÃ¨s complÃ¨te et toujours Ã  jour pour dÃ©crire ces
procÃ©dures. Pensez tout de mÃªme au temps que nÃ©cessite la maintenance de
ces documents et au temps perdu par un nÃ©ophyte pour se plonger dedans
quand il en a besoin.</p>
</div>
<div class="paragraph">
<p>Cela ne signifie pas pour autant que Maven rende un systÃ¨me documentaire
inutile. Cependant, autant que possible, automatisez et simplifiez les
choses et ayez le rÃ©flexe wiki plutÃ´t que document de synthÃ¨se validÃ©
par quinze relecteurs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Maven propose une autre approche Ã  ce problÃ¨me, une fois de plus <em>via</em>
ses plugins. Rappelons que, pour Maven, le rÃ©pertoire src ne doit
contenir que le code source et que le rÃ©pertoire <em>target</em> est dÃ©diÃ© Ã  tous
les fichiers intermÃ©diaires de la construction du projet. Maven
considÃ¨re que des fichiers gÃ©nÃ©rÃ©s ne sont pas des fichiers sources,
mÃªme s&#8217;ils sont Ã©crits dans la syntaxe du langage Java. Le fichier
source est le contrat WSDL qui permet de les produire. Rien
n&#8217;interdirait Ã  l&#8217;outil de gÃ©nÃ©ration de produire directement du code
binaire dans des fichiers class (si ce n&#8217;est que c&#8217;est nettement plus
compliquÃ©). Il n&#8217;y a donc aucune raison de placer ce code gÃ©nÃ©rÃ© dans
notre arborescence src.</p>
</div>
<div class="paragraph">
<p>Le plugin cxf-codegen associÃ© Ã  notre pile de services web Apache CXF
sait prendre en charge la procÃ©dure de gÃ©nÃ©ration de code. Il s&#8217;associe
Ã  la phase generate-source du cycle de vie qui est prÃ©vue pour ce type
de plugins. Il prend en paramÃ¨tre les fichiers WSDL Ã  traiter et les
options de gÃ©nÃ©rationÂ ; aussi plaÃ§ons-nous notre fichier WSDL dans un
rÃ©pertoire de ressources dÃ©diÃ© Ã  ce formatÂ : src/main/resources/wsdl.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
   &lt;groupId&gt;org.apache.cxf&lt;/groupId&gt;
   &lt;artifactId&gt;cxf-codegen-plugin&lt;/artifactId&gt;
   &lt;version&gt;2.3.3&lt;/version&gt;
   &lt;executions&gt;
     &lt;execution&gt;
          &lt;goals&gt;
            &lt;goal&gt;wsdl2java&lt;/goal&gt;
          &lt;/goals&gt;
     &lt;/execution&gt;
   &lt;/executions&gt;
   &lt;configuration&gt;
     &lt;defaultOptions&gt;
        &lt;noAddressBinding&gt;true&lt;/noAddressBinding&gt;
    &lt;/defaultOptions&gt;
   &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Le code gÃ©nÃ©rÃ© par ce plugin est placÃ© dans le rÃ©pertoire
target/generated-sources/cxf. Il s&#8217;agit Ã©galement d&#8217;une convention de
Maven, qui permet Ã  chaque plugin gÃ©nÃ©rateur de code d&#8217;avoir son propre
rÃ©pertoire de gÃ©nÃ©ration tout en conservant une certaine cohÃ©renceÂ :</p>
</div>
<div class="paragraph">
<p>&lt;rÃ©pertoire de build "target"&gt;/generated-(re)sources/&lt;nom du plugin&gt;</p>
</div>
<div class="paragraph">
<p>Ces rÃ©pertoires sont automatiquement ajoutÃ©s dans le chemin de
compilation du projet et seront donc pris en considÃ©ration lors de la
phase de compilation qui suit. Par ailleurs, Ã©tant placÃ© dans
l&#8217;arborescence <em>target</em>, ce code peut Ãªtre facilement isolÃ© du code source
que nous produisons, par exemple lorsque nous le publions dans notre
gestionnaire de code source.</p>
</div>
<div class="paragraph">
<p>La stratÃ©gie utilisÃ©e par Maven pour les gÃ©nÃ©rateurs de code rÃ©sout donc
nos deux problÃ¨mesÂ : la procÃ©dure de gÃ©nÃ©ration n&#8217;a tout simplement plus
besoin d&#8217;Ãªtre documentÃ©e. Elle est systÃ©matiquement exÃ©cutÃ©e, ce qui a
l&#8217;avantage non nÃ©gligeable de nous assurer la totale cohÃ©rence entre le
fichier source qui sert Ã  cette gÃ©nÃ©ration et qui seul fait foi, et le
code qui en est dÃ©rivÃ© et est utilisÃ© par l&#8217;application. Ensuite, une
modification du code gÃ©nÃ©rÃ© est tout simplement impossible, celui-ci
n&#8217;Ã©tant pas sauvegardÃ© dans le gestionnaire de sources. Il vous suffit
gÃ©nÃ©ralement d&#8217;Ã©tendre les classes gÃ©nÃ©rÃ©es pour dÃ©velopper le code
propre Ã  votre application, plutÃ´t que de venir modifier ce code et de
risquer de tout perdre lors de la gÃ©nÃ©ration suivante, ou de devoir
comparer deux versions et reporter manuellement vos modifications.</p>
</div>
<div class="paragraph">
<p>Le seul inconvÃ©nient de cette pratique est que le gÃ©nÃ©rateur de code
sera invoquÃ© Ã  chaque construction du projet par Maven. L&#8217;outil de
gÃ©nÃ©ration peut Ãªtre assez lourd et son lancement systÃ©matique,
pÃ©nalisant pour votre productivitÃ©. Aussi, les plugins Maven associÃ©s
utilisent gÃ©nÃ©ralement des mÃ©canismes permettant de ne lancer la
gÃ©nÃ©ration que lorsque c&#8217;est rÃ©ellement nÃ©cessaire, soit parce que le
rÃ©pertoire de gÃ©nÃ©ration n&#8217;existe pas, soit parce que le fichier qui
sert de rÃ©fÃ©rence a Ã©tÃ© modifiÃ©.</p>
</div>
</div>
<div class="sect2">
<h3 id="_produire_autre_chose_quun_jar">Produire autre chose qu&#8217;un JAR</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaFrancois.png" alt="MangaFrancois"></span></p>
</div>
<div class="paragraph">
<p>AmusÃ© par notre interface web en GWT, FranÃ§ois se joint Ã  notre Ã©quipe.
La particularitÃ© de FranÃ§ois est qu&#8217;il n&#8217;est pas seulement un
dÃ©veloppeur Java, mais aussi  un spÃ©cialiste de la plateforme Flex
d&#8217;Adobe. Il dÃ©cide donc de nous dÃ©velopper une interface web faisant
appel Ã  toute la richesse du plugin Flash.</p>
</div>
<div class="paragraph">
<p>Comme pour les cas prÃ©cÃ©dents, nous dÃ©couvrons avec plaisir qu&#8217;il existe
un plugin Maven, le projet Flex-mojos <sup class="footnote">[<a id="_footnoteref_16" class="footnote" href="#_footnotedef_16" title="View footnote.">16</a>]</sup>, qui prend en
charge la compilation spÃ©cifique des sources Flex. Cependant, Flex n&#8217;est
pas Java, et une application Flash s&#8217;assemble sous forme d&#8217;un fichier
SWF qui n&#8217;a pas grand-chose en commun avec un JAR. Il ne suffira donc
pas d&#8217;ajouter Ã  notre fichier POM des dÃ©clarations de plugins, il faut
complÃ¨tement changer le cycle de vie et les plugins par dÃ©faut utilisÃ©s
par Maven.</p>
</div>
<div class="paragraph">
<p>Ce cycle de vie par dÃ©faut est sÃ©lectionnÃ© par Maven en fonction de
l&#8217;Ã©lÃ©ment &lt;packaging&gt; de notre POM, qui prend par dÃ©faut la valeur jar.
Nous pouvons tout aussi bien lui donner la valeur war pour construire
une application web, ou ear pour une archive d&#8217;entreprise (voir
Chapitre 8). Pour crÃ©er une application Flash, nous allons utiliser le
packaging SWF. Cette valeur n&#8217;est, bien sÃ»r, pas comprise par Maven sans
un peu d&#8217;aide.</p>
</div>
<div class="paragraph">
<p>Maven est conÃ§u pour Ãªtre fortement extensible, aussi l&#8217;association du
packaging avec un cycle de vie est rÃ©alisÃ©e Ã  l&#8217;exÃ©cution et peut Ãªtre
assistÃ©e par des complÃ©ments, appelÃ©s extensions. Un plugin peut
lui-mÃªme apporter des extensionsÂ : c&#8217;est le cas du plugin flex-mojos.</p>
</div>
<div class="paragraph">
<p>Le fichier POM du projet proposÃ© par FranÃ§ois inclut donc, par rapport Ã 
un projet Java Â«Â classiqueÂ Â»Â :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>des dÃ©clarations classiques de dÃ©pendances vers le SDK Adobe Flex,
dont les artefacts sont de type SWC et non JARÂ ;</p>
</li>
<li>
<p>la dÃ©claration de rÃ©pertoire de sources et de tests, propre au
langage Flex qu&#8217;il utiliseÂ ;</p>
</li>
<li>
<p>la dÃ©claration du plugin flex-mojos. Le point clÃ© est l&#8217;Ã©lÃ©ment
&lt;extension&gt;true&lt;/extension&gt; qui signale Ã  Maven que ce plugin propose
des complÃ©ments qu&#8217;il faudra prendre en compte avant de dÃ©terminer le
cycle de vie et les tÃ¢ches Ã  exÃ©cuterÂ ;</p>
</li>
<li>
<p>la version du compilateur Flex Ã  utiliser par le plugin. Le plugin
n&#8217;est pas liÃ© Ã  une version particuliÃ¨re de SDK Flex, aussi l&#8217;ajout
d&#8217;une dÃ©pendance au plugin permet de spÃ©cifier la version qu&#8217;il devra
utiliser.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Le Listing 3.1 montre le POM utilisÃ© par FranÃ§ois pour son projet qui
nous fait mettre un pied en dehors du monde Java. <sup class="footnote">[<a id="_footnoteref_17" class="footnote" href="#_footnotedef_17" title="View footnote.">17</a>]</sup></p>
</div>
<div class="listingblock">
<div class="title">Listing 3.1 : Production d&#8217;un binaire SWF</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;project&gt;
   &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
   &lt;groupId&gt;fr.noubliepaslalistedescourses&lt;/groupId&gt;
   &lt;artifactId&gt;ihm-flash&lt;/artifactId&gt;
   &lt;version&gt;1.0&lt;/version&gt;
   &lt;packaging&gt;swf&lt;/packaging&gt;
   &lt;build&gt;
      &lt;sourceDirectory&gt;src/main/flex&lt;/sourceDirectory&gt;
      &lt;testSourceDirectory&gt;src/test/flex&lt;/testSourceDirectory&gt;
      &lt;plugins&gt;
         &lt;plugin&gt;
            &lt;groupId&gt;org.sonatype.flexmojos&lt;/groupId&gt;
            &lt;artifactId&gt;flexmojos-maven-plugin&lt;/artifactId&gt;
            &lt;version&gt;4.0-beta-5&lt;/version&gt;
            &lt;extensions&gt;true&lt;/extensions&gt;
         &lt;/plugin&gt;
      &lt;/plugins&gt;
   &lt;/build&gt;
   &lt;dependencies&gt;
      &lt;!-- Flex SDK dependencies --&gt;
      &lt;dependency&gt;
         &lt;groupId&gt;com.adobe.flex.framework&lt;/groupId&gt;
         &lt;artifactId&gt;flex-framework&lt;/artifactId&gt;
         &lt;version&gt;4.5.0.18623&lt;/version&gt;
         &lt;type&gt;pom&lt;/type&gt;
      &lt;/dependency&gt;
      ...
   &lt;/dependencies&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Si le numÃ©ro de version en -beta du plugin vous inquiÃ¨te, ne perdez pas
de vue que ces composants sont dÃ©veloppÃ©s en Open Source, et donc
proposent Ã  intervalle rÃ©gulier des versions intermÃ©diaires. Â« Release
early, release often Â» est une devise de dÃ©veloppement agile trÃ¨s prisÃ©e
dans ce milieu.</p>
</div>
<div class="paragraph">
<p>Cela ne signifie pas que les fonctionnalitÃ©s ne soient pas au
rendez-vous. Les versions Â« finales Â» ne bÃ©nÃ©ficient pas d&#8217;un meilleur
support ou de soins particuliers, et ces versions intermÃ©diaires vous
apportent les derniÃ¨res corrections. Par contre, les versions
intermÃ©diaires peuvent remettre en question certaines options, mÃªme si
la compatibilitÃ© et le respect des utilisateurs sont la rÃ¨gle gÃ©nÃ©ralement
suivieÂ ; aussi vous devrez consulter les release-notes pour adapter votre
projet le cas Ã©chÃ©ant.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ce fichier POM n&#8217;a rien de trÃ¨s diffÃ©rent de ce que nous avons utilisÃ©
jusqu&#8217;Ã  prÃ©sent, et pourtant il s&#8217;adresse Ã  une plateforme trÃ¨s
diffÃ©rente de Java. Maven montre ici ses capacitÃ©s d&#8217;adaptation et
d&#8217;extensibilitÃ©. Un simple plugin dÃ©diÃ© Ã  un langage ou Ã  une plateforme
diffÃ©rente permet d&#8217;utiliser Maven dans un cadre pour lequel il n&#8217;a pas
du tout Ã©tÃ© prÃ©vu initialement. Le cycle de vie du projet peut Ãªtre
totalement adaptÃ© pour des besoins trÃ¨s particuliers, enchaÃ®nant les
tÃ¢ches adÃ©quates d&#8217;un plugin dÃ©diÃ©.</p>
</div>
<div class="paragraph">
<p>Nous sommes bluffÃ©s par la dÃ©monstration de FranÃ§ois, qui nous prÃ©sente
une interface web d&#8217;un trÃ¨s haut niveau, mais nous sommes presque plus
stupÃ©faits de la facilitÃ© avec laquelle il a pu intÃ©grer un langage <em>a
priori</em> trÃ¨s Ã©loignÃ© du monde Java dans notre mÃ©canisme de construction
de projet. Et cela ne sâarrÃªte pas lÃ , nous dit-il, car avec
lâutilisation dâoutils comme flexunit,  flexpmd, flexcoverage et
lâintÃ©gration dans Sonar (que nous vous prÃ©senterons au chapitre 12), la
couverture de services autour des projets flex avec Maven est proche de
ce que lâon obtient avec du Java traditionnel.</p>
</div>
</div>
<div class="sect2">
<h3 id="_des_plugins_pour_tout">Des plugins pour toutÂ ?</h3>
<div class="paragraph">
<p>Dans les exemples que nous venons de voir, nous avons fait appel Ã 
diffÃ©rents plugins utilisant des identifiants de groupe variÃ©s. Le
plugin de compilation est dÃ©veloppÃ© dans le cadre de Maven lui-mÃªme et
porte donc l&#8217;identifiant de groupe org.apache.maven.plugins. Quelques
plugins de base sont Ã©galement dans ce cas, et leur documentation est
accessible sur le site de Maven <sup class="footnote">[<a id="_footnoteref_18" class="footnote" href="#_footnotedef_18" title="View footnote.">18</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>Le plugin GWT est dÃ©veloppÃ© dans le cadre du projet Mojo, qui est en
fait plus une communautÃ© qu&#8217;un projet Ã  proprement parler. Elle regroupe
des dÃ©veloppeurs qui contribuent Ã  une grande variÃ©tÃ© de plugins ou
expÃ©rimentent des idÃ©es dans un Â«Â bac Ã  sableÂ Â». Ces plugins sont associÃ©s
Ã  l&#8217;identifiant de groupe org.codehaus.mojo. La liste de ces plugins est
longue et s&#8217;enrichit rÃ©guliÃ¨rement, vous trouverez trÃ¨s probablement
votre bonheur dedans.</p>
</div>
<div class="paragraph">
<p>Le plugin CXF est, lui, dÃ©veloppÃ© en marge du projet Apache CXF,
autrement dit l&#8217;Ã©quipe de dÃ©veloppement de ce projet prend elle-mÃªme en
charge son intÃ©gration avec Maven. Ce cas est de plus en plus courant
avec la place importante que prend Maven dans le monde Java.</p>
</div>
<div class="paragraph">
<p>D&#8217;autres plugins, dÃ©veloppÃ©s en marge des grandes fondations ou
entreprises contributrices d&#8217;Open Source,  utilisent leurs propres
dÃ©pÃ´ts. C&#8217;est le cas par exemple pour le plugin Onejar
(<a href="http://onejar-maven-plugin.googlecode.com/">http://onejar-maven-plugin.googlecode.com</a>)
qui hÃ©berge la documentation et le dÃ©pÃ´t Maven du plugin directement
dans son Subversion. Pour utiliser un dÃ©pÃ´t non standard de plugins, il
nous faut ajouter au projet la dÃ©claration adÃ©quateÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">   &lt;pluginRepositories&gt;
      &lt;pluginRepository&gt;
         &lt;id&gt;onejar-maven-plugin.googlecode.com&lt;/id&gt;
         &lt;url&gt;http://onejar-maven-plugin.googlecode.com/svn/mavenrepo&lt;/url&gt;
      &lt;/pluginRepository&gt;
   &lt;/pluginRepositories&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>De trÃ¨s nombreux plugins vivent indÃ©pendamment, dÃ©veloppÃ©s sur les
services d&#8217;hÃ©bergement SourceForge, Googlecode, GitHub, ou par des
sociÃ©tÃ©s qui les diffusent depuis leur propre site web. Il n&#8217;en existe
pas d&#8217;index officiel ou de catalogue toujours Ã  jour vous permettant de
trouver la perle rare. Votre moteur de recherche prÃ©fÃ©rÃ© est souvent
votre meilleur ami, associÃ© au forum des utilisateurs de Maven.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Faut-il le prÃ©ciser, si vous dÃ©veloppez votre propre plugin Maven, nous
vous encourageons Ã  le publier via le dÃ©pÃ´t officiel Â« central Â». Au
prix d&#8217;un petit effort initial, vous simplifierez grandement la vie de
vos utilisateurs. La procÃ©dure est expliquÃ©e en dÃ©tail sur le siteÂ :
<a href="http://maven.apache.org/guides/mini/guide-central-repository-upload.html">http://maven.apache.org/guides/mini/guide-central-repository-upload.html</a>.</p>
</div>
<div class="paragraph">
<p>Une autre option que nous ne pouvons que vous recommander est de
proposer votre plugin en contribution au projet Mojo
(<a href="http://mojo.codehaus.org" class="bare">http://mojo.codehaus.org</a>), ce qui lui donnera une bien meilleure
visibilitÃ©, ainsi que l&#8217;aide possible des dÃ©veloppeurs de la communautÃ©.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="image"><img src="illustrations/Maven3.png" alt="Maven3"></span></p>
</div>
<div class="paragraph">
<p>Maven2 ne fait pas de sÃ©paration trÃ¨s claire entre les dÃ©pÃ´ts
dâartefacts que vous dÃ©clarez dans votre POM et vos dÃ©clarations de dÃ©pÃ´ts
de plugins â un dÃ©pÃ´t de plugin Ã©tant en gÃ©nÃ©ral aussi un dÃ©pÃ´t
dâartefacts.</p>
</div>
<div class="paragraph">
<p>Maven 3 est plus strict et refusera dâutiliser un plugin, mÃªme sâil est
prÃ©sent dans lâun des dÃ©pÃ´ts dÃ©clarÃ©s, sauf si vous dÃ©clarez clairement
le &lt;pluginRepository&gt; adÃ©quat. De mÃªme, les dÃ©pendances dÃ©clarÃ©es par le
plugin ne seront recherchÃ©es que dans son dÃ©pÃ´t dâorigine et non dans
vos propres dÃ©pÃ´ts.</p>
</div>
<div class="paragraph">
<p>Une fois encore, ce nâest pas pour vous embÃªter, mais pour fiabiliser le
projet et avoir un <em>build</em> reproductible, quel que soit lâenvironnement.
Sans cette prÃ©caution, certains plugins peuvent voir leur liste de
dÃ©pendances modifiÃ©e par le projet qui les utilise et se comporter
bizarrement.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_2">Conclusion</h3>
<div class="paragraph">
<p>Maven propose un cadre de dÃ©veloppement strict qui permet de complÃ©ter
le projet grÃ¢ce Ã  de nombreux plugins sans interaction nÃ©faste entre
eux. <em>Via</em> son cycle de vie, chaque plugin trouve sa place et contribue
Ã  l&#8217;outillage global du projet par petites touches. Un outillage complet
du cycle de vie du projet permet de contrÃ´ler toutes ses Ã©tapes en une
seule commande et, surtout, regroupe toutes les infos et tous les
paramÃ¨tres de configuration nÃ©cessaire en un seul endroit.</p>
</div>
<div class="paragraph">
<p>Quels que soient le projet Maven auquel vous participez et son langage,
la commande <code>mvn install</code> sera toujours le seul et unique point d&#8217;entrÃ©e
pour construire le projet, en intÃ©grant toutes les Ã©tapes nÃ©cessaires.
La structure du projet sera toujours identique et vous permettra d&#8217;Ãªtre
rapidement productif, sans devoir passer par un long Â«Â guide de
dÃ©marrageÂ Â» prÃ©cisant les bibliothÃ¨ques Ã  utiliser et le rÃ´le de chaque
paramÃ¨tre.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chapitre_4mettre_en_place_des_tests_unitaires">Chapitre 4Â :Â Mettre en place des tests unitaires</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le petit projet initial est maintenant de l&#8217;histoire ancienne. Sous
l&#8217;impulsion de contributeurs enthousiastes, de nombreuses
fonctionnalitÃ©s sont venues l&#8217;enrichir. Il propose aujourd&#8217;hui une
multitude de services tous aussi indispensables les uns que les autres.
La diversitÃ© des contributions introduit cependant une nouvelle
difficultÃ©Â : le projet est devenu quelque peu chaotique et relativement
hÃ©tÃ©rogÃ¨ne. Ã tel point qu&#8217;il devient dÃ©licat d&#8217;introduire une nouvelle
fonction sans risquer de Â«Â casserÂ Â» quelque chose.</p>
</div>
<div class="paragraph">
<p>La solution, nous la connaissons dÃ©jÃ . Il est nÃ©cessaire de passer par
une phase de rÃ©ingÃ©nierie (<em>refactoring</em>) pour mieux structurer notre
code et le simplifier, lâassouplir, le rendre extensible, adaptable,
brefÂ : meilleur. Ce travail nÃ©cessite cependant de s&#8217;assurer que les
services rendus resteront les mÃªmes aprÃ¨s ces modifications.</p>
</div>
<div class="paragraph">
<p>Aujourd&#8217;hui dÃ©jÃ , quelle que soit l&#8217;Ã©volution que l&#8217;on dÃ©sire apporter
au logiciel, fonctionnelle ou purement technique, nous sommes contraints
d&#8217;une faÃ§on ou d&#8217;une autre de vÃ©rifier les Ã©ventuelles erreurs et
incompatibilitÃ©s que nous pourrions introduire involontairement. Nous
passons donc beaucoup de temps Ã  tester l&#8217;application afin de voir si
elle continue de fonctionner Â«Â comme avantÂ Â».</p>
</div>
<div class="sect2">
<h3 id="_tester_pour_quoi_faire">Tester ? Pour quoi faire ?</h3>
<div class="paragraph">
<p>Tester un logiciel est un travail rÃ©pÃ©titif, souvent ennuyeux, mais
pourtant indispensable. Nous devons Ã©videmment vÃ©rifier que la toute
derniÃ¨re Ã©volution fonctionne comme prÃ©vu, ce qui est relativement
motivant. Nous devons Ã©galement par la mÃªme occasion nous assurer que
tout le reste de l&#8217;application n&#8217;a pas perdu en stabilitÃ©. Un effet de
bord peut Ãªtre dÃ©vastateur, et un bogue rapidement introduit. Et bien
souvent leur cause se cache dans une modification qui semble minime au
premier abord.</p>
</div>
<div class="paragraph">
<p>Une gestion de la qualitÃ© du logiciel doit prendre Ã  bras-le-corps la
problÃ©matique des tests. Chaque version doit proposer une sÃ©rie de
vÃ©rifications Ã  effectuer pour valider les nouveaux dÃ©veloppements, mais
aussi inclure l&#8217;ensemble des tests identifiÃ©s pour les versions
prÃ©cÃ©dentes, afin de s&#8217;assurer que l&#8217;application ne rÃ©gresse pas. Il ne
faudrait pas casser quelque chose qui fonctionnait dans la version
prÃ©cÃ©dente.</p>
</div>
<div class="paragraph">
<p>Une fonctionnalitÃ© qui disparaÃ®t ou se dÃ©grade dans la version suivante,
c&#8217;est autant d&#8217;utilisateurs mÃ©contents. Sans compter les nombreuses
heures perdues Ã  identifier le problÃ¨me et Ã  lui trouver une solution
acceptable dans l&#8217;urgenceÂ : souvent un simple compromis avec la solution
Â«Â idÃ©aleÂ Â» que l&#8217;on aimerait mettre en place, mais qui nÃ©cessiterait trop
de travail ou introduirait de nouveaux risques.</p>
</div>
<div class="paragraph">
<p>Cependant, passer des tests a un coÃ»t, surtout si l&#8217;on accumule les
tests ajoutÃ©s par de nombreuses versions du logiciel. Se reposer sur le
seul humain pour cette tÃ¢che, c&#8217;est s&#8217;exposer Ã  de nombreux risquesÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>le coÃ»t du passage des tests, considÃ©rant la main-d&#8217;Åuvre employÃ©e
Ã  plein-temps Ã  cette tÃ¢cheÂ ;</p>
</li>
<li>
<p>le temps de rÃ©action lorsqu&#8217;un problÃ¨me a Ã©tÃ© introduit par une
modification. Plus tard on s&#8217;en rendra compte, plus la correction Ã 
apporter sera dÃ©licateÂ ;</p>
</li>
<li>
<p>la rigueur du passage des tests, si l&#8217;on considÃ¨re que l&#8217;Ãªtre
humain se lasse vite de tÃ¢ches rÃ©pÃ©titives et peu porteuses de
crÃ©ativitÃ©.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_automatisons">AutomatisonsÂ !</h4>
<div class="paragraph">
<p>Pour limiter ces risques, il existe une pratique simple et
particuliÃ¨rement efficaceÂ :Â l&#8217;automatisation des testsÂ ! Un mÃ©canisme
automatique ne coÃ»te pas grand-chose Ã  l&#8217;exÃ©cution. En dehors de la
machine qu&#8217;il monopolise, il ne rÃ©clame pas d&#8217;augmentation ni de congÃ©s.
Il peut Ãªtre trÃ¨s rapide et ne se lasse pas de ce qu&#8217;on lui demande de
faire. MÃªme aprÃ¨s des centaines de rÃ©pÃ©titions, il sera tout aussi
regardant sur le rÃ©sultat qu&#8217;il est censÃ© vÃ©rifier. Nous devons donc
voir les tests comme un traitement informatique intÃ©grÃ© dans notre
projet. La crÃ©ation des tests, mÃªme si elle a un coÃ»t, est avant tout un
investissement qui nous prÃ©munit des rÃ©gressions dans le futur, et qui
amÃ©liore l&#8217;Ã©volutivitÃ© de notre logiciel en levant l&#8217;angoisseÂ : Â«Â Je ne
touche pas au cas oÃ¹ je casserais quelque chose.Â Â» Les tests automatisÃ©s
sont un vÃ©ritable vecteur pour l&#8217;amÃ©lioration de la productivitÃ© des
Ã©quipes puisqu&#8217;ils leur permettent de se concentrer sur le logiciel en
toute quiÃ©tude mÃªme si une partie importante du code doit Ãªtre
<em>refactorisÃ©e</em>.</p>
</div>
<div class="paragraph">
<p>La solution la plus Ã©lÃ©mentaire pour mettre en place des tests
automatisÃ©s consiste Ã  intÃ©grer dans le code des fragments de tests, en
gÃ©nÃ©ral sous forme d&#8217;une mÃ©thode <em>main</em> chargÃ©e de vÃ©rifier le
fonctionnement de la classe qui la dÃ©finit, comme dans l&#8217;exemple du
Listing 4.1.</p>
</div>
<div class="listingblock">
<div class="title">Listing 4.1 : Une mÃ©thode main de test</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ListeDeCoursesReader {

    public ListeDeCourses read( InputStream in ) { ... }

    /** Test automatique de la classe ListeDeCoursesReader */
    public static void main( String args[] ) {
        ListeDeCoursesReader reader = new ListeDeCourseReader();
        ListeDeCourses lu = reader.read( new FileInputStream("./test.list" ) );
        if ( lu == null ) {
            System.err.println( "FAILED : Erreur de lecture" ) ;
            System.exit( -1 ) ;
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cette pratique est cependant trÃ¨s discutable. D&#8217;une part, elle nÃ©cessite
de passer par un lanceur qui va exÃ©cuter toutes les mÃ©thodes <em>main</em> des
tests, l&#8217;automatisation n&#8217;est donc pas complÃ¨te. Ensuite, notre projet
va embarquer dans son code binaire le code de test, qui n&#8217;a pas grand
intÃ©rÃªt pour les utilisateurs. Si l&#8217;augmentation de la taille du fichier
JAR n&#8217;est pas en soi un problÃ¨me bloquant, cela n&#8217;est pas
conceptuellement trÃ¨s satisfaisant.</p>
</div>
<div class="paragraph">
<p>MalgrÃ© ces quelques reproches, considÃ©rons tout de mÃªme cette option qui
a l&#8217;avantage d&#8217;Ãªtre simple et a d&#8217;ailleurs Ã©tÃ© une pratique courante en
dÃ©veloppement Java.</p>
</div>
<div class="paragraph">
<p>Pour amÃ©liorer la capacitÃ© de notre test Ã  identifier un problÃ¨me, nous
allons contrÃ´ler le contenu de l&#8217;objet ListeDeCourses lu lors de
l&#8217;exÃ©cution du test. Nous nous basons donc sur une comparaison entre un
objet ListeDeCourses attendu et l&#8217;objet ListeDeCourses effectivement
construit lors de l&#8217;exÃ©cution du test. Pour ne pas devoir Ã©crire la
comparaison entre ces deux objets (attendu <em>vs</em> effectif), nous faisons
appel Ã  la classe BeanComparator de la bibliothÃ¨que Ã©prouvÃ©e
commons-beanutils <sup class="footnote">[<a id="_footnoteref_19" class="footnote" href="#_footnotedef_19" title="View footnote.">19</a>]</sup> qui fait ce travail pour nous en une
seule ligne de code, ce qui rend le test plus simple et plus lisible.
Inutile de rÃ©inventer la roue et de venir compliquer le code alors que
cette classe simplifie tellement la tÃ¢che et nous permet de nous
focaliser sur notre objectifÂ :Â tester de maniÃ¨re automatique autant de
fonctionnalitÃ©s que possible. Le Listing 4.2 montre cette Ã©volution de
notre mÃ©thode de test.</p>
</div>
<div class="listingblock">
<div class="title">Listing 4.2 : Utilisation d&#8217;une bibliothÃ¨que utilitaire dans le test</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    /** Test automatique de la classe ListeDeCoursesReader */

    public static void main( String args[] ) {
        ListeDeCoursesReader reader = new ListeDeCoursesReader();
        ListeDeCourses attendu = new ListeDeCourses( ... );
        ListeDeCourses lu = reader.read( new FileInputStream("./test.list" ) );
        if ( new BeanComparator().compare( attendu, lu ) != 0 ) {
            System.err.println( "FAILED : DonnÃ©es lues incorrectes" ) ;
            System.exit( -1 ) ;
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>TrÃ¨s fiers de notre mÃ©canisme de test automatisÃ©, nous lanÃ§ons donc la
version fraÃ®chement compilÃ©e de l&#8217;application sur notre serveur de test.
Et lÃ , c&#8217;est la douche froideÂ :</p>
</div>
<div class="paragraph">
<p>ClassNotFoundException org.apache.commons.beanutils.BeanComparator</p>
</div>
<div class="paragraph">
<p>Que s&#8217;est-il passÃ©Â ? L&#8217;introduction d&#8217;une nouvelle bibliothÃ¨que pour
simplifier l&#8217;Ã©criture du test a crÃ©Ã© des imports dans le code, imports
qui ne peuvent Ãªtre rÃ©solus sur le serveur de test, car nous n&#8217;avons pas
ajoutÃ© la bibliothÃ¨que commons-beanutils Ã  l&#8217;environnement de test. Cela
n&#8217;aurait aucun sens car, en dehors de ce test, elle n&#8217;est absolument pas
nÃ©cessaireÂ !</p>
</div>
<div class="paragraph">
<p>Faut-il alors renoncer Ã  utiliser des bibliothÃ¨ques dans les tests et se
contenter du seul JDKÂ ? Bien sÃ»r que nonÂ ! Cela voudrait dire que nous
plaÃ§ons les tests au second plan et que nous nous interdisons d&#8217;en faire
quelque chose d&#8217;intelligent et de facile Ã  Ã©crire. De toute Ã©vidence, la
solution de la mÃ©thode <em>main</em> pour tester montre de graves limites.</p>
</div>
</div>
<div class="sect3">
<h4 id="_utiliser_un_framework_de_test">Utiliser un framework de test</h4>
<div class="paragraph">
<p>Nous ne sommes pas les premiers Ã  faire ce constat, et la rÃ©ponse existe
depuis bien longtemps Ã  travers des outils de test spÃ©cialisÃ©s pour
Java, dont le plus connu d&#8217;entre eux est jUnit <sup class="footnote">[<a id="_footnoteref_20" class="footnote" href="#_footnotedef_20" title="View footnote.">20</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>Ces outils reposent sur des principes simplesÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>le test associÃ© Ã  une classe est Ã©crit dans une classe Java
sÃ©parÃ©e implantant ce framework, qu&#8217;on nomme par convention du nom de la
classe testÃ©e avec le suffixe Â«Â TestÂ Â»Â ;</p>
</li>
<li>
<p>chaque test Ã  rÃ©aliser est traduit par une mÃ©thode dÃ©diÃ©e dans la
classe de testÂ ;</p>
</li>
<li>
<p>l&#8217;outillage propose des mÃ©canismes d&#8217;initialisation et de
libÃ©ration qui permettent de prÃ©parer les conditions d&#8217;exÃ©cution du test
et de fermer proprement les ressources aprÃ¨s son exÃ©cution, mÃªme en cas
d&#8217;erreurÂ ;</p>
</li>
<li>
<p>l&#8217;outillage fournit des mÃ©thodes utilitaires pour les opÃ©rations
courantes de vÃ©rification du bon fonctionnement du logicielÂ ;</p>
</li>
<li>
<p>l&#8217;outillage de test se charge d&#8217;identifier tous les tests Ã 
exÃ©cuter et de les enchaÃ®ner, en fournissant finalament un rapport complet
des Ã©ventuelles erreurs rencontrÃ©es.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Pour tester notre ListeDeCoursesReader avec jUnit, nous allons donc
Ã©crire une classe ListeDeCoursesReaderTest, y crÃ©er une mÃ©thode
testLectureDeuxElements, et y transfÃ©rer notre code de test. Le
Listing 4.3 montre cette transformation de notre codeÂ :</p>
</div>
<div class="listingblock">
<div class="title">Listing 4.3 : Utilisation de jUnit</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import static org.junit.Assert.*;
public class ListeDeCoursesReaderTest {
    @Test
    public void lectureDeDeuxElements() {
        ListeDeCoursesReader reader = new ListeDeCoursesReader();
        ListeDeCourses attendu = new ListeDeCourses( ... );
        ListeDeCourses lu = reader.read( new FileInputStream("./test.list" ) );
        assertEquals( 2, lu.size(), "liste lue de taille incorrecte" ) ;
        if ( new BeanComparator().compare( attendu, lu ) != 0 ) {
            fail( "DonnÃ©es lues incorrectes" ) ;
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cette nouvelle organisation nous permet de ne pas polluer le code de
notre projet, sans pour autant renoncer Ã  nos tests automatisÃ©s. Elle
fournit un cadre simple pour l&#8217;Ã©criture de ces tests et des mÃ©thodes
utilitaires pour nous aider Ã  les Ã©crire simplement. Elle nous propose
de prendre en charge l&#8217;exÃ©cution de nos tests, en fournissant <em>via</em> une
interface graphique un compte rendu synthÃ©tique pointant immÃ©diatement
les erreurs rencontrÃ©es. Ce rapport est en particulier parfaitement
intÃ©grÃ© dans les environnements de dÃ©veloppement comme Eclipse, NetBeans
ou IntelliJ Idea.</p>
</div>
<div class="paragraph">
<p>L&#8217;objectif de cet ouvrage n&#8217;est pas de dÃ©tailler le fonctionnement de
jUnit. Nous ne pouvons donc que vous conseiller de consulter le site
junit.org et les nombreux ouvrages consacrÃ©s au sujet. Signalons
cependant que jUnit n&#8217;est pas le seul candidat pour l&#8217;Ã©criture de tests,
et quâil partage ce terrain en particulier avec son challenger TestNG et
avec sa propre version Â«Â modernisÃ©eÂ Â» jUnit4. Chacun a ses points forts,
aussi nous vous laissons choisir l&#8217;outil le plus appropriÃ© Ã  vos besoins
et Ã  vos habitudes de travail.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_les_tests_sous_maven">Les tests sous Maven</h3>
<div class="paragraph">
<p>Maven ne fait pas de choix entre ces trois outils de test. Plus
prÃ©cisÃ©ment, il choisit les trois plus tous ceux Ã  venir qui pourraient
devenir les standards de demain. L&#8217;intÃ©gration des tests sous Maven
s&#8217;accommode de la bibliothÃ¨que de tests que vous dÃ©clarez comme
dÃ©pendances de votre projet et elle s&#8217;adapte en consÃ©quence, en
tÃ©lÃ©chargeant les autres dÃ©pendances adÃ©quates.</p>
</div>
<div class="paragraph">
<p>Nos tests sont dÃ©sormais entiÃ¨rement automatisÃ©s avec l&#8217;aide de notre
framework prÃ©fÃ©rÃ©. Reste Ã  les intÃ©grer dans la construction du projet.
En effet, l&#8217;intÃ©rÃªt de ces tests automatisÃ©s estâ¦ qu&#8217;ils sont
automatisÃ©s, donc contrÃ´lables Ã  tout moment pour le seul coÃ»t du temps
qu&#8217;ils nÃ©cessitent pour s&#8217;exÃ©cuter. La logique la plus Ã©lÃ©mentaire en
termes de qualitÃ© logicielle est que ces tests doivent Ãªtre exÃ©cutÃ©s et
ne dÃ©tecter aucune erreur avant que soit produit le binaire livrable Ã 
nos utilisateurs.</p>
</div>
<div class="paragraph">
<p>Maven rejoint totalement cette logique et fait mÃªme des tests un Ã©lÃ©ment
de premier plan du projet, au mÃªme niveau que le code de l&#8217;application
lui-mÃªme. Pour suivre la logique des outils de test comme jUnit ou
TestNG, Maven dÃ©finit deux rÃ©pertoires dans la structure de fichiers du
projetÂ : src/main/java pour le livrable, src/test/java pour les tests.
La sÃ©paration entre classes du projet et classes de test qui l&#8217;outillent
est ainsi directement portÃ©e par l&#8217;emplacement physique des fichiers
sources.</p>
</div>
<div class="paragraph">
<p>Notre test jUnit ListeDeCoursesReaderTest est donc placÃ© dans
l&#8217;arborescence src/test/java. Il ne nous reste qu&#8217;Ã  lancer la commande
<code>mvn test</code> pour constater que Maven prend bien en charge la compilation et
l&#8217;exÃ©cution du test.</p>
</div>
<div class="paragraph">
<p>Cependant, notre ListeDeCoursesReaderTest comprend encore une faiblesse
notableÂ : il fait appel Ã  un fichier pour alimenter la classe testÃ©e.
Comment obtenir le chemin de ce fichier de maniÃ¨re totalement
indÃ©pendante de l&#8217;environnementÂ ? Il est Ã©videmment exclu de donner un
chemin en dur Â«Â C:/Utilisateurs/Nicolas/test/liste.listÂ Â» qui serait assez
dÃ©sastreux sur une machine non Windows ou sur un autre poste de travail
qui ne serait pas organisÃ© de la mÃªme maniÃ¨re.</p>
</div>
<div class="paragraph">
<p>Nous avons donc utilisÃ© un chemin relatif Â«Â test/liste.listÂ Â», en
supposant implicitement que le test serait lancÃ© depuis la racine du
projet oÃ¹ est placÃ© ce fichier. Si cela fonctionne assez souvent, nous
sommes cependant un peu optimistes. C&#8217;est la raison d&#8217;Ãªtre du rÃ©pertoire
src/test/resources. Celui-ci permet de stocker toutes nos donnÃ©es de
test et d&#8217;y avoir accÃ¨s Ã  l&#8217;exÃ©cution du test <em>via</em> le ClassPath. Le
Listing 4.4 montre l&#8217;Ã©volution de notre code de test pour accÃ©der Ã  ce
fichier de cette maniÃ¨re. Tous les fichiers de donnÃ©es que nous
utiliserons pour nos tests seront placÃ©s sous src/test/resources. Ils
seront ainsi intÃ©grÃ©s au ClassPath de test, mais exclus du binaire final.
Ils seront Ã©galement totalement intÃ©grÃ©s au projet et enregistrÃ©s dans
notre gestionnaire de version.</p>
</div>
<div class="listingblock">
<div class="title">Listing 4.4 : AccÃ¨s aux fichiers de test en tant que ressources</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    public void testLectureDeuxElements() {
        ListeDeCoursesReader reader = new ListeDeCoursesReader();
        InputStream is = getClass().getResourceAsStream ( "test.list" );
        ListeDeCourses lu = reader.read( is );
        ...</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ce mÃ©canisme d&#8217;accÃ¨s aux ressources est celui que nous vous recommandons
d&#8217;utiliser autant que possible. Cela s&#8217;applique lorsque vous manipulez
un type abstrait comme java.io.InputStream, java.net.URL, ou encore la
nouvelle API java.nio.file de Java7.</p>
</div>
<div class="paragraph">
<p>Si vous devez expressÃ©ment utiliser un type java.io.File, ne supposez
pas que le rÃ©pertoire courant est forcÃ©ment la racine du projet (nous
verrons au Chapitre 7 que ce n&#8217;est pas toujours le cas). Maven fournit
la variable systÃ¨me basedir qui pointe Ã  la racine du projet. Utilisez
doncÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>File basedir = new File( System.getProperty( "basedir", "" )  ).getAbsoluteFile();
File monFichier = new File( basedir, "chemin/relatif" ) ;</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_le_scope_test">Le scope Â«Â testÂ Â»</h4>
<div class="paragraph">
<p>Nous avons vu que la bibliothÃ¨que commons-beanutils nous a jouÃ© un
mauvais tour. Bien pratique pour simplifier l&#8217;Ã©criture de notre test,
elle venait perturber notre application. Maintenant que le test possÃ¨de
sa propre classe dÃ©diÃ©e, ce problÃ¨me est en principe rÃ©solu. Cependant,
les utilisateurs d&#8217;EDI font confiance Ã  leur environnement pour gÃ©rer
les imports et peuvent se faire piÃ©ger Ã  nouveau. Il est si facile
d&#8217;ajouter un import en saisissant juste le dÃ©but du nom d&#8217;une classe
qu&#8217;il n&#8217;est pas rare de terminer son travail avec quelques imports
inutiles. L&#8217;EDI peut Ã©galement faire le mÃ©nage pour nous, mais quâil
laisse passer une coquille par mÃ©garde n&#8217;est pas exclu.</p>
</div>
<div class="paragraph">
<p>Contrairement Ã  un projet dans les EDI courants, un projet Maven a deux
visages bien dÃ©finisÂ : la branche principale (src/main), portant le code
de l&#8217;application et les dÃ©pendances qui lui sont associÃ©es dans le POM,
et la branche test (src/test), portant l&#8217;outillage de contrÃ´le ainsi que
ses dÃ©pendances dÃ©diÃ©es. En effet, une dÃ©pendance dÃ©clarÃ©e dans le POM
porte une indication de <em>scope</em>, qui permet Ã  Maven de savoir quand telle
ou telle bibliothÃ¨que doit Ãªtre utilisÃ©e par les outils de compilation.
Lorsque le <em>scope</em> porte la valeur test, il est exclu de l&#8217;application et
ne sera utilisÃ© que pour la compilation et l&#8217;exÃ©cution des tests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;dependency&gt;
      &lt;groupId&gt;junit&lt;/groupId&gt;
      &lt;artifactId&gt;junit&lt;/artifactId&gt;
      &lt;version&gt;4.8.2&lt;/version&gt;
      &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Si l&#8217;assistance de l&#8217;EDI nous a fait intÃ©grer par erreur des classes
normalement dÃ©diÃ©es Ã  notre outillage de test, la compilation par Maven
Ã©chouera en signalant immÃ©diatement le problÃ¨me. Nous pouvons donc faire
appel Ã  tous les utilitaires possibles et imaginables qui nous aideront
Ã  Ã©crire nos tests de maniÃ¨re plus efficace et sans risquer de polluer
l&#8217;application.</p>
</div>
<div class="paragraph">
<p>Le choix d&#8217;outils de tests est parfois plus dÃ©licat que le choix de
l&#8217;infrastructure de notre logiciel. Pour Ãªtre pertinents et bien couvrir
les besoins, les tests doivent rester simples et performants et pouvoir
utiliser les ressources de nombreuses bibliothÃ¨ques. La gestion de
dÃ©pendances transitives de Maven nous ouvre les portes d&#8217;outils de test
et de simulation trÃ¨s avancÃ©s, avec une simplicitÃ© de mise en Åuvre
dÃ©concertante.</p>
</div>
</div>
<div class="sect3">
<h4 id="Le_developpement_pilote_par_les_tests">Le dÃ©veloppement pilotÃ© par les tests</h4>
<div class="paragraph">
<p>Les tests automatisÃ©s que nous venons d&#8217;ajouter Ã  notre projet nous
offrent un garde-fou intÃ©ressant. Ã de nombreuses reprises, ils nous
signalent qu&#8217;une Â«Â petite modificationÂ Â» s&#8217;avÃ¨re bien plus significative
que ce que nous avions pensÃ©.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaVincentM.png" alt="MangaVincentM"></span></p>
</div>
<div class="paragraph">
<p>Au cours d&#8217;une discussion sur les nouvelles idÃ©es que nous avons eues
pour notre projet, Vincent propose de changer le format du fichier dans
lequel nous stockons la liste de courses. Cette modification permettra
de stocker des donnÃ©es complÃ©mentaires, dont je vous laisse le soin
d&#8217;imaginer l&#8217;utilitÃ©.</p>
</div>
<div class="paragraph">
<p>Nos tests existants permettront de vÃ©rifier que ce nouveau format ne
perturbe pas le code existant, mais Vincent va plus loin. Avant mÃªme que
nous nâayons dÃ©terminÃ© comment nous allions lire ces nouvelles donnÃ©es
depuis le fichier, il commence Ã  Ã©crire une nouvelle mÃ©thode de test
vÃ©rifiant que les informations supplÃ©mentaires ont Ã©tÃ© correctement
lues. Aurait-il Â«Â oubliÃ©Â Â» que, pour que le logiciel fonctionne, il faut Ã 
un moment ou un autre rÃ©aliser son codeÂ ?</p>
</div>
<div class="paragraph">
<p>Une fois son test Ã©crit, Vincent le lance et ne semble mÃªme pas vexÃ© de
voir son Ã©cran afficher dans un rouge sang le rÃ©sultat assez
prÃ©visibleÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>FAILURE

java.lang.NullPointerException</pre>
</div>
</div>
<div class="paragraph">
<p>Vincent est tout simplement un adepte du dÃ©veloppement pilotÃ© par les
tests (Test Driven Development ou <em>Test First</em>). PlutÃ´t que de tester
son code, il prÃ©fÃ¨re Ã©crire des tests qui dÃ©crivent prÃ©cisÃ©ment ses
attentes, puis Ã©crire le code qui sera capable de faire passer ses tests
au vert. La diffÃ©rence est Ã©tonnamment efficace en termes de
structuration du logiciel. PlutÃ´t que d&#8217;Ãªtre guidÃ© par des contraintes
techniques ou par des considÃ©rations de pur informaticien, chaque
Ã©lÃ©ment du logiciel n&#8217;existe que parce que la bonne exÃ©cution d&#8217;un test
nÃ©cessite son existence. Comme chaque test est guidÃ© par un besoin,
Ã©crit avant mÃªme que l&#8217;on nâait commencÃ© Ã  se torturer l&#8217;esprit avec la
rÃ©alisation, le code rÃ©pond de maniÃ¨re simple et juste aux besoins.</p>
</div>
<div class="paragraph">
<p>La sur-ingÃ©nierie est une dÃ©rive courante de l&#8217;informatique oÃ¹ des
composants deviennent inutilement complexes au regard de la
fonctionnalitÃ© Ã  rendre, simplement pour rÃ©pondre Ã  des considÃ©rations
purement techniques qui n&#8217;apportent rien Ã  l&#8217;utilisateur.</p>
</div>
<div class="paragraph">
<p>Vincent a donc Ã©crit d&#8217;abord une mÃ©thode de test simple, focalisÃ©e sur
sa nouvelle idÃ©e et uniquement guidÃ©e par ce qu&#8217;il attend du logiciel et
non pas par l&#8217;idÃ©e qu&#8217;il a derriÃ¨re la tÃªte concernant les technologies
qui vont l&#8217;aider, ou le code qu&#8217;il va mettre en Åuvre. AprÃ¨s cette phase
prÃ©paratoire qu&#8217;on pourrait qualifier dans un vocabulaire plus
traditionnel d&#8217;expression de besoin, Vincent est content de voir son
test Ã©chouerÂ : le test est valide et vÃ©rifie bien quelque chose que
l&#8217;application ne fournit pas encore. Ne riez pas, trop souvent des tests
ne font qu&#8217;effleurer l&#8217;application et n&#8217;Ã©chouent pas si l&#8217;on supprime le
code censÃ© Ãªtre testÃ©Â !</p>
</div>
<div class="paragraph">
<p>Vincent commence ensuite la rÃ©alisation. AprÃ¨s quelques lignes de code,
le test lancÃ© Ã  nouveau Ã©choue encore mais sur un cas d&#8217;erreur moins
abruptÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>FAILURE

Assertion Failed : actual 1, expected 2</pre>
</div>
</div>
<div class="paragraph">
<p>Le code commence donc Ã  se mettre en place mais ne rÃ©pond pas encore aux
attentes. Quelques minutes plus tard et aprÃ¨s les corrections qui
s&#8217;imposent ont Ã©tÃ© apportÃ©es, le test passe enfin au vert.</p>
</div>
<div class="paragraph">
<p>Cette faÃ§on de travailler est un moyen trÃ¨s puissant de structurer ses
dÃ©veloppements en fonction du rÃ©sultat Ã  atteindre et non en rÃ©pondant Ã 
nos pulsions d&#8217;informaticiens avides de code. Une rÃ¨gle de base du
dÃ©veloppement pilotÃ© par les tests est qu&#8217;aucun code ne doit Ãªtre Ã©crit
s&#8217;il n&#8217;est pas rendu indispensable par un test. Autrement dit, d&#8217;une
part, du code non testÃ© ne devrait pas exister, et d&#8217;autre part, du code
qui n&#8217;est pas guidÃ© par un besoin fonctionnel n&#8217;a rien Ã  faire dans un
logiciel intelligemment construit.</p>
</div>
<div class="paragraph">
<p>La rÃ©alisation du code qui rÃ©pond Ã  son test lui a permis d&#8217;identifier
de nouvelles portions de code trÃ¨s proches d&#8217;autres dÃ©jÃ  existantes. Il
aimerait bien les regrouper dans des mÃ©thodes communes. La duplication
de code est l&#8217;ennemi d&#8217;un logiciel Ã©volutif et fiable, aussi Vincent
applique le second commandement du dÃ©veloppement pilotÃ© par les testsÂ :
DRY (Don&#8217;t Repeat Yourself â Â«Â Tu ne te rÃ©pÃ©teras pasÂ Â»).</p>
</div>
<div class="paragraph">
<p>ArmÃ© de ses tests, tous focalisÃ©s sur des aspects unitaires ou
fonctionnels de l&#8217;application, il peut faire toutes les opÃ©rations de
rÃ©ingÃ©nierie qui lui semblent nÃ©cessaires pour arriver Ã  un bon niveau
de structuration. Chaque modification apportÃ©e est contrÃ´lÃ©e par les
tests existants qui assurent ainsi que le logiciel reste
fonctionnellement Ã©quivalent. L&#8217;outillage de test en place permet Ã 
prÃ©sent de se focaliser sur des aspects purement techniques, pour ne pas
dire esthÃ©tiques, concernant l&#8217;organisation de notre codeÂ : niveau
d&#8217;abstraction, Ã©volutivitÃ©, lisibilitÃ©. Chaque modification que nous lui
apporterons afin d&#8217;en amÃ©liorer la qualitÃ© pourra Ãªtre validÃ©e d&#8217;un
point de vue des fonctions rendues par l&#8217;applicationÂ : nos tests doivent
tous rester au vert. Certaines modifications lourdes et pourtant
importantes n&#8217;auraient jamais Ã©tÃ© rÃ©alisÃ©es en confiance sans cette
garantie.</p>
</div>
<div class="paragraph">
<div class="title">Figure 04-01</div>
<p><span class="image"><img src="illustrations/04-01.png" alt="04 01"></span></p>
</div>
<div class="paragraph">
<p>DÃ©veloppement pilotÃ© par les tests.</p>
</div>
<div class="paragraph">
<p>Le dÃ©veloppement pilotÃ© par les tests est une pratique prÃ©conisÃ©e par de
nombreuses mÃ©thodes agiles <sup class="footnote">[<a id="_footnoteref_21" class="footnote" href="#_footnotedef_21" title="View footnote.">21</a>]</sup>. Sa mise en Åuvre efficace
nÃ©cessite une culture du test automatisÃ© pour Ãªtre rÃ©ellement efficace.
Maven participe Ã  cette dÃ©marche par la place qu&#8217;il donne au test dans
le cycle de vie du projet. Les tests vus par Maven sont des Ã©lÃ©ments de
premier plan du projet.</p>
</div>
</div>
<div class="sect3">
<h4 id="Pas_de_jar_sans_tests_reussis">Pas de JAR sans tests rÃ©ussis</h4>
<div class="paragraph">
<p>Le passage des tests par Maven fait partie des phases standard de
construction du projet. Maven les place au cÅur de la gestion de la
qualitÃ© et fait le choix de bloquer la construction du projet si un test
Ã©choue. Comme ces tests sont exÃ©cutÃ©s avant que la phase de <em>packaging</em>
qui construit le JAR ne soit exÃ©cutÃ©e, Maven interdit donc de construire
un livrable qui ne passe pas avec succÃ¨s tous les tests dÃ©finis par le
projet. C&#8217;est une interprÃ©tation rigoureuse des principes de qualitÃ©
logicielle, mais qui Ã©vite d&#8217;utiliser par mÃ©garde un JAR fraÃ®chement
compilÃ© et de dÃ©couvrir de maniÃ¨re dÃ©tournÃ©e et coÃ»teuse un bogue qui
est dÃ©jÃ  contrÃ´lÃ© par un test unitaire.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaFabrice.png" alt="MangaFabrice"></span></p>
</div>
<div class="paragraph">
<p>Interdire la construction du JAR, n&#8217;est-ce pas un peu abrupt comme prise
de positionÂ ? C&#8217;est en tout cas l&#8217;avis de Fabrice, qui tue le temps dans
le TGV en testant rapidement quelques nouvelles idÃ©es et qui ne parvient
pas Ã  lancer l&#8217;application. Ses modifications, rÃ©alisÃ©es en mode
Â«Â exploratoireÂ Â», ne visent qu&#8217;Ã  tester un nouveau concept et certainement
pas Ã  obtenir un rÃ©sultat stable et irrÃ©prochable.</p>
</div>
<div class="paragraph">
<p>Maven met certes les concepts de qualitÃ© logicielle au premier plan mais
ne manque cependant pas de pragmatisme. Il existe une option qui permet
de ne pas passer les tests lors de la construction du projet, et donc de
passer outre cette rÃ¨gle parfois trop stricte. Cette option, ajoutÃ©e sur
la ligne de commande, est âDskipTests. C&#8217;est une option Ã  double
tranchant, soyez-en bien conscient. Elle peut Ãªtre indispensable, comme
le pense Fabrice qui peut ainsi vÃ©rifier la pertinence de son idÃ©e,
auquel cas il pourra la prÃ©senter Ã  son client Ã  l&#8217;arrivÃ©e de son voyage
d&#8217;affaires. C&#8217;est une option dangereuse si elle est trop utilisÃ©e et que
nos tests automatisÃ©s ne sont plus exÃ©cutÃ©s.</p>
</div>
</div>
<div class="sect3">
<h4 id="Reutiliser_notre_outillage_de_test">RÃ©utiliser notre outillage de test</h4>
<div class="paragraph">
<p>Au fur et Ã  mesure de l&#8217;Ã©criture des tests, nous avons dÃ» dÃ©velopper des
classes utilitaires qui n&#8217;ont de sens que dans le cadre des testsÂ : code
bouchon et simulateur, mÃ©canisme de contrÃ´le et autres constituent un
outillage complet dÃ©diÃ© Ã  notre code afin que nous soyons en mesure de
le tester convenablement.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaLukas.png" alt="MangaLukas"></span></p>
</div>
<div class="paragraph">
<p>En marge de notre projet, Lukas se lance dans un autre projet
expÃ©rimental pour proposer une version sur tÃ©lÃ©phone mobile de notre
application â une cible de choix qu&#8217;il ne faut pas nÃ©gligerÂ !</p>
</div>
<div class="paragraph">
<p>Lukas est rapidement confrontÃ© Ã  un problÃ¨me simpleÂ : dans son
environnement de dÃ©veloppement, il dispose des deux projets et peut donc
coder les tests de son projet noubliepaslalistedescourses-on-android en
rÃ©utilisant nos utilitaires de test. Cet outillage lui simplifie
grandement la tÃ¢che et lui permet d&#8217;Ã©crire des tests pertinents et
lisibles en un temps record. Seulement, lorsqu&#8217;il tente de construire
son projet avec Maven, la compilation de ses tests Ã©choue
systÃ©matiquementÂ : nos utilitaires ne sont pas vus par le compilateur.</p>
</div>
<div class="paragraph">
<p>Cette situation en apparence paradoxale est simple Ã  expliquer. La
majoritÃ© des environnements de dÃ©veloppement intÃ©grÃ©s ne diffÃ©rencient
pas â contrairement Ã  Maven â les bibliothÃ¨ques utilisÃ©es pour Ã©crire le
code et celles associÃ©es aux tests. En rÃ©fÃ©renÃ§ant le projet
noubliepaslalistedescourses, l&#8217;environnement donne accÃ¨s Ã  toutes ses
classes et dÃ©pendances, sans distinction. Maven par contre s&#8217;appuie sur
le JAR qui a Ã©tÃ© construit par chaque projet, et sur lui seul. Nos
utilitaires de test ne sont accessibles qu&#8217;au cours de la construction
du projet qui les dÃ©finit et pas en dehors. Le projet de Lukas ne peut
donc exploiter que les classes qui sont destinÃ©es Ã  l&#8217;inclusion dans le
JAR final, et pas la panoplie de tests qui les accompagne.</p>
</div>
<div class="paragraph">
<p>Copier-coller ces classes est Ã©videmment hors de question, et nous ne
pouvons demander Ã  Lukas de rÃ©Ã©crire entiÃ¨rement ses tests sans ce code
de support qui lui a fait gagner tant de temps. La solution, Maven la
fournit <em>via</em> le plugin JAR, responsable de la construction de notre
archive.</p>
</div>
<div class="paragraph">
<p>Comme nous l&#8217;avons vu, le plugin JAR est attachÃ© par dÃ©faut au cycle de
construction du projet lors de la phase de packaging et sa tÃ¢che jar
construit l&#8217;archive â rien de trÃ¨s surprenant. Ce plugin dÃ©finit
d&#8217;autres tÃ¢ches, en particulier une qui va nous sauver la miseÂ :
test-jar. Celle-ci permet de construire en parallÃ¨le du JAR du projet un
second JAR, contenant cette fois les classes et ressources de test. Le
Listing 4.5 montre la configuration associÃ©e au plugin JAR pour obtenir
ce rÃ©sultat. Le fonctionnement par dÃ©faut suffit Ã  notre besoin, aussi
l&#8217;ajout de ce traitement ne nÃ©cessite aucun Ã©lÃ©ment de configuration
particulier.</p>
</div>
<div class="listingblock">
<div class="title">Listing 4.5 : Construction d&#8217;un test-jar en mÃªme temps que l&#8217;archive java du projet</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.3.1&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;goals&gt;
              &lt;goal&gt;test-jar&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;inherited&gt;false&lt;/inherited&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cette seconde archive partage les mÃ©tadonnÃ©es du projet (le POM). Il ne
s&#8217;agit pas d&#8217;un second projet Maven contenant nos tests, mais bien d&#8217;un
aspect secondaire de notre unique projet dont Maven se propose de gÃ©rer
la construction. La diffÃ©renciation entre l&#8217;artefact principal du projet
et des rÃ©sultats secondaires de ce type sâappuie sur un suffixe ajoutÃ©
au nom de l&#8217;artefact, ce que dans le vocabulaire Maven on nomme un
<em>classifier</em>. La tÃ¢che test-jar va construire un artefact nommÃ©
noubliepaslalistedescourses-1.0-SNAPSHOT-tests.jar.</p>
</div>
<div class="paragraph">
<p>Maven peut Ãªtre configurÃ© pour produire plus d&#8217;un artefact lors de la
construction du projet et le <em>classifier</em> permet de diffÃ©rencier les
artefacts secondaires du principal rÃ©sultat de la construction. Il est
ainsi possible de construire non seulement le JAR du projet, mais aussi
le JAR de ses tests, le JAR de son code source ou le JAR de sa
documentation JavaDoc. Chacun de ces artefacts secondaires pourra Ãªtre
rÃ©fÃ©rencÃ© comme une dÃ©pendance en ajoutant l&#8217;information de <em>classifier</em>
adÃ©quate, comme le montre le Listing 4.6 qui prÃ©sente le POM du projet
de Lukas.</p>
</div>
<div class="listingblock">
<div class="title">Listing 4.6 : Utilisation d&#8217;une dÃ©pendance exploitant la notion de classifier</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;project&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;fr.noubliepaslalistedescourses&lt;/groupId&gt;
  &lt;artifactId&gt;noubliepaslalistedescourses-on-android&lt;/artifactId&gt;
  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
  &lt;description&gt;
    Projet annexe de noubliepaslalistedescourses pour un client sur tÃ©lÃ©phone mobile AndroÃ¯d
  &lt;/description&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;fr.noubliepaslalistedescourses&lt;/groupId&gt;
      &lt;artifactId&gt;noubliepaslalistedescourses&lt;/artifactId&gt;
      &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;fr.noubliepaslalistedescourses&lt;/groupId&gt;
      &lt;artifactId&gt;noubliepaslalistedescourses&lt;/artifactId&gt;
      &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
      &lt;classifier&gt;tests&lt;/classifier&gt;
      &lt;type&gt;test-jar&lt;/type&gt;
      &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="L_integration_continue">L&#8217;intÃ©gration continue</h4>
<div class="paragraph">
<p>Nous l&#8217;avons vu, nos tests automatisÃ©s prennent toute leur valeur
lorsqu&#8217;ils sont exÃ©cutÃ©s rÃ©guliÃ¨rement. Chaque dÃ©veloppeur peut compter
sur eux pour vÃ©rifier qu&#8217;il n&#8217;a pas (ou au moins, pas trop, en fonction
de la qualitÃ© des tests) dÃ©traquÃ© l&#8217;application avec ses derniÃ¨res
modifications. Cela peut mÃªme l&#8217;aider Ã  identifier les points Ã 
reprendre sur des parties de l&#8217;application qu&#8217;il ne connaÃ®t pas bien ou
Ã  structurer ses propres dÃ©veloppements.</p>
</div>
<div class="paragraph">
<p>Une autre utilisation des tests est de rendre leur passage systÃ©matique
sur une machine dÃ©diÃ©e, afin de dÃ©tecter le plus vite possible une
erreur introduite par un dÃ©veloppeur qui n&#8217;aurait pas identifiÃ© le
problÃ¨me par lui-mÃªme. Il ne s&#8217;agit pas du tout de rechercher le mouton
noir qui introduit des bogues et ne vÃ©rifie rien sur son environnement.
Il n&#8217;est pas rare de crÃ©er des instabilitÃ©s parce qu&#8217;on a oubliÃ© de
diffuser un fichier sur le gestionnaire de version ou parce qu&#8217;un
fragment de code dÃ©pend de l&#8217;encodage des fichiers sur le systÃ¨me, d&#8217;un
chemin particulier, ou de la version du JDK utilisÃ©e.</p>
</div>
<div class="paragraph">
<p>Cette machine qui va incessamment analyser notre projet en exÃ©cutant
tous les tests aura l&#8217;avantage Ã©norme sur un contrÃ´leur humain de n&#8217;Ãªtre
limitÃ©e que par sa rapiditÃ© d&#8217;exÃ©cution pour signaler les problÃ¨mes.
Ã la moindre faute, elle pourra se fonder sur la liste des derniÃ¨res
modifications pour signaler aux personnes concernÃ©es le problÃ¨me
identifiÃ©. Venant d&#8217;un automate plutÃ´t que d&#8217;un collÃ¨gue, ce genre de
reproche est plus facile Ã  accepter.</p>
</div>
<div class="paragraph">
<p>Ce contrÃ´le automatisÃ© et incessant fait partie (mais n&#8217;est qu&#8217;un
Ã©lÃ©ment) de l&#8217;intÃ©gration continue, une pratique introduite par les
mÃ©thodes de dÃ©veloppement agiles. C&#8217;est un outil puissant et facile Ã 
mettre en place que nous ne pouvons que vous recommander. MÃªme si, dans
un premier temps, vous ne l&#8217;utilisez que pour contrÃ´ler la bonne
exÃ©cution des tests et identifier au plus tÃ´t les dÃ©faillances de vos
collaborateurs et les faiblesses de votre application, vous constaterez
rapidement ses bÃ©nÃ©fices et les bonnes pratiques que vous pouvez en
tirer.</p>
</div>
<div class="paragraph">
<p>Le serveur qui va exÃ©cuter nos tests peut se baser sur l&#8217;un des nombreux
outils disponibles. Nous citerons Continuum, Jenkins et Hudson, mais cette liste
est loin d&#8217;Ãªtre exhaustive.</p>
</div>
</div>
<div class="sect3">
<h4 id="_continuum">Continuum</h4>
<div class="paragraph">
<p>Continuum a Ã©tÃ© dÃ©veloppÃ© par la communautÃ© Maven, avec bien sÃ»r pour
objectif de prendre en charge de maniÃ¨re aussi intÃ©grÃ©e que possible la
structure des projets Maven et les relations de dÃ©pendance qu&#8217;ils
peuvent entretenir. Il ne se limite cependant pas Ã  ce type de projets
et peut tout aussi bien accueillir vos projets Ant ou ceux outillÃ©s par des
scripts.</p>
</div>
<div class="paragraph">
<p>Son point fort est son excellente intÃ©gration des projets Maven. Sur
dÃ©tection d&#8217;un changement dans le gestionnaire de code source, Continuum
va ainsi construire uniquement le projet impactÃ© puis enchaÃ®ner avec
tous les autres projets qui l&#8217;utilisent et qui pourraient Ãªtre impactÃ©s de
maniÃ¨re indirecte par ce changement.</p>
</div>
<div class="paragraph">
<p>Son premier point faible est son interface web qui ne bÃ©nÃ©ficie pas des
raffinements auxquels nous ont habituÃ©s les applications web modernes.
Un peu trop de configuration et de changements de page sont nÃ©cessaires
pour l&#8217;exploiter.</p>
</div>
<div class="paragraph">
<p>Son second et principal point faible est l&#8217;absence de mÃ©canismes
d&#8217;extension permettant des contributions et des adaptations de l&#8217;outil Ã 
des contextes de projets spÃ©cifiques, sans devoir entrer dans les rouages
trÃ¨s techniques de l&#8217;outil. Par ailleurs, la lenteur de son cycle de
dÃ©veloppement, qui ne propose une nouvelle version qu&#8217;aprÃ¨s plusieurs
mois, rÃ©duit sa capacitÃ© Ã  proposer rapidement des Ã©volutions Ã  ses
utilisateurs.</p>
</div>
<div class="paragraph">
<div class="title">Figure 04-02</div>
<p><span class="image"><img src="illustrations/04-02.png" alt="04 02"></span></p>
</div>
<div class="paragraph">
<p>Continuum en train de surveiller les projets de Maven 2.</p>
</div>
</div>
<div class="sect3">
<h4 id="_jenkins">Jenkins</h4>
<div class="paragraph">
<p>CrÃ©Ã© par Kohsuke Kawaguchi, employÃ© de SUN, pendant son temps libre,
Jenkins est rapidement devenu un outil incontournable. Son cycle de
dÃ©veloppement est extrÃªmement bref, au point qu&#8217;il est difficile de
choisir une version, la suivante pouvant apparaÃ®tre dans les jours ou
les heures qui suivent. Cette trÃ¨s forte rÃ©activitÃ© permet cependant
d&#8217;apporter rapidement les corrections qui s&#8217;imposent et de proposer des
fonctionnalitÃ©s nouvelles par petites touches.</p>
</div>
<div class="paragraph">
<p>Jenkins n&#8217;est pas dÃ©diÃ© Ã  Maven et peut tout aussi bien accueillir des
projets Ant ou simplement basÃ©s sur des scripts. Le support de Maven,
bien qu&#8217;arrivÃ© tardivement et longtemps considÃ©rÃ© comme expÃ©rimental,
est cependant d&#8217;un bon niveau et parfaitement fonctionnel.</p>
</div>
<div class="paragraph">
<p>Les points forts de Jenkins sont la qualitÃ© de son interface web et
l&#8217;extrÃªme simplicitÃ© de son installation. Son principal point faible est l&#8217;intÃ©gration, en constante amÃ©lioration mais
toujours perfectible des projets Maven, en particulier ceux rÃ©partis en
plusieurs modules (voir Chapitre 6).</p>
</div>
<div class="paragraph">
<p>Le point dÃ©cisif qui fait de Jenkins un concurrent de choix, c&#8217;est sa
rÃ©activitÃ© de dÃ©veloppement. Avec une nouvelle version chaque semaine et
une armÃ©e de contributeurs sur son Ã©cosystÃ¨me de plugins, Jenkins est un
logiciel extrÃªmement rÃ©actif et porteur de nombreuses innovations.</p>
</div>
<div class="paragraph">
<div class="title">Figure 04-03</div>
<p><span class="image"><img src="illustrations/04-03.png" alt="04 03"></span></p>
</div>
<div class="paragraph">
<p>Jenkins, en train de surveiller sa propre construction, respectant
l&#8217;adage anglo-saxon Â«Â eat your own dog foodÂ Â» (Â«Â mange toi-mÃªme la
nourriture de ton chienÂ Â»).</p>
</div>
</div>
<div class="sect3">
<h4 id="_hudson">Hudson</h4>
<div class="paragraph">
<p>Hudson est le cousin de Jenkins. Suite au rachat de SUN par Oracle, ce
dernier a fait valoir ses droits sur le nom Â«Â HudsonÂ Â», marque dÃ©posÃ©e
et nom historique du projet. Voulant imposer ses rÃ¨gles Ã  la communautÃ©
des dÃ©veloppeurs, Oracle a provoquÃ© un divorce, qualifiÃ©e de <em>fork</em> dans
le vocabulaire de l&#8217;Open Source. Ainsi est nÃ© Jenkins d&#8217;une part,
continuitÃ© naturelle du projet, et Oracle HudsonÂ® de l&#8217;autre, dÃ©veloppÃ©
et supportÃ© par Oracle et ses partenaires.</p>
</div>
<div class="paragraph">
<p>Techniquement parlant, les deux projets sont relativement identiques Ã 
l&#8217;heure ou nous Ã©crivons ces lignes, mais ils ne suivront pas les mÃªmes
choix techniques ou organisationnels Ã  l&#8217;avenir.</p>
</div>
<div class="paragraph">
<div class="title">Figure 04-04</div>
<p><span class="image"><img src="illustrations/04-04.png" alt="04 04"></span></p>
</div>
<div class="paragraph">
<p>Husdon, lui aussi en train de surveiller la construction de Maven2, dans
la forge Sonatype, partenaire d&#8217;Oracle.</p>
</div>
</div>
<div class="sect3">
<h4 id="_lequel_choisir">Lequel choisirÂ ?</h4>
<div class="paragraph">
<p>Le choix de votre serveur d&#8217;intÃ©gration continue va dÃ©pendre de nombreux
critÃ¨res. Techniquement parlant, il faut qu&#8217;il soit adaptÃ© Ã  vos
environnements, qu&#8217;il sache communiquer avec votre gestionnaire de
versions et Ã©ventuellement Ã  votre outil de suivi de bogues. Il faudra
aussi qu&#8217;il puisse facilement remonter de l&#8217;information aux
dÃ©veloppeurs, par mail, messagerie instantanÃ©e, plugin dans
l&#8217;environnement de dÃ©veloppement ou autre. Dans tous les cas, il faudra
vÃ©rifier que la compatibilitÃ© est au rendez-vous.</p>
</div>
<div class="paragraph">
<p>Ce ne sont pas les seuls critÃ¨res Ã  retenir. Nous n&#8217;avons vu ici qu&#8217;une
utilisation trÃ¨s superficielle de l&#8217;intÃ©gration continue, qui se
contente de compiler et de tester rÃ©guliÃ¨rement notre projet pour
signaler les erreurs. La pratique d&#8217;intÃ©gration continue va trÃ¨s
au-delÃ , comme nous le verrons au chapitre suivant. En fonction de votre
utilisation, certaines fonctionnalitÃ©s vous sembleront indispensables et
d&#8217;autres, inutiles. Les possibilitÃ©s d&#8217;extension et de configuration de
ces serveurs sont nombreuses et rÃ©pondent Ã  des usages et Ã  des rÃ¨gles
de fonctionnement trÃ¨s variÃ©s.</p>
</div>
<div class="paragraph">
<p>Quelques pistes pour vous guiderÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>que devra surveiller l&#8217;intÃ©gration continueÂ ? Votre gestionnaire
de code source est-il supportÃ©Â ?</p>
</li>
<li>
<p>avez-vous autre chose que des <em>builds</em> Maven Ã  lui faire supporterÂ ? Avez-vous des dÃ©veloppements sous Ant, Ruby on Rails, Python, Grailsâ¦ qui pourraient bÃ©nÃ©ficier de cette initiativeÂ ?</p>
</li>
<li>
<p>qu&#8217;attendez-vous de l&#8217;intÃ©gration continue ? Quels processus de
contrÃ´le devra-t-elle porter ? MÃ©triques qualitÃ©, tests fonctionnels ou
de performance, dÃ©ploiement d&#8217;une version de dÃ©monstration, publication
des rÃ©sultatsÂ ?</p>
</li>
<li>
<p>comment doit-elle interagir avec vous ? IHM web seule et
diffusion de mails, notification par messagerie instantanÃ©e, plugin dans
votre EDIÂ ?</p>
</li>
<li>
<p>quel support Ãªtes-vous prÃªt Ã  fournir pour votre service
d&#8217;intÃ©gration continueÂ ? Mises Ã  jour rÃ©guliÃ¨res, phase de qualification
et/ou support commercialÂ ?</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_conclusion_3">Conclusion</h4>
<div class="paragraph">
<p>Les tests unitaires sont des acteurs de premier plan pour introduire la
qualitÃ© logicielle dans le cycle de dÃ©veloppement du projet. Maven les
considÃ¨re comme tels, et son fonctionnement mÃªme participe trÃ¨s
activement Ã  la promotion de cette pratique.</p>
</div>
<div class="paragraph">
<p>L&#8217;intÃ©gration de tests dans un projet nÃ©cessite un changement de
pratiques et l&#8217;appropriation de nouveaux outils, elle n&#8217;est donc ni
instantanÃ©e, ni totalement gratuite. Le Â«Â retour sur investissementÂ Â» est
cependant sans commune mesure une fois les bonnes habitudes en place. Un
projet outillÃ© par des tests rassure tout le monde sur son niveau de
qualitÃ© et sa stabilitÃ© dans le temps. Livrer un logiciel dont tous les
tests sont au vert est autrement plus rassurant pour l&#8217;Ã©quipe que
d&#8217;appliquer les derniers correctifs en espÃ©rant ne pas avoir introduit
d&#8217;erreur Ã  quelques heures de la livraison.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Mettre_en_place_des_tests_d_integration">Chapitre 5Â :Â Mettre en place des tests d&#8217;intÃ©gration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nous avons vu au fil des pages qui prÃ©cÃ¨dent comment outiller notre
projet d&#8217;un ensemble de tests automatisÃ©s qui permettent de valider son
bon fonctionnement et sa stabilitÃ©. Cet apport majeur Ã  notre mode de
dÃ©veloppement est un virage important qui modifie notre organisation.
Nous n&#8217;avons plus Ã  proprement parler une phase de dÃ©veloppement puis
une phase de test, mais une combinaison des deux qui vise Ã  obtenir un
rÃ©sultat toujours meilleur.</p>
</div>
<div class="paragraph">
<p>Fort de ce nouveau paradigme, notre Ã©quipe dÃ©veloppe rapidement une
rÃ©elle addiction aux tests. Nous outillons progressivement notre code
pour vÃ©rifier et valider chaque parcelle de notre application.</p>
</div>
<div class="sect2">
<h3 id="_des_tests_unitaires_de_moins_en_moins_unitaires">Des tests unitairesâ¦ de moins en moins unitaires</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaNicolas.png" alt="MangaNicolas"></span></p>
</div>
<div class="paragraph">
<p>Vous vous rappelez peut-Ãªtre que nous avons choisi Google Web Toolkit
pour la rÃ©alisation de notre site web. Ce choix nous a donnÃ© entiÃ¨re
satisfaction jusqu&#8217;ici. Ã l&#8217;heure de lui appliquer notre stratÃ©gie de
test, Nicolas se rÃ©jouit de constater que la classe GWTTestCase nous y
aide grandementÂ :Â il nous suffit de bÃ¢tir nos tests dessus pour pouvoir
valider le fonctionnement de cette couche.</p>
</div>
<div class="paragraph">
<p>AprÃ¨s quelques jours, nous devons cependant dÃ©chanter. La construction
complÃ¨te du projet est passÃ©e de huit minutes Ã â¦ plus de trenteÂ ! Les
tests de notre interface web sont trÃ¨s longs Ã  exÃ©cuter, sans pour
autant que le contenu du test puisse Ãªtre incriminÃ©. Nicolas, qui n&#8217;y
est pourtant pour rien, sent monter la grogne des dÃ©veloppeurs, lassÃ©s
d&#8217;attendre de longues minutes la fin de la construction du projet Ã 
cause de ces tests qui n&#8217;en finissent pas.</p>
</div>
<div class="paragraph">
<p>La rÃ©ponse vient de la structure particuliÃ¨re de ces tests utilisant
GWTÂ : l&#8217;Ã©quipe de dÃ©veloppement de Google offre un mÃ©canisme de test qui
s&#8217;intÃ¨gre bien dans nos habitudes basÃ©es sur jUnitÂ ; cependant, pour en
arriver lÃ , ils ont dÃ» jongler avec des contraintes contradictoires. Un
test GWT nÃ©cessite une phase de compilation spÃ©cifique du code de
l&#8217;application, l&#8217;Ã©mulation d&#8217;un navigateur web, en plus du lancement
d&#8217;un serveur HTTP, comme le montre la Figure 05-01. Ces deux Ã©tapes sont
trÃ¨s lourdes et ralentissent considÃ©rablement l&#8217;exÃ©cution du test. La
phase de prÃ©paration du test peut ainsi rapidement occuper beaucoup plus
de temps que l&#8217;exÃ©cution du test lui-mÃªme. Ce problÃ¨me, multipliÃ© par de
nombreux tests sur le mÃªme modÃ¨le, a des consÃ©quences immÃ©diates sur le
temps de construction de notre projet.</p>
</div>
<div class="paragraph">
<div class="title">Figure 05-01</div>
<p><span class="image"><img src="illustrations/05-01.png" alt="05 01"></span></p>
</div>
<div class="paragraph">
<p>La sÃ©quence d&#8217;opÃ©ratoire dÃ©roulÃ©e par un test GWT.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaHerve.png" alt="MangaHerve"></span></p>
</div>
<div class="paragraph">
<p>Impatients d&#8217;obtenir le rÃ©sultat de leur travail, les dÃ©veloppeurs
prennent peu Ã  peu l&#8217;habitude d&#8217;utiliser l&#8217;option skipTests ( mvn
install -DskipTests=true ). Celle-ci est bien pratique, parfois mÃªme
indispensable, mais elle devrait Ãªtre l&#8217;exception et non la rÃ¨gle dans
l&#8217;utilisation courante de Maven. HervÃ© se dÃ©sole de voir que les bonnes
pratiques Ã  peine acquises sont si rapidement oubliÃ©es. Il doit pourtant
bien reconnaÃ®tre que l&#8217;outillage de test unitaire ne peut Ãªtre pertinent
que s&#8217;il est rapide Ã  exÃ©cuter.</p>
</div>
<div class="sect3">
<h4 id="_quest_ce_quun_test_unitaire">Qu&#8217;est-ce qu&#8217;un test Â«Â unitaireÂ Â»Â ?</h4>
<div class="paragraph">
<p>Quand nous parlons de tests unitaires, nous considÃ©rons des tests
simples, ciblÃ©s, exÃ©cutÃ©s dans un environnement lÃ©ger et totalement sous
contrÃ´le. Ces tests sont Ã©ligibles Ã  une exÃ©cution systÃ©matique, car ils
peuvent Ãªtre exÃ©cutÃ©s rapidement, sans nÃ©cessiter de prÃ©paration
particuliÃ¨re de la machine.</p>
</div>
<div class="paragraph">
<p>Avec cette dÃ©finition, nous mettons donc de cÃ´tÃ© un grand nombre de
tests que nous pourrions tout de mÃªme automatiserÂ :Â tests
d&#8217;interopÃ©rabilitÃ©, tests de charge et d&#8217;endurance, tests nÃ©cessitant
l&#8217;installation du logiciel sur un serveur â typiquement, l&#8217;interface web
d&#8217;une application WARâ¦</p>
</div>
<div class="paragraph">
<p>Laisser de cÃ´tÃ© une gamme aussi large de tests juste parce qu&#8217;ils
n&#8217;entrent pas dans la logique du Â«Â tester souventÂ Â» de Maven n&#8217;est pas une
option qui nous mÃ¨nera bien loin. Ce que nous voulons, c&#8217;est intÃ©grer
dans la construction du projet de nouvelles tÃ¢ches mais les conserver
optionnelles pour la majoritÃ© des dÃ©veloppeurs qui ne seront pas
concernÃ©s. Le mÃ©canisme de profil de Maven offre une solution simple
pour que chaque dÃ©veloppeur puisse activer les spÃ©cificitÃ©s qui
conviennent Ã  sa tÃ¢che en cours, sans perdre le bÃ©nÃ©fice d&#8217;avoir toute
la configuration et tout l&#8217;outillage nÃ©cessaire (ou du moins le maximum)
configurÃ©s dans le seul fichier POM.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_les_profils">Les profils</h3>
<div class="paragraph">
<p>La rÃ©ponse de Maven Ã  ce problÃ¨me s&#8217;appelle un <em>profil</em>. Il s&#8217;agit tout
simplement de regrouper tout ce qui implique un pan de construction que
nous voulons rendre optionnel. DÃ©fini au sein d&#8217;un bloc dÃ©diÃ©, il pourra
au besoin Ãªtre activÃ© ou dÃ©sactivÃ© selon le dÃ©veloppeur qui intervient
sur le projet. Le profil peut dÃ©finir des plugins supplÃ©mentaires, de
nouvelles dÃ©pendances ou des propriÃ©tÃ©s supplÃ©mentaires.</p>
</div>
<div class="paragraph">
<p>Ce mÃ©canisme est trÃ¨s pratique dans le cadre de nos tests qui ne sont
pas indÃ©pendants de l&#8217;environnement ou qui sont pÃ©nalisants en raison de
leur durÃ©e d&#8217;exÃ©cution. Le Listing 5.1 prÃ©sente la configuration d&#8217;un
profil qui exÃ©cutera nos tests GWT si le profil associÃ© est activÃ©.
Notez la configuration du plugin <em>surefire</em> qui le prÃ©cÃ¨de, lequel permet
d&#8217;exclure ces tests dans le mode de fonctionnement par dÃ©faut. Un
dÃ©veloppeur qui n&#8217;a que faire de l&#8217;interface web ne sera donc pas
pÃ©nalisÃ©, et un dÃ©veloppeur qui travaille dessus n&#8217;aura qu&#8217;Ã  activer le
profil associÃ© en ajoutant Ã  sa ligne de commande l&#8217;option -Pgwt.</p>
</div>
<div class="listingblock">
<div class="title">Listing 5.1 : Un profil dÃ©diÃ© aux tests GWT</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;build&gt;
   &lt;plugins&gt;
      &lt;plugin&gt;
         &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
          &lt;version&gt;2.4.3&lt;/version&gt;
          &lt;configuration&gt;
               &lt;excludes&gt;**/*GwtTest.java&lt;/excludes&gt;
          &lt;/configuration&gt;
      &lt;plugin&gt;
   &lt;/plugins&gt;
&lt;/build&gt;
&lt;profiles&gt;
  &lt;profile&gt;
    &lt;id&gt;gwt&lt;/id&gt;
    &lt;build&gt;
       &lt;plugins&gt;
          &lt;plugin&gt;
             &lt;artifactId&gt;gwt-maven-plugin&lt;/artifactId&gt;
               &lt;version&gt;1.1&lt;/version&gt;
               &lt;executions&gt;
                  &lt;execution&gt;
                      &lt;goals&gt;&lt;goal&gt;test&lt;/goal&gt;&lt;/goals&gt;
                  &lt;execution&gt;
               &lt;executions&gt;
               &lt;configuration&gt;
                  &lt;includes&gt;**/*GwtTest.java&lt;/includes&gt;
               &lt;/configuration&gt;
          &lt;plugin&gt;
       &lt;/plugins&gt;
    &lt;/build&gt;
  &lt;/profile&gt;
&lt;profiles&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tous ceux qui dÃ©veloppent du code GWT sont ainsi en mesure de bÃ©nÃ©ficier
de notre couverture de test, sans perturber d&#8217;autres dÃ©veloppeurs comme
notre spÃ©cialiste de la base de donnÃ©es que nâintÃ©ressent pas nos
Widgets et autres ClickHandlers. L&#8217;option -P suivie des noms des profils
sÃ©parÃ©s par une virgule permet d&#8217;activer Ã  la demande les profils
dÃ©sirÃ©s par l&#8217;utilisateur.</p>
</div>
<div class="sect3">
<h4 id="S_adapter_a_l_environnement">S&#8217;adapter Ã  l&#8217;environnement</h4>
<div class="paragraph">
<p>Une autre utilisation des profils consiste Ã  adapter la configuration
Maven du projet Ã  l&#8217;environnement de l&#8217;utilisateur. Il est aussi
possible de conditionner l&#8217;activation du profil Ã  une spÃ©cificitÃ© de
l&#8217;environnement d&#8217;exÃ©cution, par exemple le systÃ¨me d&#8217;exploitation ou la
version de Java qui exÃ©cute Maven. Une propriÃ©tÃ© systÃ¨me (dÃ©finie avec
l&#8217;option -Dnom=valeur de la ligne de commande) peut aussi servir de
condition pour activer un profil. Enfin, le profil peut Ãªtre activÃ© en
fonction de la prÃ©sence d&#8217;un fichier particulier.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaOlivier.png" alt="MangaOlivier"></span></p>
</div>
<div class="paragraph">
<p>Olivier, qui travaille sous Solaris, se sent un peu exclu lorsqu&#8217;il voit
apparaÃ®tre dans le projet des dÃ©pendances de type DLL pour Windows.
Celles-ci sont nÃ©cessaires pour un de nos outils de dÃ©veloppement mais
elles sont Ã©galement disponibles dans des versions pour Mac ou Linux.
PlutÃ´t que d&#8217;obliger chacun de nous Ã  tÃ©lÃ©charger ces trois variantes
juste pour Ãªtre sÃ»r de satisfaire tout le monde, Olivier utilise les
profils pour Ã©tablir une liste de dÃ©pendance par type de systÃ¨me.</p>
</div>
<div class="paragraph">
<p>Le Listing 5.2 montre un autre cas d&#8217;activation d&#8217;un profil lorsque le
systÃ¨me qui exÃ©cute Maven est Windows. Cette particularitÃ© est exploitÃ©e
pour ajouter une dÃ©pendance qui n&#8217;aurait aucun sens sur un autre
systÃ¨meÂ :Â une bibliothÃ¨que native DLL.</p>
</div>
<div class="listingblock">
<div class="title">Listing 5.2 : Activation d&#8217;un profil en fonction du systÃ¨me d&#8217;exploitation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">   &lt;dependencies&gt;
       &lt;dependency&gt;
           &lt;groupId&gt;com.google.gwt&lt;/groupId&gt;
           &lt;artifactId&gt;gwt-dev&lt;/artifactId&gt;
           &lt;version&gt;1.6.2&lt;/version&gt;
           &lt;classifier&gt;${platform}&lt;/classifier&gt;
       &lt;dependency&gt;
   &lt;dependencies&gt;
   &lt;!--  profiles (activation en fonction de la plateforme) --&gt;
   &lt;profiles&gt;
          &lt;profile&gt;
                 &lt;id&gt;windows&lt;/id&gt;
                 &lt;properties&gt;
                        &lt;platform&gt;windows&lt;/platform&gt;
                 &lt;/properties&gt;
                 &lt;activation&gt;
                        &lt;os&gt;
                               &lt;family&gt;windows&lt;/family&gt;
                        &lt;/os&gt;
                 &lt;/activation&gt;
          &lt;/profile&gt;
          &lt;profile&gt;
                 &lt;id&gt;macos&lt;/id&gt;
                 &lt;properties&gt;
                        &lt;platform&gt;mac&lt;/platform&gt;
                 &lt;/properties&gt;
                 &lt;activation&gt;
                        &lt;activeByDefault&gt;false&lt;/activeByDefault&gt;
                        &lt;os&gt;
                               &lt;family&gt;mac&lt;/family&gt;
                        &lt;/os&gt;
                 &lt;/activation&gt;
          &lt;/profile&gt;
          &lt;profile&gt;
                 &lt;id&gt;solaris&lt;/id&gt;
                 &lt;properties&gt;
                        &lt;platform&gt;linux&lt;/platform&gt;
                 &lt;/properties&gt;
                 &lt;activation&gt;
                        &lt;activeByDefault&gt;false&lt;/activeByDefault&gt;
                        &lt;os&gt;
                               &lt;name&gt;sunos&lt;/name&gt;
                        &lt;/os&gt;
                 &lt;/activation&gt;
          &lt;/profile&gt;
   &lt;/profiles&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Dans l&#8217;exemple du Listing 5.2, la dÃ©pendance indiquÃ©e utilise la notion
de <em>classifier</em> que nous avons dÃ©jÃ  rencontrÃ©e au Chapitre 4. Celle-ci
permet de placer dans un rÃ©fÃ©rentiel Maven plusieurs variantes d&#8217;un mÃªme
artefact sous la mÃªme identitÃ© groupIdÂ : artefactIdÂ : version. C&#8217;est la
mÃ©thode recommandÃ©e si vous devez dÃ©river un mÃªme composant en fonction
du systÃ¨me cible comme ici, ou distribuer une version de la mÃªme
bibliothÃ¨que avec et sans mÃ©canisme de dÃ©bogage comme le propose le
<em>pilote</em> Oracle.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="desactiver_a_la_demande">DÃ©sactiver Ã  la demande</h4>
<div class="paragraph">
<p>Un profil peut aussi Ãªtre dÃ©clarÃ© Â«Â actif par dÃ©fautÂ Â», auquel cas on
considÃ¨re que le fait de ne pas exÃ©cuter les tÃ¢ches qu&#8217;il dÃ©clare est
une exception au mode de construction standard du projet mais qui peut
se justifier dans certains cas. Un profil actif par dÃ©faut peut Ãªtre
dÃ©sactivÃ© (Ã  partir de Maven 2.0.10) depuis la ligne de commande <em>via</em>
l&#8217;option -P, mais en faisant prÃ©cÃ©der son nom du symbole Â«Â !Â Â», qui
reprÃ©sente la nÃ©gation, comme en Java. Supposons, par exemple, que votre
projet exploite des rÃ¨gles de codage strictes, mais que vous admettez
que vos dÃ©veloppeurs puissent vouloir tester leur code avant de
s&#8217;assurer qu&#8217;elles sont strictement respectÃ©es. Le Listing 5.3 prÃ©sente
une configuration de ce type. La commande suivante permet de dÃ©roger Ã 
cette rÃ¨gle le temps d&#8217;une exÃ©cution de MavenÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mvn -P!codestyle install</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 5.3 : Profil contrÃ´lant le respect des rÃ¨gles de codage</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;profile&gt;
  &lt;id&gt;codestyle&lt;/id&gt;
  &lt;activation&gt;
    &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
  &lt;/activation&gt;
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-checkstyle-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.2&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;phase&gt;validate&lt;/phase&gt;
            &lt;configuration&gt;
                &lt;configLocation&gt;checkstyle.xml&lt;/configLocation&gt;
                &lt;consoleOutput&gt;true&lt;/consoleOutput&gt;
                &lt;failsOnError&gt;true&lt;/failsOnError&gt;
                &lt;linkXRef&gt;false&lt;/linkXRef&gt;
            &lt;/configuration&gt;
            &lt;goals&gt;
                &lt;goal&gt;checkstyle&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/profile&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Les profils sont ainsi un mÃ©canisme puissant que propose Maven pour
offrir plusieurs visages Ã  un projet, sans perdre le bÃ©nÃ©fice d&#8217;une
configuration unique pour tous. En activant les profils qui
correspondent Ã  son rÃ´le dans l&#8217;Ã©quipe, un dÃ©veloppeur peut faire coller
le comportement de Maven Ã  sa tÃ¢che courante. Il ne devra pas perdre un
temps prÃ©cieux Ã  chercher de lui-mÃªme des moyens de contournement pour
des traitements qui lui importent peu ou qui ne le concernent pas.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Le paramÃ¨tre d&#8217;activation &lt;activeByDefault&gt; ne s&#8217;applique que lorsqu&#8217;on
ne prÃ©cise pas explicitement une liste de profils avec l&#8217;option -P. Il ne
signifie pas que ce profil est toujours actif. Cela peut donc avoir des
effets indÃ©sirables si on introduit un nouveau profil sur un projet, car
ceux qui Ã©taient jusqu&#8217;ici Â«Â actifs par dÃ©fautÂ Â» seront alorsâ¦ dÃ©sactivÃ©s.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Tester_l_acces_a_une_base_de_donnees">Tester l&#8217;accÃ¨s Ã  une base de donnÃ©es</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaHerve.png" alt="MangaHerve"></span></p>
</div>
<div class="paragraph">
<p>Notre application utilise Ã©galement â comme une trÃ¨s grande majoritÃ© des
applications d&#8217;entreprise â une base de donnÃ©es. Une nouvelle fois, nous
ne voulons pas que cette partie technique de notre code passe au travers
de l&#8217;outillage de testÂ ; aussi, Ã©crivons-nous des tests unitaires qui
passent les requÃªtes SQL pour s&#8217;assurer de leur traitement correct dans
notre code. Nous utilisons des outils dÃ©diÃ©s Ã  ces tests un peu
particuliers pour nous faciliter la tÃ¢che, comme DBUnit ou Unitils (si
vous ne les connaissez pas, il est encore temps de rattraper votre
retardÂ !).</p>
</div>
<div class="paragraph">
<p>La difficultÃ© que ces outils viennent traiter est l&#8217;initialisation de
donnÃ©es de test prÃ©visibles, de maniÃ¨re qu&#8217;un test qui repose sur le
compte utilisateur Â«Â Marcel DupontÂ Â» trouve effectivement ce compte en
base dans l&#8217;Ã©tat prÃ©vu. VoilÃ  qui colle parfaitement avec nos attentesÂ :
une construction reproductible Ã  tout moment, <em>via</em> des donnÃ©es de test
totalement prÃ©visibles.</p>
</div>
<div class="paragraph">
<p>HervÃ© met en place les plugins Maven qui peuvent nous aider dans cette
tÃ¢che. Le Listing 5.4 prÃ©sente la configuration du plugin SQL servant Ã 
recrÃ©er complÃ¨tement la base de donnÃ©es et Ã  effacer les traces d&#8217;une
exÃ©cution prÃ©cÃ©dente ou de modifications manuelles qui pourraient
impacter le bon dÃ©roulement et la reproductibilitÃ© de nos tests.
D&#8217;autres scripts injectent des donnÃ©es de tests communes avant
l&#8217;exÃ©cution de ceux-ci. Cette configuration, bien qu&#8217;un peu longue
(d&#8217;avance, veuillez excuser la verbositÃ© du XML utilisÃ© par Maven),
dÃ©finit le pilote JDBC et la connexion Ã  la base de donnÃ©es Ã  utiliser,
puis ordonne la suppression de la base, sa reconstruction selon nos
scripts DDL et enfin l&#8217;injection de donnÃ©es de test de rÃ©fÃ©rence.</p>
</div>
<div class="paragraph">
<p>Il existe Ã©galement un plugin pour DBUnit qui permet d&#8217;utiliser le
format spÃ©cifique de celui-ci dans le mÃªme but.</p>
</div>
<div class="listingblock">
<div class="title">Listing 5.4 : PrÃ©paration d&#8217;une base de donnÃ©es de test "propre" avec le plugin SQL</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;sql-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.2&lt;/version&gt;
        &lt;dependencies&gt;
          &lt;dependency&gt;
            &lt;groupId&gt;com.oracle&lt;/groupId&gt;
            &lt;artifactId&gt;ojdbc14&lt;/artifactId&gt;
            &lt;version&gt;10.2.0.3.0&lt;/version&gt;
          &lt;/dependency&gt;
        &lt;/dependencies&gt;
        &lt;configuration&gt;
          &lt;driver&gt;oracle.jdbc.driver.OracleDriver &lt;/driver&gt;
          &lt;url&gt;jdbc:oracle:thin@localhost:1521:XE&lt;/url&gt;
          &lt;username&gt;user&lt;/username&gt;
          &lt;password&gt;pwd&lt;/password&gt;
        &lt;/configuration&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;drop-all-tables-before-test &lt;/id&gt;
            &lt;phase&gt;process-test-resources&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;execute&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;srcFiles&gt;
                &lt;srcFile&gt;src/main/sql/drop-schema.sql&lt;/srcFile&gt;
              &lt;/srcFiles&gt;
              &lt;onError&gt;continue&lt;/onError&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
          &lt;execution&gt;
            &lt;id&gt;create-schema&lt;/id&gt;
            &lt;phase&gt;process-test-resources&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;execute&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;srcFiles&gt;
                &lt;srcFile&gt;src/main/sql/create-schema.ddl&lt;/srcFile&gt;
              &lt;/srcFiles&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
          &lt;execution&gt;
            &lt;id&gt;create-data&lt;/id&gt;
            &lt;phase&gt;process-test-resources&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;execute&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;orderFile&gt;ascending&lt;/orderFile&gt;
              &lt;fileset&gt;
                &lt;basedir&gt;${basedir}/src/test/sql&lt;/basedir&gt;
                &lt;includes&gt;
                  &lt;include&gt;*.sql&lt;/include&gt;
                &lt;/includes&gt;
              &lt;/fileset&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Si cette configuration fonctionne trÃ¨s bien pour ceux qui ont installÃ©
une base Oracle eXpress, nos outils ne sont pas en mesure d&#8217;en installer
une et de la lancer Ã  notre place. Ils posent comme un prÃ©requis qu&#8217;une
base soit disponible Ã  chaque exÃ©cution du test avec les droits
nÃ©cessaires pour installer les donnÃ©es de test.</p>
</div>
<div class="paragraph">
<p>Il n&#8217;existe pas (encore) de plugin Maven qui installe et configure une
base de donnÃ©es Oracle ou MySQL sur votre poste durant la construction
du projet. Nous devons donc faire confiance au dÃ©veloppeur et penser
qu&#8217;il dispose sur son environnement d&#8217;une base de donnÃ©es fonctionnelle
et correctement configurÃ©e pour que nos tests puissent s&#8217;exÃ©cuter
correctement. Cela est par contre possible avec d&#8217;autres bases 100 %
Java comme Apache Derby ou HSQLDB.</p>
</div>
<div class="paragraph">
<p>La philosophie de Maven est justement d&#8217;aller contre ces prÃ©requis, qui
imposent aux dÃ©veloppeurs de passer de longues heures Ã  mettre leur
environnement au carrÃ© pour pouvoir enfin coller aux attentes du projet.
Demander Ã  chaque dÃ©veloppeur de disposer d&#8217;une base de donnÃ©es, de
fichiers de test ou de simulateurs fonctionnels, alors qu&#8217;il
n&#8217;intervient que sur une sous-partie du logiciel est contre-productif.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaHerve.png" alt="MangaHerve"></span></p>
</div>
<div class="paragraph">
<p>Ici aussi, un profil dÃ©diÃ© s&#8217;imposeÂ ! Avant de voir les dÃ©veloppeurs web
se plaindre de devoir installer Oracle eXpress juste pour les tests,
HervÃ© dÃ©finit un nouveau profil db dÃ©diÃ© Ã  cette partie spÃ©cifique de
l&#8217;application. Une nouvelle fois, tout le monde est ravi du compromis
obtenu, qui permet d&#8217;outiller trÃ¨s correctement notre code sans
pÃ©naliser la productivitÃ© des dÃ©veloppeurs non concernÃ©s.</p>
</div>
<div class="paragraph">
<p>Ceux qui s&#8217;acharnent Ã  trouver l&#8217;ordre SQL ultime peuvent tester avec un
outillage adaptÃ©, tandis que les dÃ©veloppeurs web qui n&#8217;ont aucune idÃ©e
de ce qu&#8217;est un Â«Â OUTER LEFT JOINÂ Â» peuvent purement et simplement
continuer Ã  l&#8217;ignorer et se focaliser sur leurs propres soucis.</p>
</div>
</div>
<div class="sect2">
<h3 id="_utiliser_des_tests_fonctionnels">Utiliser des tests fonctionnels</h3>
<div class="paragraph">
<p>Jusqu&#8217;ici, nos tests se sont limitÃ©s Ã  une approche unitaire, dans
laquelle nous validons le fonctionnement de composants isolÃ©s,
Ã©ventuellement implantÃ©s dans leur environnement technique, mais guÃ¨re
plus. Une autre faÃ§on, complÃ©mentaire, de tester une application est de
faire appel Ã  des outils de test fonctionnels, lesquels visent Ã  dÃ©crire
les cas de test de maniÃ¨re aussi conviviale et Â«Â non informatiqueÂ Â» que
possible. Ces tests sont donc lisibles par un utilisateur final et
facilement Ã©ditables pour coller au mieux aux besoins.</p>
</div>
<div class="paragraph">
<p>Nous utilisons Fitnesse <sup class="footnote">[<a id="_footnoteref_22" class="footnote" href="#_footnotedef_22" title="View footnote.">22</a>]</sup> pour dÃ©finir nos tests
fonctionnels. Cet outil se prÃ©sente Ã  l&#8217;utilisateur comme un wiki,
Ã©ditable en ligne <em>via</em> une syntaxe simpleÂ ; un outil particuliÃ¨rement
convivial qui s&#8217;adresse Ã  un public rebutÃ© par les langages de
programmation. La Figure 05-02 montre l&#8217;un de nos tests Fitnesse. Ses
intentions sont comprÃ©hensibles par tous, loin de la syntaxe obscure
d&#8217;un bout de code jUnit.</p>
</div>
<div class="paragraph">
<div class="title">Figure 05-02</div>
<p><span class="image"><img src="illustrations/05-02.png" alt="05 02"></span></p>
</div>
<div class="paragraph">
<p>Un test fonctionnel Ã©crit sous Fitnesse.</p>
</div>
<div class="paragraph">
<p>Le Listing 5.5 prÃ©sente la configuration du
plugin Maven <sup class="footnote">[<a id="_footnoteref_23" class="footnote" href="#_footnotedef_23" title="View footnote.">23</a>]</sup> permettant d&#8217;exÃ©cuter nos tests Fitnesse
lors de la construction du projet.</p>
</div>
<div class="listingblock">
<div class="title">Listing 5.5 : Configuration du plugin Fitnesse</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;fitnesse-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.0-beta-2&lt;/version&gt;
        &lt;configuration&gt;
          &lt;fitnesses&gt;
            &lt;fitnesse&gt;
                &lt;hostName&gt;myFitnesseServer&lt;/hostName&gt;
                &lt;port&gt;80&lt;/port&gt;
                &lt;pageName&gt;mySuitePage&lt;/pageName&gt;
            &lt;/fitnesse&gt;
          &lt;/fitnesses&gt;
          &lt;failOnError&gt;true&lt;/failOnError&gt;
          &lt;classPathProvider&gt;maven&lt;/classPathProvider&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ce plugin gÃ¨re l&#8217;intÃ©gration du serveur Fitnesse, sur lequel nous
enregistrons nos tests fonctionnels et leur pilotage depuis une exÃ©cution
de Maven. Le paramÃ¨tre classPathProvider, par exemple, permet de
remplacer la gestion du classpath Fitnesse par celle de Maven, grÃ¢ce Ã 
quoi nos dÃ©clarations de dÃ©pendances sont cohÃ©rentes avec le code
exÃ©cutÃ© par nos tests fonctionnels.</p>
</div>
<div class="paragraph">
<p>En une simple commande, nous pouvons demander l&#8217;exÃ©cution de notre
batterie de tests et valider le fonctionnement de notre application. La
simple commande <code>mvn fitnesse:run</code> suffit pour nous donner en quelques
minutes un rapport complet sur l&#8217;Ã©tat d&#8217;avancement de notre
dÃ©veloppement par rapport aux attentes exprimÃ©es par nos tests
fonctionnels.</p>
</div>
<div class="paragraph">
<p>Le paramÃ¨tre failOnError permet de stopper la construction du projet si
les tests fonctionnels ne sont pas entiÃ¨rement validÃ©s, option que nous
retiendrons pour automatiser notre livraison ou pour une campagne de
non-rÃ©gression entre deux versions.</p>
</div>
<div class="paragraph">
<p>Les tests fonctionnels, parfois aussi appelÃ©s <em>tests d&#8217;acceptation</em>,
sont un excellent moyen de qualifier un projet par rapport aux exigences
des utilisateurs. Leur intÃ©gration dans un projet Maven est un trÃ¨s bon
moyen de mesurer le taux rÃ©el de couverture des besoins, alors que
d&#8217;autres outils, basÃ©s sur les tests unitaires, vont reflÃ©ter la
couverture technique mais pas l&#8217;adÃ©quation du code avec la demande.</p>
</div>
<div class="paragraph">
<p>Avec cette catÃ©gorie d&#8217;outils et la possibilitÃ© de les utiliser dans
notre construction de projet sans installation prÃ©alable d&#8217;un matÃ©riel
particulier, nous ouvrons la porte Ã  un dÃ©veloppement pilotÃ© par les
besoins des utilisateurs. Si nos tests techniques, plus ou moins
unitaires, permettent de valider le fonctionnement technique de notre
application, cette nouvelle catÃ©gorie apporte une rÃ©elle plus-value Ã 
notre travail en Ã©tant disponible sur chaque poste de dÃ©veloppement
<em>via</em> une simple commande Maven.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tester_la_charge_et_les_performances">Tester la charge et les performances</h3>
<div class="paragraph">
<p>Tous les tests qui prÃ©cÃ¨dent ont un point communÂ : ils sont
mono-utilisateurs. Ils valident le fonctionnement de l&#8217;application mais
pas sa capacitÃ© Ã  traiter la charge d&#8217;utilisateurs simultanÃ©s et Ã 
Ã©viter les interblocages et autres Ã©crasements qui peuvent en rÃ©sulter.
Comme tous nos tests, des tests de charge de ce type sont intÃ©ressants Ã 
un instant <em>t</em> mais ils le sont beaucoup plus si on est en mesure de les
rejouer Ã  l&#8217;identique et d&#8217;analyser l&#8217;Ã©volution des rÃ©sultats. Et, bien
sÃ»r, ils deviennent rapidement indispensables si nous sommes en mesure
d&#8217;automatiser le processus et d&#8217;agrÃ©ger les rÃ©sultats dans un outil de
suivi.</p>
</div>
<div class="paragraph">
<p>Quel chef de projet ne rÃªve pas d&#8217;un tableau de bord lui indiquant,
<em>via</em> une courbe synthÃ©tique, l&#8217;Ã©volution de la capacitÃ© de son
application semaine aprÃ¨s semaine, Ã  encaisser une charge de 100, 200 et
500 utilisateurs simultanÃ©sÂ ?</p>
</div>
<div class="paragraph">
<p>Nous faisons appel Ã  jMeter <sup class="footnote">[<a id="_footnoteref_24" class="footnote" href="#_footnotedef_24" title="View footnote.">24</a>]</sup>, outil de la fondation
Apache, pour dÃ©finir des scÃ©narios de test. Cet outil permet
d&#8217;enregistrer puis de rejouer Ã  volontÃ© des scÃ©narios pour charger une
application web, un service web SOAP, une base de donnÃ©es JDBC, un
serveur de messagerie JMS, ou encore un annuaire LDAPâ¦ Il s&#8217;utilise le
plus souvent en deux tempsÂ :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On se place au cours d&#8217;une premiÃ¨re phase dans un mode
d&#8217;enregistrement, pour lequel jMeter va agir en mandataire pour accÃ©der
Ã  notre application et enregistrer toutes nos actions. Le rÃ©sultat est
un scÃ©nario d&#8217;utilisation de notre application que nous pouvons par la
suite modifier ou instrumenter pour le rendre plus intelligent qu&#8217;une
simple rÃ©exÃ©cution Ã  l&#8217;identiqueÂ ;</p>
</li>
<li>
<p>Le mode charge permet de rejouer notre scÃ©nario depuis plusieurs
<em>threads</em> selon un ordonnancement Ã  notre convenance. Il est ainsi
possible de tester le comportement de notre application web sous
100 requÃªtes par seconde avec juste ce qu&#8217;il faut de dÃ©lais alÃ©atoires
pour simuler une charge rÃ©aliste.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Une fois encore, nous faisons appel Ã  un plugin Maven <sup class="footnote">[<a id="_footnoteref_25" class="footnote" href="#_footnotedef_25" title="View footnote.">25</a>]</sup>
pour faire le lien entre notre projet et cet outil. Celui-ci est
cependant moins abouti que ceux que nous avons rencontrÃ©s jusqu&#8217;ici et
il nous faudra le compiler par nos propres moyens. Pas de panique, une
simple commande Maven suffit pour cela, comme l&#8217;indique la page de
documentation du plugin. Si vous voulez Ã©viter Ã  chaque utilisateur
cette tÃ¢che, soyez un peu patient et attendez la lecture du Chapitre 6.</p>
</div>
<div class="paragraph">
<p>Nos scÃ©narios ont Ã©tÃ© enregistrÃ©s sous forme de fichiers jmx, le format
utilisÃ© par jMeter. Nous suivons la convention du plugin jmeter en les
plaÃ§ant dans notre projet sous src/test/jmeter. AprÃ¨s une configuration
minimale, il ne nous reste plus qu&#8217;Ã  invoquer la commande mvn
jmeter:jmeter pour envoyer Ã  notre application les 50 requÃªtes par
seconde qui vont vÃ©rifier sa bonne stabilitÃ© sous la chargeÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.jmeter&lt;/groupId&gt;
        &lt;artifactId&gt;maven-jmeter-plugin&lt;/artifactId&gt;
        &lt;configuration&gt;
          &lt;includes&gt;
            &lt;include&gt;consultation-50parSeconde.jmx&lt;/include&gt;
            &lt;include&gt;miseAJour-50parSeconde.jmx&lt;/include&gt;
          &lt;/includes&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cette intÃ©gration suppose que notre application est en cours de
fonctionnement sur le serveur lorsque nous lanÃ§ons la charge. Nous
verrons au Chapitre 8 qu&#8217;il est Ã©galement possible d&#8217;utiliser
l&#8217;automatisation par Maven pour assembler notre application web,
configurer un serveur d&#8217;application de test et dÃ©marrer le tout juste
avant d&#8217;exÃ©cuter ce type de test.</p>
</div>
<div class="sect3">
<h4 id="integration_continue_2">IntÃ©gration continue</h4>
<div class="paragraph">
<p>Le serveur d&#8217;intÃ©gration continue est utilisÃ© pour l&#8217;instant pour
valider l&#8217;exÃ©cution de nos tests unitaires. L&#8217;objectif est quâil
rÃ©agisse trÃ¨s vite pour nous signaler une maladresse ou une dÃ©faillance
de l&#8217;un de nos neurones, ce qui est plus frÃ©quent qu&#8217;on le voudrait.</p>
</div>
<div class="paragraph">
<p>Avec tous nos nouveaux profils, comment configurer l&#8217;intÃ©gration
continueÂ ? Nous voulons une couverture aussi complÃ¨te que possible, mais
sans rÃ©duire le temps de rÃ©action du serveur. Une pratique courante est
d&#8217;avoir une intÃ©gration continue en plusieurs passesÂ :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Le serveur principal, qui scrute notre gestionnaire de code
source pour identifier la moindre de nos modifications, est configurÃ©
pour rÃ©agir au plus vite. Il n&#8217;exÃ©cute que les tests unitaires et
Ã©ventuellement quelques contrÃ´les complÃ©mentaires peu coÃ»teuxÂ ;</p>
</li>
<li>
<p>Un second serveur vient en complÃ©ment. Il effectue une
construction du projet plus poussÃ©e et passe les tests d&#8217;intÃ©gration
plus consommateurs de ressources. Le lancement de ce serveur est pilotÃ©
depuis le premier serveur, suite Ã  une construction rÃ©ussie.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Bien sÃ»r, cela suppose de disposer de davantage de machines disponibles,
mais n&#8217;oubliez pas ce que peut coÃ»ter un bogue identifiÃ© tardivement sur
un projet, surtout si c&#8217;est pour constater finalement qu&#8217;il s&#8217;agit d&#8217;une
Ã©tourderie, d&#8217;un Â«Â TODOÂ Â» laissÃ© nÃ©gligemment dans le code, d&#8217;un
copier-coller maladroit, ou d&#8217;une petite modif' sans grande importance
qui en a finalement eu plus que prÃ©vu. Tout cela alors qu&#8217;on dispose de
tout l&#8217;outillage nÃ©cessaire pour identifier de telles Ã¢neries. Les
machines ne dorment pas, ne se plaignent pas, et surtout ne relÃ¢chent
jamais leur attention lorsqu&#8217;il s&#8217;agit d&#8217;Ã©pier nos dÃ©faillancesÂ !</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_profils_et_effets_de_bords">Profils et effets de bords</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaEmmanuel.png" alt="MangaEmmanuel"></span></p>
</div>
<div class="paragraph">
<p>Emmanuel est confrontÃ© Ã  un problÃ¨meÂ : il dispose de deux versions de
nos fichiers de configurationÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>une version de dÃ©veloppement et de test, utilisant une base de
donnÃ©es lÃ©gÃ¨re en mÃ©moire et avec une sÃ©curitÃ© minimaliste nÃ©cessaire
pour nos testsÂ ;</p>
</li>
<li>
<p>une version de production, ciblant notre cluster MySQL et
verrouillant tous les accÃ¨s.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>La norme JavaEE prÃ©voit comme seule solution de configuration d&#8217;une
application le passage par des rÃ©fÃ©rences JNDI. En faisant abstraction
de la relative complexitÃ© que cela implique, il est surtout regrettable
qu&#8217;il n&#8217;existe pas de solution simple et portable pour dÃ©finir des
paramÃ¨tres de configuration Ã  l&#8217;extÃ©rieur de l&#8217;archive WAR ou EAR, et de
passer ainsi facilement d&#8217;une configuration de test Ã  une configuration
de production.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Pour pallier ce problÃ¨me, chacun invente sa solutionÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>emplacement des fichiers de configuration passÃ©s via le JNDIÂ ;</p>
</li>
<li>
<p>variable systÃ¨me Java ajoutÃ© Ã  la JVM du serveur d&#8217;applicationÂ ;</p>
</li>
<li>
<p>chemin des fichiers de configuration ajoutÃ© dans le classpath du
serveurÂ ;</p>
</li>
<li>
<p>â¦</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Chacune a ses avantages et ses inconvÃ©nients.</p>
</div>
<div class="paragraph">
<p>Nous avons mis en place un certain nombre de profils pour isoler des
aspects coÃ»teux ou dÃ©pendants de l&#8217;environnement. Emmanuel a l&#8217;idÃ©e
d&#8217;utiliser le mÃªme mÃ©canisme pour que le <em>build</em> du projet produise soit
une version de dÃ©veloppement, soit une version de production. L&#8217;ajout
d&#8217;un petit paramÃ¨tre -Pdev suffit Ã  basculer sur la version de
dÃ©veloppement.</p>
</div>
<div class="paragraph">
<p>GÃ©nialÂ ? C&#8217;est ce que nous avons pensÃ©, avant de constater avec horreur
que notre derniÃ¨re version mise en production Ã©tait une version de
dÃ©veloppementÂ !</p>
</div>
<div class="paragraph">
<p>L&#8217;activation d&#8217;un profil modifie la nature de notre livrable, sans en
changer pour autant l&#8217;identitÃ© au sens Maven (groupId + artifactId<br>
version). L&#8217;un de nous a par mÃ©garde dÃ©ployÃ© sa version de
dÃ©veloppement, sans qu&#8217;aucun mÃ©canisme Maven ne puisse le prÃ©venir de la
bÃ©vue (par respect pour sa famille, nous ne dÃ©noncerons pas ici le
malheureux qui a fait cette bourde, cependant il nous est redevable de
deux douzaines de biÃ¨res).</p>
</div>
<div class="paragraph">
<p>Les profils, comme nous l&#8217;avons vu dans ce chapitre, permettent de
rendre des parties du <em>build</em> optionnelles, ou dÃ©pendantes de
l&#8217;environnement. Un livrable construit sans exÃ©cuter les tests de
performance reste le mÃªme livrable. Un livrable construit en changeant
son contenu, mÃªme partiellement, n&#8217;est pas le mÃªme livrable et doit donc
disposer d&#8217;une carte d&#8217;identitÃ© propre. Pour ce cas de figure, Maven
prÃ©voit le mÃ©canisme de <em>classifier</em>, une sorte d&#8217;extension de
l&#8217;artifactId, qui permet d&#8217;identifier une variante d&#8217;un mÃªme artefact
(toutes les variantes partagent le mÃªme POM).</p>
</div>
<div class="paragraph">
<p>Pour mettre en Åuvre ce principe, il suffit de prÃ©voir dans notre
profil dev, qui modifie la nature du livrable pour le faire basculer en
mode allÃ©gÃ© et facilement testable, d&#8217;associer au passage un classifier
Ã  notre artefact. Le livrable produit ne sera alors jamais en conflit
avec son petit frÃ¨re de productionÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;profile&gt;
  &lt;id&gt;dev&lt;/id&gt;
  &lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;
            &lt;version&gt;2.3.1&lt;/version&gt;
            &lt;configuration&gt;
                &lt;classifier&gt;dev&lt;/classifier&gt;
            &lt;/configuration&gt;
        &lt;/plugin&gt;
        ...</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_4">Conclusion</h3>
<div class="paragraph">
<p>Lorsqu&#8217;on pousse la logique d&#8217;outiller l&#8217;application de tests
automatisÃ©s, on peut aller trÃ¨s loin, et de nombreux outils vont venir
nous Ã©pauler dans cette tÃ¢che. Le Web fourmille d&#8217;ailleurs de nouvelles
idÃ©es sur le sujet, qui deviendront peut-Ãªtre les standards de
dÃ©veloppement de demain. Maven prÃ©voit les mÃ©canismes nÃ©cessaires pour
venir les greffer dans la construction du projet, au prix parfois de
quelques acrobaties techniques tant les dÃ©fis Ã  relever peuvent Ãªtre
complexes.</p>
</div>
<div class="paragraph">
<p>La Figure 05-03 rÃ©sume les outils que nous venons dâÃ©voquer, ce qui est
loin de couvrir toute l&#8217;Ã©tendue de l&#8217;outillage de test disponible mÃªme
en ne considÃ©rant que les outils Open Source. On y voit le
positionnement de chaque outil en fonction du niveau d&#8217;abstraction,
proche du code ou bien du fonctionnel, et de la spÃ©cialisation d&#8217;un
outil vis-Ã -vis d&#8217;une technologie donnÃ©e.</p>
</div>
<div class="paragraph">
<div class="title">Figure 05-03</div>
<p><span class="image"><img src="illustrations/05-03.png" alt="05 03"></span></p>
</div>
<div class="paragraph">
<p>Positionnement de nos outils de test.</p>
</div>
<div class="paragraph">
<p>Les profils permettent de rendre optionnelles toutes ces Ã©tapes
dÃ©licates ou coÃ»teuses et limitent l&#8217;impact qu&#8217;elles peuvent avoir sur
l&#8217;ensemble de l&#8217;Ã©quipe alors qu&#8217;elles nâen concernent qu&#8217;une petite
partie. Tester efficacement une application est une tÃ¢che tellement
large qu&#8217;elle ne peut pas se rÃ©sumer Ã  quelques plugins. Si vous ne
devez retenir qu&#8217;une chose, c&#8217;est que tout cet outillage peut prendre sa
place dans votre configuration Maven et gagnera en homogÃ©nÃ©itÃ©. Placez
vos scripts de test sous SVN et voyez comment configurer leur exÃ©cution
depuis Maven. Ceux qui vous suivront vous en remercieront pour le temps
que vous leur ferez gagner.</p>
</div>
</div>
</div>
</div>
<h1 id="_partie_2" class="sect0">Partie 2</h1>
<div class="openblock partintro">
<div class="title">Maven en entreprise</div>
<div class="content">
<div class="paragraph">
<p>Dans cette deuxiÃ¨me partie, nous allons confronter Maven Ã  des
contraintes assez particuliÃ¨res, celles du monde de l&#8217;entreprise. Ici
rÃ¨gnent la loi et l&#8217;ordre, mais aussi l&#8217;urgence et le manque de moyens.
Il faut faire bien â trÃ¨s bien, mÃªme â avec les gens dont on dispose. Il
faut respecter Ã  la lettre le cahier des charges, rÃ©pondre aux critÃ¨res
de qualitÃ© et de traÃ§abilitÃ©, Ãªtre capable Ã  tout moment de passer la
main Ã  un autre dÃ©veloppeur pour faire face Ã  des fluctuations
d&#8217;effectif.</p>
</div>
<div class="paragraph">
<p>Maven est un projet nÃ© dans le monde de l&#8217;Open Source, fondÃ© sur la
collaboration bÃ©nÃ©vole de dÃ©veloppeurs venus d&#8217;horizons trÃ¨s variÃ©s.
Aussi Ã©tonnant que cela puisse paraÃ®tre, une communautÃ© de ce type est
ce qu&#8217;il existe de plus exigeantÂ : les volontaires ne prennent aucun
plaisir Ã  passer de longues heures Ã  corriger un bogue, ils apprÃ©cient
peu de voir leur code Â«Â bousculÃ©Â Â» par un autre dÃ©veloppeur qui a choisi
des rÃ¨gles d&#8217;Ã©criture diffÃ©rentes, et rechignent Ã  expliquer longuement
au petit nouveau les secrets de leur code. Ils sont donc les premiers Ã 
vouloir dÃ©finir et appliquer un cadre commun, des rÃ¨gles de lisibilitÃ©,
et Ã  s&#8217;outiller en consÃ©quence pour que toutes les tÃ¢ches rÃ©barbatives
ou risquÃ©es soient automatisÃ©es.</p>
</div>
<div class="paragraph">
<p>Nous allons voir dans quelle mesure la communautÃ© Open Source Maven a
devancÃ© les attentes du monde de l&#8217;informatique professionnelle, en
proposant, <em>via</em> son outil, une gestion de projets, d&#8217;une part, trÃ¨s
propre et disciplinÃ©e et, d&#8217;autre part, trÃ¨s simple et accessible Ã 
tous.</p>
</div>
<div class="paragraph">
<p>$$$ SEPARATEUR</p>
</div>
<div class="paragraph">
<p>Nos compÃ¨res prennent bien du plaisir sur leur projet de gestion de
liste de courses. De nombreuses fonctionnalitÃ©s et technologies de
pointe en ont fait un outil riche et attrayant, si bien qu&#8217;une petite
communautÃ© d&#8217;utilisateurs commence Ã  rÃ©clamer les prochaines versions
avec impatience. Les choses aboutissent de faÃ§on inespÃ©rÃ©eÂ : un
investisseur, un Â«Â business angelÂ Â» Ã  la recherche de la perle rare, leur
propose de passer du statut d&#8217;amateur Ã  celui de professionnels de
l&#8217;informatique en montant une start-up pour porter le projet.
LesOutilsIndispensablesDeLaMÃ©nagÃ¨re.com est nÃ©Â !</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="illustrations/MeNAgere.png" alt="MeNAgere"></span></p>
</div>
<div class="paragraph">
<p>Alors que Maven devenait un outil de plus en plus utilisÃ©, quelques
dÃ©veloppeurs du projet ont fondÃ© en 2004 une sociÃ©tÃ© dÃ©diÃ©e au support
et au dÃ©veloppement de leur bÃ©bÃ©. Mergere Ã©tait nÃ©. L&#8217;aventure a tournÃ©
court et a donnÃ© naissance en 2007 Ã  deux sociÃ©tÃ©s qui continuent de
soutenir le dÃ©veloppement de Maven, Sonatype et Devzuz (rachetÃ©e depuis
par Exist Global).</p>
</div>
<div class="paragraph">
<p>Le logo de l&#8217;entreprise de notre Â«Â histoire romancÃ©e d&#8217;un projet fictifÂ Â»
est un clin d&#8217;Åil Ã  cette aventure humaine qui montre un autre visage du
dÃ©veloppement Open Source.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Gestion_avancee_des_dependances">Chapitre 6Â : Gestion avancÃ©e des dÃ©pendances</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Notre projet commence Ã  prendre une tournure Â«Â intÃ©ressanteÂ Â» du point de
vue de ses fonctionnalitÃ©s. Sous le capot, par contre, c&#8217;est un peu un
mÃ©lange hÃ©tÃ©roclite de technologies diverses, chacune ayant apportÃ© sa
petite touche Ã  l&#8217;Ã©difice.</p>
</div>
<div class="paragraph">
<p>Jusqu&#8217;ici, nous nous Ã©tions contentÃ©s d&#8217;ajouter des dÃ©pendances, sans y
regarder de trop prÃ¨s. Nous avons dÃ©jÃ  constatÃ© que cela pouvait avoir
des effets de bord en introduisant des doublons dans nos bibliothÃ¨ques.
Nous lanÃ§ons donc une analyse un peu plus stricte de nos dÃ©pendances.
PremiÃ¨re Ã©tape, reconstruction de l&#8217;intÃ©gralitÃ© du projet sur un poste
de dÃ©veloppement fraÃ®chement installÃ©.</p>
</div>
<div class="sect2">
<h3 id="_oracle_quand_tu_nous_tiens">Oracle, quand tu nous tiens</h3>
<div class="paragraph">
<p>La construction du projet Ã©choue dans sa toute premiÃ¨re phase. VoilÃ  qui
n&#8217;est pas trÃ¨s encourageantÂ ! Maven signale le problÃ¨me de dÃ©pendance
indiquÃ© au Listing 6.1.</p>
</div>
<div class="listingblock">
<div class="title">Listing 6.1 : Erreur de rÃ©solution des dÃ©pendances</div>
<div class="content">
<pre>[ERROR] BUILD ERROR
[INFO] ------------------------------------------------------------------------
[INFO] Failed to resolve artifact. Missing:
----------
\1) com.oracle:ojdbc14:jar:10.2.0.2.0
  Try downloading the file manually from the project website.
  Then, install it using the command:
      mvn install:install-file -DgroupId=com.oracle -DartifactId=ojdbc14 -Dversion=10.2.0.2.0 -Dpackaging=jar -Dfile=/path/to/file
  Alternatively, if you host your own repository you can deploy the file
there:
      mvn deploy:deploy-file -DgroupId=com.oracle -DartifactId=ojdbc14 -Dversion=10.2.0.2.0 -Dpackaging=jar -Dfile=/path/to/file -Durl=[url] -DrepositoryId=[id]
  Path to dependency:
        1) fr.noubliepaslalistedescourses:noubliepaslalistedescourses:jar:1.0.0-SNAPSHOT
        2) com.oracle:ojdbc14:jar:10.2.0.2.0
----------

1 required artifact is missing.

for artifact:

fr.noubliepaslalistedescourses:noubliepaslalistedescourses:jar:1.0.0-SNAPSHOT

from the specified remote repositories:

  central (http://repo1.maven.org/maven2),
----</pre>
</div>
</div>
<div class="sect3">
<h4 id="_un_moteur_de_recherche_pour_maven">Un moteur de recherche pour Maven</h4>
<div class="paragraph">
<p>Notre dÃ©claration de dÃ©pendance est-elle incorrecteÂ ? Peut-Ãªtre
n&#8217;utilisons-nous pas le bon identifiant de groupe en spÃ©cifiant
com.oracle, alors qu&#8217;il faudrait indiquer com.oracle.jdbc,
com.oracle.driver ou encore oracle tout courtÂ ? Nous pouvons, bien sÃ»r,
nous lancer dans une recherche manuelle mais cela risque rapidement
d&#8217;Ãªtre pÃ©nible et pas forcÃ©ment trÃ¨s concluant.</p>
</div>
<div class="paragraph">
<p>D&#8217;autres ont eu ce mÃªme problÃ¨me et ont donc mis en place des moteurs de
recherche spÃ©cialisÃ©s pour Maven, par exemple, le site mvnrepository.com
qui offre une indexation du dÃ©pÃ´t <em>central</em> utilisÃ© par dÃ©faut par
Maven. Nous y faisons une recherche sur le mot Â«Â oracleÂ Â», et nous
obtenons rapidement la confirmation attendue sur l&#8217;identitÃ© de notre
pilote JDBC (voir Figure 06-01).</p>
</div>
<div class="paragraph">
<div class="title">Figure 06-01</div>
<p><span class="image"><img src="illustrations/06-01.png" alt="06 01"></span></p>
</div>
<div class="paragraph">
<p>Recherche d&#8217;un artefact <em>via</em> un moteur de recherche spÃ©cialisÃ©.</p>
</div>
<div class="paragraph">
<p>Nous voilÃ  au moins rassurÃ©s pour l&#8217;identification de notre dÃ©pendanceÂ :
nous avons spÃ©cifiÃ© les groupe, artifactId et version corrects. Mais
alors, pourquoi Maven ne parvient-il pas Ã  tÃ©lÃ©charger ce pilote JDBCÂ ?</p>
</div>
<div class="paragraph">
<p>La rÃ©ponse est relativement Ã©vidente si vous vous connectez au site
OracleÂ : la distribution de cette bibliothÃ¨que est soumise Ã  l&#8217;accord
d&#8217;Oracle, et elle ne peut Ãªtre tÃ©lÃ©chargÃ©e qu&#8217;aprÃ¨s enregistrement sur
le site de l&#8217;Ã©diteur. L&#8217;Ã©quipe Maven qui gÃ¨re le dÃ©pÃ´t ne peut donc pas
la mettre librement Ã  disposition de chacun, tout juste peut-elle
proposer un fichier POM et un groupe clairement dÃ©fini pour ce pilote.</p>
</div>
<div class="paragraph">
<p>Il revient donc Ã  chacun d&#8217;aller tÃ©lÃ©charger manuellement le fichier
indiquÃ©.</p>
</div>
</div>
<div class="sect3">
<h4 id="_pourquoi_publier_un_pom_sans_jar">Pourquoi publier un POM sans JARÂ ?</h4>
<div class="paragraph">
<p>Quel intÃ©rÃªt y a-t-il Ã  publier sur <em>central</em> le POM du pilote Oracle si
la bibliothÃ¨que ne l&#8217;accompagne pasÂ ? Un Ã©lÃ©ment de rÃ©ponse figure dans
le paragraphe qui prÃ©cÃ¨deÂ : toute personne utilisant Maven qui recherche
ce pilote va au moins utiliser des identifiants de groupe, d&#8217;artefact et
les versions dÃ©jÃ  rÃ©fÃ©rencÃ©es. Cela assure l&#8217;homogÃ©nÃ©itÃ© des projets.
Ensuite, le fichier POM compte de nombreuses mÃ©tadonnÃ©es qui peuvent
informer sur la bibliothÃ¨que, en particulierÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>l&#8217;organisation qui dÃ©veloppe cette bibliothÃ¨queÂ ;</p>
</li>
<li>
<p>une description qui peut nous aider Ã  confirmer son identitÃ©Â ;</p>
</li>
<li>
<p>la licence sous laquelle elle est distribuÃ©e, ce qui peut dans
certains cas Ãªtre rÃ©dhibitoire (pensez, par exemple, aux conditions
particuliÃ¨res de certaines licences propriÃ©taires ou Ã  la licence GPL
qui s&#8217;applique par Â«Â contaminationÂ Â» au projet dans son ensemble)Â ;</p>
</li>
<li>
<p>l&#8217;URL oÃ¹ on peut la tÃ©lÃ©charger. Tout site Internet respectueux de
ses utilisateurs ne changerait jamais une URL de tÃ©lÃ©chargement,
n&#8217;est-ce pasÂ ?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>L&#8217;intÃ©gralitÃ© de ces mÃ©tadonnÃ©es n&#8217;est cependant pas toujours disponible
ce qui est fort dommageable. En particulier, l&#8217;information de licence
devrait Ãªtre plus gÃ©nÃ©ralement indiquÃ©e, car elle peut fortement impacter
les projets qui utilisent une dÃ©pendance.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>La licence GPL s&#8217;applique Ã  des logiciels libres et autorise
l&#8217;utilisation totalement gratuite du logiciel considÃ©rÃ©. Elle impose
cependant que la modification ou l&#8217;utilisation du logiciel sous GPL dans
un autre logiciel ne puisse se faire que dans les mÃªmes conditions de
licence.</p>
</div>
<div class="paragraph">
<p>Dit plus simplement, l&#8217;utilisation d&#8217;une bibliothÃ¨que sous GPL impose
que votre projet soit dÃ©veloppÃ© sous cette licence. Si votre projet est
Ã  usage interne, ce n&#8217;est pas nÃ©cessairement un problÃ¨me (bien que cela
soit sujet Ã  interprÃ©tation), mais si vous envisagez de le diffuser,
l&#8217;impact est Ã©norme. Cela Ã©tant dit, certaines licences propriÃ©taires
sont largement aussi contraignantes lorsqu&#8217;on lit le dÃ©tail des petites
lignesÂ ;).</p>
</div>
<div class="paragraph">
<p>L&#8217;information de licence n&#8217;Ã©tant pas toujours disponible, il n&#8217;est pas
possible d&#8217;automatiser de maniÃ¨re fiable l&#8217;analyse des licences sur un
projet. Ce serait cependant une fonctionnalitÃ© trÃ¨s intÃ©ressante de
Maven.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_installer_le_fichier_manquant">Installer le fichier manquant</h4>
<div class="paragraph">
<p>GrÃ¢ce aux informations du POM, nous sommes enfin en mesure de rÃ©cupÃ©rer
la bibliothÃ¨que du pilote JDBC Oracle en suivant la procÃ©dure lÃ©gale de
tÃ©lÃ©chargement, aprÃ¨s avoir lu en dÃ©tail la longue page d&#8217;acceptation de
la licence.</p>
</div>
<div class="paragraph">
<p>La solution que propose spontanÃ©ment Maven, c&#8217;est d&#8217;installer la
bibliothÃ¨que manquante Ã  la main. La commande Ã  utiliser a Ã©tÃ© fournie
dans le message du Listing 6.1. Il nous suffit de faire un copier-coller
dans notre console en indiquant le fichier en questionâ¦ ce qui suppose
tout de mÃªme que nous l&#8217;ayons trouvÃ© quelque part et, bien sÃ»r, que nous
soyons parfaitement certains de l&#8217;identitÃ© du fichier.</p>
</div>
<div class="paragraph">
<p>Le numÃ©ro de version Ã  5 chiffres utilisÃ© par Oracle n&#8217;est pas trÃ¨s
rassurant de ce point de vue. Il y a de toute Ã©vidence de nombreuses
microversions, sans doute des correctifs successifs dont nous n&#8217;avons
pas strictement besoin, mais qui saitÂ ?</p>
</div>
<div class="paragraph">
<p>C&#8217;est une solution rapide, tout Ã  fait lÃ©gitime si nous disposons de la
bibliothÃ¨que en question par un autre moyen.</p>
</div>
</div>
<div class="sect3">
<h4 id="les_dependances_system">Les dÃ©pendances Â«Â SystemÂ Â»</h4>
<div class="paragraph">
<p>Nous avons donc une solution pour le pilote OracleÂ ; cependant, chacun
de nous doit l&#8217;installer dans son dÃ©pÃ´t local. MÃªme si nous nous le
passons par mail, clÃ© USB ou partage de rÃ©pertoire interposÃ© (ce qui
sous-entend que nous n&#8217;avons pas trÃ¨s bien lu la longue page de licence
du site Oracle), ce n&#8217;est pas trÃ¨s pratique.</p>
</div>
<div class="paragraph">
<p>D&#8217;un point de vue lÃ©gal, chaque dÃ©veloppeur doit accepter
individuellement la licence Oracle pour obtenir le fameux pilote. Une
faÃ§on courante de l&#8217;obtenir est donc de tÃ©lÃ©charger et d&#8217;installer
l&#8217;environnement de dÃ©veloppement Oracle (client natif et autres outils)
qui comprendra entre autres le fameux pilote. Dans ce cas bien prÃ©cis,
nous pouvons indiquer une dÃ©pendance system sous la formeÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.oracle&lt;/groupId&gt;
    &lt;artifactId&gt;ojdbc14&lt;/artifactId&gt;
    &lt;version&gt;10.2.0.3.0&lt;/version&gt;
    &lt;scope&gt;system&lt;/scope&gt;
    &lt;systemPath&gt;${env.ORACLE_HOME}/client/java/ojdbc14.jar&lt;/systemPath&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Le scope system utilisÃ© ici permet de pointer vers un emplacement du
poste de dÃ©veloppement pour accÃ©der Ã  une ressource locale qui ne peut
pas Ãªtre gÃ©rÃ©e par le mÃ©canisme de tÃ©lÃ©chargement des dÃ©pendances, pour
des raisons lÃ©gales la plupart du temps. Les dÃ©pendances de ce type sont
accompagnÃ©es d&#8217;un Ã©lÃ©ment supplÃ©mentaire systemPath (qui n&#8217;est pas
valide en dehors de ce cas). Ce chemin indique l&#8217;emplacement physique de
l&#8217;artefact.</p>
</div>
<div class="paragraph">
<p>Ãvidemment, ce cas de figure correspond Ã  une lecture stricte du contrat
de licence Oracle, et, pour des questions pratiques, vous prÃ©fÃ©rerez
trÃ¨s certainement partager entre dÃ©veloppeurs d&#8217;une mÃªme Ã©quipe le
fichier JAR tÃ©lÃ©chargÃ© une fois pour toutes. Il est trÃ¨s improbable
qu&#8217;Oracle vous envoie ses brigades antipirates pour violation de la
licence, surtout si vous venez de l&#8217;acheter pour installer la base de
donnÃ©es sur votre serveur bi-processeur quad-core <sup class="footnote">[<a id="_footnoteref_26" class="footnote" href="#_footnotedef_26" title="View footnote.">26</a>]</sup> assortie d&#8217;un contrat de supportÂ ;-).</p>
</div>
<div class="paragraph">
<p>Nous pourrions aussi Ãªtre tentÃ©s de dÃ©tourner ce scope et d&#8217;intÃ©grer le
JAR dans le gestionnaire de code, ce qui permettrait Ã  chacun d&#8217;en
disposer d&#8217;une maniÃ¨re simple sans se poser plus de questionsÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.oracle&lt;/groupId&gt;
    &lt;artifactId&gt;ojdbc14&lt;/artifactId&gt;
    &lt;version&gt;10.2.0.3.0&lt;/version&gt;
    &lt;scope&gt;system&lt;/scope&gt;
    &lt;systemPath&gt;${basedir}/lib/ojdbc14.jar&lt;/systemPath&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cela nous Ã©vite de devoir Ã©changer le fichier Ã  la main. Cependant,
stocker des binaires dans notre gestionnaire de code source est quelque
peu contre-nature. Par ailleurs, si chaque projet qui utilise une base
Oracle doit intÃ©grer un rÃ©pertoire lib, nous allons Ãªtre tÃ©moins de la
multiplication rapide des fichiers JAR sur nos postes de dÃ©veloppement.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Creer_son_propre_depot">CrÃ©er son propre dÃ©pÃ´t</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaCarlos.png" alt="MangaCarlos"></span></p>
</div>
<div class="paragraph">
<p>Carlos n&#8217;apprÃ©cie pas de nous voir Ã©changer des JAR par clÃ© USB juste
pour obtenir notre fameux pilote JDBC. Il aime la gestion transparente
et totalement automatisÃ©e des dÃ©pendances par Maven, aussi dÃ©cide-t-il
de mettre en place notre propre dÃ©pÃ´t privÃ© pour venir complÃ©ter ce qui
pourrait manquer sur le dÃ©pÃ´t <em>central</em> de Maven. En combinant les deux,
nous ne devrions plus Ãªtre gÃªnÃ©s par ces histoires de JAR manquant.</p>
</div>
<div class="paragraph">
<p>Cette solution est la plus couramment retenue et Ã©galement la plus
souple. CrÃ©er son propre dÃ©pÃ´t privÃ© â pour les bibliothÃ¨ques dont la
diffusion n&#8217;est pas libre ou pour hÃ©berger ses propres dÃ©veloppements Ã 
destination d&#8217;autres projets internes â permet de gÃ©rer de maniÃ¨re
centralisÃ©e et dÃ©finitive ces problÃ¨mes de dÃ©pendances rÃ©calcitrantes.</p>
</div>
<div class="paragraph">
<p>Physiquement parlant, un dÃ©pÃ´t n&#8217;est rien de plus qu&#8217;un systÃ¨me de
fichiers accessible depuis les postes de dÃ©veloppement soit directement
(protocole file:), soit <em>via</em> un serveur HTTP. Il n&#8217;est donc pas bien
compliquÃ© de faire hÃ©berger sur votre serveur intranet un sous-domaine
<a href="http://repository.masociete.com" class="bare">http://repository.masociete.com</a>.</p>
</div>
<div class="paragraph">
<p>Pour mettre Ã  disposition notre driver Oracle, il nous suffit donc de
crÃ©er l&#8217;arborescence adÃ©quate et d&#8217;y placer le JAR sous le nom
appropriÃ©. Il reste alors Ã  indiquer Ã  Maven l&#8217;emplacement de notre
dÃ©pÃ´t Â«Â maisonÂ Â», ce qui se traduit par un Ã©lÃ©ment &lt;repository&gt; dans le
POMÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;repositories&gt;
   &lt;repository&gt;
       &lt;id&gt;private&lt;/id&gt;
       &lt;url&gt;http://repository.noubliepaslalistedescourses.fr&lt;/url&gt;
   &lt;/repository&gt;
&lt;/repositories&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>PlutÃ´t que de regrouper nos dÃ©clarations de dÃ©pÃ´ts dans la
configuration, nous pouvons les placer dans le fichier settings.xml
utilisÃ© pour configurer Maven. Le gestionnaire de dÃ©pÃ´t Nexus peut mÃªme
gÃ©nÃ©rer ce fichier avec les dÃ©clarations adÃ©quates.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="controle_d_identite_vos_papiers_s_il_vous_plait">ContrÃ´le d&#8217;identitÃ©, vos papiers s&#8217;il vous plaÃ®tÂ !</h4>
<div class="paragraph">
<p>Le dÃ©pÃ´t de bibliothÃ¨ques ne contient pas seulement le fichier POM de
notre pilote JDBC, mais aussi deux fichiers suffixÃ©s md5 et sha1
associÃ©s Ã  l&#8217;archive JAR. Il s&#8217;agit des sommes de contrÃ´le de l&#8217;archive
â qui, elle, n&#8217;est pas disponible dans le dÃ©pÃ´t. Ces sommes de contrÃ´le
sont l&#8217;Ã©quivalent de nos empreintes digitales. Un bit modifiÃ© dans le
JAR donnera une somme de contrÃ´le diffÃ©rente. C&#8217;est donc un excellent
moyen pour valider un tÃ©lÃ©chargement, toujours sujet Ã  un risque de
dÃ©faillance du transfert rÃ©seau.</p>
</div>
<div class="paragraph">
<p>Ce contrÃ´le, Maven le fait de maniÃ¨re systÃ©matique et totalement
transparenteâ¦ du moins tant que le contrÃ´le n&#8217;Ã©choue pasÂ ! Dans notre
cas, la bibliothÃ¨que tÃ©lÃ©chargÃ©e ne correspond pas aux sommes de
contrÃ´le mises Ã  disposition dans le dÃ©pÃ´t Maven.</p>
</div>
<div class="paragraph">
<p>Ce n&#8217;est cependant qu&#8217;une alerte, car dans un monde imparfait, certaines
sommes de contrÃ´le mises Ã  disposition sont malheureusement incorrectes.
Dans le doute, nous tÃ©lÃ©chargeons Ã  nouveau le pilote JDBC Oracle. Il
est vrai que la connexion ADSL n&#8217;est pas trÃ¨s en forme aujourd&#8217;hui, sans
parler de ce satanÃ© virus qui a infectÃ© notre rÃ©seau la semaine
derniÃ¨re.</p>
</div>
<div class="paragraph">
<p>Le rÃ©sultat est sans appelÂ : le second fichier tÃ©lÃ©chargÃ©, une fois
installÃ© dans notre dÃ©pÃ´t privÃ©, corrige le problÃ¨me. Peut-Ãªtre
aurions-nous constatÃ© un problÃ¨me immÃ©diat avec ce pilote, peut-Ãªtre ne
serait-il apparu que trÃ¨s tardivement, mais dans tous les cas, remonter
jusqu&#8217;Ã  l&#8217;origine du problÃ¨me aurait Ã©tÃ© bien dÃ©licat. Qui aurait l&#8217;idÃ©e
de mettre en question le JAR Oracle alors qu&#8217;il y a tant de raisons pour
que notre application ne fonctionne pasÂ ?</p>
</div>
</div>
<div class="sect3">
<h4 id="rebelote_mais_ou_est_javax_jms">RebeloteÂ : mais oÃ¹ est javax.jmsÂ ?</h4>
<div class="paragraph">
<p>Notre problÃ¨me de dÃ©pendance sur le pilote JDBC Oracle est enfin rÃ©solu
de maniÃ¨re satisfaisante. Mais voilÃ  que nous obtenons Ã  nouveau un
message d&#8217;erreur comparable, concernant cette fois l&#8217;API <em>Java Messaging
Service</em> (JMS pour les intimes).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Missing:
----------
\1) javax.jms:jsm:jar:1.0.2b
  Try downloading the file manually from the project website.</pre>
</div>
</div>
<div class="paragraph">
<p>La solution est toute trouvÃ©e, puisque le problÃ¨me est Ã©quivalent Ã 
celui que nous avons rencontrÃ© avec Oracle. Un rapide coup de fil Ã 
Carlos permet de mettre Ã  disposition le JAR manquant sur notre dÃ©pÃ´t
privÃ©.</p>
</div>
<div class="paragraph">
<p>Cependant, il ne s&#8217;agit pas d&#8217;un produit propriÃ©taire mais bien d&#8217;une
API standard de Java, et mÃªme pas spÃ©cialement exotique ou rÃ©cente.
Comment est-il possible que Maven ne dispose pas de cette bibliothÃ¨queÂ ?
Il doit bien y avoir des millions de dÃ©veloppeurs Ã  l&#8217;utiliser chaque
jour sur des projets JavaEE.</p>
</div>
<div class="paragraph">
<p>Une lecture approfondie de la documentation, et plus particuliÃ¨rement de
la <em>Sun Binary Code License</em>, rÃ©pond Ã  cette question. Comme de
nombreuses API, JMS en version 1.0.2 a Ã©tÃ© diffusÃ© par SUN sous une
licence contraignante, interdisant la libre distribution de l&#8217;archive
Java. Il est donc lÃ©galement interdit de mettre ce fichier Ã  disposition
d&#8217;autres utilisateurs, et en particulier <em>central,</em> le dÃ©pÃ´t officiel de
Maven, doit se plier au respect de cette rÃ¨gle.</p>
</div>
<div class="paragraph">
<p>La licence SBCL impose en fait Ã  chaque utilisateur de cocher la petite
case Â«Â J&#8217;accepte la licence d&#8217;utilisationÂ Â» avant de pouvoir obtenir
l&#8217;archive Java tant convoitÃ©e. Ce petit raffinement qui paraÃ®t anodin
est un obstacle incontournable au tÃ©lÃ©chargement automatisÃ© des
bibliothÃ¨ques.</p>
</div>
<div class="paragraph">
<p>Pourquoi Maven ne propose-t-il pas d&#8217;accepter la licenceÂ ?</p>
</div>
<div class="paragraph">
<p>Au mÃªme titre que le site de tÃ©lÃ©chargement de SUN, Maven pourrait â
techniquement parlant â proposer d&#8217;accepter la licence avant d&#8217;effectuer
le tÃ©lÃ©chargement. Cela serait satisfaisant sur le plan lÃ©gal et
Ã©viterait ce genre d&#8217;aberration pour les utilisateurs. L&#8217;Ã©quipe du
projet Maven n&#8217;a cependant pas suivi cette option.</p>
</div>
<div class="paragraph">
<p>D&#8217;une part, cela introduit une interaction avec l&#8217;utilisateur qui n&#8217;est
pas compatible avec le mode de fonctionnement Â«Â batchÂ Â» prÃ©vu par Maven
(qui peut aussi s&#8217;exÃ©cuter sur des machines automatisÃ©es).</p>
</div>
<div class="paragraph">
<p>D&#8217;autre part, l&#8217;Ã©quipe Ã©tant trÃ¨s attachÃ©e aux valeurs du logiciel
libre, elle a fait front pour faire Ã©voluer l&#8217;approche de SUN pour ses
licences, au point que Java 7 est aujourd&#8217;hui totalement libreÂ ! Une
belle victoire, qui nous permet de tÃ©lÃ©charger librement la bibliothÃ¨que
JMS 1.1 depuis le dÃ©pÃ´t <em>central</em>. SUN n&#8217;a cependant pas poussÃ© la
courtoisie jusqu&#8217;Ã  changer la licence de ses anciennes bibliothÃ¨ques,
d&#8217;oÃ¹ notre problÃ¨me avec JMS 1.0.2.</p>
</div>
<div class="paragraph">
<p>Ce second exemple montre bien Ã  quel point la problÃ©matique des licences
ne doit pas Ãªtre nÃ©gligÃ©e. Si, honnÃªtement, personne ne lit
attentivement les dÃ©tails de ces textes plus ou moins abscons, leur
influence sur un projet peut Ãªtre Ã©norme. Le tÃ©lÃ©chargement automatique
des bibliothÃ¨ques par Maven est bien pratique, mais tend Ã  nous faire
oublier que nous ne vivons pas dans un monde de Bisounours oÃ¹ tout est
gratuit et librement diffusable. Chaque bibliothÃ¨que introduit des
contraintes d&#8217;utilisation, parfois les restrictions d&#8217;une licence
commerciale, parfois les obligations d&#8217;une licence libre.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Gerer_son_depot_prive">GÃ©rer son dÃ©pÃ´t privÃ©</h3>
<div class="paragraph">
<p>Ce qui devait au dÃ©part Ãªtre une tÃ¢che de fond pour Carlos se rÃ©vÃ¨le
rapidement un casse-tÃªte. Dans un premier temps, Carlos a voulu faire
plaisir Ã  tout le monde â c&#8217;est un peu une deuxiÃ¨me nature chez lui â et
a donc rÃ©pondu favorablement Ã  toutes nos demandesÂ :</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaCarlos.png" alt="MangaCarlos"></span> <span class="image" style="float: left"><img src="illustrations/MangaFabrice.png" alt="MangaFabrice"></span></p>
</div>
<div class="paragraph">
<p>FabriceÂ : j&#8217;ai besoin de trucUtils, peux-tu l&#8217;ajouterÂ ?</p>
</div>
<div class="paragraph">
<p>CarlosÂ : pas de soucis. D&#8217;oÃ¹ Ã§a vient, quelle versionÂ ?</p>
</div>
<div class="paragraph">
<p>FabriceÂ : je l&#8217;ai trouvÃ© sur sourceforge, et Ã§a doit Ãªtre la version 1.2</p>
</div>
<div class="paragraph">
<p>CarlosÂ : OK, c&#8217;est en place.</p>
</div>
<div class="paragraph">
<p>Tout aurait pu se passer dans cette bonne humeur gÃ©nÃ©rale jusqu&#8217;Ã  ce
que, d&#8217;une part, Carlos croule sous les demandes, mais surtout que les
choses se compliquent sensiblementÂ :</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaCarlos.png" alt="MangaCarlos"></span> <span class="image" style="float: left"><img src="illustrations/MangaOlivier.png" alt="MangaOlivier"></span></p>
</div>
<div class="paragraph">
<p>OlivierÂ : Salut Carlos, j&#8217;aurais besoin de trucUtils.</p>
</div>
<div class="paragraph">
<p>CarlosÂ : Pas de soucis, dÃ¨s que j&#8217;ai deux minutes. D&#8217;oÃ¹ Ã§a vient, quelle
versionÂ ?</p>
</div>
<div class="paragraph">
<p>OlivierÂ : De trucUtils.org, et c&#8217;est la version 1.2</p>
</div>
<div class="paragraph">
<p>CarlosÂ : Attends, Ã§a me dit quelque choseâ¦ Ã§a serait pas le mÃªme que
net.sourceforge:trucUtilsÂ ?</p>
</div>
<div class="paragraph">
<p>OlivierÂ : â¦ hum â¦ non, celui-lÃ  ne fait que 18Â Ko, Ã§a devait Ãªtre la
version bÃªta. La version finale fait 21Â Ko.</p>
</div>
<div class="paragraph">
<p>CarlosÂ : OK. Ãa t&#8217;ennuie si je le renomme Â«Â 1.2-finalÂ Â» dans le groupe
net.sourceforgeÂ ?</p>
</div>
<div class="paragraph">
<p>OlivierÂ : Benâ¦ c&#8217;est un peu bÃªte, toute leur doc est sur trucUtils.orgÂ !</p>
</div>
<div class="paragraph">
<p>Je vous laisse imaginer la suite de la journÃ©e de Carlos. Rapidement,
notre dÃ©pÃ´t Â«Â maisonÂ Â» compte des doublons, des erreurs de mÃ©tadonnÃ©es ou
des versions farfelues pour compenser les erreurs prÃ©cÃ©dentes.</p>
</div>
<div class="paragraph">
<p>Maven1 ou Maven2Â ?</p>
</div>
<div class="paragraph">
<p>De nombreux dÃ©pÃ´ts de bibliothÃ¨que Maven existent en version Â«Â Maven1Â Â» ou
Â«Â Maven2Â Â». Le premier format est conservÃ© pour des raisons historiques.
Le second prÃ©sente une structure plus hiÃ©rarchisÃ©e et des mÃ©tadonnÃ©es
supplÃ©mentaires. Maven2 sait utiliser les deux formats. Le dÃ©pÃ´t
<em>central</em>, qui pointe physiquement sur les mÃªmes fichiers, est
accessible au format Maven1 <sup class="footnote">[<a id="_footnoteref_27" class="footnote" href="#_footnotedef_27" title="View footnote.">27</a>]</sup></p>
</div>
<div class="paragraph">
<p>MoralitÃ©Â : la gestion d&#8217;un dÃ©pÃ´t n&#8217;est pas Ã  prendre Ã  la lÃ©gÃ¨re. Il ne
s&#8217;agit pas simplement de pallier les manques du dÃ©pÃ´t existant, mais
aussi de s&#8217;assurer de lâunitÃ© de notre dÃ©pÃ´t et de sa cohÃ©rence avec ce
qui est disponible en ligne.</p>
</div>
</div>
<div class="sect2">
<h3 id="Metadonnees">MÃ©tadonnÃ©es</h3>
<div class="paragraph">
<p>Les choses se compliquent franchement lorsque nous commenÃ§ons Ã  utiliser
des composants en version SNAPSHOT.</p>
</div>
<div class="paragraph">
<p>Nous utilisons une version SNAPSHOT du plugin GWT pour la compilation de
notre interface web. Rappelez-vous que ce mot clÃ© Ã  la fin d&#8217;un numÃ©ro
de version indique qu&#8217;il s&#8217;agit d&#8217;un artefact en cours de dÃ©veloppement,
sujet Ã  modifications. Autrement dit, Maven va tenter, Ã  intervalles
rÃ©guliers, d&#8217;en tÃ©lÃ©charger une mise Ã  jour. Ce sont les mÃ©tadonnÃ©es qui
lui indiquent si une nouvelle version est disponible. Par dÃ©faut, Maven
va les consulter toutes les vingt-quatre heures.</p>
</div>
<div class="paragraph">
<p>Nous avons dÃ» faire nos propres modifications dans ce plugin pour le
faire fonctionner selon nos besoins. Nous les avons diffusÃ©es Ã  l&#8217;Ã©quipe
qui le dÃ©veloppe, mais nous ne pouvons attendre qu&#8217;elles soient
acceptÃ©es. Nous avons donc placÃ© dans le dÃ©pÃ´t privÃ© une version
modifiÃ©e du plugin. Pour que celle-ci soit utilisÃ©e, nous devons mettre
Ã  jour le fichier de mÃ©tadonnÃ©es associÃ©, sans quoi Maven ne verra rien
de nouveau et ne la prendra pas.</p>
</div>
<div class="paragraph">
<p>Carlos doit donc manuellement fusionner le fichier de mÃ©tadonnÃ©es qu&#8217;il
a obtenu du dÃ©pÃ´t officiel contenant le plugin avec les donnÃ©es de notre
propre version. VoilÃ  un travail bien passionnant qu&#8217;il va en plus
falloir rÃ©pÃ©ter Ã  chaque correctionÂ ! Ici aussi, un outillage adÃ©quat
s&#8217;impose.</p>
</div>
</div>
<div class="sect2">
<h3 id="Passer_a_un_veritable_gestionnaire_de_depot">Passer Ã  un Â«Â vÃ©ritableÂ Â» gestionnaire de dÃ©pÃ´t</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaCarlos.png" alt="MangaCarlos"></span></p>
</div>
<div class="paragraph">
<p>Carlos perd un temps fou dans la gestion de son dÃ©pÃ´t privÃ©, car les
Â«Â utilisateursÂ Â» n&#8217;ont pas de moyen simple pour rechercher une
bibliothÃ¨que. Il manque aussi des outils pour vÃ©rifier le contenu du
dÃ©pÃ´tÂ : les sommes de contrÃ´le sont-elles prÃ©sentes et correctesÂ ? Les
fichiers POM sont-ils validesÂ ? Enfin, et c&#8217;est loin d&#8217;Ãªtre nÃ©gligeable,
nous dÃ©pendons d&#8217;une connexion Ã  Internet pour tout ce qui n&#8217;est pas
dans notre dÃ©pÃ´t privÃ©. Une coupure rÃ©seau et c&#8217;est l&#8217;impasse assurÃ©e
pour ceux qui n&#8217;ont pas dÃ©jÃ  tÃ©lÃ©chargÃ© toutes les dÃ©pendances
nÃ©cessaires.</p>
</div>
<div class="paragraph">
<p>Il est temps de passer Ã  la vitesse supÃ©rieure et de faire appel Ã  un
outil dÃ©diÃ© pour la gestion de notre dÃ©pÃ´t privÃ©.</p>
</div>
<div class="paragraph">
<p>Maven utilise un fichier de configuration local, placÃ© sous
$HOME/.m2/settings.xml. Ce fichier XML (un de plusÂ !) permet de dÃ©clarer
un miroir qui va remplacer les accÃ¨s Ã  certains dÃ©pÃ´ts depuis le poste
de l&#8217;utilisateur. Nous pouvons donc facilement forcer Maven Ã  ne plus
accÃ©der directement Ã  central, mais Ã  utiliser un serveur miroir sous
notre contrÃ´le et dont nous pourrons maÃ®triser la disponibilitÃ© et le
contenu.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Pour les utilisateurs de Windows, le $HOME est le rÃ©pertoire
C:\Documents and Settings\votreNom, et sous Windows 7 sous
C:\Utilisateurs\votreNom. La notion de HOME est Ã©videmment plus
naturelle pour les Â«Â unixiensÂ Â» et autres Â«Â mac&#8217;istesÂ Â».</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;settings&gt;
  &lt;mirrors&gt;
      &lt;mirror&gt;
         &lt;id&gt;private&lt;/id&gt;
         &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;
         &lt;url&gt;http://repository.noubliespaslalistedescourses.fr&lt;/url&gt;
      &lt;/mirror&gt;
  &lt;/mirrors&gt;
&lt;settings&gt;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_un_miroir_de_central">Un miroir de <em>central</em></h4>
<div class="paragraph">
<p>Notre premiÃ¨re idÃ©e est d&#8217;Ã©tablir un site miroir du dÃ©pÃ´t central de
Maven, ce qui nous permettra de faire abstraction de la connexion
Internet lorsque celle-ci est dÃ©faillante, ou tout simplement
d&#8217;Ã©conomiser la bande passante.</p>
</div>
<div class="paragraph">
<p>L&#8217;idÃ©e est simple, facile Ã  mettre en Åuvre avec les outils courants.
Nous constatons cependant trÃ¨s vite qu&#8217;elle a ses limites. D&#8217;une part,
le miroir occupe plusieurs gigaoctets pour un grand nombre de
bibliothÃ¨ques obsolÃ¨tes ou totalement dÃ©nuÃ©es d&#8217;intÃ©rÃªt pour notre
dÃ©veloppement. Ensuite, nous ne disposons toujours d&#8217;aucun outil pour
maintenir de maniÃ¨re fiable et ergonomique le contenu de ce site. Les
mÃ©tadonnÃ©es Maven peuvent Ãªtre complÃ¨tement aberrantes, les artefacts
dupliquÃ©s en de nombreux endroits, sans qu&#8217;aucun outil d&#8217;audit nous en
informe. Bref, cette solution nâapporte rien de plus, il faut un outil
dÃ©diÃ©.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>En environnement dâentreprise, on dÃ©sire souvent Ã©viter de dÃ©pendre de
ressources Internet non maÃ®trisÃ©es. Une solution consiste alors Ã 
dÃ©finir une configuration de miroir qui force Maven Ã  passer par notre
dÃ©pÃ´t interne, quelles que soient les URL dÃ©clarÃ©es dans les Ã©lÃ©ments
&lt;repositories&gt; de nos projets.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;mirror&gt;
     &lt;id&gt;corporate-repo&lt;/id&gt;
    &lt;url&gt;http://repository.noubliepaslalistedescourses.fr&lt;/url&gt;
    &lt;mirrorOf&gt;*&lt;/mirrorOf&gt;
&lt;/mirror&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_un_gestionnaire_dartefacts">Un gestionnaire d&#8217;artefacts</h4>
<div class="paragraph">
<p>En marge du projet Maven, la communautÃ© des dÃ©veloppeurs a crÃ©Ã© le
projet Â«Â Maven Repository ManagerÂ Â», devenu par la suite
Archiva <sup class="footnote">[<a id="_footnoteref_28" class="footnote" href="#_footnotedef_28" title="View footnote.">28</a>]</sup>. Cet outil n&#8217;est pas seul dans cette catÃ©gorie
et doit faire face Ã  la concurrence de Nexus <sup class="footnote">[<a id="_footnoteref_29" class="footnote" href="#_footnotedef_29" title="View footnote.">29</a>]</sup> ainsi que
d&#8217;Artifactory <sup class="footnote">[<a id="_footnoteref_30" class="footnote" href="#_footnotedef_30" title="View footnote.">30</a>]</sup>. Tous sont disponibles en open source,
les deux derniers proposant une option de support professionnel qui peut
Ãªtre indispensable si l&#8217;on considÃ¨re qu&#8217;une entreprise confie la
productivitÃ© de ses dÃ©veloppements Ã  ces outils. Pour ne pas faire de
jaloux, nous avons choisi de proposer une capture d&#8217;Ã©cran pour chacun
(voir Figures 06-02 Ã  06-04).</p>
</div>
<div class="paragraph">
<p>Ces outils sont des applications web dÃ©diÃ©es Ã  la gestion de dÃ©pÃ´t
Maven. Ils assurent un grand nombre de fonctionnalitÃ©sÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>recherche parmi les artefacts prÃ©sents dans le dÃ©pÃ´tÂ ;</p>
</li>
<li>
<p>identification d&#8217;un JAR par recherche de son empreinte MD5Â ;</p>
</li>
<li>
<p>miroir d&#8217;un autre dÃ©pÃ´t, typiquement pour conserver un cache local
de <em>central</em> et/ou d&#8217;autres dÃ©pÃ´tsÂ ;</p>
</li>
<li>
<p>conversion Ã  la volÃ©e d&#8217;un dÃ©pÃ´t Maven 1 au format Maven 2Â ;</p>
</li>
<li>
<p>indexation des dÃ©pÃ´ts et publication d&#8217;un index unifiÃ©Â ;</p>
</li>
<li>
<p>tÃ©lÃ©chargement (upload) de nouveaux artefacts, l&#8217;Ã©quivalent de la
commande <code>mvn install-file</code>Â ;</p>
</li>
<li>
<p>interface graphique d&#8217;administration â plus ou moins sexy selon
l&#8217;outil considÃ©rÃ©Â ;</p>
</li>
<li>
<p>contrÃ´le d&#8217;accÃ¨s â pratique pour autoriser un utilisateur Ã  gÃ©rer
certaines parties du dÃ©pÃ´t sans prendre le risque de tout casserÂ ;</p>
</li>
<li>
<p>mÃ©canismes d&#8217;audit, d&#8217;indexation et de contrÃ´le d&#8217;intÃ©gritÃ© en
tÃ¢che de fond.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La fonctionnalitÃ© de miroir est probablement celle qui vous fera
installer Archiva pour votre entreprise. En disposant d&#8217;un miroir sous
votre contrÃ´le du dÃ©pÃ´t central, vous pourrez Ã©conomiser la bande
passante de votre accÃ¨s Internet, ne pas dÃ©pendre de la bonne santÃ©
d&#8217;Internet et obtenir des temps de rÃ©ponse impressionnants pour les
demandes d&#8217;artefacts dÃ©jÃ  placÃ©s dans le cache.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaCarlos.png" alt="MangaCarlos"></span></p>
</div>
<div class="paragraph">
<p>C&#8217;est en effet ce que Carlos met en placeÂ : notre dÃ©pÃ´t privÃ© sert
dÃ©sormais Ã  la fois d&#8217;hÃ©bergement pour nos bibliothÃ¨ques non publiques
et de miroir pour les tÃ©lÃ©chargements depuis central. Le gestionnaire
fonctionne en mandataire (proxy)Â : pour chaque demande d&#8217;artefact non
encore placÃ© dans le miroir, il va consulter les dÃ©pÃ´ts configurÃ©s et
complÃ©ter le cache en consÃ©quence. Ainsi, les demandes suivantes seront
traitÃ©es immÃ©diatement, sans dÃ©pendance Ã  Internet. Ce fonctionnement
est nettement moins consommateur qu&#8217;un miroir complet du dÃ©pÃ´t <em>central</em>
dont nous n&#8217;exploiterons qu&#8217;une infime partie des gigaoctets de
bibliothÃ¨ques.</p>
</div>
<div class="paragraph">
<p>En fonction des besoins des projets, Carlos va rapidement ajouter
d&#8217;autres dÃ©pÃ´ts Ã  la configurationÂ : le dÃ©pÃ´t java.net apparaÃ®t vite
indispensable, car il contient un certain nombre d&#8217;API Java standardÂ ; le
dÃ©pÃ´t de JBoss, qui propose les derniÃ¨res versions d&#8217;HibernateÂ ; le
dÃ©pÃ´t SpringSource, qui offre les derniÃ¨res versions MileStone du
framework SpringÂ ; et ainsi de suiteâ¦</p>
</div>
<div class="paragraph">
<p>PlutÃ´t que de nous obliger Ã  dÃ©clarer un &lt;mirror&gt; dans notre fichier
settings.xml Ã  chaque nouvel arrivant dans la configuration du
gestionnaire de dÃ©pÃ´t, Carlos met en place un dÃ©pÃ´t virtuel, comme le
montre la Figure 06-02. DÃ©sormais, sous l&#8217;appellation publique, se cachent
cinq dÃ©pÃ´ts de bibliothÃ¨ques, dont nous complÃ©tons au besoin le contenu
<em>via</em> l&#8217;interface d&#8217;administration. Notre fichier settings.xml Ã©volue
alors comme suitÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;settings&gt;
  &lt;mirrors&gt;
      &lt;mirror&gt;
         &lt;id&gt;releases&lt;/id&gt;
         &lt;mirrorOf&gt;*&lt;/mirrorOf&gt;
         &lt;url&gt;http://repository.noubliespaslalistedescourses.fr/content/groups/public&lt;/url&gt;
      &lt;/mirror&gt;
  &lt;/mirrors&gt;
&lt;settings&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>La syntaxe &lt;mirrorOf&gt;*&lt;/ mirrorOf&gt; permet d&#8217;intercepter toute tentative
de Maven d&#8217;accÃ©der Ã  un dÃ©pÃ´t quel qu&#8217;il soit, et de la rediriger vers
notre gestionnaire. Nous sommes ainsi assurÃ©s qu&#8217;aucune bibliothÃ¨que ne
sera utilisÃ©e sans avoir Ã©tÃ© mise en cache sur notre serveur et prÃ©vue
sur notre liste de dÃ©pÃ´ts.</p>
</div>
<div class="paragraph">
<p>Si vous prÃ©fÃ©rez diffÃ©rencier les dÃ©pÃ´ts contenant des snapshots,
utilisez alors la syntaxe combinÃ©e &lt;mirrorOf&gt;*,!codehaus.snapshot&lt;
mirrorOf&gt; et dÃ©finissez un second miroir pour chacun des dÃ©pÃ´ts snapshot
auxquels vous accÃ©dez.</p>
</div>
<div class="paragraph">
<p>Figure 06-02
<span class="image"><img src="illustrations/06-02.png" alt="06 02"></span></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Configuration d&#8217;un dÃ©pÃ´t dans Nexus.</p>
</div>
<div class="paragraph">
<p>Les mÃ©canismes d&#8217;audit permettent Ã  Carlos de contrÃ´ler la bonne santÃ©
de son dÃ©pÃ´t. Il peut mÃªme programmer des purges et obtenir des
statistiques d&#8217;usage. Enfin, le mÃ©canisme de gestion des droits des
utilisateurs lui permet de dÃ©lÃ©guer certaines tÃ¢ches Ã  ses collÃ¨gues.
Certains d&#8217;entre nous sont ainsi autorisÃ©s Ã  publier sur le dÃ©pÃ´t les
artefacts de nos composants communs, sans pour autant risquer de
compromettre la cohÃ©rence globale.</p>
</div>
<div class="paragraph">
<p>L&#8217;Ã©norme point fort d&#8217;un gestionnaire de dÃ©pÃ´t sur un simple serveur
HTTP est qu&#8217;il prend en charge les mÃ©tadonnÃ©es Maven, fusionnant
plusieurs dÃ©pÃ´ts Ã  la volÃ©e. Du point de vue de l&#8217;utilisateur, le
gestionnaire apparaÃ®t alors comme un unique dÃ©pÃ´t. La gestion manuelle
des mÃ©tadonnÃ©es est complexe et source d&#8217;erreurÂ ; son automatisation est
un point fort de ces outils.</p>
</div>
<div class="paragraph">
<p>Les outils d&#8217;indexation et d&#8217;audit fournissent une synthÃ¨se des
problÃ¨mes identifiÃ©s, et la programmation de tÃ¢ches de fond permet de
purger et de corriger automatiquement les erreurs courantes dans le
dÃ©pÃ´t sans intervention humaine. La Figure 06-03 montre par exemple le
rapport d&#8217;audit sur un dÃ©pÃ´t administrÃ© par Archiva, et les diffÃ©rents
problÃ¨mes qu&#8217;il a su y dÃ©tecter.</p>
</div>
<div class="paragraph">
<div class="title">Figure 06-03</div>
<p><span class="image"><img src="illustrations/06-03.png" alt="06 03"></span></p>
</div>
<div class="paragraph">
<p>Rapports d&#8217;audit d&#8217;Archiva.</p>
</div>
<div class="paragraph">
<p>Le gestionnaire de dÃ©pÃ´t permet aussi une recherche globale, fournissant
une vue graphique des mÃ©tadonnÃ©es, comme le montre la Figure 06-04. La
recherche peut s&#8217;effectuer sur le nom de l&#8217;artefact, mais peut aussi se
baser sur une classe dÃ©finie par une bibliothÃ¨que ou servir Ã  identifier
un JAR en calculant son empreinte et en la comparant Ã  l&#8217;index. Le
gestionnaire expose Ã©galement ses index pour une intÃ©gration dans les
environnements de dÃ©veloppement (voir le Chapitre 9). Enfin, un espace
de stockage permet la diffusion des dÃ©veloppements au reste de l&#8217;Ã©quipe,
servant de dÃ©pÃ´t Â«Â public-privÃ©Â Â».</p>
</div>
<div class="paragraph">
<div class="title">Figure 06-04</div>
<p><span class="image"><img src="illustrations/06-04.png" alt="06 04"></span></p>
</div>
<div class="paragraph">
<p>Page de recherche d&#8217;Artifactory.</p>
</div>
</div>
<div class="sect3">
<h4 id="_conclusion_5">Conclusion</h4>
<div class="paragraph">
<p>Plein de bonne volontÃ©, Carlos a vite compris que la gestion d&#8217;un dÃ©pÃ´t
Maven n&#8217;est pas aussi simple qu&#8217;il y paraÃ®t. La gestion purement
manuelle trouve ses limites et est bien incapable de prendre en charge
la complexitÃ© liÃ©e Ã  la quantitÃ© et Ã  la diversitÃ© des artefacts. Un
outil dÃ©diÃ© comme Archiva est non seulement utile mais rapidement
indispensable. Ses fonctionnalitÃ©s annexes sont incontournables pour une
gestion fiable du dÃ©pÃ´t interne.</p>
</div>
<div class="paragraph">
<p>Notre Ã©quipe de dÃ©veloppement est dÃ©sormais sereine face Ã  la gestion de
ses dÃ©pendances. Nous passons systÃ©matiquement par notre serveur Archiva
<em>via</em> la syntaxe &lt;mirrorOf&gt;* et sommes assurÃ©s de ne pas dÃ©pendre
volontairement ou non d&#8217;un dÃ©pÃ´t non configurÃ© dans notre gestionnaire
de dÃ©pÃ´t. Nous ne sommes plus fondamentalement dÃ©pendants de l&#8217;accÃ¨s Ã 
Internet et pouvons obtenir en un temps record les dÃ©pendances de nos
projets. Enfin, nous pouvons au besoin publier en interne les artefacts
qui nous manqueraient.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chapitre7_quand_le_projet_devient_trop_lourd">ChapitreÂ 7 : Quand le projet devient trop lourd</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Notre application a fait un joli bout de chemin. D&#8217;un embryon de projet
avec trois classes, elle est devenue un vaste logiciel couvrant des
accÃ¨s Ã  une base de donnÃ©es, la communication avec des services web, un
module d&#8217;authentification des utilisateurs, de nombreux mÃ©canismes
d&#8217;administration et de supervision, sans parler de notre interface web
et de nos diverses extensions pour le poste client. Tout cela nÃ©cessite
de multiples bibliothÃ¨ques, sans mÃªme parler des nombreux outils de
test. Il est temps de donner au projet un peu plus de structuration pour
y voir plus clair.</p>
</div>
<div class="sect2">
<h3 id="_un_projet_un_artefact">Un projet â un artefact</h3>
<div class="paragraph">
<p>Une rÃ¨gle de base que nous avons rapidement comprise avec Maven est
qu&#8217;un projet ne peut produire qu&#8217;un seul artefact. Inutile donc de
chercher Ã  contourner la logique de l&#8217;outil pour faire de notre projet
une hydre Ã  cinq tÃªtes qui serait capable d&#8217;un cÃ´tÃ© de produire
l&#8217;application web et de l&#8217;autre le module d&#8217;administration, sans revoir
la structure Maven qui l&#8217;accompagne.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Cette affirmation n&#8217;est pas tout Ã  fait exacte et nous l&#8217;avons dÃ©jÃ  vu
au Chapitre 4Â : la notion de classifier permet d&#8217;attacher plusieurs
artefacts Ã  un projet, cependant ceux-ci partagent nÃ©cessairement le
mÃªme POM et ne peuvent constituer que des variantes ou des artefacts
secondaires.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Nous avons dÃ©jÃ  Ã©tÃ© confrontÃ©s Ã  ce problÃ¨me lorsque FranÃ§ois a proposÃ©
une version Flex de notre interface Web (voir le Chapitre 3). La
construction d&#8217;un binaire SWF Ã©tait tout Ã  fait possible, mais
nÃ©cessitait un projet et un POM dÃ©diÃ©. Pour l&#8217;instant, nous avons fait
avec cette contrainte en crÃ©ant autant de fichiers POM que nous avions
de composants indÃ©pendants Ã  construire.</p>
</div>
<div class="paragraph">
<p>Le premier Ã©cueil que nous rencontrons, suite aux nombreux outils et
rÃ¨gles de dÃ©veloppement que nous avons mis en place, est la duplication
de la configuration Maven entre les diffÃ©rents POM. Les mÃªmes plugins,
les mÃªmes paramÃ¨tres, les mÃªmes versions de dÃ©pendances sont multipliÃ©s
dans chacun de ces fichiers sans mutualisation.</p>
</div>
<div class="paragraph">
<p>Face au formalisme XML du fichier POM, notre premier rÃ©flexe est de
rechercher un mÃ©canisme d&#8217;import de fragments XML. C&#8217;est typiquement ce
que permet Ant ou la plupart des outils basÃ©s sur XML. On retrouve ainsi
souvent dans les projets Ant d&#8217;envergure un build.xml accompagnÃ© d&#8217;un
build-common.xml. On retrouve exactement le mÃªme mÃ©canisme pour la
dÃ©claration de services web dans un fichier WSDL. La balise &lt;xs:import&gt;
permet de dÃ©composer le document XML en sous-parties plus simples ou
focalisÃ©es sur un domaine particulier.</p>
</div>
<div class="paragraph">
<p>Grosse dÃ©ceptionÂ : le schÃ©ma XML qui dirige la syntaxe du fichier POM ne
prÃ©voit aucune balise &lt;import&gt;, &lt;include&gt; ou quoi que ce soit
d&#8217;Ã©quivalent.</p>
</div>
<div class="sect3">
<h4 id="Heritage">HÃ©ritage</h4>
<div class="paragraph">
<p>Maven utilise certes un format XML pour l&#8217;Ã©criture du POM, format par
ailleurs Ã©trangement verbeux comparÃ© Ã  d&#8217;autres outils, mais il ne faut
jamais perdre de vue qu&#8217;il ne s&#8217;agit pour lui que d&#8217;une reprÃ©sentation
de son modÃ¨le interne. Les dÃ©veloppeurs de Maven ont donc choisi non pas
une logique de morcellement par inclusion, mais une logique d&#8217;hÃ©ritage,
trÃ¨s familiÃ¨re Ã  tout dÃ©veloppeur Java. Un POM peut hÃ©riter d&#8217;un autre
POM et reÃ§oit les attributs dÃ©finis par son parent, sauf s&#8217;il les
redÃ©finit lui-mÃªme.</p>
</div>
<div class="paragraph">
<p>Comme en Java, un POM ne peut avoir qu&#8217;un seul parent, dÃ©clarÃ© par la
baliseâ¦ &lt;parent&gt;Â ! Ce parent est lui-mÃªme considÃ©rÃ© comme un artefact
Maven. Il est donc identifiÃ© par le triplet groupIdÂ : artifactIdÂ :
version.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;project&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;fr.noubliepaslalistedescourses&lt;/groupId&gt;
        &lt;artifactId&gt;noubliepaslalistedescourses-parent&lt;/artifactId&gt;
        &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;artifactId&gt;noubliepaslalistedescourses&lt;/artifactId&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Le fait de dÃ©clarer un parent permet de supprimer l&#8217;information de
groupId et de version que nous partageons avec lui. C&#8217;est une pratique
trÃ¨s courante qui assure par la mÃªme occasion l&#8217;homogÃ©nÃ©itÃ© des
sous-projets avec leur parent commun.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_packaging_dun_pom_parent">Packaging d&#8217;un POM parent</h4>
<div class="paragraph">
<p>Notre POM parent est donc lui-mÃªme un autre projet Maven, mais celui-ci
ne va pas produire de JAR, de War ou mÃªme de binaire exÃ©cutable. Il va
se contenter du seul fichier POM qui permet de mutualiser notre
configuration. Le packaging pom est prÃ©vu Ã  cet effet. La construction
d&#8217;un projet de ce type utilise un cycle de vie simplifiÃ© qui se limite Ã 
publier le fichier POM dans le dÃ©pÃ´t. Le Listing 7.1 montre le POM
parent sur le projet noubliepaslalistedescourses. Il nous permet de
configurer en un seul endroit l&#8217;utilisation de Java 5 comme cible de
compilation.</p>
</div>
<div class="listingblock">
<div class="title">Listing 7.1 : pom parent du projet</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;project&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;fr.noubliepaslalistedescourses&lt;/groupId&gt;
    &lt;artifactId&gt;noubliepaslalistedescourses-parent&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;
    &lt;!-- configuration commune --&gt;
    &lt;build&gt;
      &lt;plugins&gt;
        &lt; !-- ... TODO --&gt;
      &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>La configuration et les plugins dÃ©clarÃ©s dans le POM parent seront ainsi
appliquÃ©s Ã  tout projet qui dÃ©clare cet hÃ©ritage. VoilÃ  la rÃ©ponse Ã 
notre problÃ¨me de mutualisationÂ ! Nous pouvons mÃªme aller au-delÃ , en
spÃ©cifiant un super-parent qui dÃ©finira une configuration Maven propre Ã 
notre organisation et applicable Ã  tous ces projets. On y trouvera, par
exemple, la configuration des plugins liÃ©s Ã  nos rÃ¨gles qualitÃ© et des
serveurs propres Ã  nos machines de dÃ©veloppement.</p>
</div>
<div class="paragraph">
<p>Cette pratique est mÃªme recommandÃ©e par Maven, c&#8217;est ce qu&#8217;on appelle un
peu pompeusement un Â«Â corporate POMÂ Â». Les donnÃ©es qui y sont placÃ©es sont
souvent plus descriptives que techniques, mais elles dÃ©finissent au moins
un endroit unique commun Ã  tous. Il n&#8217;est pas rare qu&#8217;un POM de ce type
utilise un numÃ©ro de version rÃ©duit Ã  un seul chiffre, vu qu&#8217;il n&#8217;est
pas rÃ©ellement sujet Ã  des Ã©volutions mineures ou correctives.</p>
</div>
<div class="paragraph">
<p>Maven lui-mÃªme est un bon exemple de cette pratique : le projet est
dÃ©composÃ© en de nombreux modules qui hÃ©ritent d&#8217;un POM parent commun,
qui lui-mÃªme hÃ©rite du POM parent Apache, commun Ã  tous les projets de
la fondation du mÃªme nom.</p>
</div>
<div class="paragraph">
<div class="title">Figure 07-01</div>
<p><span class="image"><img src="illustrations/07-01.png" alt="07 01"></span></p>
</div>
<div class="paragraph">
<p>HiÃ©rarchie des POM Apache Maven</p>
</div>
</div>
<div class="sect3">
<h4 id="_parent_naturel">Parent Â«Â naturelÂ Â»</h4>
<div class="paragraph">
<p>L&#8217;hÃ©ritage d&#8217;un POM parent simplifie l&#8217;existence, mais elle nÃ©cessite
cependant que nous disposions dans notre dÃ©pÃ´t Maven du POM en question.
Sa mise au point se complique donc singuliÃ¨rement, car nous devons
l&#8217;installer Ã  chaque modification avant de pouvoir constater ses effets
sur les projets qui en hÃ©ritent.</p>
</div>
<div class="paragraph">
<p>Maven a heureusement prÃ©vu le coupÂ : en plus de l&#8217;identification par le
triplet groupIdÂ : artifactIdÂ : version, triplet qui nous est maintenant
familier, la balise &lt;parent&gt; propose un Ã©lÃ©ment inhabituel,
&lt;relativePath&gt;. Comme son nom l&#8217;indique, il fournit le chemin physique
d&#8217;accÃ¨s Ã  ce POM parent Ã  partir de la racine du projet courant. Et pour
combler notre dÃ©sir d&#8217;en faire le moins possible, Maven prÃ©voit une
valeur par dÃ©faut pour cet Ã©lÃ©mentÂ : Â«Â ../pom.xmlÂ Â».</p>
</div>
<div class="paragraph">
<p>Autrement dit, Maven va rechercher avant toute chose le POM parent dans
le rÃ©pertoire pÃ¨re de notre projet â sous rÃ©serve que les indications de
groupe, dâartefact et de version concordent. Cette recherche
hiÃ©rarchique est un mÃ©canisme puissant qui va profondÃ©ment orienter
votre faÃ§on de travailler. Chaque projet pourra ainsi se dÃ©composer en
sous-modules sous forme de sous-rÃ©pertoires. Chaque groupe pourra
organiser facilement son information en rassemblant tous ses projets
sous une arborescence commune, dont la racine hÃ©bergera un majestueux
corporate POM.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Cela est particuliÃ¨rement efficace si vous utilisez un gestionnaire de
version du code comme Subversion. Celui-ci permet, en effet, de dÃ©finir
des alias, permettant de construire une structure virtuelle. Il est
ainsi possible d&#8217;avoir depuis Subversion une vision trunk / corporate /
projet / module tout en conservant une gestion locale classique projet /
trunk / module.</p>
</div>
<div class="paragraph">
<p>Si cette organisation ne vous convient pas, vous pouvez comme toujours
utiliser d&#8217;autres conventions et affecter Ã  la balise &lt;relativePath&gt; le
chemin qui vous convient. Vous perdrez cependant les avantages des
conventionsÂ : plus de configuration, obligation pour chaque nouvel
arrivant de s&#8217;adapter aux habitudes locales.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mutualiser">Mutualiser</h3>
<div class="paragraph">
<p>Nous avons donc un mÃ©canisme de mutualisation en place. Que pouvons-nous
mutualiserÂ ?</p>
</div>
<div class="paragraph">
<p>D&#8217;une part, toutes nos dÃ©clarations de plugins et de propriÃ©tÃ©s peuvent
Ãªtre remontÃ©es dans ce POM commun. Nous ne conserverons dans un module
donnÃ© que ce qui lui est totalement spÃ©cifique. Cela allÃ¨ge la
configuration, mais ne rÃ©sout pas un problÃ¨me sur lequel StÃ©phane a dÃ»
s&#8217;acharner pendant de trop longues heures.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaStephane.png" alt="MangaStephane"></span></p>
</div>
<div class="paragraph">
<p>StÃ©phane a Ã©tÃ© confrontÃ© Ã  une incohÃ©rence dans nos dÃ©pendances. Notre
module d&#8217;administration utilisait en effet une version d&#8217;Hibernate
diffÃ©rente de notre application web. Si cela peut ne pas Ãªtre
fondamentalement gÃªnant, c&#8217;est tout de mÃªme peu plaisant et source
dâennuis. Il a donc cherchÃ© Ã  s&#8217;assurer d&#8217;une faÃ§on ou d&#8217;une autre que
nos diffÃ©rentes bibliothÃ¨ques Ã©taient utilisÃ©es dans des versions
cohÃ©rentes sur nos divers sous-projets. TÃ¢che ingrate et pÃ©nible, vu le
nombre impressionnant de dÃ©pendances.</p>
</div>
<div class="sect3">
<h4 id="gestion_des_dependances">Gestion des dÃ©pendances</h4>
<div class="paragraph">
<p>Un Ã©lÃ©ment du fichier POM que nous n&#8217;avons pas encore utilisÃ© rÃ©pond Ã 
ce besoin, il s&#8217;agit du &lt;dependencyManagement&gt;. Cette balise n&#8217;est utile
que dans le cadre d&#8217;un POM parent, ce qui explique que nous ne l&#8217;ayons
encore jamais rencontrÃ©e. Comme la balise &lt;dependencies&gt;, elle se
compose d&#8217;une suite de dÃ©pendances mais, contrairement Ã  elle, il ne
s&#8217;agit ici que de dÃ©finir les versions par dÃ©faut de ces dÃ©pendances.
Notre fichier POM parent va ainsi lister quelle version de chaque
bibliothÃ¨que fait office de rÃ©fÃ©rence sur le projet. Dans chaque
sous-projet, nous pourrons alors dÃ©clarer nos dÃ©pendances sans
indication de version, auquel cas celle indiquÃ©e par le
dependencyManagement sera utilisÃ©e.</p>
</div>
<div class="paragraph">
<p>Autre avantage de cette pratique, si une bibliothÃ¨que est introduite par
la gestion transitive des dÃ©pendances, et mÃªme si nous ne l&#8217;utilisons
pas explicitement dans nos projets, nous pouvons tout de mÃªme imposer
lâutilisation dâune version prÃ©cise <em>via</em> le dependencyManagement.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>La bibliothÃ¨que commons-logging est extrÃªmement rÃ©pandue et pourtant
dÃ©criÃ©e par certains. Il est donc difficile de l&#8217;exclure d&#8217;un projet, car
la transitivitÃ© des dÃ©pendances la fait rÃ©apparaÃ®tre chaque fois qu&#8217;on
tente de l&#8217;exclure. Il existe cependant une solution qui ressemble Ã  un
hack mais qui est trÃ¨s pratiqueÂ : utiliser une version inexistante de
cette bibliothÃ¨que, dÃ©clarÃ©e en dependencyManagement.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;commons-logging&lt;/groupId&gt;
    &lt;artifactId&gt;commons-logging&lt;/artifactId&gt;
    &lt;version&gt;99-does-not-exist&lt;/version&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cette version Â«Â pirateÂ Â» de commons-logging est disponible dans le
repository Maven de JBoss. L&#8217;utilisation du scope provided nous permet
d&#8217;Ãªtre sÃ»rs qu&#8217;elle ne sera pas ajoutÃ©e dans nos livrables de type WAR
ou EAR.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La gestion centralisÃ©e des versions est une pratique simple qui assure
la cohÃ©rence des projets dÃ©composÃ©s en modules. Elle n&#8217;empÃªche pas au
besoin un module de dÃ©clarer explicitement une version autre que celle
recommandÃ©e par le POM parent, pour bÃ©nÃ©ficier d&#8217;une fonction
particuliÃ¨re.</p>
</div>
<div class="paragraph">
<p>De la mÃªme faÃ§on, si les rÃ¨gles de l&#8217;entreprise l&#8217;imposent, un corporate
POM peut dÃ©finir les versions validÃ©es et supportÃ©es des bibliothÃ¨ques,
que chaque projet pourra alors utiliser en toute confiance.</p>
</div>
<div class="paragraph">
<p>HÃ©riter d&#8217;un corporate POM juste pour partager la dÃ©claration d&#8217;un
&lt;dependencyManagement&gt; est cependant une contrainte un peu lourde, Ã©tant
donnÃ© qu&#8217;on ne peut hÃ©riter que d&#8217;un seul POM parent. Maven, depuis sa
version 2.0.9, propose une autre option <em>via</em> import, un scope
particulier. Une dÃ©pendance marquÃ©e de ce scope ne sera pas ajoutÃ©e au
classpath du projet. Par contre, sa dÃ©claration &lt;dependencyManagement&gt;
sera Â«Â importÃ©eÂ Â» dans le projet comme si elle y avait Ã©tÃ© copiÃ©e-collÃ©e.
Cette option permet ainsi de construire des POM communs dÃ©finissant des
versions des bibliothÃ¨ques courantes dont vous avez validÃ© la bonne
intÃ©gration. Avec la multiplication des frameworks, un POM indiquant les
versions compatibles entre Spring, Hibernate, Wicket,
Hibernate-validator, AspectJ et EH-Cache ne sera pas un luxe pour lancer
rapidement un projet sans avoir ce problÃ¨me Ã  gÃ©rerÂ !</p>
</div>
</div>
<div class="sect3">
<h4 id="_gestion_des_plugins">Gestion des plugins</h4>
<div class="paragraph">
<p>Au mÃªme titre que pour nos dÃ©pendances, les versions de nos plugins
Maven ne doivent pas Ãªtre nÃ©gligÃ©es. MÃªme en supposant qu&#8217;aucune
rÃ©gression ne soit constatÃ©e entre deux versions d&#8217;un mÃªme plugin,
l&#8217;utilisation de versions incohÃ©rentes est source de bizarreries, voire
de bogues trÃ¨s dÃ©licats Ã  identifier.</p>
</div>
<div class="paragraph">
<p>Le POM parent peut, lÃ  aussi, nous aider <em>via</em> son Ã©lÃ©ment
&lt;pluginManagement&gt;. Comme pour la gestion des dÃ©pendances, il nous
permet de centraliser les versions des plugins utilisÃ©s par chaque
module du projet.</p>
</div>
<div class="paragraph">
<p>Le format du fichier POM n&#8217;impose pas de dÃ©clarer pour chaque plugin
utilisÃ© un numÃ©ro de version. Il est cependant fortement recommandÃ© de
fixer cette version car sans cela, Maven considÃ¨re que vous dÃ©sirez
utiliser la derniÃ¨re version stable du plugin. Si les dÃ©veloppeurs font
trÃ¨s attention Ã  la compatibilitÃ© ascendante, ils ne sont pas Ã  l&#8217;abri
d&#8217;une rÃ©gression et peuvent au fil de versions successives dÃ©prÃ©cier
puis supprimer certaines fonctionnalitÃ©s ou certains paramÃ¨tres. Si vous
intervenez sur un projet ancien aprÃ¨s quâun plugin a subi de telles
Ã©volutions, Maven utilisera la derniÃ¨re version et votre projet ne
pourra pas Ãªtre construit Ã  l&#8217;identique, voire ne pourra plus Ãªtre
construit du toutÂ !</p>
</div>
<div class="paragraph">
<p>Indiquer systÃ©matiquement la version des plugins comme si l&#8217;Ã©lÃ©ment
&lt;version&gt; Ã©tait obligatoire est contraignant et source d&#8217;hÃ©tÃ©rogÃ©nÃ©itÃ©
dans un projet multimodule. Le pluginManagement va permettre de
centraliser au niveau du projet parent les versions de tous les plugins
utilisÃ©s.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaRaphael.png" alt="MangaRaphael"></span></p>
</div>
<div class="paragraph">
<p>Fort de ces nouveaux concepts, RaphaÃ«l reprend les POM du projet pour
centraliser notre gestion de version. &lt;dependencyManagement&gt; et
&lt;pluginManagement&gt; sont renseignÃ©s aprÃ¨s une revue complÃ¨te de tous nos
fichiers POM. La tÃ¢che est complexe et source d&#8217;erreurs tant les risques
d&#8217;oubli sont nombreux. RaphaÃ«l cherche donc un moyen pour s&#8217;assurer
qu&#8217;il n&#8217;a omis aucune dÃ©claration de version pour un plugin. Par
ailleurs, il voudrait Ãªtre sÃ»r qu&#8217;Ã  l&#8217;avenir un plugin ajoutÃ© dans un
module ne risquera pas de passer entre les mailles du filet. Si aucun de
nos POM ne dÃ©clare de version pour les plugins, nous savons que par
mimÃ©tisme les nouveaux plugins seront dÃ©clarÃ©s de la mÃªme maniÃ¨re.</p>
</div>
<div class="paragraph">
<p>RaphaÃ«l trouve la solution Ã  ce problÃ¨me dans le plugin Enforcer.
Celui-ci ne contribue pas Ã  la construction du projet, mais fait partie
d&#8217;une catÃ©gorie un peu particuliÃ¨re de plugins qui visent Ã  outiller
l&#8217;utilisation de Maven. Enforcer va analyser notre modÃ¨le de projet pour
vÃ©rifier certaines rÃ¨gles. L&#8217;une des rÃ¨gles prÃ©dÃ©finies exige justement
de vÃ©rifier que chaque plugin du projet a une version correctement
dÃ©finie.</p>
</div>
<div class="listingblock">
<div class="title">Listing 7.2 : Utilisation du plugin Enforcer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-enforcer-plugin&lt;/artifactId&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;enforce-versions&lt;/id&gt;
            &lt;goals&gt;
              &lt;goal&gt;enforce&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;rules&gt;
                &lt;requirePluginVersions&gt;
                   &lt;message&gt;DÃ©finissez plugin.version !&lt;/message&gt;
                &lt;/requirePluginVersions&gt;
              &lt;/rules&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Enforcer ne fait pas une analyse de notre fichier POM en tant que
document XML, ce qui serait peu utile puisque la version du plugin peut
Ãªtre dÃ©finie dans un parent ou dans un bloc &lt;pluginManagement&gt;. Il
utilise le modÃ¨le objet du projet qui est le rÃ©sultat de l&#8217;analyse de
notre POM et de ceux dont il hÃ©rite. Si une version est dÃ©finie quelque
part, il saura donc la dÃ©tecter et, Ã  l&#8217;inverse, il saura dÃ©tecter son
absenceÂ !</p>
</div>
<div class="paragraph">
<p>Enforcer propose de nombreuses autres rÃ¨gles d&#8217;usage de Maven permettant
de s&#8217;assurer que le projet est utilisÃ© selon les bons usages ou les
contraintes spÃ©cifiques dÃ©finies par le projet. Il peut ainsi vÃ©rifier
que le dÃ©veloppeur utilise une version prÃ©cise de Maven ou du JDK, mais
aussi que certains fichiers existent (ou n&#8217;existent pas), qu&#8217;aucun
SNAPSHOT n&#8217;est utilisÃ© en dÃ©pendance, ou encore interdire l&#8217;utilisation
de certaines dÃ©pendances (par exemple, pour Ã©viter des problÃ¨mes de
licence).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Diviser_pour_regner">Diviser pour rÃ©gner</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaStephane.png" alt="MangaStephane"></span></p>
</div>
<div class="paragraph">
<p>StÃ©phane est trÃ¨s satisfait de la solution du POM parent que nous venons
de dÃ©couvrir, lui qui en avait assez de passer en revue un Ã  un nos
fichiers POM pour mettre en place une configuration cohÃ©rente. Il reste
cependant un peu sur sa faimÂ : pour construire toute l&#8217;application et la
tester dans son ensemble, il doit encore passer de projet en projet pour
lancer Ã  rÃ©pÃ©tition la commande <code>mvn install</code>. Les choses se compliquent
mÃªme rapidement lorsqu&#8217;il doit tenir compte d&#8217;une dÃ©pendance entre deux
sous-projets.</p>
</div>
<div class="paragraph">
<p>Un projet de type POM inclut cependant une particularitÃ© que nous
n&#8217;avons pas encore explorÃ©eÂ : il peut dÃ©finir un Ã©lÃ©ment &lt;modules&gt;.
Celui-ci dÃ©clare une liste de modules qui sont, en fait, des chemins
relatifs au POM. Lorsque nous demandons Ã  Maven de construire un projet
de ce type, il exploite cette information pour rechercher dans chacun de
ces chemins un autre projet Maven Ã  construire, qu&#8217;il intÃ©grera dans une
macroconstruction de projet. En plus d&#8217;enchaÃ®ner la construction des
projets/modules, Maven va surtout tenir compte des dÃ©pendances qu&#8217;ils
peuvent avoir les uns pour les autres et ordonnancer son processus de
construction en consÃ©quence. Les binaires rÃ©sultants seront donc
toujours cohÃ©rents avec l&#8217;Ã©tat du code source de l&#8217;ensemble des modules.</p>
</div>
<div class="paragraph">
<p>VoilÃ  une fonctionnalitÃ© dÃ©terminante pour StÃ©phane. Jusqu&#8217;ici, notre
projet d&#8217;application web contenait Ã  la fois les pages web, mais aussi
toute la partie back-end de l&#8217;applicationÂ : rÃ¨gles mÃ©tier, accÃ¨s Ã  la
base de donnÃ©es et exposition de services web.</p>
</div>
<div class="paragraph">
<p>Le dÃ©coupage de notre sous-projet webapp en modules permet d&#8217;isoler
physiquement chaque couche de notre architecture. Un module pour notre
domaine mÃ©tier accueillera nos objets ListeDeCourses, Promotion et
BonneAdresse. Un module permettra d&#8217;isoler nos services mÃ©tier. Un
troisiÃ¨me se concentrera sur l&#8217;accÃ¨s Ã  notre base de donnÃ©es, un autre Ã 
l&#8217;exposition de nos services mÃ©tier sous forme de services Web, et ainsi
de suite. Chaque module, recentrÃ© sur un besoin ou sur une technologie
particuliÃ¨re, va voir sa liste de dÃ©pendances fondre et se spÃ©cialiser.</p>
</div>
<div class="paragraph">
<p>Il sera alors aisÃ© d&#8217;assurer des rÃ¨gles d&#8217;architecture du type Â«Â seule la
couche base de donnÃ©es peut faire appel Ã  HibernateÂ Â». Il suffit que les
autres modules n&#8217;aient pas de dÃ©pendance Hibernate pour qu&#8217;une erreur de
codage saute aux yeux Ã  la premiÃ¨re compilationÂ !</p>
</div>
<div class="paragraph">
<p>Ce recentrage sur une technologie simplifie nettement le dÃ©veloppement
lorsque l&#8217;Ã©quipe est organisÃ©e par domaine de compÃ©tence. Notre
spÃ©cialiste de la persistance JPA va pouvoir donner libre cours Ã  son
imagination. Outils de test spÃ©cialisÃ©s et gestion fine des dÃ©pendances
sont Ã  sa disposition pour forger son module selon ses habitudes et les
bonnes pratiques du domaine.</p>
</div>
<div class="sect3">
<h4 id="heritage_naturel">HÃ©ritage Â«Â naturelÂ Â»</h4>
<div class="paragraph">
<p>Les mÃ©canismes de modules et d&#8217;hÃ©ritage ne sont pas nÃ©cessairement liÃ©s
l&#8217;un Ã  l&#8217;autre, cependant ils se complÃ¨tent de maniÃ¨re naturelle. Il est
trÃ¨s frÃ©quent que le POM parent soit celui qui dÃ©clare un projet comme
module. En fait, les cas oÃ¹ une autre organisation est nÃ©cessaire sont
assez rares et rÃ©pondent Ã  des contraintes d&#8217;organisation trÃ¨s
particuliÃ¨res. La structure hiÃ©rarchique des projets est donc une
structure trÃ¨s courante pour les projets Maven, gÃ©nÃ©ralement reflÃ©tÃ©e
par l&#8217;organisation physique des rÃ©pertoires.</p>
</div>
</div>
<div class="sect3">
<h4 id="et_l_integration_continue">Et l&#8217;intÃ©gration continueÂ ?</h4>
<div class="paragraph">
<p>Comment va se comporter notre serveur d&#8217;intÃ©gration continue face Ã  ce
nouveau dÃ©coupage en modulesÂ ? Les outils que nous avons retenus
supportent parfaitement cette approche de Maven. Ils vont donc
identifier chaque module comme un projet Ã  ajouter dans la configuration
de l&#8217;intÃ©gration continue.</p>
</div>
<div class="paragraph">
<p>Continuum a nÃ©anmoins ici un coup d&#8217;avance sur la concurrenceÂ : en
dÃ©tectant une modification dans le code du projet, il va lancer la
construction du module concernÃ©, puis exploiter la gestion des
dÃ©pendances entre projets pour lancer la construction de tous les autres
modules qui en dÃ©pendent et pourraient donc Ãªtre impactÃ©s, mais pas de
ceux qui n&#8217;ont aucun lien direct ou indirect avec la modification. Mais
Hudson le talonne de prÃ¨s et commence Ã  supporter lui aussi une gestion
plus intelligente de Mavenâ¦ Ã  suivreÂ !</p>
</div>
<div class="paragraph">
<p>L&#8217;avantage de ce fonctionnement, dÃ©taillÃ© dans la figure 07-02,  est que
la construction d&#8217;un module (ou de plusieurs) est plus rapide que celle
du projet dans son ensemble. Le serveur sera ainsi plus rÃ©actifÂ : une
modification erronÃ©e sur un module sera identifiÃ©e rapidement, son
impact sur un autre module apparaÃ®tra en quelques instants, alors qu&#8217;une
construction complÃ¨te aurait pu prendre de longues minutes, impliquant
de nombreux modules non concernÃ©s par la modification.</p>
</div>
<div class="paragraph">
<div class="title">Figure 07-02</div>
<p><span class="image"><img src="illustrations/07-02.png" alt="07 02"></span></p>
</div>
<div class="paragraph">
<p>RÃ©action du serveur d&#8217;intÃ©gration continue Ã  une modification.</p>
</div>
</div>
<div class="sect3">
<h4 id="_un_gros_projet_vs_plein_de_modules">Un gros projet <em>vs</em> plein de modules</h4>
<div class="paragraph">
<p>Certains utilisateurs n&#8217;apprÃ©cient pas le dÃ©coupage en nombreux modules
qu&#8217;encourage Maven. Ils ont l&#8217;impression que leur projet s&#8217;effrite en
petits bouts de code sans grande valeur et dÃ©licats Ã  identifier pour
les utilisateurs finaux.</p>
</div>
<div class="paragraph">
<p>Cette impression dÃ©coule dâune habitude prise avant l&#8217;apparition de
Maven, qui consiste Ã  proposer un gros JAR avec tout ce qui est
nÃ©cessaire Ã  l&#8217;intÃ©rieur pour que les utilisateurs n&#8217;aient pas Ã  se
soucier des dÃ©pendances. Paradoxalement, cette pratique est plus
pÃ©rilleuse qu&#8217;elle n&#8217;y paraÃ®t et introduit des incompatibilitÃ©s sans
solution lorsqu&#8217;on veut marier deux outils construits avec cette
optique.</p>
</div>
<div class="paragraph">
<p>Les utilisateurs de Maven n&#8217;ont plus Ã  se prÃ©occuper des problÃ¨mes de
dÃ©pendances, et chaque module peut prÃ©ciser finement ce qui lui est
nÃ©cessaire. Au contraire, un artefact unique devraÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>soit dÃ©clarer trop de dÃ©pendances, dont un grand nombre ne sont
nÃ©cessaires qu&#8217;Ã  des fonctions que certains utilisateurs considÃ©reront
comme annexes alors qu&#8217;elles sont indispensables pour d&#8217;autresÂ ;</p>
</li>
<li>
<p>soit dÃ©clarer un grand nombre de dÃ©pendances optionnelles, auquel
cas les utilisateurs devront eux-mÃªmes aller Ã  la pÃªche aux informations
pour reconstituer la liste de dÃ©pendances.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Dans les deux cas, les utilisateurs de Maven sont pÃ©nalisÃ©s, et ceux qui
ne l&#8217;utilisent pas ne sont pas beaucoup plus avancÃ©s dans leur gestion
manuelle des dÃ©pendances.</p>
</div>
</div>
<div class="sect3">
<h4 id="_les_modules_au_service_de_larchitecture">Les modules au service de l&#8217;architecture</h4>
<div class="paragraph">
<p>Le dÃ©coupage en modules permet aussi de renforcer nos rÃ¨gles
d&#8217;architecture logicielle. Si notre structuration JavaEE impose par
exemple que Â«Â <em>seule la couche mÃ©tier est autorisÃ©e Ã  manipuler les
objets de la couche d&#8217;accÃ¨s Ã  la base</em>Â Â», la dÃ©claration des dÃ©pendances
permet d&#8217;interdire Ã  tout autre module de l&#8217;utiliserÂ : en l&#8217;absence de
dÃ©pendance sur le module <em>persistance</em>, aucun risque de le voir utilisÃ©
par mÃ©gardeÂ ! Fini la mauvaise surprise de dÃ©couvrir un tag JSP qui
effectue sa propre requÃªte en base pour construire une liste de
sÃ©lection.</p>
</div>
</div>
<div class="sect3">
<h4 id="garder_le_controle">Garder le contrÃ´le</h4>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaStephane.png" alt="MangaStephane"></span></p>
</div>
<div class="paragraph">
<p>StÃ©phane aboutit Ã  une structure de projet claire et bien organisÃ©e, oÃ¹
chaque composant trouve sa place dans un moduleÂ : un module pour notre
code mÃ©tier, un module pour notre couche dâaccÃ¨s Ã  la base de donnÃ©es,
un module pour notre IHM web, un module pour nos services web REST, un
autre pour nos batchs de sauvegardeâ¦</p>
</div>
<div class="paragraph">
<p>Dans un premier temps, nous trouvons cela dâune grande Ã©lÃ©gance, surtout
parce que cela nous permet de ne travailler que dans un module et donc
dâallÃ©ger dâautant notre Â«Â vueÂ Â» de lâapplication. Par contre, pour
compiler tout Ã§a il nous faut toujours lancer un gros <code>mvn install</code>, mÃªme
si un seul module isolÃ© est modifiÃ©, ou bien lancer la commande dans le
rÃ©pertoire de chaque module impactÃ© en respectant lâordre de
construction. Câest tout de mÃªme dommage dâavoir un outil qui gÃ¨re
lâordre des modules et de devoir gÃ©rer ce problÃ¨me Ã  la mainÂ !</p>
</div>
<div class="paragraph">
<p>Pas de panique nous rassure EmmanuelÂ : mÃªme si le fonctionnement par
dÃ©faut consiste Ã  enchaÃ®ner tous les modules du projet, Maven propose
des options avancÃ©es pour filtrer quels modules intÃ©grer au build et
quels modules ignorer.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PremiÃ¨re option Ã  connaÃ®tre, -N permet de ne construire que notre
projet POM parent, sans ses modules. Sur de trÃ¨s gros projets, cela peut
permettre de diffuser le POM parent indÃ©pendamment du reste du projet,
les dÃ©veloppeurs nâayant alors pas besoin de disposer sur leur poste de
dÃ©veloppement de lâintÃ©gralitÃ© du projet</p>
</li>
<li>
<p>Autre option intÃ©ressante, -pl (Â«Â project listÂ Â») permet de
dÃ©finir la liste des modules (chemins relatifs des rÃ©pertoires ou
[groupId]:artifactId sÃ©parÃ©s par des virgules) Ã  intÃ©grer dans le build.
Si nous nâavons modifiÃ© que le module webapp, nous pouvons donc le
construire de maniÃ¨re isolÃ©e en lanÃ§ant <code>mvn install âpl webapp</code>.</p>
</li>
<li>
<p>AssociÃ© Ã  lâoption project-list, -am (Â«Â also makeÂ Â») demande Ã 
Maven de construire tous les modules dont dÃ©pend notre liste, autrement
dit de sâassurer que notre projet se construit correctement jusquâaux
modules indiquÃ©s.</p>
</li>
<li>
<p>Lâoption inverse âamd (Â«Â also make dependentÂ Â»), permet de
construire les modules indiquÃ©s ainsi que tous les modules qui en
dÃ©pendent. Cela permet donc de vÃ©rifier que nos modifications nâont pas
cassÃ© quelque chose dans un module de plus haut niveau. Câest cette
option qui est mise Ã  profit par lâintÃ©gration continue Jenkins dans
lâoption Â«Â build incrÃ©mentalÂ Â». Si la structure des modules est
correcte, une modification dans un module ne devrait avoir aucun impact
sur dâautres modules qui nâont pas de lien de dÃ©pendance. Si cette
hypothÃ¨se est respectÃ©e, cela permet dâaccÃ©lÃ©rer sensiblement la
rapiditÃ© de lâintÃ©gration continue.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="illustrations/Maven3.png" alt="Maven3"></span></p>
</div>
<div class="paragraph">
<p>Nous pouvons ainsi rÃ©duire le nombre de modules construits par un mvn
install aux modules impactÃ©s par une modification. Bien, mais nous
sommes exigeants et en voulons encore plusÂ !</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaStephane.png" alt="MangaStephane"></span></p>
</div>
<div class="paragraph">
<p>StÃ©phane a gardÃ© une carte dans sa manche. Face Ã  un build qui enchaÃ®ne
encore plusieurs modules, il nous propose dâajouter une derniÃ¨re option,
-T 4. Il ne sâagit pas de demander de lâaide Ã  Skynet en invoquant
Terminator IV, mais de lancer Maven en parallÃ©lisant la construction des
modules sur les 4 processeurs de nos machines de dÃ©veloppement â car
depuis la crÃ©ation de notre start-up, nous avons tous reÃ§u un magnifique
MacBook Pro core i7. Maven peut alors traiter en parallÃ¨le certains de
nos modules et nous Ã©conomiser un temps prÃ©cieux. La seule limite est la
dÃ©pendance de nos modules entre eux, que Maven doit tout de mÃªme
respecter.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>LâexÃ©cution du build en parallÃ¨le nâest possible que si les plugins le
permettent. Câest le cas pour les versions rÃ©centes des plugins
officiels Maven et dâun grand nombre de plugins du projet Mojo. Si ce
nâest pas le cas, Maven vous gratifiera dâun message dâavertissement, ce
qui ne signifie pas que cela ne fonctionnera pas, mais juste que le
plugin nâa pas Ã©tÃ© testÃ© dans cette configurationÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[WARNING] *****************************************************************
[WARNING] * Your build is requesting parallel execution, but project      *
[WARNING] * contains the following plugin(s) that are not marked as       *
[WARNING] * @threadSafe to support parallel building.                     *
[WARNING] * While this /may/ work fine, please look for plugin updates    *
[WARNING] * and/or request plugins be made thread-safe.                   *
[WARNING] * If reporting an issue, report it against the plugin in        *
[WARNING] * question, not against maven-core                              *
[WARNING] *****************************************************************</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Bien, mais nous sommes exigeants et en voulons encore plusÂ ! StÃ©phane,
en fin stratÃ¨ge, a gardÃ© sa toute derniÃ¨re rÃ©plique pour la fin, et nous
invite Ã  refaire le monde autour dâune biÃ¨re. VoilÃ  qui met tout le
monde dâaccordÂ !</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_6">Conclusion</h3>
<div class="paragraph">
<p>Le mÃ©canisme d&#8217;hÃ©ritage est une originalitÃ© de Maven par rapport aux
autres outils orientÃ©s script qui utilisent une logique d&#8217;inclusion. Il
en rÃ©sulte une mutualisation trÃ¨s structurante et trÃ¨s puissante du
projet en modules. Un projet Maven est ainsi rapidement dÃ©composÃ© en
modules spÃ©cialisÃ©s dans un domaine ou une technologie. Le dÃ©veloppement
d&#8217;un de ces modules gagne en clartÃ©, focalisÃ© sur un aspect prÃ©cis de
l&#8217;application, sans pour autant compliquer la construction du projet. Un
simple <code>mvn install</code> depuis le projet de plus haut niveau enchaÃ®ne les
compilations de tous les modules pour produire un livrable cohÃ©rent.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chapitre_8_maven_et_javaee">Chapitre 8Â : Maven et JavaEE</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Notre application <em>noubliepaslalistedescourses</em> est fin prÃªte pour une
ouverture au public. Nous ne disposons cependant pas de nos propres
serveurs et faisons appel Ã  un hÃ©bergeur. Celui-ci nous propose un
magnifique service d&#8217;hÃ©bergement JavaEE surveillÃ© 24 heures sur 24 par
une Ã©quipe de spÃ©cialistes. Autant laisser faire les pros. Chacun son
mÃ©tierÂ !</p>
</div>
<div class="paragraph">
<p>Le monde de Java cÃ´tÃ© serveur est un monde en Â«Â ARÂ Â»Â : JAR, WAR, RAR, EAR
se cÃ´toient dans un ballet un peu dÃ©concertant d&#8217;archives Java et de
descripteurs de dÃ©ploiement. Souvent dÃ©criÃ©, le modÃ¨le JavaEE est
pourtant solidement implantÃ© et continue de progresser avec une refonte
significative dans sa mouture JavaEE6. Maven ne pouvait pas faire
l&#8217;impasse sur ce modÃ¨le, sur ses limites et sur les bonnes pratiques de
dÃ©veloppement qui l&#8217;accompagnent.</p>
</div>
<div class="sect2">
<h3 id="_java_entreprise_edition">Java Entreprise Edition</h3>
<div class="paragraph">
<p>Le modÃ¨le JavaEE n&#8217;a pas trÃ¨s bonne rÃ©putation. Il dÃ©finit (entre
autres) deux rÃ´les spÃ©cialisÃ©sÂ : le dÃ©veloppeur et l&#8217;assembleur de
composants. Ce dernier est chargÃ© de dÃ©finir, <em>via</em> des descripteurs de
dÃ©ploiement, la faÃ§on dont des macrocomposants sont liÃ©s au sein d&#8217;une
application d&#8217;entreprise. Ces macrocomposants, ce sont les EJB,
connecteurs et applications web que nous devons regrouper dans une
archive d&#8217;entreprise EAR. Les descripteurs, ce sont ces (tropÂ ?)
nombreux fichiers XML dans lesquels nous dÃ©clarons des rÃ©fÃ©rences vers
d&#8217;autres composants ou vers des ressources du serveur (typiquement, une
base de donnÃ©es). Nous y enregistrons aussi l&#8217;identitÃ© de chaque
composant pour sa parution dans un annuaire JNDI. La Figure 08-01 rÃ©sume
cette structure. Si vous n&#8217;Ãªtes pas familier avec la norme JavaEE ou si
vous voulez en avoir une description plus fine et moins biaisÃ©e que
notre rÃ©sumÃ© de quelques lignes, nous vous recommandons l&#8217;introduction
disponible sur le site de SUN <sup class="footnote">[<a id="_footnoteref_31" class="footnote" href="#_footnotedef_31" title="View footnote.">31</a>]</sup>.</p>
</div>
<div class="paragraph">
<div class="title">Figure 08-01</div>
<p><span class="image"><img src="illustrations/08-01.png" alt="08 01"></span></p>
</div>
<div class="paragraph">
<p>Structure d&#8217;une application selon le modÃ¨le JavaEE.</p>
</div>
<div class="paragraph">
<p>Cette structure soulÃ¨ve de nombreuses critiques, qui ne sont pas l&#8217;objet
de ce livre. Nous ne nous attarderons donc pas dessus. Quoi qu&#8217;on en
pense, JavaEE est une norme largement implantÃ©e et supportÃ©e, et il nous
faut la suivre d&#8217;une faÃ§on ou d&#8217;une autre si nous voulons dÃ©ployer notre
belle application sur le serveur dâhÃ©bergement.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Java EE, J2EE ou JEEÂ ? Pour une raison obscure, JavaÂ 1.2 a Ã©tÃ© annoncÃ©
par SUN sous le nom de Â«Â Java 2Â Â». En ont dÃ©coulÃ© les versions standard
J2SE, mobile J2ME et entreprise J2EE. Dans un Ã©lan de logique, les
versions suivantes ont conservÃ© ce nom en ajoutant un numÃ©ro de version,
on a donc eu le droit Ã  J2EEÂ 1.3 puis J2EEÂ 1.4. Ce nâest quâavec la
version 1.5 que SUN a changÃ© de politique pour nommer son bÃ©bÃ© Â«Â Java
5Â Â». Au passage, la dÃ©clinaison entreprise est devenue JavaEEÂ 5, puis
JavaEEÂ 6.</p>
</div>
<div class="paragraph">
<p>Seul souci, prononcÃ© rapidement, J2EE Â«Â Ji-deux-eeuuhÂ Â» devient
rapidement JEE, au mÃªme titre quâon dit Â«Â Ã¨s-Ã¨s-deux-iÂ Â» pour lâacronyme
SSII. On voit donc dans de nombreux CV ou offres dâemploi le terme JEE
qui ne correspond Ã  rien. Ceci dit, cela ne change absolument rien et
tout le monde comprend de quoi on parle, mais câÃ©tait lâoccasion de
faire un petit point culturel :)</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_construire_une_archive_web_war">Construire une archive web WAR</h4>
<div class="paragraph">
<p>La premiÃ¨re Ã©tape consiste Ã  crÃ©er l&#8217;archive WAR de notre application
web, en incluant son descripteur de dÃ©ploiement. En tant que fichier
binaire, un WAR n&#8217;est rien d&#8217;autre qu&#8217;une archive JAR avec une extension
spÃ©cifique, donc rien de bien compliquÃ©. Nous devons cependant suivre la
structure dÃ©finie par la norme JavaEE, en particulier le rÃ©pertoire
WEB-INF qui doit contenirÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>le descripteur de dÃ©ploiement web.xmlÂ ;</p>
</li>
<li>
<p>un sous-rÃ©pertoire classes avec le code compilÃ© de nos servlets et
des autres classes nÃ©cessaires Ã  notre applicationÂ ;</p>
</li>
<li>
<p>un sous-rÃ©pertoire lib avec les bibliothÃ¨ques utilisÃ©es.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sur un projet utilisant un rÃ©pertoire lib fourre-tout pour placer ses
bibliothÃ¨ques, le troisiÃ¨me point serait traitÃ© avant mÃªme qu&#8217;on ne se
pose la question, mais sur notre projet MavenÂ ?</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaVincentS.png" alt="MangaVincentS"></span></p>
</div>
<div class="paragraph">
<p>Vincent s&#8217;attaque Ã  la construction automatisÃ©e de notre WAR. Il trouve
rapidement un alliÃ© de choix dans le plugin war de Maven. Celui-ci a Ã©tÃ©
conÃ§u pour rÃ©pondre de la maniÃ¨re la plus souple et la plus transparente
qui soit Ã  ces contraintes d&#8217;assemblage. Ce plugin va bÃ¢tir dans le
rÃ©pertoire de construction (target) la structure ouverte de l&#8217;archive
WAR Ã  partir des Ã©lÃ©ments de notre projet et de nos dÃ©clarations dans le
POM. Il va donc y recopier tous les Ã©lÃ©ments statiques de notre
application web (pages html, images, scriptsâ¦), ainsi que nos classes
compilÃ©es par le plugin compiler, notre descripteur de dÃ©ploiement et
nos bibliothÃ¨ques â du tout cuitÂ !</p>
</div>
<div class="paragraph">
<p>Cerise sur le gÃ¢teau, Vincent n&#8217;a mÃªme pas besoin de dÃ©clarer
explicitement ce plugin comme nous l&#8217;avons fait jusqu&#8217;iciÂ : puisque
notre projet ne produit pas un JAR, il remplace la dÃ©claration de
&lt;packaging&gt; pour indiquer la construction d&#8217;une archive WAR. Ce
packaging, supportÃ© par dÃ©faut par Maven, provoque automatiquement une
sÃ©lection diffÃ©rente des plugins associÃ©s par dÃ©faut aux phases du
projet, et en particulier l&#8217;activation du plugin war lors de
l&#8217;assemblage.</p>
</div>
<div class="paragraph">
<p>Vincent aurait-il tirÃ© le gros lot en prenant en charge cette tÃ¢cheÂ ?
Une ligne de configuration Ã  Ã©diter en tout et pour tout, c&#8217;est plutÃ´t
reposantÂ ! Eh bien nonÂ ! Au lancement de notre application sur le
serveur de test Tomcat, nous avons droit Ã  une erreur qui pourrait faire
sourire si nous Ã©tions un 1<sup>er</sup> avril, mais qui nous laisse perplexesÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ClassCastException : fr.noubliepaslalistedescourses.servlets.LoginServlet is not a javax.servlet.Servlet</pre>
</div>
</div>
<div class="paragraph">
<p>Nous devons explorer un peu plus la logique de JavaEE pour comprendre.
Un serveur JavaEE isole chacun des composants qu&#8217;on y dÃ©ploie afin
qu&#8217;ils ne se perturbent pas mutuellement. Cette isolation se fait <em>via</em>
des chargeurs de classes dÃ©diÃ©s. Notre application web aura donc son
propre chargeur de classes, incluant les bibliothÃ¨ques de notre
WEB-INF/lib et nos classes de WEB-INF/classes. Celui-ci hÃ©rite d&#8217;un
chargeur pÃ¨re qui contient les classes du serveur d&#8217;application
permettant la mise en Åuvre de l&#8217;API servlet. Le serveur sera donc en
mesure de manipuler nos servlets parce que nous partageons avec lui les
classes de cette API. La Figure 08-02 compare cependant ce modÃ¨le
thÃ©orique et ce que nous observons.</p>
</div>
<div class="paragraph">
<div class="title">Figure 08-02</div>
<p><span class="image"><img src="illustrations/08-02.png" alt="08 02"></span></p>
</div>
<div class="paragraph">
<p>Comparaison de la structure des chargeurs de classesÂ : thÃ©orie <em>vs</em>
pratique.</p>
</div>
<div class="paragraph">
<p>Lorsque le serveur d&#8217;application tente d&#8217;initialiser un de nos servlets,
il manipule tout naturellement le type javax.servlet.Servlet, Ã  partir
des classes prÃ©sentes dans son chargeur de classes. Notre servlet
LoginServlet a cependant Ã©tÃ© instanciÃ© dans le chargeur de classes de
l&#8217;application webÂ ; aussi, pour que tout fonctionne bien, il faut que le
type javax.servlet.Servlet, lorsqu&#8217;il est manipulÃ© depuis l&#8217;application
web, soit le mÃªme que depuis le code du serveur d&#8217;application.</p>
</div>
<div class="paragraph">
<p>En jetant un coup d&#8217;Åil Ã  notre WEB-INF/lib, nous y dÃ©couvrons le
coupableÂ : servlet-api-2.5.jar. Un servlet crÃ©Ã© dans notre application
web aura comme type parent une classe qui est chargÃ©e elle aussi par
l&#8217;application web, et pas le javax.servlet.Servlet commun Ã  tout le
serveur d&#8217;application. D&#8217;oÃ¹ cet Ã©trange message d&#8217;erreur. Vincent est
rassurÃ© sur sa santÃ© mentale.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Lorsqu&#8217;il s&#8217;agit du JAR de l&#8217;API servlet le constat est rapide, mais il
peut arriver qu&#8217;une bibliothÃ¨que ait la mauvaise idÃ©e de contenir les
classes d&#8217;une API Java (plutÃ´t que d&#8217;en dÃ©pendre), par exemple le
JAR gwt-user de GWT. L&#8217;identification du coupable est alors nettement
moins immÃ©diate.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Cette dÃ©pendance javax.servlet:servlet-api:2.5 est pourtant
indispensable Ã  notre application pour quâelle soit en mesure de
compiler. Nous faisons de nombreuses rÃ©fÃ©rences directes Ã  ces classes
dans notre codeÂ ! Nous avons dÃ©jÃ  explorÃ© les scopes que nous pouvons
affecter Ã  nos dÃ©pendances. Le scope par dÃ©faut (compile) signifie que
la bibliothÃ¨que associÃ©e est nÃ©cessaire pour compiler et s&#8217;exÃ©cuter,
c&#8217;est donc <em>a priori</em> bien le cas. Il existe cependant un autre scope,
provided, qui est trÃ¨s proche avec une nuance significativeÂ : il dÃ©clare
une dÃ©pendance nÃ©cessaire pour compiler et s&#8217;exÃ©cuter mais qui est
fournie par l&#8217;environnement d&#8217;exÃ©cution, typiquement notre serveur
JavaEE.</p>
</div>
<div class="paragraph">
<p>La modification suivante sur nos dÃ©pendances corrige donc ce problÃ¨me
assez dÃ©boussolant et nous permet enfin de lancer l&#8217;application web sur
notre serveur Tomcat.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
    &lt;artifactId&gt;servlet-api&lt;/artifacId&gt;
    &lt;version&gt;2.5&lt;/version&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_construire_un_ejb">Construire un EJB</h4>
<div class="paragraph">
<p>Notre exploration du monde JavaEE se poursuit avec un Entreprise Java
Bean, c&#8217;est-Ã -dire un macrocomposant mÃ©tier qui sera potentiellement
distribuable sur l&#8217;ensemble de notre cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Quoi, nous n&#8217;avons pas de clusterÂ ? Pourquoi avoir choisi un EJB alorsÂ ?
Sans vouloir faire de l&#8217;anti-JavaEE, disons que les EJB ont longtemps
traÃ®nÃ© de lourdes casseroles, car ils Ã©taient appliquÃ©s sans quâon en
comprenne le rÃ´le dans l&#8217;architecture. Jusqu&#8217;Ã  l&#8217;Ã©mergence de JavaEE5 et
de JavaEE6, qui les dÃ©poussiÃ¨rent sensiblement, leur utilisation Ã©tait
mÃªme largement dÃ©criÃ©e au profit de modÃ¨les lÃ©gers dont SpringFramework
est le fer de lance.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaVincentS.png" alt="MangaVincentS"></span></p>
</div>
<div class="paragraph">
<p>Nous avons donc isolÃ© notre code mÃ©tier dans un module (voir le
Chapitre 7) dÃ©diÃ©, chargÃ© de construire un composant rÃ©utilisable. Fort
de son prÃ©cÃ©dent succÃ¨s, Vincent se porte volontaire pour explorer la
Â«Â mavenisationÂ Â» de cet aspect de notre application.</p>
</div>
<div class="paragraph">
<p>La mÃªme recette donne le mÃªme rÃ©sultat, ce qui finit par nous faire
penser que Vincent a dÃ©cidÃ©ment le nez finÂ : &lt;packaging&gt;ejb&lt;/packaging&gt;
dans le POM suffit pour changer la configuration par dÃ©faut du cycle de
vie et produire un EJB. La seule chose que nous devrons y ajouter est la
configuration de la version de l&#8217;API EJB que nous voulons utiliser, Ã 
savoir EJB3 ce qui n&#8217;est pas la valeur par dÃ©faut (2.1).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-ejb-plugin&lt;/artifactId&gt;
    &lt;version&gt;2.1&lt;/version&gt;
    &lt;configuration&gt;
          &lt;ejbVersion&gt;3.0&lt;/ejbVersion&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cette formalitÃ© passÃ©e, nous obtenons l&#8217;EJB tant attendu, dont nous
pouvons tester le dÃ©ploiement sur un serveur de test OpenEJB.</p>
</div>
<div class="paragraph">
<p>Il nous reste Ã  faire le lien avec notre application web. Celle-ci doit
disposer des classes client de l&#8217;EJB, c&#8217;est-Ã -dire de la partie de l&#8217;EJB
qui dÃ©finit son utilisation (interfaces, objets paramÃ¨tres). Cela ne va
pas nous coÃ»ter beaucoup d&#8217;efforts puisque le plugin ejb a la bonne idÃ©e
de crÃ©er une archive avec ces classes pour nous, en ajoutant simplement
Ã  sa configuration &lt;generateClient&gt;true&lt;/generateClient&gt;. Nous obtenons
donc finalament deux archives JavaÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>noubliepaslalistedescourses-ejb-1.0.0-SNAPSHOT.jar, notre fameux
EJBÂ ;</p>
</li>
<li>
<p>noubliepaslalistedescourses-ejb-1.0.0-SNAPSHOT-client.jar,
l&#8217;archive des classes client qui permettra d&#8217;invoquer notre EJB.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Dans notre application web, il nous suffit donc de dÃ©clarer une nouvelle
dÃ©pendance vers ce client pour pouvoir utiliser notre EJBÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
      &lt;groupId&gt;fr.noubliepaslalistedescourses&lt;/groupId&gt;
      &lt;artifactId&gt;noubliepaslalistedescourses-ejb&lt;/artifactId&gt;
      &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;
      &lt;type&gt;ejb-client&lt;/type&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Reste Ã  faire le lien entre les deux composants, <em>via</em> les descripteurs
de dÃ©ploiement. L&#8217;objet de ce livre n&#8217;est pas de vous faire un exposÃ©
complet sur JavaEEÂ ; pourtant, nous ne pouvons pas honnÃªtement vous
laisser sans rÃ©ponse si prÃ¨s du butâ¦ Les Listings 8.1 et 8.2 montrent
les deux descripteurs de dÃ©ploiement de notre application, le premier
permettant Ã  l&#8217;EJB de s&#8217;identifier et de demander une ressource de type
base de donnÃ©es, le second permettant Ã  l&#8217;application Web d&#8217;obtenir une
rÃ©fÃ©rence vers notre EJB, potentiellement installÃ© sur un autre serveur,
voire distribuÃ© sur un cluster.</p>
</div>
<div class="listingblock">
<div class="title">Listing 8.1 : Descripteur de dÃ©ploiement de notre EJB</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE ejb-jar PUBLIC
   '-//Sun Microsystems, Inc.//DTD Enterprise JavaBeans 1.1//EN'
   'http://java.sun.com/j2ee/dtds/ejb-jar_1_1.dtd'&gt;
&lt;ejb-jar&gt;
   &lt;enterprise-beans&gt;
      &lt;session&gt;
         &lt;ejb-name&gt;ListeDeCoursesEJB&lt;/ejb-name&gt;
         &lt;home&gt;
            fr.noubliepaslalistedescourses.ListeDeCoursesHome
         &lt;/home&gt;
         &lt;remote&gt;
            fr.noubliepaslalistedescourses.ListeDeCourses
         &lt;/remote&gt;
         &lt;ejb-class&gt;
            fr.noubliepaslalistedescourses.ListeDeCoursesBean
         &lt;/ejb-class&gt;
         &lt;session-type&gt;Stateless&lt;/session-type&gt;
         &lt;transaction-type&gt;Container&lt;/transaction-type&gt;
         &lt;resource-ref&gt;
            &lt;res-ref-name&gt;jdbc/appDB&lt;/res-ref-name&gt;
            &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
            &lt;res-auth&gt;Container&lt;/res-auth&gt;
            &lt;description&gt;
               AccÃ¨s JDBC Ã  la base de donnÃ©es
            &lt;/description&gt;
         &lt;/resource-ref&gt;
      &lt;/session&gt;
   &lt;/enterprise-beans&gt;
&lt;/ejb-jar&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 8.2 : Descripteur de dÃ©ploiement de notre application web</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version=_"1.0"_ encoding=_"UTF-8"_?&gt;

&lt;web-app version=_"2.4"_
    xmlns=_"http://java.sun.com/xml/ns/j2ee"_
    xmlns:xsi=_"http://www.w3.org/2001/XMLSchema-instance"_
    xsi:schemaLocation=_"http://java.sun.com/xml/ns/j2ee_
	_http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"_&gt;
  &lt; !-- Servlet GWT-RPC de l'application web --&gt;
  &lt;servlet&gt;
    &lt;servlet-name&gt;gwt-rpc&lt;/servlet-name&gt;
    &lt;servlet-class&gt;
      org.springframework.web.servlet.DispatcherServlet
    &lt;/servlet-class&gt;
    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;gwt-rpc&lt;/servlet-name&gt;
    &lt;url-pattern&gt;*.rpc&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
  &lt; !âRÃ©fÃ©rence vers notre EJB --&gt;
  &lt;ejb-ref&gt;
    &lt;ejb-ref-name&gt;ejb/ListeDeCourses&lt;/ejb-ref-name&gt;
    &lt;ejb-ref-type&gt;Session&lt;/ejb-ref-type&gt;
    &lt;ejb-ref-home&gt;
       fr.noubliepaslalistedescourses.ListeDeCoursesHome
    &lt;/ejb-ref-home&gt;
    &lt;ejb-ref-remote&gt;
       fr.noubliepaslalistedescourses.ListeDeCoursesRemote
    &lt;/ejb-ref-remote&gt;
  &lt;/ejb-ref&gt;
&lt;/web-app&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_construire_une_archive_dentreprise_ear">Construire une archive d&#8217;entreprise EAR</h4>
<div class="paragraph">
<p>Il ne nous reste plus qu&#8217;Ã  prendre nos composants et Ã  les grouper dans
un joli paquet-cadeau avant de l&#8217;envoyer Ã  notre hÃ©bergeur. En terme
JavaEE, le paquet-cadeau est une archive d&#8217;entreprise EAR.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaVincentS.png" alt="MangaVincentS"></span></p>
</div>
<div class="paragraph">
<p>Pour produire ce nouvel artefact, Vincent applique la recette qui lui a
jusqu&#8217;ici rÃ©ussi et fait mouche une nouvelle foisÂ : un nouveau module,
avec comme packaging ear suffit pour produire un artefact EAR. Si tout
pouvait Ãªtre aussi simpleâ¦ enfin, passons.</p>
</div>
<div class="paragraph">
<p>La seule chose Ã  dÃ©clarer dans le POM de ce nouveau module est la liste
de dÃ©pendances, pointant vers nos composants JavaEE, Ã  inclure dans
l&#8217;EAR â dans notre cas, l&#8217;application web et l&#8217;EJB, mais potentiellement
plusieurs composants de ce type et/ou des connecteurs RAR ou autres
subtilitÃ©s JavaEE propriÃ©taires ou non.</p>
</div>
<div class="paragraph">
<p>Le plugin ear compte de nombreuses options qui permettent d&#8217;ajuster
finement le nom de chaque composant Ã  l&#8217;intÃ©rieur de l&#8217;archive EAR. Il
propose mÃªme de gÃ©nÃ©rer pour nous le descripteur de dÃ©ploiement
application.xml, ce qui nous fera toujours un fichier de moins Ã 
maintenir.</p>
</div>
<div class="paragraph">
<p>Nous avons un bel EAR prÃªt pour une mise en production, cependant un
dÃ©tail chagrine VincentÂ : notre application web, comme notre EJB,
utilise plusieurs bibliothÃ¨ques utilitaires, telles que commons-lang ou
commons-io. Dans sa structure actuelle, nous retrouvons ces fichiers en
double, une fois dans le WEB-INF/lib de l&#8217;application web, une fois dans
le fichier EJB. Ce n&#8217;est pas intellectuellement trÃ¨s satisfaisant.</p>
</div>
<div class="paragraph">
<p>Le modÃ¨le JavaEE a prÃ©vu le dÃ©coupage des composants en modules mais n&#8217;a
pas non plus nÃ©gligÃ© la mutualisation des bibliothÃ¨ques. Le mÃ©tafichier
MANIFEST permet de dÃ©clarer des bibliothÃ¨ques nÃ©cessaires Ã  l&#8217;exÃ©cution
d&#8217;un module JavaEE, bibliothÃ¨ques qui seront alors mises Ã  disposition
<em>via</em> l&#8217;EAR.</p>
</div>
<div class="paragraph">
<p>Maven n&#8217;a pas non plus nÃ©gligÃ© cet aspect du packaging JavaEE, et nous
devons revenir dans notre projet application web pour marquer les
dÃ©pendances que nous voulons Ã  prÃ©sent exclure de WEB-INF/lib pour les
mutualiser.</p>
</div>
<div class="paragraph">
<p>Ã la premiÃ¨re Ã©tape, on demande au plugin war de construire, dans les
mÃ©tadonnÃ©es de l&#8217;archive, l&#8217;indication de classpathÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.0.2&lt;/version&gt;
        &lt;configuration&gt;
          &lt;archive&gt;
            &lt;manifest&gt;
              &lt;addClasspath&gt;true&lt;/addClasspath&gt;
            &lt;/manifest&gt;
          &lt;/archive&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pour chaque dÃ©pendance que nous voulons voir apparaÃ®tre dans ce chemin
de classes commun, et donc exclure de notre WEB-INF/lib, il suffit
d&#8217;indiquer le statut optionnel de la dÃ©pendanceÂ :
&lt;optional&gt;true&lt;/optional&gt;. La dÃ©claration peut sembler un peu
contre-nature, puisque dans la majoritÃ© des cas la dÃ©pendance en
question n&#8217;est pas du tout optionnelle. Il s&#8217;agit, avouons-le, d&#8217;un
dÃ©tournement de la notion de dÃ©pendance optionnelle, qui, de toute
faÃ§on, n&#8217;a pas vraiment de sens pour un projet WAR.</p>
</div>
<div class="paragraph">
<p>Dans notre projet EJB, nous appliquons au plugin ejb la mÃªme dÃ©claration
&lt;archive&gt; que pour le plugin war. L&#8217;EJB produit aura alors dans son
MANIFEST une dÃ©claration de classpath Ã  la place de l&#8217;inclusion de ses
dÃ©pendances. Il ne nous reste plus qu&#8217;Ã  dÃ©clarer ces dÃ©pendances dans
notre projet EAR pour que celui-ci les intÃ¨gre dans l&#8217;archive EAR et
qu&#8217;elles soient ainsi partagÃ©es entre nos deux composants JavaEE.</p>
</div>
<div class="paragraph">
<p>Pour Ã©viter un travail fastidieux de cohÃ©rence entre les trois modules,
nous remontons dans le projet parent ces dÃ©clarations de dÃ©pendances,
qui deviennent alors elles-mÃªmes mutualisÃ©es. Comme dÃ©claration de
dÃ©pendances, notre projet application web ne contient alors que les
bibliothÃ¨ques spÃ©cifiquement web qu&#8217;il emploie. La Figure 08-03 indique
la structure finale de notre projet Maven.</p>
</div>
<div class="paragraph">
<div class="title">Figure 08-03</div>
<p><span class="image"><img src="illustrations/08-03.png" alt="08 03"></span></p>
</div>
<div class="paragraph">
<p>Multiprojet JavaEE avec mise en commun des dÃ©pendances <em>via</em> l&#8217;EAR.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tester">Tester</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaVincentS.png" alt="MangaVincentS"></span></p>
</div>
<div class="paragraph">
<p>Nous savons dÃ©sormais construire notre archive d&#8217;entreprise en une seule
ligne de commande, respectant Ã  la lettre la spÃ©cification JavaEE. Mais
Vincent ne veut pas en rester lÃ Â : <em>quid</em> des tests de nos composantsÂ ?
En particulier, si nous savons les tester unitairement ou Ã  un niveau
intÃ©gration (voir le Chapitre 5), la partie web reste le parent pauvre.
Par dÃ©finition, nos pages web produites par des JSP, composants JSF ou
servlets, ne peuvent Ãªtre testÃ©es que lorsqu&#8217;elles sont hÃ©bergÃ©es par un
serveur JavaEE ou, au minimum, un moteur de servlet. Comment contrÃ´ler
le bon enchaÃ®nement de nos pages, la remontÃ©e correcte des donnÃ©es, le
fonctionnement global de notre applicationÂ ?</p>
</div>
<div class="paragraph">
<p>Ce dont Vincent rÃªve, c&#8217;est d&#8217;un outil qui ferait ce que nous devons
faire Ã  la main Ã  chaque modification du codeÂ : assembler l&#8217;application,
la dÃ©ployer sur un serveur de test, la dÃ©marrer, puis lancer notre
navigateur et enchaÃ®ner quelques Ã©crans pour constater le rendu HTML
d&#8217;une page particuliÃ¨re. Eh bien rÃ©jouissons-nous, cet outil de rÃªve
existeÂ !</p>
</div>
<div class="sect3">
<h4 id="_selenium">Selenium</h4>
<div class="paragraph">
<p>Selenium <sup class="footnote">[<a id="_footnoteref_32" class="footnote" href="#_footnotedef_32" title="View footnote.">32</a>]</sup> est un outil qui n&#8217;est pas limitÃ© au monde
Java mais s&#8217;y intÃ¨gre trÃ¨s bien. Il s&#8217;agit d&#8217;un systÃ¨me complet
d&#8217;enregistrement et de pilotage du navigateur web Ã  des fins de test â
rien que Ã§a.</p>
</div>
<div class="paragraph">
<p>Il se compose de deux partiesÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Un enregistreur, qui se base sur le navigateur Firefox et permet
de capturer une sÃ©quence d&#8217;actions sur ce dernier. Vous enregistrez
ainsi un scÃ©nario d&#8217;utilisation type de votre application.</p>
</li>
<li>
<p>Un outil de pilotage, qui va rejouer le scÃ©nario enregistrÃ© sur un
navigateur. Selenium lance et dirige le navigateur de votre
environnement, remplaÃ§ant l&#8217;utilisateur humain.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Le grand intÃ©rÃªt de cette approche par rapport Ã  de nombreux autres
outils de test est que l&#8217;on peut tester une application web dans un
vÃ©ritable navigateur, avec ses particularitÃ©s, ses bogues, sa faÃ§on bien
Ã  lui d&#8217;interprÃ©ter les balises HTML et le code JavaScript.</p>
</div>
<div class="paragraph">
<p>L&#8217;enregistreur peut sauvegarder le scÃ©nario de test selon de nombreux
formats, dont deux vont particuliÃ¨rement nous intÃ©resser. Le premier est
une simple table HTML, listant les actions rÃ©alisÃ©es sur le navigateur
(cliquer, attendre la page suivanteâ¦). Le second utilise notre bon vieux
langage Java et le framework de test jUnit. Cette seconde option nous
permet dâÃ©diter le scÃ©nario pour y ajouter les contrÃ´les qui nous
plaisent en utilisant notre langage de programmation habituel. Nous
n&#8217;avons donc pas Ã  apprendre les secrets d&#8217;un nouveau langageÂ !</p>
</div>
<div class="paragraph">
<p>Le Listing 8.3 montre le code d&#8217;un test Selenium utilisant la syntaxe
Java. Du point de vue du programmeur, l&#8217;API de Selenium offre une vision
de trÃ¨s haut niveau du navigateur sous contrÃ´le, ce qui rend la
programmation trÃ¨s rapide et agrÃ©able.</p>
</div>
<div class="listingblock">
<div class="title">Listing 8.3 : Test Selenium en syntaxe Java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import com.thoughtworks.selenium.*;
import junit.framework.*;
import java.util.regex.Pattern;

public class SimpleTest extends SeleneseTestCase
{
    public void setUp()
    {
        setUp( "http://localhost:8080/", "*iexplore" );
        selenium.open( "noubliepaslalistedescourses.home" );
    }
    public void testLogin()
    {
        selenium.type( "login", "Vincent" );
        selenium.click( "submit" );
        selenium.waitForPageToLoad( "5000" );
        assertTrue( selenium.isElementPresent( "salut" ) );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Si la syntaxe du test est celle de jUnit, l&#8217;exÃ©cution d&#8217;un test Selenium
nÃ©cessite un peu plus que le simple framework de test. Selenium repose
sur un composant contrÃ´leur, chargÃ© de lancer le navigateur de la
machine hÃ´te et d&#8217;en piloter le comportement. Nous devons donc intÃ©grer
le dÃ©marrage de ce contrÃ´leur dans notre processus de construction Maven
si nous voulons en exploiter la puissanceÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>DÃ©marrer la</strong> partie serveur (le contrÃ´leur) de Selenium. Elle va
permettre de faire le lien entre le test et le navigateur.</p>
</li>
<li>
<p>Lancer le navigateur disponible sur la plateforme.</p>
</li>
<li>
<p><strong>ExÃ©cuter le test</strong> sur le navigateur sous le contrÃ´le du serveur.</p>
</li>
<li>
<p>Collecter le rÃ©sultat du test et le consolider pour l&#8217;intÃ©grer
dans les comptes-rendus d&#8217;exÃ©cution de Maven (et faire Ã©chouer le build
si les tests ne passent pas).</p>
</li>
<li>
<p><strong>Fermer le navigateur</strong> et arrÃªter le serveur pour libÃ©rer
correctement les ressources de la machine hÃ´te.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Le plugin selenium vient Ã  notre secoursÂ : il propose deux tÃ¢ches
complÃ©mentaires, chargÃ©es de faire dÃ©marrer et d&#8217;arrÃªter proprement le
contrÃ´leur Selenium, respectivement au cours des phases
pre-integration-test et post-integration-test. Ce qui nous laisse donc
la phase integration-test pour exÃ©cuter nos tests, comme Ã§a tombe bienÂ !</p>
</div>
<div class="paragraph">
<p>Nous l&#8217;avons vu, Selenium peut stocker les scÃ©narios sous forme de
fichiers HTML. Le plugin selenium propose une tÃ¢che dÃ©diÃ©e Ã  ce format
qui permet de les exÃ©cuter au cours du build Maven. Il est donc facile
d&#8217;outiller une application de tests de non-rÃ©gressionÂ : il suffit
d&#8217;enregistrer des scÃ©narios au format HTML et d&#8217;ajouter la configuration
du Listing 8.4Â ; les tests seront alors rejouÃ©s Ã  l&#8217;identique Ã  chaque
construction complÃ¨te du projet.</p>
</div>
<div class="listingblock">
<div class="title">Listing 8.4 : Configuration du plugin Selenium</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
    &lt;artifactId&gt;selenium-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;1.0-rc-1&lt;/version&gt;
    &lt;executions&gt;
      &lt;execution&gt;
        &lt;phase&gt;integration-test&lt;/phase&gt;
        &lt;goals&gt;
          &lt;goal&gt;selenese&lt;/goal&gt;
        &lt;/goals&gt;
      &lt;/execution&gt;
    &lt;/executions&gt;
    &lt;configuration&gt;
      &lt;browser&gt;*firefox&lt;/browser&gt;
      &lt;startURL&gt;localhost:8080/myApp&lt;/startURL&gt;
      &lt;suite&gt;src/test/selenium/suite.html&lt;/suite&gt;
    &lt;/configuration&gt;
  &lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>La seconde option, fondÃ©e sur l&#8217;enregistrement et l&#8217;enrichissement
Ã©ventuel de nos scÃ©narii de test au format jUnit, va utiliser le plugin
standard surefire pour l&#8217;exÃ©cution des tests. Il sera simplement
configurÃ© de maniÃ¨re spÃ©cifique pour s&#8217;exÃ©cuter lors de la phase
integration-test.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaVincentS.png" alt="MangaVincentS"></span></p>
</div>
<div class="paragraph">
<p>MagiqueÂ ! Vincent s&#8217;empresse d&#8217;ajouter Ã  notre projet le plugin surefire
â qui prend en charge l&#8217;exÃ©cution de tests jUnit â et de l&#8217;associer Ã 
cette phase de test d&#8217;intÃ©gration. SitÃ´t dit, sitÃ´t fait, mais lÃ  gros
problÃ¨meÂ : nos tests sont exÃ©cutÃ©s avant que le contrÃ´leur Selenium ne
dÃ©marre. Nous l&#8217;avions oubliÃ©, mais Surefire est dÃ©jÃ  configurÃ© pour
s&#8217;exÃ©cuter au cours de la construction de notre projet, car c&#8217;est lui
qui est chargÃ© de l&#8217;exÃ©cution de nos tests unitaires, et il ne sait pas
diffÃ©rencier sans notre aide les tests Selenium des tests plus
classiques.</p>
</div>
<div class="paragraph">
<p>Une premiÃ¨re solution est d&#8217;utiliser des rÃ¨gles de nommage pour
diffÃ©rencier facilement les deux catÃ©gories de tests. Nous n&#8217;avons alors
qu&#8217;Ã  configurer Surefire avec des patrons complÃ©mentaires
d&#8217;inclusion/exclusion pour que chaque test se dÃ©roule dans la phase
adÃ©quate. Le Listing 8.5 montre la configuration dans le fichier POM qui
met en Åuvre cette stratÃ©gie. Les tests Selenium sont suffixÃ©s Selenium
au lieu de Test pour les diffÃ©rencier.</p>
</div>
<div class="listingblock">
<div class="title">Listing 8.5 : Configuration du plugin Surefire pour exÃ©cuter nos tests Selenium</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">  &lt;plugin&gt;
    &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
    &lt;executions&gt;
      &lt;execution&gt;
       &lt;id&gt;integration-test&lt;/id&gt;
       &lt;goals&gt;
         &lt;goal&gt;test&lt;/goal&gt;
       &lt;/goals&gt;
       &lt;phase&gt;integration-test&lt;/phase&gt;
       &lt;configuration&gt;
         &lt;includes&gt;
           &lt;include&gt;**/*Selenium.java&lt;/include&gt;
         &lt;/includes&gt;
       &lt;/configuration&gt;
      &lt;/execution&gt;
    &lt;/executions&gt;
  &lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Une autre solution consiste Ã  crÃ©er un second projet, destinÃ© aux tests
d&#8217;intÃ©gration, dans lequel nous les placerons, ce qui Ã©vite toute
ambiguÃ¯tÃ©. La configuration est alors plus simple, et nous disposons
d&#8217;un emplacement dÃ©diÃ© pour la dÃ©finition de nos tests d&#8217;intÃ©gration.</p>
</div>
<div class="paragraph">
<p>Les deux approches sont valides et couramment appliquÃ©es selon les goÃ»ts
de chacun. La premiÃ¨re utilise de maniÃ¨re assez logique les phases
*integrations-test de Maven, la seconde isole cette catÃ©gorie de tests
un peu hors normes dans un projet dÃ©diÃ© qui concerne une catÃ©gorie
diffÃ©rente de dÃ©veloppeurs.</p>
</div>
<div class="paragraph">
<p>Nous savons donc lancer un navigateur et lui faire suivre un scÃ©nario
prÃ©dÃ©fini. Reste Ã  le faire pointer vers notre application. Mais au
fait, oÃ¹ est-elle notre applicationÂ ? Nous avons bien une archive WAR,
mais sans serveur oÃ¹ la dÃ©ployer, elle nâaffichera jamais de page HTMLÂ !</p>
</div>
</div>
<div class="sect3">
<h4 id="_cargo">Cargo</h4>
<div class="paragraph">
<p>Cargo <sup class="footnote">[<a id="_footnoteref_33" class="footnote" href="#_footnotedef_33" title="View footnote.">33</a>]</sup> est un autre outil majeur pour notre boÃ®te Ã 
outils de test. Son objectif est de prendre en charge l&#8217;installation
d&#8217;un serveur JavaEE, sa configuration, son dÃ©marrage et le dÃ©ploiement
de composants JavaEE, le tout pour tous les serveurs existants (Ã 
l&#8217;exception notable de Websphere, rÃ©calcitrant Ã  toutes les tentatives)
et <em>via</em> une API simple et homogÃ¨ne â vaste programmeÂ !</p>
</div>
<div class="paragraph">
<p>Dans notre cas, nous allons utiliser Cargo pour exÃ©cuter notre
application sur un serveur JBoss. L&#8217;automatisation quâoffre cet outil
par le biais de son plugin Maven est telle qu&#8217;il propose de tÃ©lÃ©charger
pour nous le ZIP de ce serveur, de l&#8217;installer dans un rÃ©pertoire
temporaire et d&#8217;en configurer une instance Ã  la demande lors de la
construction de notre projet. Tout Ã§a en une seule ligne de commande,
c&#8217;est tout de mÃªme pas mal. Bien sÃ»r, la configuration est un peu moins
facile que pour un plugin plus Â«Â simpleÂ Â» (voir Listing 8.6). Cet extrait
de notre POM dÃ©finit les paramÃ¨tres d&#8217;utilisation de Cargo :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>L&#8217;exÃ©cution lors des phases pre-integration-test et
post-integration-test pour installer, configurer et dÃ©marrer puis
arrÃªter proprement le serveur.</p>
</li>
<li>
<p>L&#8217;identification du serveur utilisÃ©, <em>via</em> la clÃ© jboss42x, et des
rÃ©pertoires de travail, de log ainsi que de l&#8217;emplacement depuis lequel
l&#8217;archive sera tÃ©lÃ©chargÃ©e.</p>
</li>
<li>
<p>La configuration du serveur et de la machine virtuelle Java qui va
l&#8217;exÃ©cuter.</p>
</li>
<li>
<p>Les composants JavaEE qui seront dÃ©ployÃ©s sur ce serveur avant de
passer Ã  la phase integration-test. Nous indiquons l&#8217;artefact de notre
application web ainsi qu&#8217;un fichier XML, dans un format spÃ©cifique de
JBoss, qui nous permet de dÃ©finir l&#8217;accÃ¨s Ã  notre base de donnÃ©es de
test.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 8.6 : Configuration du plugin Cargo</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
  &lt;!--
  DÃ©marrage d'un serveur JBoss 4.0.2 et dÃ©ploiement de l'appli web
  @see http://cargo.codehaus.org/Starting+and+stopping+a+container
   --&gt;
  &lt;groupId&gt;org.codehaus.cargo&lt;/groupId&gt;
  &lt;artifactId&gt;cargo-maven2-plugin&lt;/artifactId&gt;
  &lt;version&gt;1.0&lt;/version&gt;
  &lt;executions&gt;
    &lt;!-- dÃ©marrage et arrÃªt du serveur lors d'un mvn:install --&gt;
    &lt;execution&gt;
      &lt;id&gt;start-container&lt;/id&gt;
      &lt;phase&gt;pre-integration-test&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;start&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;
    &lt;execution&gt;
      &lt;id&gt;stop-container&lt;/id&gt;
      &lt;phase&gt;post-integration-test&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;stop&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
  &lt;configuration&gt;
    &lt;container&gt;
      &lt;!-- Configuration du serveur ("container") pilotÃ© par Cargo --&gt;
      &lt;containerId&gt;jboss42x&lt;/containerId&gt;
      &lt;zipUrlInstaller&gt;
        &lt;url&gt;http://downloads.sourceforge.net/jboss/jboss-4.0.2.zip&lt;/url&gt;
        &lt;installDir&gt;${java.io.tmpdir}/cargoinstalls&lt;/installDir&gt;
      &lt;/zipUrlInstaller&gt;
      &lt;timeout&gt;600000&lt;/timeout&gt;
      &lt;output&gt;${project.build.directory}/jboss42x.log&lt;/output&gt;
      &lt;append&gt;true&lt;/append&gt;
      &lt;log&gt;${project.build.directory}/cargo.log&lt;/log&gt;
      &lt;dependencies&gt;
        &lt;!-- Ajout du driver de la base de donnÃ©es --&gt;
        &lt;dependency&gt;
          &lt;groupId&gt;com.oracle&lt;/groupId&gt;
          &lt;artifactId&gt;ojdbc14&lt;/artifactId&gt;
        &lt;/dependency&gt;
      &lt;/dependencies&gt;
    &lt;/container&gt;
    &lt;!-- Configuration du dÃ©ploiement de l'application web --&gt;
    &lt;configuration&gt;
      &lt;type&gt;standalone&lt;/type&gt;
      &lt;home&gt;${project.build.directory}/jboss42x&lt;/home&gt;
      &lt;properties&gt;
        &lt;cargo.logging&gt;high&lt;/cargo.logging&gt;
        &lt;cargo.jvmargs&gt;
          -XX:PermSize=512m -XX:MaxPermSize=1024
          -XX:+CMSPermGenSweepingEnabled
          -XX:+CMSClassUnloadingEnabled
        &lt;/cargo.jvmargs&gt;
&lt;!â
   Quoi, vous ne connaissiez pas l'option CMSClassUnloadingEnabled ? ;p
--&gt;
      &lt;/properties&gt;
      &lt;deployables&gt;
        &lt;deployable&gt;
          &lt;!-- DÃ©ploiement d'une DataSource JDBC Oracle --&gt;
         &lt;location&gt;${build.testOutputDirectory}/oracle-ds.xml&lt;/location&gt;
          &lt;type&gt;file&lt;/type&gt;
        &lt;/deployable&gt;
        &lt;deployable&gt;
          &lt;!-- DÃ©ploiement de notre application web --&gt;
          &lt;groupId&gt;fr.noubliepaslalistedescourses&lt;/groupId&gt;
          &lt;artifactId&gt;noubliepaslalistedescourses&lt;/artifactId&gt;
          &lt;type&gt;war&lt;/type&gt;
        &lt;/deployable&gt;
      &lt;/deployables&gt;
    &lt;/configuration&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaVincentS.png" alt="MangaVincentS"></span></p>
</div>
<div class="paragraph">
<p>AprÃ¨s avoir ingurgitÃ© la hiÃ©rarchie un peu lourde de cette configuration
XML, Vincent lance la commande magique <code>mvn install</code> et constate avec
plaisir le tÃ©lÃ©chargement puis le dÃ©marrage d&#8217;un serveur JBoss sur son
environnement, et le dÃ©ploiement de notre application, prÃªte pour les
tests Selenium qui ont enfin du grain Ã  moudre.</p>
</div>
<div class="paragraph">
<p>Nous nous serions bien contentÃ©s de cette solution, mais Vincent est un
perfectionniste. Tout ce XML, toute cette mÃ©canique, pour tester un bout
de code JavaEE Ã§a lui semble dÃ©mesurÃ©. Cargo fait trÃ¨s bien son boulot,
mais nâest quâun outil de dÃ©ploiement. Il faut lui greffer une bonne
dose de complexitÃ© pour en faire un outil de pilotage de nos tests
dâintÃ©gration.</p>
</div>
<div class="paragraph">
<p>Notre projet EJB est un Ã©lÃ©ment assez dÃ©licat Ã  tester confortablement.
Le cycle de vie de l&#8217;EJB doit Ãªtre respectÃ© pour que son code fonctionne
et il repose sur la fourniture par l&#8217;environnement de ressources gÃ©rÃ©es
par le serveur. Nous avons dÃ©coupÃ© notre code pour pouvoir tester
unitairement les aspects essentiels, mais nous voudrions pouvoir
lâexÃ©cuter en mode EJB rÃ©el, au moins pour quelques tests dâintÃ©gration.</p>
</div>
<div class="paragraph">
<p>Une fois de plus, la force d&#8217;une norme comme JavaEE va apporter des
solutions. Comme nous ne dÃ©veloppons pas du code dÃ©pendant d&#8217;un serveur
particulier, nous pouvons le changer d&#8217;environnement pour le tester. La
portabilitÃ© est garantie par la certification JavaEE qui valide le
respect de la norme par chaque serveur JavaEE candidat.</p>
</div>
<div class="paragraph">
<p>OpenEJB nous propose de dÃ©ployer notre EJB dans un environnement
particuliÃ¨rement lÃ©ger, Ã  tel point qu&#8217;on peut facilement l&#8217;intÃ©grer
dans un test unitaire. La seule chose que nous ayons Ã  faire, c&#8217;est de
lancer l&#8217;annuaire JNDI d&#8217;OpenEJB, qui se chargera automatiquement dans
la foulÃ©e. Le Listing 8.7 montre, par exemple, le code excessivement
complexe J qui permet de lancer notre EJB au sein d&#8217;un test unitaire.</p>
</div>
<div class="listingblock">
<div class="title">Listing 8.7 : Lancement d&#8217;OpenEJB embarquÃ© dans un test</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Test
Public void testMonEJB() throws Exception
{
    Properties p = new Properties();
    p.setProperty( Context.INITIAL_CONTEXT_FACTORY,
        "org.apache.openejb.client.LocalInitialContextFactory" );
     InitialContext ctx = new InitialContext( p );
     MonEjb ejb = (MonEjb) ctx.lookup( "MonEJBLocalBean" );
     // Test sur l'ejb...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Plus d&#8217;excuses pour ne pas dÃ©velopper une couverture de test de qualitÃ©
autour de nos composants mÃ©tierÂ !</p>
</div>
<div class="paragraph">
<p>Ce dernier exemple montre qu&#8217;il ne faut pas tout attendre des plugins
Maven, et que de nombreux outils fournissent des moyens de tester notre
code dans des conditions confortables directement depuis nos tests
jUnit. Le dÃ©ploiement sur un serveur, mÃªme pilotÃ© par Cargo, reste une
opÃ©ration lourde que nous rÃ©servons aux tests fonctionnels ou aux tests
de charge.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_arquillian">Arquillian</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaVincentS.png" alt="MangaVincentS"></span></p>
</div>
<div class="paragraph">
<p>Vincent nâest cependant pas totalement satisfait de devoir tester du
code destinÃ© Ã  JBoss (notre serveur de production) sur OpenEJB. Certes
la norme JavaEE dÃ©finit le comportement attendu sur tous les serveurs
certifiÃ©s, mais la pratique rÃ©serve gÃ©nÃ©ralement de mauvaises surprises,
et nous voudrions Ã©viter de nous en rendre compte le jour de la mise en
production.</p>
</div>
<div class="paragraph">
<p>Vincent nous dÃ©niche alors un projet prometteurÂ : JBoss Arquillian.
ConÃ§u comme un outil de test, Arquillian prend en charge
lâinstrumentation des tests, le dÃ©ploiement sur le serveur et la capture
des rÃ©sultats. Du tout en un, avec en plus une petite dose de modernitÃ©
qui fait dÃ©faut Ã  CargoÂ : la possibilitÃ© de faire fonctionner le serveur
en mode embarquÃ©, accÃ©lÃ©rant sensiblement les tests.</p>
</div>
<div class="paragraph">
<p>Reprenons donc notre EJB ListeDeCoursesBean, et faisons appel Ã 
Arquillian pour le tester sur un serveur JBoss. Du cÃ´tÃ© de notre bluid
Maven, lâajout de la dÃ©pendance adÃ©quate sâimpose de lui mÃªme :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
   &lt;groupId&gt;org.jboss.arquillian&lt;/groupId&gt;
   &lt;artifactId&gt;arquillian-junit&lt;/artifactId&gt;
   &lt;version&gt;1.0.0.Alpha5&lt;/version&gt;
   &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Quelques annotations dans une classe de test jUnit suffisent pour
rÃ©diger notre test dâEJBÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RunWith( Arquillian.class )

public class ListeDeCoursesBeanTest {

   @Deployment
   public static JavaArchive createTestArchive() {
      return ShrinkWrap.create( JavaArchive.class,
         "test.jar")
         .addClasses( ListeDeCourses.class );
   }

   @EJB
   private ListeDeCourses bean;

   @Test
   public void listeVide() throws Exception {
      Assert.assertTrue( bean.isEmpty( "user" ) );
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>En dehors de la mÃ©thode createTestArchive, qui prÃ©pare un test.jar
contenant notre bean EJB, rien de bien surprenant. La classe ShrinkWrap
permet de composer le contenu de notre jar de test, en y incluant notre
code et, au besoin, des fichiers de ressources (par exemple un fichier
beans.xml pour activer lâinjection de dÃ©pendances CDI).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Si vous avez exclu le terme EJB de votre vocabulaire depuis lâÃ©poque
J2EEÂ 1.4, nous vous recommandons de jeter un Åil rapide Ã  la norme JavaÂ EEÂ 6 et EJBÂ 3.1. Les EJB Â«Â nouvelle modeÂ Â» nâont mÃªme plus besoin de XML
ou de multiples interfaces pour embarquer du code mÃ©tier. Pour en savoir
plus, courrez chez votre libraire pour commander le livre dâAntonio
Goncalves JavaÂ EEÂ 6 et GlassfishÂ 3 chez le mÃªme Ã©diteur.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Pour lancer notre test, nous devons fournir Ã  Arquillian les billes
nÃ©cessaires au lancement du serveur JavaEE cible. Si Arquillian est
dÃ©veloppÃ© par JBoss, il nâest pas limitÃ© Ã  ce serveur et supporte dÃ©jÃ 
dâautres environnements, comme OpenWebBeans ou Weld, lâimplÃ©mentation de
rÃ©fÃ©rence de CDI que vous retrouvez dans GlassFishÂ 3. Comme nous
cherchons Ã  nous dÃ©marquer de Cargo, nous allons tenter dâutiliser le
mode embarquÃ© de JBossÂ 6. Arquillian dÃ©tecte le serveur cible en se
basant sur les librairies disponibles dans le projet; il nous suffit
donc dâajouter les dÃ©pendances JBoss adaptÃ©es, Ã  savoir le composant
apportant le support de JBossÂ 6 en mode embarquÃ©Â :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.jboss.arquillian.container&lt;/groupId&gt;
    &lt;artifactId&gt;arquillian-jbossas-embedded-6&lt;/artifactId&gt;
    &lt;version&gt;1.0.0.Alpha4&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cette configuration Ã©tant en place, il ne nous reste plus quâÃ  invoquer
le bon vieux <code>mvn install</code> pour que notre code EJB soit compilÃ© et testÃ©,
comme le reste de notre projet. Nous pouvons tout aussi bien le lancer
dans notre IDE prÃ©fÃ©rÃ© sans la moindre configuration superflue.</p>
</div>
<div class="paragraph">
<p>Si le test reste sensiblement plus long quâun test unitaire
hors-conteneur JavaEE, nous avons rÃ©duit sensiblement la difficultÃ© pour
tester en environnement cible. Dâautant que, en utilisant des profils
adaptÃ©s, nous pourrions aussi bien exÃ©cuter le mÃªme test en dÃ©ployant
sur un serveur JBoss externe ou sur un autre environnement.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaVincentS.png" alt="MangaVincentS"></span></p>
</div>
<div class="paragraph">
<p>Vincent nâest pas un peu fier dâavoir rÃ©duit la complexitÃ© lÃ©gendaire de
JavaEE et des tests associÃ©s Ã  quelques API simples et cinq lignes de
XML. Ce qui nous amÃ¨ne Ã  rÃ©flÃ©chir Ã  notre productivitÃ© dans cet
environnementÂ : faire du dÃ©veloppement Java EE signifie-t-il forcÃ©ment
faire des choses complexes, contraignantes et consommatrices de tempsÂ ?</p>
</div>
</div>
<div class="sect2">
<h3 id="_soyons_pragmatiques_soyons_productifs">Soyons pragmatiques, soyons productifs</h3>
<div class="paragraph">
<p>Nous sommes devenus des cadors de JavaEE, avec une automatisation
complÃ¨te du processus d&#8217;assemblage et de test. Au quotidien, les choses
ne sont pourtant pas toujours aussi roses. Pour tester visuellement une
modification si mineure soit-elle sur une simple page JSP, nous devons
relancer une phase lourde d&#8217;assemblage et de dÃ©ploiement. L&#8217;attente est
longue, les nerfs en subissent les consÃ©quences et la productivitÃ©
s&#8217;Ã©croule.</p>
</div>
<div class="paragraph">
<p>Ce n&#8217;est pas la faute seulement du modÃ¨le JavaEE. S&#8217;il impose une structure
d&#8217;assemblage complexe qui alourdit notre processus, c&#8217;est Ã  nous de
trouver des outils qui proposent des raccourcis pour plus de
productivitÃ©. Respecter la norme JavaEE pour un serveur ne signifie pas
se limiter Ã  la norme JavaEE !</p>
</div>
<div class="sect3">
<h4 id="_une_application_web_sur_place">Une application web Â«Â sur placeÂ Â»</h4>
<div class="paragraph">
<p>Premier constat, pour tester notre modification de JSP, notre serveur
Tomcat va dÃ©compresser notre archive WAR, retrouvant ainsi exactement la
structure que le plugin war a construite dans notre rÃ©pertoire de
construction (target). Le mÃ©canisme de configuration de Tomcat permet de
pointer directement sur ce rÃ©pertoire, plutÃ´t que de passer par une
archive WAR.</p>
</div>
<div class="paragraph">
<p>Nous pouvons mÃªme faire mieuxÂ : pourquoi recopier notre JSP Ã  chaque
modification dans le rÃ©pertoire de construction alors que la structure
de l&#8217;application web existe quasiment sous src/main/webappÂ ? La seule
chose qui manque pour avoir une application web conforme JavaEE, ce sont
les rÃ©pertoires WEB-INF/classes et WEB-INF/lib. Sous rÃ©serve d&#8217;une
configuration correcte de notre gestionnaire de code source pour ignorer
ces deux rÃ©pertoires, il n&#8217;est pas compliquÃ© de construire ces deux
rÃ©pertoires manquants â et c&#8217;est d&#8217;ailleurs ce que propose le plugin war
avec sa tÃ¢che inplace.</p>
</div>
<div class="paragraph">
<p><code>mvn war:inplace</code> va prÃ©parer l&#8217;application web, prÃªte Ã  Ãªtre exÃ©cutÃ©e sur
un serveur d&#8217;application qui supporte ce mode de fonctionnement. Une
modification dans une page JSP sera alors appliquÃ©e immÃ©diatement, <em>via</em>
le mÃ©canisme de recompilation des JSP qui est intÃ©grÃ© Ã  tout serveur
JavaEE.</p>
</div>
</div>
<div class="sect3">
<h4 id="_une_application_web_sans_assemblage">Une application web sans assemblage</h4>
<div class="paragraph">
<p>Nous faisons de nets progrÃ¨s, mais nous devons encore invoquer une
commande Maven Ã  chaque Ã©dition d&#8217;une classe de l&#8217;application ou
relancer le serveur lorsqu&#8217;un fichier de configuration est modifiÃ©.</p>
</div>
<div class="paragraph">
<p>Le conteneur de servlets (comme Tomcat, ce n&#8217;est pas un serveur JavaEE
complet) Jetty propose un mode de fonctionnement particuliÃ¨rement adaptÃ©
Ã  notre utilisation. GrÃ¢ce Ã  un plugin dÃ©diÃ©, il se lance sur un projet
Maven sans nÃ©cessiter la moindre phase de prÃ©paration. Il rÃ©fÃ©rence
directement les bibliothÃ¨ques de notre dÃ©pÃ´t local, pointe sur notre
rÃ©pertoire de compilation (target/classes) et dÃ©marre l&#8217;application web
en un temps record avec la seule commande <code>mvn jetty:run</code>.</p>
</div>
<div class="paragraph">
<p>Jetty va encore plus loin car il peut fonctionner en mode scrutationÂ :
il va surveiller le rÃ©pertoire de compilation et identifier une
modification sur une classe ou sur un fichier de configuration. Il
lancera alors un rechargement immÃ©diat de l&#8217;application. La rÃ©activitÃ©
de l&#8217;environnement de dÃ©veloppement est alors excellenteÂ : lancement de
l&#8217;application en un minimum de temps et sans aucune prÃ©paration, prise
en compte rapide des modifications.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ne_plus_sortir_de_lide">Ne plus sortir de l&#8217;IDE</h4>
<div class="paragraph">
<p>Pour ceux qui n&#8217;apprÃ©cient pas la ligne de commande, les IDE ont
planchÃ©, de leur cÃ´tÃ©, sur le manque de productivitÃ© liÃ© au modÃ¨le
JavaEE. Eclipse Web Tools Platform se propose par exemple de redÃ©ployer
automatiquement l&#8217;application lors d&#8217;une modification, ce qui permet de
contrÃ´ler l&#8217;impact d&#8217;une modification sans intervention manuelle. Il
suffit de configurer le serveur cible pour qu&#8217;Eclipse prenne en charge
la procÃ©dure de redÃ©ploiement.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Web Tools Platform ne se limite pas Ã  JavaEE et couvre de nombreuses
technologies liÃ©es au Web. MÃªme si vous n&#8217;utilisez pas la fonctionnalitÃ©
de dÃ©ploiement, ce module d&#8217;extension d&#8217;Eclipse sera rapidement
indispensable pour Ã©diter convenablement les fichiers HTML, JSP, XML,
XSD, JavaScript, CSS, les contrats WSDL de services web et dâautres
formats normalisÃ©s, sans parler des petits outils bien pratiques comme
l&#8217;espion TCP/IP ou le client graphique de service web.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>L&#8217;Ã©quipe de dÃ©veloppement de m2eclipse a eu pitiÃ© des dÃ©veloppeurs et
leur Ã©vite de devoir configurer chaque projet pour adapter la
configuration WTP Ã  leur projet Maven. <em>Via</em> une extension optionnelle,
m2eclipse dÃ©clarera automatiquement les modules war comme projets WTP
avec les chemins et les dÃ©pendances extraites de la configuration du
plugin war. Elle est pas belle la vieÂ ?</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaNicolas.png" alt="MangaNicolas"></span></p>
</div>
<div class="paragraph">
<p>Histoire de ne pas faire comme tout le monde, Nicolas n&#8217;utilise pas WTP
sous Eclipse mais un petit plugin <em>Made in France</em>Â : Sysdeo Tomcat,
distribuÃ© par le site de veille technologique www.eclipsetotale.com. Ce
plugin tout simple permet de lancer un serveur Tomcat, qui a l&#8217;avantage
d&#8217;Ãªtre lÃ©ger et rapide Ã  dÃ©marrer et largement suffisant tant qu&#8217;on
n&#8217;exploite que les technologies de l&#8217;API servlet, ce qui est le cas
d&#8217;une grande majoritÃ© des applications web.</p>
</div>
<div class="paragraph">
<p>Ce plugin pour Eclipse a son pendant pour Maven <sup class="footnote">[<a id="_footnoteref_34" class="footnote" href="#_footnotedef_34" title="View footnote.">34</a>]</sup>,
lequel va configurer le plugin Eclipse en fonction du projet Maven et
des multiples modules impliquÃ©s. Ce plugin Eclipse a la particularitÃ©
d&#8217;exploiter la souplesse de Tomcat pour pointer sur les rÃ©pertoires de
compilation de chaque module prÃ©sent dans l&#8217;IDE plutÃ´t que sur l&#8217;archive
JAR qu&#8217;il produit. Une modification dans un module est donc exploitable
sans manipulation particuliÃ¨re de l&#8217;IDE qui se contente de recompiler,
aprÃ¨s que vous avez simplement cliquÃ© sur le bouton relancer Tomcat.</p>
</div>
<div class="paragraph">
<p>Cette combinaison apporte un support limitÃ© de JavaEE, mais permet de
bÃ©nÃ©ficier d&#8217;un environnement lÃ©ger et raisonnablement rÃ©actif. Elle
montre surtout que WTP a ratÃ© sa cible en apportant certes le support
JavaEE sous Eclipse, mais en choisissant la voix la moins productive.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>La seule option pour aller encore plus vite est de permettre la
modification Ã  chaud des classes de l&#8217;application web, ce qui Ã©conomise
le temps de rechargement de l&#8217;application. Le HotSwap de la machine
virtuelle Java permet cette opÃ©ration avec des contraintes assez fortes,
mais un outil comme JRebel de ZeroTurnaroud permet quasiment de modifier
Ã  chaud tous les Ã©lÃ©ments de l&#8217;application web, y compris les fichiers
de configuration des frameworks courants comme Struts ou Spring.</p>
</div>
<div class="paragraph">
<p>Il sâinstalle dans votre IDE sous forme de plugin et ajoute une petite
option magique. Au lancement de lâapplication, quelques logs indiquent
que JRebel est intÃ©grÃ© et les plugins quâil a activÃ©s en fonction des
technologies utilisÃ©es dans le projet (Spring, Wicket, Hibernate, etc).
En dehors de cela, rien de notableâ¦ sauf que lâapplication prend en
compte toutes vos modifications de code ou de configuration sans dÃ©laiÂ !</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_javaee6">JavaEE6</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaAntonio.png" alt="MangaAntonio"></span></p>
</div>
<div class="paragraph">
<p>Venu nous passer un petit bonjour, Antonio s&#8217;amuse bien en voyant notre
configuration Maven pour construire cette belle archive d&#8217;entreprise EAR
qui nous a coÃ»tÃ© tant d&#8217;efforts. Pourquoi ce sourire moqueurÂ ? Antonio
travaille de son cÃ´tÃ© sur une application JavaEE6, et les Ã©volutions
liÃ©es Ã  cette version de la norme font de notre construction Ã  trois
modules (EJB + WAR + EAR) un amusant pachyderme en voie de disparition.</p>
</div>
<div class="paragraph">
<p>Dans sa sixiÃ¨me Ã©dition majeure, la norme JavaEE fait peau neuve.
AiguillonnÃ© par les solutions alternatives plus lÃ©gÃ¨res proposÃ©es par
des outils Open Source, et en particulier par le succÃ¨s massif de
SpringFramework, le groupe d&#8217;experts qui dÃ©finit cette norme a donnÃ© une
nouvelle impulsion qui influe fortement sur la faÃ§on de dÃ©velopper pour
la plateforme JavaEE.</p>
</div>
<div class="paragraph">
<p>Parmi les nombreuses nouveautÃ©s introduites pour simplifier le
dÃ©veloppement, allÃ©ger la construction d&#8217;une application ou dÃ©finir des
comportements par dÃ©faut qui Ã©vitent une longue phase de configuration,
l&#8217;assemblage d&#8217;une application JavaEE a Ã©tÃ© fortement revu.</p>
</div>
<div class="paragraph">
<p>Les EJB nouvelle mouture ne doivent plus nÃ©cessairement Ãªtre placÃ©s dans
une archive JAR dÃ©diÃ©e, puis groupÃ©s dans un EAR avec l&#8217;application web
WAR. Ce jeu de poupÃ©es gigognes peut laisser place Ã  une simple archive
WAR dans laquelle sont placÃ©s les EJB, dont les annotations suffisent Ã 
dÃ©finir le comportement vis-Ã -vis du conteneur. Le descripteur de
dÃ©ploiement ejb-jar.xml, devenu optionnel, peut Ãªtre placÃ© directement
sous WEB-INF.</p>
</div>
<div class="paragraph">
<p>Les nouveautÃ©s de JavaEE6 vont bien au-delÃ  de ces quelques
assouplissements d&#8217;assemblage, mais, au niveau de la construction du
projet, c&#8217;est ce qui a le plus d&#8217;impact. Nous pouvons conserver notre
code mÃ©tier dans un module sÃ©parÃ© par souci de clarification du projet,
mais nous n&#8217;avons plus besoin de dÃ©finir un module juste pour construire
une archive EAR. Nous pouvons aussi dÃ©ployer notre application sur un
serveur GlassFish (qui est l&#8217;implÃ©mentation de rÃ©fÃ©rence de la norme
JavaEE6) sans avoir besoin d&#8217;assembler notre WARÂ : il nous suffit de
configurer le mode inplace sur notre application web et de lancer le
serveur. Notre EJB bÃ©nÃ©ficie d&#8217;un serveur JavaEE complet, y compris la
gestion du cycle de vie, l&#8217;enrobage transactionnel ou encore la
persistance JPA.</p>
</div>
<div class="paragraph">
<p>Nous pouvons mÃªme faire encore mieux en exploitant le plugin Maven pour
GlassFish <sup class="footnote">[<a id="_footnoteref_35" class="footnote" href="#_footnotedef_35" title="View footnote.">35</a>]</sup>, qui propose un mode de fonctionnement
Ã©quivalent Ã  ce que nous avons vu pour Jetty. Il suffit de lancer une
simple commande Maven pour que le serveur soit tÃ©lÃ©chargÃ© et quâil
dÃ©marre en embarquant notre application telle qu&#8217;elle est dans notre
IDE, sans assemblage d&#8217;un WAR ou autre perte de temps.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_7">Conclusion</h3>
<div class="paragraph">
<p>La norme JavaEE peut paraÃ®tre complexe, encombrÃ©e de descripteurs XML et
d&#8217;archives imbriquÃ©es. Maven permet d&#8217;une part de prendre en charge de
maniÃ¨re transparente ses particularitÃ©s, mais surtout d&#8217;intÃ©grer un
ensemble de bonnes pratiques et d&#8217;outils qui simplifient les
dÃ©veloppements ou amÃ©liorent la productivitÃ©.</p>
</div>
<div class="paragraph">
<p>Une fois de plus, Maven ne fait que catalyser, grÃ¢ce Ã  une sÃ©rie de
plugins officiels ou externes, les bonnes idÃ©es de dÃ©veloppeurs du monde
entier. L&#8217;intÃ©gration en quelques lignes de XML des meilleurs outils du
moment est pour l&#8217;utilisateur final un confort sans prÃ©cÃ©dent.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chapitre_9maven_et_les_ide">Chapitre 9Â :Â Maven et les IDE</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nous avons jusqu&#8217;ici considÃ©rÃ© Maven comme un outil en ligne de
commande. Le dÃ©veloppement informatique est cependant depuis longtemps
assistÃ© par des environnements intÃ©grÃ©s toujours plus Ã©voluÃ©s (et
gourmands). L&#8217;adoption de Maven sur de nombreux projets pose donc le
problÃ¨me de sa bonne intÃ©gration dans nos outils de travail.</p>
</div>
<div class="paragraph">
<p>RÃ©guliÃ¨rement, nous voyons arriver de nouveaux dÃ©veloppeurs en renfort
ponctuel. Nous qui sommes plutÃ´t rÃ©ceptifs aux concepts Maven, nous
sommes confrontÃ©s chaque fois au rejet de cet outil en ligne de commande
et de ses messages parfois obscurs. Nous devons donc dÃ©finir de maniÃ¨re
plus pragmatique notre environnement de dÃ©veloppement pour fournir un
ensemble intÃ©grÃ© et adaptÃ© aux attentes des dÃ©veloppeurs.</p>
</div>
<div class="sect2">
<h3 id="_un_plugin_maven_pour_eclipse">Un plugin Maven pour Eclipse</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaArnaud.png" alt="MangaArnaud"></span></p>
</div>
<div class="paragraph">
<p>Arnaud a dans un premier temps tentÃ© de dÃ©velopper un plugin Maven dÃ©diÃ©
Ã  la configuration d&#8217;Eclipse, l&#8217;IDE le plus couramment utilisÃ© par les
dÃ©veloppeurs. L&#8217;idÃ©e est d&#8217;extraire du fichier POM toutes les
informations nÃ©cessaires pour configurer l&#8217;environnement Eclipse, ses
nombreuses fonctionnalitÃ©s et extensions.</p>
</div>
<div class="paragraph">
<p>Le format des fichiers de configuration de l&#8217;IDE n&#8217;Ã©tant pas trÃ¨s
complexe, Arnaud arrive assez vite Ã  un rÃ©sultat fonctionnel.
L&#8217;engouement des Ã©quipes permet d&#8217;amÃ©liorer les fonctionnalitÃ©s Ã  grande
vitesse, mais rapidement Arnaud croule sous les demandes parfois
contradictoires.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaNicolas.png" alt="MangaNicolas"></span></p>
</div>
<div class="paragraph">
<p>Nicolas utilise l&#8217;environnement de programmation par Aspect AJDT.
L&#8217;intÃ©gration d&#8217;AspectJ sous Eclipse qu&#8217;il propose en fait un outil
puissant. Arnaud ajoute les options et paramÃ¨tres nÃ©cessaires au plugin
pour crÃ©er les fichiers de configuration nÃ©cessaires et exclure
automatiquement la dÃ©pendance vers la bibliothÃ¨que runtime
aspectjrt.jar, qui est intÃ©grÃ©e dans AJDT. L&#8217;import des projets Maven se
passe bien, et Nicolas est satisfaitâ¦ jusqu&#8217;Ã  ce qu&#8217;il tente de dÃ©marrer
son serveur Web Tomcat.</p>
</div>
<div class="paragraph">
<p>java.lang.NoClassDefFoundError:
org/aspectj/weaver/reflect/ReflectionWorld$ReflectionWorldException</p>
</div>
<div class="paragraph">
<p>Ce n&#8217;Ã©tait pas, semble-t-il, une si bonne idÃ©e de tout miser sur AJDT.
Un magnifique hack permet de contourner le problÃ¨me en paramÃ©trant le
plugin avec ajdtVersion=none, afin de dÃ©sactiver artificiellement la
prise en compte d&#8217;AJDT dans le plugin eclipse. Le problÃ¨me est certes
corrigÃ©, mais la solution est loin d&#8217;Ãªtre satisfaisanteÂ ! Sans parler de
la faÃ§on dont nous allons devoir expliquer Ã§a dans la documentation du
plugin sans passer pour des sagouins.</p>
</div>
<div class="paragraph">
<p>Certains rÃ©clament le support du plugin Eclipse Machin Truc Muche,
d&#8217;autres rÃ©alisent leurs applications web <em>via</em> les Eclipse Web Tools.
Quelques-uns ont installÃ© EasyEclipse, une distribution de l&#8217;IDE
intÃ©grant une sÃ©lection de plugins, alors que les plus exigeants
prÃ©fÃ¨rent sÃ©lectionner eux-mÃªmes la composition de leur environnement.
Sans oublier les fans (ou victimes) d&#8217;IBM qui ne jurent que par RADÂ !</p>
</div>
<div class="paragraph">
<p>Assez rapidement, l&#8217;affluence des demandes dÃ©passe la capacitÃ© d&#8217;Arnaud
Ã  Ã©tablir une liste de prioritÃ©s et surtout Ã©puise sa bonne volontÃ©.
Eclipse n&#8217;est pas Ã  proprement parler un IDE mais plutÃ´t une plateforme
dÃ©rivÃ©e en presque autant de variantes qu&#8217;il y a de dÃ©veloppeurs. MalgrÃ©
ses efforts, la configuration d&#8217;Eclipse reste incomplÃ¨te et nÃ©cessite
encore et toujours soit des manipulations complÃ©mentaires dans l&#8217;IDE,
soit l&#8217;ajout de blocs entiers de configuration dans notre POM qui seront
copiÃ©s tels quels dans l&#8217;environnement de travail. Solution peu
satisfaisanteÂ !</p>
</div>
</div>
<div class="sect2">
<h3 id="_maven_vu_depuis_lide">Maven vu depuis l&#8217;IDE</h3>
<div class="paragraph">
<p>Loin de se dÃ©courager, Arnaud trouve encore du temps libre pour se
lancer dans l&#8217;Ã©valuation de la solution inverse : faire confiance Ã 
l&#8217;IDE pour analyser le fichier POM de Maven. Pour ne pas le laisser seul
dans cette lourde tÃ¢che â ou peut-Ãªtre par peur qu&#8217;il nous impose son
point de vue â, nous organisons un concours interneÂ : Eclipse vs
NetBeans vs Intellij Idea.</p>
</div>
<div class="paragraph">
<p>Chacun de ces environnements sera dÃ©fendu par son Â«Â cobayeÂ Â»Â : Nicolas
pour Eclipse, RaphaÃ«l pour NetBeans et StÃ©phane pour Idea. Le reste de
l&#8217;Ã©quipe jouant le rÃ´le du jury exigeant et impartial. Ã vos marques,
prÃªts, cliquez !</p>
</div>
<div class="paragraph">
<p>Notre concours repose sur quelques critÃ¨res pour ne pas fausser le jeuÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>transparence de l&#8217;import d&#8217;un projet Maven dans l&#8217;environnement de
dÃ©veloppementÂ ;</p>
</li>
<li>
<p>facilitÃ© de prise en mainÂ ;</p>
</li>
<li>
<p>gestion des mÃ©tadonnÃ©es du fichier POM en dehors du seul Ã©diteur
XMLÂ ;</p>
</li>
<li>
<p>intÃ©gration des plugins Maven dans la construction du projet par
l&#8217;environnement de dÃ©veloppementÂ ;</p>
</li>
<li>
<p>fonctionnalitÃ©s bonus.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_eclipse">Eclipse</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaNicolas.png" alt="MangaNicolas"></span></p>
</div>
<div class="paragraph">
<p>Notre premier candidat n&#8217;a pas eu la tÃ¢che facile, puisque ce n&#8217;est pas
une, mais deux solutions qu&#8217;il a dÃ» prÃ©senter Ã  un jury plutÃ´t
dubitatifÂ : la fondation Eclipse a acceptÃ© deux contributions
concurrentes visant Ã  fournir une intÃ©gration de Maven dans
l&#8217;environnement de dÃ©veloppement Ã©ponymeÂ : m2eclipse <sup class="footnote">[<a id="_footnoteref_36" class="footnote" href="#_footnotedef_36" title="View footnote.">36</a>]</sup>
et q4e (rebaptisÃ© pour l&#8217;occasion IAM <sup class="footnote">[<a id="_footnoteref_37" class="footnote" href="#_footnotedef_37" title="View footnote.">37</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>Ces deux contributions sont cependant relativement comparables et
destinÃ©es Ã  fusionner au sein de l&#8217;incubateur de la fondation Eclipse â
dans le meilleur des cas; la survie d&#8217;un seul des deux candidats est
plus probable. Nicolas s&#8217;est donc focalisÃ© sur m2eclipse (en version
0.9.8), qui propose rÃ©guliÃ¨rement de nouvelles versions, sachant que des
fonctionnalitÃ©s Ã©quivalentes sont disponibles ou planifiÃ©es chez son
concurrent avec une prÃ©sentation un peu diffÃ©rente. Le seul hic de ces
plugins est qu&#8217;ils alourdissent considÃ©rablement l&#8217;environnement de
dÃ©veloppement Eclipseâ¦</p>
</div>
<div class="sect3">
<h4 id="_installation">Installation</h4>
<div class="paragraph">
<p>Comme tout composant d&#8217;Eclipse, le support de Maven passe par
l&#8217;installation de plugins. Le mÃ©canisme de sites d&#8217;installation et de
mise Ã  jour permet d&#8217;effectuer l&#8217;opÃ©ration en quelques clics Ã  partir
d&#8217;une connexion Ã  Internet. Un redÃ©marrage est prÃ©fÃ©rable pour terminer
l&#8217;installation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_import_dun_projet_maven">Import d&#8217;un projet Maven</h4>
<div class="paragraph">
<p>L&#8217;import d&#8217;un projet Maven commence par un simple clic droit, qui lance
un assistant. L&#8217;utilisateur indique le chemin du projet, et le plugin
analyse le fichier POM, identifie correctement les rÃ©pertoires de code
source, ainsi que ceux associÃ©s Ã  des gÃ©nÃ©rateurs de code qu&#8217;il exÃ©cute
automatiquement. Il est Ã©galement capable de configurer l&#8217;environnement
de programmation orientÃ©e aspect AspectJ, si celui-ci est installÃ©, ou
d&#8217;Ã©tablir un lien avec les gestionnaires de code source CVS et
Subversion si le plugin adÃ©quat est installÃ© sous Eclipse.</p>
</div>
<div class="paragraph">
<p>AprÃ¨s import, l&#8217;ensemble des dÃ©pendances Maven apparaÃ®t dans un
conteneur dÃ©diÃ©, au cÃ´tÃ© de l&#8217;environnement d&#8217;exÃ©cution Java. L&#8217;IDE ne
diffÃ©rencie cependant pas les dÃ©pendances de scope test. D&#8217;un simple
clic, on peut demander au plugin de tÃ©lÃ©charger les archives de sources
des dÃ©pendances, ce qui permet le cas Ã©chÃ©ant de poser des points
d&#8217;arrÃªt avec le dÃ©bogueur dans les classes manipulÃ©es.</p>
</div>
<div class="paragraph">
<p>L&#8217;import peut Ã©galement s&#8217;effectuer directement depuis le gestionnaire
de code source dont on saisit l&#8217;URL. Cette possibilitÃ© est utilisÃ©e dans
une fonctionnalitÃ© annexe qui consiste Ã  matÃ©rialiser une dÃ©pendance
sous forme d&#8217;un nouveau projet dans l&#8217;environnement, Ã  condition bien
sÃ»r que la dÃ©pendance en question dÃ©clare dans son POM le chemin correct
de son gestionnaire de code source.</p>
</div>
<div class="paragraph">
<p>Dans tous les cas, les dÃ©pendances dont le projet est prÃ©sent dans
l&#8217;espace de travail d&#8217;Eclipse sont rÃ©fÃ©rencÃ©es comme projet, et non via
l&#8217;archive JAR, permettant de tester rapidement l&#8217;impact d&#8217;une
modification.</p>
</div>
</div>
<div class="sect3">
<h4 id="_prise_en_main">Prise en main</h4>
<div class="paragraph">
<p>Une nouvelle entrÃ©e dans le menu contextuel nous permet d&#8217;exÃ©cuter les
tÃ¢ches liÃ©es Ã  Maven. Nos projets Maven sont reconnus et dÃ©corÃ©s d&#8217;une
petite icÃ´ne Â«Â MÂ Â»Â ; quant Ã  notre POM, il a droit Ã  une icÃ´ne dÃ©diÃ©e qui
permet de facilement le diffÃ©rencier des autres fichiers du projet (voir
Figure 09-01).</p>
</div>
<div class="paragraph">
<div class="title">Figure 09-01</div>
<p><span class="image"><img src="illustrations/09-01.png" alt="09 01"></span></p>
</div>
<div class="paragraph">
<p>Un projet Maven vu sous Eclipse au travers de m2eclipse.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Le plugin peut Ãªtre configurÃ© pour utiliser votre propre installation de
Maven pour les tÃ¢ches courantes, mais dispose par dÃ©faut d&#8217;une copie
interne de Maven qu&#8217;il utilise pour analyser le fichier POM. Il s&#8217;agit
cependant d&#8217;une version de Maven 3.x encore en cours de dÃ©veloppement,
aussi il est prÃ©fÃ©rable pour Ã©viter toute mauvaise surprise de pointer
sur l&#8217;installation locale de Maven 2.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>L&#8217;utilisation courante de Maven est totalement enrobÃ©e dans des
assistants et la ligne de commande n&#8217;est plus du tout nÃ©cessaire. Maven
est automatiquement invoquÃ© lors des rafraÃ®chissements de
l&#8217;environnement de travail, permettant ainsi d&#8217;exÃ©cuter les tÃ¢ches
associÃ©es aux plugins en complÃ©ment de la compilation Java par l&#8217;IDE.
Les deux environnements se complÃ¨tent donc, Eclipse ne conservant Ã  sa
charge que la compilation des sources Java.</p>
</div>
</div>
<div class="sect3">
<h4 id="_gestion_du_pom">Gestion du POM</h4>
<div class="paragraph">
<p>Un Ã©diteur graphique est proposÃ© pour le POM. Il permet de saisir les
mÃ©tadonnÃ©es sans avoir Ã  se soucier de la structure XML sous-jacente. La
gestion des dÃ©pendances propose une assistance Ã  la saisie des
identifiants de groupe, d&#8217;artefact et de version, basÃ©e sur un index du
dÃ©pÃ´t de bibliothÃ¨que mis Ã  jour pÃ©riodiquement en tÃ¢che de fond. Un
onglet dÃ©diÃ© permet de consulter les dÃ©pendances du projet et
d&#8217;identifier le jeu de transitivitÃ© Ã  travers lequel elles apparaissent
dans le projet (voir Figure 09-02).</p>
</div>
<div class="paragraph">
<div class="title">Figure 09-02</div>
<p><span class="image"><img src="illustrations/09-02.png" alt="09 02"></span></p>
</div>
<div class="paragraph">
<p>Gestion des dÃ©pendances.</p>
</div>
<div class="paragraph">
<p>Une vue permet d&#8217;obtenir un graphe des dÃ©pendances. EsthÃ©tique, ce n&#8217;est
au mieux qu&#8217;un gadget pour impressionner ses collÃ¨gues et justifier son
statut d&#8217;expert Maven.</p>
</div>
<div class="paragraph">
<p>La vue XML bÃ©nÃ©ficie Ã©galement d&#8217;enrichissements par rapport Ã  l&#8217;Ã©diteur
XML de base. Elle permet de saisir rapidement les structures rÃ©pÃ©titives
du POM <em>via</em> un patron type, comme les &lt;dependency&gt; ou les &lt;execution&gt;,
ou d&#8217;inclure la configuration de quelques plugins rÃ©currents, comme pour
les plugins war ou aspectj. L&#8217;utilisateur peut d&#8217;ailleurs dÃ©finir ses
propres patrons pour les plugins ou structures XML qu&#8217;il utilise
rÃ©guliÃ¨rement. Comme dans l&#8217;Ã©diteur graphique, l&#8217;Ã©diteur XML propose une
assistance Ã  la saisie pour les identifiants de groupe, d&#8217;artefact et
les versions.</p>
</div>
<div class="paragraph">
<p>La configuration des plugins, qui se fait exclusivement dans la vue XML,
est, elle aussi, assistÃ©eÂ : m2eclipse identifie les paramÃ¨tres des
plugins et les propose par complÃ©tion automatique, ce qui Ã©vite de
devoir consulter la documentation et de faire une malheureuse faute de
frappe dans leur nom. La figure 09-03 montre m2eclipse en action
proposant cette assistance.</p>
</div>
<div class="paragraph">
<div class="title">Figure 09-03</div>
<p><span class="image"><img src="illustrations/09-03.png" alt="09 03"></span></p>
</div>
<div class="paragraph">
<p>Ãdition de la configuration des plugins.</p>
</div>
</div>
<div class="sect3">
<h4 id="integration_des_plugins_maven">IntÃ©gration des plugins Maven</h4>
<div class="paragraph">
<p>Lors de l&#8217;import du projet, m2eclipse lit la configuration de quelques
plugins clÃ©s pour adapter le paramÃ©trage du projet en consÃ©quence. Le
plugin compiler permet ainsi de dÃ©finir l&#8217;environnement d&#8217;exÃ©cution Java
associÃ© au projet. Ce support peut mÃªme Ãªtre Ã©tendu par des plugins
complÃ©mentaires qui exploitent les API de m2eclipse. C&#8217;est par exemple
le cas pour le plugin Eclipse-cs qui exploite la configuration du
plugin checkstyle de Maven pour aligner les deux environnements.</p>
</div>
<div class="paragraph">
<p>Lors de la construction du projet dans l&#8217;environnement de dÃ©veloppement,
m2eclipse exÃ©cute les plugins Maven associÃ©s aux premiÃ¨res phases du
cycle de vie, en particulier les gÃ©nÃ©rateurs de code et de ressources.
Cela lui permet d&#8217;identifier les rÃ©pertoires de code gÃ©nÃ©rÃ©, mais a pour
effet de bord d&#8217;Ãªtre assez fortement consommateur en ressourcesÂ : Ã 
chaque modification ou sauvegarde d&#8217;un fichier de ressource ou d&#8217;une
classe, l&#8217;IDE lance une construction qui se traduit donc par une
exÃ©cution de Maven. Selon le nombre de plugins concernÃ©s et leur
rapiditÃ©, cela peut vite devenir pÃ©nalisant comme le montre la
Figure 09-04Â : l&#8217;IDE se fige en attendant la fin de cette exÃ©cution, et
affiche le message trÃ¨s agaÃ§ant Â«Â user operation waiting for building
workspace to completeÂ Â». Il s&#8217;agit d&#8217;une limite de l&#8217;IDE dans sa gestion
des tÃ¢ches de fond et de la construction incrÃ©mentale des projets, et
celle-ci peut devenir trÃ¨s gÃªnante pour son utilisation quotidienne. Les
choses devraient aller mieux avec la prochaine version du plugin
m2eclipseâ¦</p>
</div>
<div class="paragraph">
<div class="title">Figure 09-04</div>
<p><span class="image"><img src="illustrations/09-04.png" alt="09 04"></span></p>
</div>
<div class="paragraph">
<p>Veuillez patienterâ¦</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>MÃªme si l&#8217;Ã©quipe Maven n&#8217;a pas les moyens de faire plier
significativement Eclipse Ã  ses usages, elle essaie de traiter ce
problÃ¨me Ã  son niveau. Des Ã©volutions sur quelques plugins clÃ©s et le
noyau de Maven permettent de mieux prendre en charge la compilation
incrÃ©mentale d&#8217;Eclipse, en n&#8217;exÃ©cutant que les tÃ¢ches spÃ©cifiques de
Maven et en laissant l&#8217;IDE prendre en charge toutes les Ã©tapes pour
lesquelles il propose une fonction Ã©quivalente.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_et_la_cerise">Et la ceriseâ¦</h4>
<div class="paragraph">
<p>Le plugin Maven vient complÃ©ter les fonctionnalitÃ©s de correction rapide
(Quick Fix) d&#8217;Eclipse. Lors de l&#8217;utilisation d&#8217;une classe non
rÃ©fÃ©rencÃ©e, dâun simple clic droit vous obtenez une liste de dÃ©pendances
qui dÃ©finissent la classe considÃ©rÃ©e (voir Figure 09-05). Il n&#8217;est donc
pas nÃ©cessaire de passer par l&#8217;Ã©dition du POM pour ajouter une
dÃ©pendance suite au copier-coller d&#8217;un fragment de code intÃ©ressant.</p>
</div>
<div class="paragraph">
<div class="title">Figure 09-05</div>
<p><span class="image"><img src="illustrations/09-05.png" alt="09 05"></span></p>
</div>
<div class="paragraph">
<p>Correction rapide par ajout d&#8217;une dÃ©pendance.</p>
</div>
<div class="paragraph">
<p>Pour finir sa dÃ©mo, Nicolas passe dans la vue dÃ©pendances, effectue une
recherche sur commons-logging et obtient au bout de quelques instants
une liste de bibliothÃ¨ques variÃ©es et les chemins par lesquels nous
rÃ©cupÃ©rons ce JAR controversÃ© dans notre projet. Un simple clic droit
permet de l&#8217;exclure en ajoutant les nombreuses exclusions qui
s&#8217;imposent. Ceux d&#8217;entre nous qui se sont dÃ©jÃ  battus avec la gestion
des dÃ©pendances de Maven, parfois un peu trop gÃ©nÃ©reuse, apprÃ©cient ce
raccourci.</p>
</div>
</div>
<div class="sect3">
<h4 id="_interrogations">Interrogations</h4>
<div class="paragraph">
<p>Les versions successives de m2eclipse apportent corrections et nouvelles
fonctionnalitÃ©s et montrent un rÃ©el dynamisme pour proposer une
intÃ©gration fiable et productive de Maven avec Eclipse. Il reste
cependant assez dÃ©concertant de voir deux plugins, dont l&#8217;architecture
est relativement incompatible, hÃ©bergÃ©s par l&#8217;incubateur de la fondation
Eclipse. Si quelques points de collaboration sont possibles, une fusion
pure est simple n&#8217;est pas envisageable. Que va-t-il en ressortir, et
surtout Ã  quelle Ã©chÃ©anceÂ ?</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_intellij_idea">Intellij Idea</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaStephane.png" alt="MangaStephane"></span></p>
</div>
<div class="paragraph">
<p>Notre deuxiÃ¨me candidat utilise l&#8217;environnement de dÃ©veloppement de
JetBrains, Intellij Idea. Outil mixte propriÃ©taire + opensource, Idea
part avec un petit handicap par rapport Ã  ses concurrents pour notre
jury, grand fan des logiciels libres, car la version Â« communautaire Â»
nâoffre que les fonctionnalitÃ©s de base. StÃ©phane a prÃ©vu le coup et
nous informe qu&#8217;une license Idea Â«Â ultimateÂ Â» (la version payante mais
ultracomplÃ¨te) est offerte aux dÃ©veloppeurs de projets open source
reconnus ainsi qu&#8217;en lot pour les Java User Group. Il a ainsi pu s&#8217;en
procurer une licence sans trop d&#8217;effort, sachant qu&#8217;on peut aussi tenter
l&#8217;aventure avec une version d&#8217;Ã©valuation. Le prix Ã  dÃ©bourser pour une
licence n&#8217;excÃ¨de de toute faÃ§on pas quelques centaines d&#8217;euros, Ã 
comparer au prix de la journÃ©e d&#8217;un consultant.</p>
</div>
<div class="sect3">
<h4 id="_import_dun_projet_maven_2">Import d&#8217;un projet Maven</h4>
<div class="paragraph">
<p>Idea Ã©tant, comme tous les IDE rÃ©cents, basÃ© sur des mÃ©canismes
d&#8217;extensions, il nous faut d&#8217;abord installer le plugin Maven. Cette
formalitÃ© rÃ©glÃ©e, il ne nous reste qu&#8217;Ã  demander l&#8217;import de notre
projet en indiquant son rÃ©pertoire racine (ou son URL Subversion), et Ã 
fournir quelques paramÃ¨tres de base comme le JDK Ã  utiliser et les
profils Maven Ã  activer dans notre environnement. On laisse ensuite
l&#8217;IDE analyser et indexer tous les Ã©lÃ©ments du projet et de ses
dÃ©pendances. Cette phase d&#8217;import peut Ãªtre assez longue et nous permet
de dÃ©couvrir un premier lot d&#8217;astuces d&#8217;Idea, ou encore de vÃ©rifier le
bon fonctionnement de la machine Ã  cafÃ©.</p>
</div>
<div class="paragraph">
<p>AprÃ¨s cette premiÃ¨re Ã©tape incontournable, Idea prÃ©sente chaque module
du projet comme un projet Java, en ayant identifiÃ© les rÃ©pertoires de
code gÃ©nÃ©rÃ©, le niveau de langage Ã  utiliser pour la syntaxe Java et
l&#8217;ensemble des dÃ©pendances. Comme sous m2eclipse, les rÃ©fÃ©rences
intermodules sont dÃ©finies comme telles (sans passer par l&#8217;archive
JAR), ce qui nous permettra d&#8217;Ã©diter librement les sources des
diffÃ©rents modules et de constater immÃ©diatement leur impact.</p>
</div>
<div class="paragraph">
<p>Jusqu&#8217;ici, notre projet Maven est donc parfaitement bien pris en charge
par l&#8217;environnement de dÃ©veloppement (voir Figure 09-06). Nos modules
sont clairement identifiÃ©s et prÃ©sentÃ©s dans une vue dÃ©diÃ©e. Celle-ci
nous permettra de lancer depuis l&#8217;IDE les opÃ©rations gÃ©rÃ©es par Maven,
par exemple une construction jusqu&#8217;Ã  une phase prÃ©cise du cycle de vie
ou l&#8217;exÃ©cution d&#8217;un plugin particulier.</p>
</div>
<div class="paragraph">
<div class="title">Figure 09-06</div>
<p><span class="image"><img src="illustrations/09-06.png" alt="09 06"></span></p>
</div>
<div class="paragraph">
<p>Le projet Maven aprÃ¨s import dans Idea.</p>
</div>
</div>
<div class="sect3">
<h4 id="_gestion_du_pom_2">Gestion du POM</h4>
<div class="paragraph">
<p>L&#8217;Ã©dition du fichier POM se fait <em>via</em> sa reprÃ©sentation XML, avec
cependant de nombreux assistants. Idea identifie, par exemple, toutes
les dÃ©pendances qui ne sont pas compatibles OSGi et propose de
rechercher pour une version OSGi-ready, dans un dÃ©pÃ´t spÃ©cialisÃ©
(typiquement celui gÃ©rÃ© par SpringSource pour son DM server). Bien sÃ»r,
tous ceux qui ne ciblent pas un environnement de ce type n&#8217;y verront
qu&#8217;un gadget, mais l&#8217;engouement rÃ©cent pour cette plateforme modulaire
n&#8217;est pas Ã  nÃ©gligerÂ ; aussi, est-il intÃ©ressant de constater que nos
outils sont dÃ©jÃ  Ã  niveau pour la gÃ©rer.</p>
</div>
<div class="paragraph">
<p>Au sein de l&#8217;Ã©diteur XML, Idea propose une assistance Ã  la saisie dÃ©diÃ©e
Ã  Maven, par exemple pour saisir les identifiants d&#8217;une dÃ©pendance ou
d&#8217;un plugin. Ces rÃ©fÃ©rences agissent comme des hyperliens et permettent
de naviguer dans les POM du projet de maniÃ¨re fluide. Idea ne propose
cependant aucune vue graphique des mÃ©tadonnÃ©es Maven. Pas de synthÃ¨se ni
d&#8217;outil d&#8217;analyse des dÃ©pendances. On reste donc un peu sur sa faim.</p>
</div>
<div class="paragraph">
<p>La vue de configuration du module (au sens Idea du terme) reflÃ¨te
cependant parfaitement les mÃ©tadonnÃ©es de notre projet Maven (voir
Figure 09-07). On y retrouve tous nos rÃ©pertoires de code source (et de
code gÃ©nÃ©rÃ©), que nous pouvons au besoin complÃ©ter, mais dans ce cas la
configuration Idea ne sera plus synchrone avec le projet Maven.</p>
</div>
<div class="paragraph">
<div class="title">Figure 09-07</div>
<p><span class="image"><img src="illustrations/09-07.png" alt="09 07"></span></p>
</div>
<div class="paragraph">
<p>La configuration du module Idea Ã  partir des mÃ©tadonnÃ©es Maven.</p>
</div>
<div class="paragraph">
<p>De la mÃªme faÃ§on, les dÃ©pendances du projet sont clairement identifiÃ©es,
avec un petit raffinement propre Ã  Idea qui diffÃ©rencie le code de test
du code principal, ainsi que les bibliothÃ¨ques qui sont sÃ©parÃ©es en deux
catÃ©gories (voir Figure 09-08). Les bibliothÃ¨ques non exportÃ©es ne
seront pas visibles depuis un autre projet qui fait rÃ©fÃ©rence au module
considÃ©rÃ©. Pas de risque ainsi d&#8217;introduire involontairement des imports
parasites.</p>
</div>
<div class="paragraph">
<div class="title">Figure 09-08</div>
<p><span class="image"><img src="illustrations/09-08.png" alt="09 08"></span></p>
</div>
<div class="paragraph">
<p>Les dÃ©pendances Maven vues sous Idea.</p>
</div>
</div>
<div class="sect3">
<h4 id="integration_des_plugins_maven_2">IntÃ©gration des plugins Maven</h4>
<div class="paragraph">
<p>Les plugins qui gÃ©nÃ¨rent du code lors des premiÃ¨res phases de la
construction du projet sont invoquÃ©s lors de l&#8217;import du projet, ce qui
permet Ã  Idea d&#8217;identifier les rÃ©pertoires associÃ©s. Pour le reste, Idea
ne sait pas exploiter la configuration des plugins Maven pour ajuster la
configuration des siens. Le dÃ©veloppeur doit donc manuellement
configurer le plugin Idea Checkstyle pour s&#8217;adapter aux rÃ¨gles dÃ©clarÃ©es
dans son POM.</p>
</div>
<div class="paragraph">
<p>Cette restriction est valable pour tous les IDE, car elle demande au
dÃ©veloppeur de chaque plugin pour un environnement donnÃ© de faire
l&#8217;effort de s&#8217;interfacer avec le support Maven, autrement dit de mettre
un pied dans trois mondes diffÃ©rents (Maven, l&#8217;IDE et l&#8217;outil supportÃ©
par le plugin). Une telle gymnastique n&#8217;est pas facile et est
gÃ©nÃ©ralement rÃ©servÃ©e aux outils majoritaires pour lesquels l&#8217;effort en
vaut la chandelle.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaStephane.png" alt="MangaStephane"></span></p>
</div>
<div class="paragraph">
<p>Ce rÃ©sultat en demi-teinte est rapidement compensÃ© par la dÃ©monstration
que nous fait StÃ©phane de l&#8217;utilisation courante de l&#8217;IDE. Il Ã©dite
quelques classes, ajoute des dÃ©pendances, puis lance un test. Dans tous
les cas, l&#8217;environnement rÃ©pond promptement et ajuste sa configuration
en fonction des directives du POM. StÃ©phane rÃ©sume les choses en disant
qu&#8217;il marche, Â«Â tout simplementÂ Â», faisant rÃ©fÃ©rence Ã  son rival Eclipse
dont le building workspace n&#8217;amuse plus personne.</p>
</div>
</div>
<div class="sect3">
<h4 id="_bonus">Bonus</h4>
<div class="paragraph">
<p>L&#8217;intÃ©gration de Maven dans Idea se fait donc sans fioriture visuelle
qui sorte du lot, mais tout simplement avec une solution totalement
fonctionnelle et parfaitement intÃ©grÃ©e dans le fonctionnement de l&#8217;IDE.
Contrairement Ã  ce qui se passait avec Eclipse, nous n&#8217;avons pas
l&#8217;impression de voir s&#8217;exÃ©cuter une surcouche au-dessus de
l&#8217;environnement qui tenterait de faire le lien entre deux mondes. C&#8217;est
bien notre IDE qui sait parler le Maven, peut-Ãªtre pas dans toutes ses
subtilitÃ©s, mais bien assez pour nous permettre de travailler
confortablement.</p>
</div>
<div class="paragraph">
<p>StÃ©phane explique que ce qui oppose Eclipse Ã  Idea, câest la philosophie
de lâoutilÂ : Eclipse tente de masquer la complexitÃ© des outils en
intÃ©grant tout leur fonctionnement dans son fameux build incrÃ©mental. Il
en rÃ©sulte quâÃ  chaque changement dans le code, un build Maven est
lancÃ©, parfois suivit dâun redÃ©ploiement par WTP, et quâen consÃ©quence
une machine haut de gamme sâavÃ¨re vite nÃ©cessaire. Idea est avant tout
un Ã©diteur et se focalise sur cette tÃ¢che pour fournir les assistances Ã 
la saisie de code les plus pointues. LâintÃ©gration des outils est
prÃ©sente, mais nÃ©cessite une configuration parfois manuelle et une
exÃ©cution explicite. LâIDE reste en permanence disponible pour son
utilisateur, et utilise les ressources de la machine pour offrir de
meilleures analyses du code en cours de rÃ©daction.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaNicolas.png" alt="MangaNicolas"></span></p>
</div>
<div class="paragraph">
<p>Nicolas grogne un peu dans son coin, se demandant s&#8217;il a choisi le bon
camp, mais il est vite repÃªchÃ© par une question du juryÂ : si les Ã©quipes
sont habituÃ©es Ã  Eclipse, largement diffusÃ© dans les entreprises,
l&#8217;apprentissage d&#8217;Idea est-il rapideÂ ? Il faut bien l&#8217;admettre,
apprivoiser un nouvel IDE prend du temps et les raccourcis que nous
avons mis tant de temps Ã  mÃ©moriser sont dÃ©sormais bien ancrÃ©s. Certes,
le support de Maven dans Idea semble trÃ¨s bon, mais entre le coÃ»t de
licence, le coÃ»t de (re)formation et l&#8217;Ã©ventuelle perte de productivitÃ©
des dÃ©veloppeurs contraints Ã  migrer, il va falloir faire passer la
piluleÂ !</p>
</div>
<div class="paragraph">
<p>Avant que le dÃ©bat ne s&#8217;enlise dans de stÃ©riles discussions sur le temps
nÃ©cessaire pour apprivoiser un nouvel environnement et sur la
compensation que peut apporter un outil plus efficace, nous dÃ©cidons de
passer Ã  notre troisiÃ¨me candidat.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_netbeans">NetBeans</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaRaphael.png" alt="MangaRaphael"></span></p>
</div>
<div class="paragraph">
<p>Notre dernier candidat est un farouche partisan de NetBeans et compte
bien nous dÃ©montrer sa supÃ©rioritÃ© pour le mariage de Maven avec un
environnement de dÃ©veloppement intÃ©grÃ©.</p>
</div>
<div class="sect3">
<h4 id="_prise_en_main_2">Prise en main</h4>
<div class="paragraph">
<p>Le support de Maven est nativement intÃ©grÃ© dans NetBeans, nous n&#8217;avons
donc aucun plugin Ã  installer. C&#8217;est prometteurÂ : les dÃ©veloppeurs de
NetBeans ont pris Ã  bras-le-corps la problÃ©matique du support de Maven
dans l&#8217;IDE et n&#8217;ont pas dÃ©lÃ©guÃ© Ã  une Ã©quipe externe l&#8217;intÃ©gration de
cette fonctionnalitÃ©. Le reste de l&#8217;environnement n&#8217;a rien de
fondamentalement dÃ©concertant et la visite guidÃ©e proposÃ©e par RaphaÃ«l
n&#8217;effraie pas grand monde.</p>
</div>
</div>
<div class="sect3">
<h4 id="_import_dun_projet_maven_3">Import d&#8217;un projet Maven</h4>
<div class="paragraph">
<p>Seconde bonne surprise, que RaphaÃ«l ne manque pas de souligner, NetBeans
n&#8217;importe pas un projet Maven, il se contente de lire nativement le POM.
Autrement dit, NetBeans ne va pas chercher Ã  traduire le POM pour crÃ©er
sa propre configuration comme le font Eclipse ou Idea, mais il va
entiÃ¨rement se baser sur le POM. Nous sommes ainsi assurÃ©s que les
modifications qui lui seront apportÃ©es seront prises en compte sans
nÃ©cessiter une quelconque synchronisation, de mÃªme que nous ne risquons
pas de tomber dans le travers de modifier la configuration de l&#8217;IDE sans
que le POM soit cohÃ©rent. La Figure 09-09 montre l&#8217;import d&#8217;un projet
Maven, et, comme le souligne avec insistance RaphaÃ«l, le POM n&#8217;est pas
dans cet environnement un format annexe, mais bien un descripteur de
projet Ã  part entiÃ¨re qui se suffit complÃ¨tement.</p>
</div>
<div class="paragraph">
<div class="title">Figure 09-09</div>
<p><span class="image"><img src="illustrations/09-09.png" alt="09 09"></span></p>
</div>
<div class="paragraph">
<p>Ouverture native d&#8217;un projet Maven.</p>
</div>
<div class="paragraph">
<p>Nos dÃ©pendances, rÃ©pertoires de sources (y compris le code gÃ©nÃ©rÃ©) et
sous-modules sont parfaitement dÃ©tectÃ©s, NetBeans ayant mÃªme le bon goÃ»t
de sÃ©parer nos dÃ©pendances de test, ce qui amÃ©liore la lisibilitÃ© du
projet qui compte plusieurs dizaines de bibliothÃ¨ques. Le lancement
d&#8217;une construction du projet dans l&#8217;IDE exÃ©cute tout naturellement Maven
dans une console, et nous pouvons Ã©videmment exÃ©cuter Ã  la demande une
tÃ¢che particuliÃ¨re.</p>
</div>
</div>
<div class="sect3">
<h4 id="_gestion_du_pom_3">Gestion du POM</h4>
<div class="paragraph">
<p>L&#8217;Ã©dition des mÃ©tadonnÃ©es du POM se fait ici aussi selon le formalisme
XML. Ã l&#8217;intÃ©rieur de cet Ã©diteur, NetBeans ne propose pas d&#8217;assistance
Ã  la saisie spÃ©cifique de Maven. Par contre, nous pouvons introduire de
nouvelles dÃ©pendances <em>via</em> un menu contextuel (clic droit sur l&#8217;icÃ´ne
qui regroupe nos bibliothÃ¨ques). L&#8217;assistant propose alors un outil de
recherche, basÃ©, comme ses concurrents, sur les index mis Ã  disposition
par les gestionnaires de dÃ©pÃ´ts.</p>
</div>
</div>
<div class="sect3">
<h4 id="integration_des_plugins_maven_3">IntÃ©gration des plugins Maven</h4>
<div class="paragraph">
<p>NetBeans ne propose pas d&#8217;intÃ©gration particuliÃ¨re des plugins Maven
pour lesquels il dispose de plugins Ã©quivalents. Cette passerelle semble
donc Ãªtre une spÃ©cificitÃ© d&#8217;Eclipse, que certains apprÃ©cieront mais Ã 
laquelle dâautres, comme RaphaÃ«l, prÃ©fÃ©reront un environnement
rÃ©ellement fonctionnel. Une rapide dÃ©monstration de dÃ©veloppement suffit
d&#8217;ailleurs Ã  le prouver, et RaphaÃ«l rejoint ainsi StÃ©phane dans son
combat tout sauf Eclipse.</p>
</div>
</div>
<div class="sect3">
<h4 id="_bonus_2">Bonus</h4>
<div class="paragraph">
<p>NetBeans prend en charge la gestion des bibliothÃ¨ques Maven de maniÃ¨re
particuliÃ¨rement intÃ©grÃ©e dans les rouages de l&#8217;IDE. Les assistants de
correction (Quick Fix) proposent par exemple de corriger un import non
rÃ©solu en ajoutant la dÃ©pendance adÃ©quate, <em>via</em> une recherche dans le
dÃ©pÃ´t. Comme l&#8217;indique la Figure 09-10, RaphaÃ«l ne se prive pas de nous
montrer cette fonctionnalitÃ© comme preuve de la premiÃ¨re place qu&#8217;occupe
Maven dans son environnement prÃ©fÃ©rÃ©.</p>
</div>
<div class="paragraph">
<div class="title">Figure 09-10</div>
<p><span class="image"><img src="illustrations/09-10.png" alt="09 10"></span></p>
</div>
<div class="paragraph">
<p>IntÃ©gration de la gestion des dÃ©pendances au plus profond de NetBeans.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Deliberation_du_jury">DÃ©libÃ©ration du jury</h3>
<div class="paragraph">
<p>La dÃ©libÃ©ration du jury est longue et mouvementÃ©e. Riche en arguments,
en comparaisons, mais aussi parfois en mauvaise foi, la discussion se
prolonge sans fin et le rÃ©sultat ne coule pas de source. Chacun y va de
sa petite dÃ©mo, de sa fonctionnalitÃ© absolument indispensable que
l&#8217;autre n&#8217;a pas, de ses considÃ©rations sur la formation des
dÃ©veloppeursâ¦ La conclusion finit par Ã©merger, avec l&#8217;aide d&#8217;un regard
externe au dÃ©bat.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaSebastien.png" alt="MangaSebastien"></span></p>
</div>
<div class="paragraph">
<p>Venu nous rendre une petite visite de courtoisie, SÃ©bastien s&#8217;Ã©tonne de
nous trouver dans cette situation de guerre de chapelles. Pour dÃ©bloquer
la situation, il lui suffit de poser une question toute bÃªteÂ : Â«Â Maisâ¦
est-ce que vous pouvez toujours construire le projet Ã  100 % en ligne de
commande ?Â Â» Bien sÃ»r que oui, environnement de dÃ©veloppement intÃ©grÃ© ou
pas, notre projet repose entiÃ¨rement sur Maven et ne dÃ©pend d&#8217;aucun des
trois IDE candidats Ã  l&#8217;intronisation.</p>
</div>
<div class="paragraph">
<p>Dans ce cas, en quoi est-ce importantÂ ? Si StÃ©phane est Ã  l&#8217;aise sous
Idea, RaphaÃ«l indÃ©crochable de son NetBeans, et Nicolas tellement
profondÃ©ment habituÃ© Ã  Eclipse qu&#8217;il ne sait plus s&#8217;en passer, pourquoi
les faire changerÂ ? Chacun trouve son compte dans son environnement, le
tout est que la construction du projet ne soit pas affectÃ©e par les
choix locaux de chacun. AprÃ¨s tout, il n&#8217;a jamais Ã©tÃ© question de
demander Ã  Arnaud de renoncer Ã  son Mac, tout simplement parce que cela
n&#8217;a aucune influence sur le projet, de mÃªme que RaphaÃ«l travaille sous
Linux.</p>
</div>
<div class="paragraph">
<p>Les choses tournent donc rapidement au consensus et se terminent autour
du verre de l&#8217;amitiÃ© (on l&#8217;a Ã©chappÃ© belle, n&#8217;est-ce pasÂ ?).</p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_8">Conclusion</h3>
<div class="paragraph">
<p>Un Ã©norme avantage de Maven est qu&#8217;il porte intÃ©gralement le projet. Que
l&#8217;on travaille dans un environnement graphique ou avec le bloc-notes n&#8217;a
aucune influence sur le projet lui-mÃªme. Seul l&#8217;utilisateur peut Ãªtre
pÃ©nalisÃ© par un environnement qu&#8217;il ne maÃ®trise pas, aussi autant le
laisser choisir librement. Ne forcez pas un utilisateur d&#8217;Idea sur Mac Ã 
supporter avec angoisse un Eclipse sous Windows. N&#8217;obligez pas un
Â«Â linuxienÂ Â» sous NetBeans Ã  abandonner ses raccourcis prÃ©fÃ©rÃ©s. Ne
demandez pas Ã  un habituÃ© du couple Windows/Eclipse comme il en existe
des milliers Ã  tout rÃ©apprendre juste pour rÃ©pondre Ã  un choix venu d&#8217;en
haut, avec la perte de productivitÃ© qui va nÃ©cessairement en dÃ©couler.</p>
</div>
<div class="paragraph">
<p>Maven nous a libÃ©rÃ©s des IDE, nous pouvons utiliser celui que nous
voulons et en changer Ã  tout moment, car aucune de nos tÃ¢ches
stratÃ©giques n&#8217;y est liÃ©e.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chapitre_10le_jour_jla_livraison">Chapitre 10Â :Â Le jour JÂ :Â la livraison</h2>
<div class="sectionbody">
<div class="paragraph">
<p>La vie d&#8217;un projet est ponctuÃ©e de moments forts, et le jour de la
livraison en est un particuliÃ¨rement Ã©prouvant. AprÃ¨s de longues
semaines de dÃ©veloppement et de mise au point, notre logiciel est mis Ã 
la disposition de ses utilisateurs, soumis Ã  leur jugement et Ã  leur
manque de compassion pour les erreurs que nous aurions pu commettre.</p>
</div>
<div class="sect2">
<h3 id="Strategie_de_livraison">StratÃ©gie de livraison</h3>
<div class="sect3">
<h4 id="Premiere_livraison">PremiÃ¨re livraison</h4>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaEmmanuel.png" alt="MangaEmmanuel"></span></p>
</div>
<div class="paragraph">
<p>La toute premiÃ¨re version publique de Â«Â noubliepaslalistedescoursesÂ Â» a
Ã©tÃ© particuliÃ¨rement hÃ©roÃ¯que. Tout commence par plusieurs semaines de
tests intensifs pour identifier tous les bogues qui auraient pu nous
Ã©chapper. Les derniers correctifs sont appliquÃ©s, avant de se lancer
dans une ultime journÃ©e de vÃ©rification pour Ãªtre sÃ»r de ne rien laisser
au hasard. AprÃ¨s quoi, il nous faut prÃ©parer le logiciel enfin stabilisÃ©
et validÃ© pour la diffusion. Emmanuel prend en charge la prÃ©paration de
cette toute premiÃ¨re mouture.</p>
</div>
<div class="paragraph">
<p>Il commence par parcourir tous les fichiers de configuration du projet
pour indiquer comme numÃ©ro de version la fameuse valeur 1.0.0. Le
projet, reconstruit avec cette nouvelle configuration, est testÃ© une
derniÃ¨re fois avant d&#8217;Ãªtre rendu public. Emmanuel marque dans notre
gestionnaire de code source ce moment crucial, ce qui se traduit par la
pose d&#8217;un Â«Â tagÂ Â». La journÃ©e se termine donc tard autour d&#8217;une bonne
bouteille pour fÃªter le succÃ¨s de notre belle aventure.
Â«Â noubliepaslalistedescoursesÂ Â» est dÃ©sormais en ligne et attend de pied
ferme ses utilisateurs.</p>
</div>
</div>
<div class="sect3">
<h4 id="deuxieme_livraison">DeuxiÃ¨me livraison</h4>
<div class="paragraph">
<p>Une mauvaise surprise nous tombe dessus lorsque nous devons en urgence
appliquer une correction pour un problÃ¨me de performances. Soumise Ã  un
succÃ¨s inattendu, l&#8217;application a commencÃ© Ã  cafouiller et il a fallu
trouver des palliatifs immÃ©diats. Le tag posÃ© par Emmanuel nous permet
de rÃ©cupÃ©rer le code source associÃ© Ã  cette fameuse version 1.0.0 et de
prÃ©parer aussi vite que possible une version 1.0.1 corrigeant ce
problÃ¨me. Et lÃ , impossible de reconstruire le projet. Lors de la
premiÃ¨re livraison, les modifications n&#8217;avaient pas Ã©tÃ© complÃ¨tement
intÃ©grÃ©es dans le gestionnaire de code source lors de la pose du tag.
Emmanuel doit donc gÃ©rer dans l&#8217;urgence deux problÃ¨mes lÃ  oÃ¹ un seul lui
suffisait dÃ©jÃ  largement.</p>
</div>
<div class="paragraph">
<p>Pour ne pas reproduire la mÃªme erreur, il dÃ©cide de poser le tag de la
version 1.0.1, puis d&#8217;extraire du gestionnaire de sources le code
associÃ© au tag encore tout frais et de s&#8217;en servir pour construire le
logiciel qui sera validÃ© une toute derniÃ¨re fois avant d&#8217;Ãªtre publiÃ©. Si
jamais nous dÃ©tections un problÃ¨me de derniÃ¨re minute, il nous suffirait
d&#8217;apporter les corrections nÃ©cessaires, de poser un nouveau tag et de
reprendre la procÃ©dure.</p>
</div>
</div>
<div class="sect3">
<h4 id="troisieme_livraison">TroisiÃ¨me livraison</h4>
<div class="paragraph">
<p>Les choses semblent enfin maÃ®trisÃ©es, mais nous dÃ©chantons vite quand
d&#8217;autres problÃ¨mes apparaissent sur la version 1.0.1. AprÃ¨s analyse, on
comprend que ces problÃ¨mes auraient dÃ» Ãªtre dÃ©tectÃ©s par notre outillage
de tests. Alors, que s&#8217;est-il passÃ©Â ?</p>
</div>
<div class="paragraph">
<p>Ces tests sont malheureusement associÃ©s Ã  un profil qui doit Ãªtre activÃ©
Ã  la demande. Comme ils portent sur les accÃ¨s Ã  la base de donnÃ©es, et
pour ne pas pÃ©naliser les autres dÃ©veloppeurs, nous les avons isolÃ©s
dans un profil dÃ©diÃ©, comme nous l&#8217;avons vu au Chapitre 4. Ãtait-ce une
fausse bonne idÃ©eÂ ?</p>
</div>
<div class="paragraph">
<p>L&#8217;Ã©quipe de dÃ©veloppement, malgrÃ© le fiasco de cette version corrective,
n&#8217;en est pas convaincue. Les profils permettent Ã  chacun d&#8217;Ãªtre
correctement outillÃ© sur la partie qui le concerne sans Ãªtre handicapÃ©
par des temps de construction interminables ou par des prÃ©requis sur
l&#8217;environnement de dÃ©veloppement.</p>
</div>
<div class="paragraph">
<p>Lors de la construction de notre projet avant livraison, nous devons
tout simplement ne pas nÃ©gliger d&#8217;activer tous les profils adÃ©quats pour
valider au maximum l&#8217;application. Nous pouvons mÃªme ajouter, Ã  cette
phase cruciale, des profils spÃ©cifiques pour adjoindre des informations
dans le livrableÂ : date de livraison, auteur de la livraison, numÃ©ro de
rÃ©vision dans le gestionnaire de code sourceâ¦</p>
</div>
<div class="paragraph">
<p>La version 1.0.2 sera donc la bonne, maintenant qu&#8217;Emmanuel tient enfin
une procÃ©dure de livraison fiable etâ¦ connue de tousÂ ?</p>
</div>
</div>
<div class="sect3">
<h4 id="_documentation">Documentation</h4>
<div class="paragraph">
<p>La procÃ©dure peut Ãªtre aussi bÃ©tonnÃ©e qu&#8217;on le voudra, elle n&#8217;est fiable
que si elle est appliquÃ©e scrupuleusement. Autrement dit, le facteur
humain reste comme toujours l&#8217;Ã©pÃ©e de DamoclÃ¨s qui menace les projets.</p>
</div>
<div class="paragraph">
<p>La plupart des entreprises rÃ©pondent Ã  ce problÃ¨me par une documentation
lourdement contrÃ´lÃ©e, rÃ©pondant Ã  des rÃ¨gles trÃ¨s strictes de contrÃ´le
qualitÃ© et Ã  des nomenclatures prÃ©cises. En supposant que tout le monde
soit rompu aux pratiques de qualitÃ© et vive dans un monde labellisÃ© AFAQ
et ISO-900x, cela devrait garantir le succÃ¨s du projet en toute
circonstance. Seulement, nous ne vivons pas dans ce monde â est-ce
rÃ©ellement regrettableÂ ?</p>
</div>
<div class="paragraph">
<p>D&#8217;autres prÃ©fÃ¨rent une approche plus souple et rÃ©active en faisant appel
Ã  l&#8217;auto-organisation, par exemple <em>via</em> une documentation supportÃ©e par
un wiki.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Pour ceux qui ne le sauraient pas, un wiki est un site web dont le
contenu peut Ãªtre modifiÃ©, corrigÃ© ou complÃ©tÃ© par ses utilisateurs. Il
est donc trÃ¨s dynamique et peut s&#8217;adapter Ã  la rÃ©alitÃ© des problÃ¨mes
rencontrÃ©s et s&#8217;organiser en fonction des informations rÃ©ellement
utiles.</p>
</div>
<div class="paragraph">
<p>Un wiki n&#8217;est pas du tout incompatible avec une gestion Â«Â classiqueÂ Â» de
la documentation. Si vous n&#8217;en avez pas un sur votre projet, faites un
petit essai avec votre Ã©quipe, vous serez surpris du rÃ©sultat. Les
solutions ne manquent pas, du wiki PHP de base au trÃ¨s professionnel
Confluence, en passant par l&#8217;incontournable XWiki cher Ã  Vincent.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Emmanuel documente ainsi la procÃ©dure de livraison dans notre wiki,
accessible rapidement et sans les ambiguÃ¯tÃ©s d&#8217;une classification
documentaire complexe. Elle a aussi l&#8217;Ã©norme mÃ©rite de permettre Ã  celui
qui applique la procÃ©dure de venir complÃ©ter la documentation pour
prÃ©ciser un point qu&#8217;il trouve mal expliquÃ©, ou donner des indications
sur un point pas assez dÃ©taillÃ©. Certains seront trÃ¨s Ã  l&#8217;aise avec les
commandes Unix alors que d&#8217;autres auront besoin qu&#8217;on les prenne par la
main.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaEmmanuel.png" alt="MangaEmmanuel"></span></p>
</div>
<div class="paragraph">
<p>Est-ce vraiment la panacÃ©eÂ ? Pourquoi acceptons-nous que le moment de la
livraison â le plus crucial de la vie du projet â soit le seul Ã  ne pas
bÃ©nÃ©ficier de l&#8217;approche que Maven a apportÃ©e au projetÂ :
l&#8217;automatisation aussi complÃ¨te que possible <em>via</em> une commande unique.
Emmanuel a pris le soin de documenter dans le dÃ©tail la procÃ©dure, et le
principe du wiki permet Ã  chacun de la complÃ©ter si un point restait
obscur. Cependant, nous construisons tous nos projets, quelles que
soient leur complexitÃ© ou leur technologie, par la commande universelle
<code>mvn install</code>. La procÃ©dure de livraison ne pourrait-elle pas elle aussi
Ãªtre homogÃ©nÃ©isÃ©eÂ ? Emmanuel part donc Ã  la pÃªche aux bonnes pratiques
du cÃ´tÃ© de Maven et de ses pluginsâ¦</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_le_plugin_release">Le plugin <em>release</em></h3>
<div class="paragraph">
<p>Le plugin release de Maven a Ã©tÃ© conÃ§u dans cet esprit. Il regroupe en
une seule commande toutes les bonnes pratiques de livraison apprises sur
de nombreux projets. En l&#8217;utilisant, vous n&#8217;aurez pas comme nous Ã 
apprendre Ã  vos dÃ©pens que l&#8217;Ã©tablissement d&#8217;une procÃ©dure fiable ne
s&#8217;improvise pas. Surtout, vous n&#8217;aurez pas besoin de 20 pages de
documentation pour indiquer la procÃ©dure Ã  suivre.</p>
</div>
<div class="paragraph">
<p>Pour vous donner une idÃ©e de ce que le plugin propose, voici le
processus qu&#8217;il applique pour produire un livrable.</p>
</div>
<div class="sect3">
<h4 id="etape_1_preparation">Ãtape 1Â :Â prÃ©paration</h4>
<div class="ulist">
<ul>
<li>
<p>Il contrÃ´le l&#8217;environnement de l&#8217;utilisateur qui ne doit prÃ©senter
aucune modification non sauvegardÃ©e dans le gestionnaire de code source.
Optionnellement, un accÃ¨s exclusif au gestionnaire peut Ãªtre demandÃ©
pour les plus paranoÃ¯aques d&#8217;entre nous.</p>
</li>
<li>
<p>Il contrÃ´le le projet qui ne doit rÃ©fÃ©rencer aucune dÃ©pendance en
SNAPSHOT, dont l&#8217;Ã©tat serait par nature non reproductible.</p>
</li>
<li>
<p>Il modifie les indications de version dans les fichiers POM des
modules du projet. Le plugin peut Ãªtre configurÃ© pour affecter la mÃªme
version Ã  toutes les branches d&#8217;un projet multimodule, sinon il
demandera de saisir une version pour chacun d&#8217;eux.</p>
</li>
<li>
<p>Il indique dans le POM du projet le tag appliquÃ© Ã  la version Ã 
produire. Le projet comptera donc une rÃ©fÃ©rence explicite Ã 
l&#8217;emplacement oÃ¹ son code source est stockÃ©.</p>
</li>
<li>
<p>Il effectue une construction complÃ¨te du projet pour contrÃ´ler les
modifications appliquÃ©es automatiquement et s&#8217;assurer qu&#8217;elles n&#8217;ont pas
un impact nÃ©gatif.</p>
</li>
<li>
<p>Il sauvegarde les modifications appliquÃ©es dans le gestionnaire de
code source.</p>
</li>
<li>
<p>Il pose un tag dans le gestionnaire de code source pour la
livraison en cours de prÃ©paration.</p>
</li>
<li>
<p>Il modifie Ã  nouveau les indications de version pour pointer vers
la version de dÃ©veloppement suivante et les sauvegarde.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Comme vous pouvez le constater, la dÃ©marche est plus que rigoureuse et
elle est entiÃ¨rement automatisÃ©e. Finalement, le projet dispose, dans son
gestionnaire de versions, d&#8217;un tag pour la version Ã  livrer, et la
version courante (<em>trunk</em>) correspond Ã  la prochaine version Ã 
dÃ©velopper. L&#8217;Ã©tat Â«Â version livrÃ©eÂ Â» n&#8217;est apparu que furtivement dans
l&#8217;historique du gestionnaire de code source, ce qui correspond bien Ã  la
rÃ©alitÃ© de cet Ã©vÃ©nement aussi ponctuel que capital.</p>
</div>
</div>
<div class="sect3">
<h4 id="etape_2_livraison">Ãtape 2Â : livraison</h4>
<div class="paragraph">
<p>La production du logiciel livrable est rÃ©alisÃ©e Ã  partir du tag placÃ©
dans le gestionnaire de sources. Nous pourrions effectuer cette manÅuvre
manuellement, mais ici encore le plugin release simplifie la tÃ¢cheÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>extraction du code correspondant au tag dans un rÃ©pertoire dÃ©diÃ©,
vierge de toute modification locale malencontreuseÂ ;</p>
</li>
<li>
<p>construction du projet Ã  partir d&#8217;une liste de cibles, d&#8217;options
et de profils indiquÃ©s dans le POM.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Le point capital ici est que la description de la configuration et des
commandes nÃ©cessaires Ã  la construction correcte du livrable est
entiÃ¨rement documentÃ©e dans le POM lui-mÃªme. Pas de document Ã 
connaÃ®tre, Ã  retrouver dans la bonne version ou Ã  ne surtout pas oublier
de mettre Ã  jour.</p>
</div>
<div class="paragraph">
<p>Un projet Maven utilisant le plugin release permet de rÃ©aliser une
livraison totalement maÃ®trisÃ©e, contrÃ´lÃ©e et synchronisÃ©e avec le
gestionnaire de code source en une simple commandeÂ :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mvn release:prepare release:perform</pre>
</div>
</div>
<div class="paragraph">
<p>Emmanuel est plus que satisfait par cette simplicitÃ©. Maven prouve ici
son efficacitÃ©Â : une commande unique pour rÃ©aliser un traitement loin
d&#8217;Ãªtre simple et applicable sur tous nos projets, toutes complexitÃ©s et
technologies confondues. Reprenez le document PROCx589002-02.1-ProcÃ©dure
de livraison.doc que vous aviez jusqu&#8217;ici et servez-vous-en pour caler
votre armoire bancale. Et si votre responsable qualitÃ© vous rÃ©clame un
document de procÃ©dure, faites-lui une photocopie de la Figure 10-01Â !</p>
</div>
<div class="paragraph">
<div class="title">Figure 10-01</div>
<p><span class="image"><img src="illustrations/10-01.png" alt="10 01"></span></p>
</div>
<div class="paragraph">
<p>Ãtapes rÃ©alisÃ©es par le plugin release_._</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Cette procÃ©dure est loin d&#8217;Ãªtre Ã©lÃ©mentaire et il y a donc de nombreuses
raisons qu&#8217;elle plante en cours de route avant d&#8217;Ãªtre complÃ¨tement au
point. Le plugin propose un mode <em>dryRun</em> qui permet de l&#8217;exÃ©cuter Ã 
blanc, sans qu&#8217;aucune modification soit appliquÃ©e dans le gestionnaire
de code source, le temps de bien mettre au point la configuration du
plugin.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="et_si_ca_foire">Et si Ã§a foireÂ ?</h4>
<div class="paragraph">
<p>La prÃ©paration de la livraison comprend de nombreuses Ã©tapes et
contrÃ´les. Si l&#8217;une d&#8217;elles Ã©choue, le plugin va Ã©videmment
s&#8217;interrompre. AprÃ¨s avoir identifiÃ© et corrigÃ© le problÃ¨me, nous avons
deux optionsÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reprendre toute la procÃ©dure Ã  son point de dÃ©part. Le plugin
release propose alors de faire un retour arriÃ¨re complet dans l&#8217;Ã©tat
initial, dans l&#8217;esprit de ce que propose une base de donnÃ©es au cours
d&#8217;une transactionÂ : <code>mvn release:rollback</code></p>
</li>
<li>
<p>Reprendre la procÃ©dure Ã  partir du point oÃ¹ elle s&#8217;est arrÃªtÃ©e
prÃ©cÃ©demment.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La seconde solution est Ã©videmment moins stricteÂ ; cependant, vous
pouvez parfois Ãªtre bloquÃ© par un problÃ¨me purement local et indÃ©pendant
de la stabilitÃ© du projet, comme un contrÃ´le de votre environnement par
le plugin enforcer qui Ã©choue, ou la construction qui n&#8217;aboutit pas
parce que vous n&#8217;avez pas attribuÃ© suffisamment de mÃ©moire Ã  l&#8217;exÃ©cution
de Maven.</p>
</div>
<div class="paragraph">
<p>Dans les deux cas, la rÃ©solution du problÃ¨me ne nÃ©cessite pas de
modifier le projet lui-mÃªme, et le plugin release permet de reprendre le
processusÂ : par dÃ©faut, lancÃ© une deuxiÃ¨me fois sur le mÃªme projet, il
va reprendre sa tÃ¢che lÃ  oÃ¹ il en Ã©tait restÃ©, sauf si on lui indique
explicitement de tout reprendre de zÃ©ro <em>via</em> l&#8217;option -Dresume=false.</p>
</div>
</div>
<div class="sect3">
<h4 id="_qui_fait_la_release">Qui fait la releaseÂ ?</h4>
<div class="paragraph">
<p>Notre processus est dÃ©sormais bien rÃ´dÃ©. Reste un dernier point Ã 
rÃ©glerÂ : sur quel environnement faire la releaseÂ ? Dans notre build,
nous avons tentÃ© de blinder au maximum toute dÃ©pendance Ã 
lâenvironnement, clarifiÃ© tous les prÃ©requis. Mais nous savons bien
quâun grain de sable se faufile si vite entre les rouagesâ¦</p>
</div>
<div class="paragraph">
<p>Nous sommes tous dâaccordÂ : un poste de dÃ©veloppement nâest pas idÃ©al
pour faire la release. Il contient par dÃ©finition des Ã©lÃ©ments de test,
des fichiers modifiÃ©s, des simulateurs en tout genre que nous risquons
dâincorporer sans le savoir dans le livrable. Pourtant, il y a un membre
de lâÃ©quipe qui est irrÃ©prochable sur le sujetÂ : notre intÃ©gration
continueÂ !</p>
</div>
<div class="paragraph">
<p>Avantages majeursÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>le serveur dâintÃ©gration continue tourne sur un systÃ¨me Unix
strictement identique au systÃ¨me cible. Cela nous permet dâidentifier
plus rapidement dâÃ©ventuels problÃ¨mes sur les accÃ¨s fichiers ou rÃ©seau
propres au systÃ¨me, autant rÃ©utiliser cet avantageÂ ;</p>
</li>
<li>
<p>le serveur dâintÃ©gration continue ne dÃ©veloppe pas, et ne fait
donc aucune modification que nous risquerions dâincorporer au livrableÂ ;</p>
</li>
<li>
<p>le serveur dâintÃ©gration continue ne rÃ¢le jamais et est toujours
prÃªt Ã  donner de son temps. Notre processus de release devenant
relativement ambitieux, le faire tourner sur nos postes câest
immobiliser un dÃ©veloppeur pendant un temps non nÃ©gligeable.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Notre serveur Jenkins dispose justement dâun plugin qui correspond Ã 
toutes nos attentesÂ : Â«Â Maven Release PluginÂ Â», un plugin pour lancer
une release depuis notre fauteuil par un simple click â sitÃ´t essayÃ©,
sitÃ´t adoptÃ©Â !</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>On pourra reprocher Ã  cette approche de rendre nos livrables
Â«Â anonymesÂ Â». Dans certaines circonstances, nous voudrions conserver la
traÃ§abilitÃ© en signant le binaire avec une clÃ© GPG, ce qui est par
exemple nÃ©cessaire pour les diffuser sur central.</p>
</div>
<div class="paragraph">
<p>Dans ces circonstances, il faudra revenir Ã  une approche plus
Â«Â traditionnelleÂ Â».</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_notre_prochaine_version">Notre prochaine version</h4>
<div class="paragraph">
<p>La livraison de la version 1.2.0 de Â«Â noubliepaslalistedescoursesÂ Â» n&#8217;a
pas Ã©tÃ© une de ces journÃ©es de stress sans fin, qui se terminent bien
aprÃ¨s le coucher du soleil. Elle n&#8217;a pas non plus Ã©tÃ© menÃ©e par un
expert rompu Ã  tous nos outils et spÃ©cialiste de la procÃ©dure. C&#8217;est
notre stagiaire qui l&#8217;a rÃ©alisÃ©e, le plus naturellement du monde, et
sans mÃªme se rendre compte de ce qu&#8217;avaient pu Ãªtre les livraisons
prÃ©cÃ©dentes.</p>
</div>
<div class="paragraph">
<p>L&#8217;approche par convention et l&#8217;excellente extensibilitÃ© de Maven
montrent toute la force de celui-ci dans le plugin release. Un seul
fichier, utilisant un formalisme XML certes verbeux mais simple, permet
de dÃ©crire toutes les Ã©tapes de construction et toutes les options
nÃ©cessaires pour obtenir un rÃ©sultat fiable.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tester_des_candidats">Tester des candidats</h3>
<div class="paragraph">
<p>Jusqu&#8217;Ã  prÃ©sent, nous avons utilisÃ© notre outillage de tests automatisÃ©
et une sÃ©rie de tests en amont pour valider le fonctionnement de notre
logiciel avant livraison. Nous ne sommes cependant jamais Ã  l&#8217;abri d&#8217;une
coquille de derniÃ¨re minute qui passerait au travers du processus de
livraison. Aussi, nous voulons tester une derniÃ¨re fois avant de mettre
le coup de tampon Â«Â bon pour le serviceÂ Â».</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaEmmanuel.png" alt="MangaEmmanuel"></span></p>
</div>
<div class="paragraph">
<p>C&#8217;est Ã  nouveau Emmanuel qui s&#8217;y colle, maintenant qu&#8217;il est devenu
notre gourou de la livraison. Pour notre version 1.3.0, il propose de
complÃ©ter notre procÃ©dure techniquement bien rodÃ©e d&#8217;une phase
supplÃ©mentaire de tests. La version marquÃ©e 1.3.0 sera installÃ©e sur
notre serveur de validation et subira nos tests les plus redoutables.
Comment gÃ©rer cependant les versions dans les essais successifs que nous
allons probablement enchaÃ®nerÂ ? Chaque candidat au titre de livraison
officielle a sa propre identitÃ© et ne doit pas Ãªtre confondu avec les
autres.</p>
</div>
<div class="paragraph">
<p>PremiÃ¨re option, utiliser un nombre supplÃ©mentaire dans le numÃ©ro de
version, indiquant le numÃ©ro du candidat dans la course au logiciel sans
faille. La 1.3.0.1 sera probablement imparfaite, la 1.3.0.2 aura son lot
de rÃ©gressions inacceptables, la 1.3.0.3 sera peut-Ãªtre la bonne.
Certains logiciels suivent cette option et ne diffusent publiquement que
les sous-versions qui ont satisfait tous les critÃ¨res de qualitÃ©. Les
utilisateurs peuvent cependant Ãªtre surpris de constater des manques
dans la sÃ©rie des numÃ©ros de version.</p>
</div>
<div class="paragraph">
<p>Emmanuel n&#8217;aime pas trop cette solution et voudrait pouvoir redÃ©finir la
version de notre meilleur candidat en Â«Â 1.3.0Â Â». Seulement, le code marquÃ©
dans notre gestionnaire de code source ne porterait pas la bonne
version, et le tag serait inadaptÃ©. Une fois de plus, Maven et son
plugin release viennent Ã  notre secours. Lorsque nous exÃ©cutons la
commande <code>mvn release:perform</code>, nous demandons Ã  Maven de construire le
livrable et de le diffuser sur notre dÃ©pÃ´t public. Une autre commande
<code>mvn release:stage</code> est trÃ¨s comparable, mais remplace automatiquement la
phase de dÃ©ploiement pour pointer sur notre dÃ©pÃ´t de validation. Le
logiciel installÃ© sur celui-ci sera donc strictement identique, au bit
prÃ¨s, Ã  une livraison classique, mais aura juste changÃ© de destination.
Nous pourrons donc le tester attentivement en toute tranquillitÃ©.</p>
</div>
<div class="paragraph">
<p>La seconde diffÃ©rence qu&#8217;introduit stage est qu&#8217;il conserve la
possibilitÃ© de lancer un rollback. Il est donc possible, si la version
en cours de test ne nous satisfait pas, de revenir en arriÃ¨re sur notre
gestion de version et de relancer plus tard une nouvelle version avec le
mÃªme numÃ©ro de version.</p>
</div>
<div class="paragraph">
<p>Si effectivement notre premier Â«Â release candidateÂ Â» est insuffisant pour
rÃ©pondre Ã  nos exigences, il nous suffit de revenir <em>via</em> un
release:rollback en version 1.3.0-SNAPSHOT. La seule chose qui restera
du candidat malheureux est le tag, que nous pouvons renommer en
1.3.0-RC1. Si, par malheur, toutes nos tentatives ne produisaient qu&#8217;un
logiciel encore pire, nous pourrions toujours, pressÃ©s par le temps,
repartir de ce tag. Celui-ci prÃ©sente bien la capacitÃ© de produire un
projet en version 1.3.0Â !</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaCarlos.png" alt="MangaCarlos"></span></p>
</div>
<div class="paragraph">
<p>Carlos est trÃ¨s intriguÃ© par les explications d&#8217;Emmanuel sur cette
procÃ©dure de mise sur Ã©tagÃ¨re d&#8217;une version candidate. Il propose alors
d&#8217;utiliser un autre mÃ©canisme, en se fondant sur le gestionnaire de
dÃ©pÃ´t dont il a la responsabilitÃ©. Notre procÃ©dure de livraison va
produire un livrable dans la version cible 1.3.0 et le diffuser sur le
gestionnaire de dÃ©pÃ´t. Par contre, l&#8217;emplacement dans ce dÃ©pÃ´t sera
choisi dans une sous-catÃ©gorie spÃ©ciale, dÃ©diÃ©e aux prÃ©versions
candidates. Nos bÃªta-testeurs pourront pointer dessus pour rÃ©cupÃ©rer le
binaire et le tester en connaissance de cause, alors que les autres
utilisateurs n&#8217;en auront pas connaissance. Une fois cet artefact validÃ©,
il suffira de demander au gestionnaire de dÃ©pÃ´t de le promouvoir dans le
dÃ©pÃ´t public (sous Nexus, dans la version pro, voir la gestion des
<em>staging repositories</em>).</p>
</div>
<div class="paragraph">
<p>Emmanuel et Carlos nous proposent ainsi, par le biais dâoutils propres
au monde Maven, une procÃ©dure complÃ¨te, fiabilisÃ©e et totalement
automatisÃ©e pour produire notre livrable, le tester puis le diffuser.</p>
</div>
</div>
<div class="sect2">
<h3 id="_urgence">UrgenceÂ !</h3>
<div class="paragraph">
<p>Notre version 1.3.0 n&#8217;est pas encore complÃ¨tement stabilisÃ©e que nous
avons un retour alarmant d&#8217;un de nos clients sur la version 1.2.0. Un
bogue trÃ¨s gÃªnant, qui nÃ©cessite de notre part une intervention
immÃ©diate. Impossible de proposer une migration dans la nouvelle version
qui n&#8217;est mÃªme pas encore prÃªte et apporte de toute faÃ§on des
changements significatifs dont notre client n&#8217;a que faire dans son Ã©tat
d&#8217;esprit du moment.</p>
</div>
<div class="paragraph">
<p>Il nous faut un correctif, une 1.2.1, et le plus vite sera le mieux. Et
c&#8217;est bien sÃ»r sur Emmanuel que Ã§a tombe une fois de plusÂ !</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaEmmanuel.png" alt="MangaEmmanuel"></span></p>
</div>
<div class="paragraph">
<p>Mais, cette fois, Emmanuel ne s&#8217;est pas laissÃ© prendre de vitesse et a
prÃ©vu le coup. Notre gestionnaire de code source prend ce problÃ¨me en
charge Ã  travers la notion de branche. En parallÃ¨le, vont commencer Ã 
croÃ®tre d&#8217;un cÃ´tÃ© le tronc du projet, correspondant Ã  la version 1.3.0
qui continue son chemin, et, dâun autre cÃ´tÃ©, une branche 1.2.1, dont le
point de dÃ©part est le moment exact de crÃ©ation de la version 1.2.0. Les
divergences entre les codes de ces deux versions pourront Ãªtre
fusionnÃ©es plus tard, ou peut-Ãªtre resteront-elles dÃ©finitivement
sÃ©parÃ©es, l&#8217;avenir nous le dira. La Figure 10-02 donne une idÃ©e de la
gestion en parallÃ¨le de versions, avec un point de branchement et un
point de fusion quelques semaines plus tard. Cette approche peut Ãªtre
utilisÃ©e pour des besoins correctifs ou pour expÃ©rimenter Ã  l&#8217;abri d&#8217;un
petit coin tranquille une Ã©volution complexe, qui impacterait trop le
reste de l&#8217;Ã©quipe.</p>
</div>
<div class="paragraph">
<div class="title">Figure 10-02</div>
<p><span class="image"><img src="illustrations/10-02.png" alt="10 02"></span></p>
</div>
<div class="paragraph">
<p>Utilisation d&#8217;une branche de dÃ©veloppement parallÃ¨le.</p>
</div>
<div class="paragraph">
<p>Encore une fois, le plugin release va nous faciliter la tÃ¢che, ce qui
est la moindre des choses lorsqu&#8217;il faut en plus gÃ©rer l&#8217;Ã©nervement de
notre client au bout du fil et lui prouver notre rÃ©activitÃ©. mvn
release:branch nous permet de crÃ©er rapidement une branche de
dÃ©veloppement, avec mise Ã  jour de nos POM pour indiquer la version
corrective et les rÃ©fÃ©rences adÃ©quates Ã  notre gestionnaire de code
source. Nous pouvons alors commencer Ã  travailler dans la branche
fraÃ®chement crÃ©Ã©e sans perdre de temps.</p>
</div>
<div class="paragraph">
<p>Il faudra juste configurer le serveur d&#8217;intÃ©gration continue pour
scruter l&#8217;avancement de ce dÃ©veloppement parallÃ¨le. Sous Hudson, nous
pouvons simplement copier la configuration existante pour crÃ©er un
nouveau job. Seul l&#8217;emplacement du gestionnaire de code source sera
modifiÃ©.</p>
</div>
<div class="paragraph">
<p>Une fois notre dÃ©veloppement terminÃ©, le couple release:prepare
release:perform reprendra du service pour produire ce livrable correctif
trÃ¨s attendu. Une fois de plus, toute cette procÃ©dure aurait pu Ãªtre
traitÃ©e manuellement, dans une ambiance de stress et de prÃ©cipitation
dont les rÃ©sultats peuvent Ãªtre dÃ©sastreux. Maven propose de les prendre
en charge de maniÃ¨re totalement structurÃ©e et automatisÃ©e.</p>
</div>
</div>
<div class="sect2">
<h3 id="_vis_ma_vie">Vis ma vie</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaEmmanuel.png" alt="MangaEmmanuel"></span>
<span class="image" style="float: left"><img src="illustrations/MangaVincentS.png" alt="MangaVincentS"></span></p>
</div>
<div class="paragraph">
<p>Emmanuel est confrontÃ© Ã  un problÃ¨meÂ : en tant que responsable du
dÃ©veloppement du portail web, il est soumis aux demandes rÃ©pÃ©tÃ©es du
marketing. Tout est toujours urgentissime, et il faudrait pouvoir
multiplier les versions. Mais Vincent, qui est responsable du back-end
nâest pas sur la mÃªme longueur dâondeÂ : il a des Ã©volutions lourdes Ã 
prendre en compte pour gÃ©rer la forte montÃ©e en puissance de notre
service. Les deux Ã©quipes nâont pas le mÃªme cycle de vie, et continuer Ã 
gÃ©rer cela dans un seul et mÃªme projet Maven pose problÃ¨me.</p>
</div>
<div class="paragraph">
<p>Leur premiÃ¨re idÃ©e est de sÃ©parer le projet en deux, seulement il y a
notre fameux POM parent dont tout le monde hÃ©rite. Nous sÃ©parons donc en
trois, chacun avec son propre numÃ©ro de version et son propre cycle de
vie. Pour respecter la structure de Subversion par rapport au cycle de
vie, nous aboutissons Ã  une structure de fichiers sous Subversion assez
disgracieuseÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>+ /parent/trunk
|       |_branches
|       |_tags
+ /portail/trunk
|        |_branches
|        |_tags
+ /backend/trunk
|        |_branches
|        |_tags</pre>
</div>
</div>
<div class="paragraph">
<p>En dehors des considÃ©rations esthÃ©tiques, notre parent nâest plus dans
le rÃ©pertoire â¦ parent de chaque module. Maven nous permet de dÃ©finir un
chemin relatif pour pallier Ã  celaÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;parent&gt;
    &lt;groupId&gt;fr.noubliepaslalistedescourses&lt;/groupId&gt;
    &lt;artifactId&gt;parent&lt;/artifactId&gt;
    &lt;version&gt;5&lt;/version&gt;
    &lt;relativePath&gt;../parent/tags/parent-5/pom.xml&lt;/relativePath&gt;
&lt;/parent&gt;
&lt;artifactId&gt;portal&lt;/artifactId&gt;
&lt;version&gt;4.2.0-SNAPSHOT&lt;/version&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Â«Â BofÂ Â», câest tout ce que cela nous inspire spontanÃ©ment. Dâaccord, Ã§a
marche, mais de toute Ã©vidence ce nâest pas la panacÃ©e. Sans compter
que, pour obtenir les fichiers nÃ©cessaires Ã  un build complet, nous
devons faire un checkout total du projet, tags et branches inclus.</p>
</div>
<div class="paragraph">
<p>La solution nous vient en regardant comment est gÃ©rÃ© le code deâ¦ Maven
lui-mÃªmeÂ ! Subversion dispose dâun mÃ©canisme quâon pourrait comparer aux
liens symboliques dâUnixÂ : les externals. Il sâagit de rÃ©pertoires
fantÃ´mes dans la structure de fichiers SVN, sur lesquels on indique via
une propriÃ©tÃ© un lien vers un autre emplacement SVN (voir un autre dÃ©pÃ´t
SVN). Dans notre cas, nous crÃ©ons un rÃ©pertoire /trunks (avec un Â«Â sÂ Â»)
vide qui va regrouper toutes les racines de nos diffÃ©rents modulesÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>+ /parent/trunks</pre>
</div>
</div>
<div class="paragraph">
<p>Ce rÃ©pertoire ne contient strictement rien, en dehors de la propriÃ©tÃ©
svn:externals suivanteÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>pom.xml      /parent/trunk/pom.xml
portal       /portal/trunk
backend      /backend/trunk</pre>
</div>
</div>
<div class="paragraph">
<p>Un checkout de /trunks extrait de Subversion la structure traditionnelle
Maven, avec sa hiÃ©rarchie de modules, pour toutes les versions de
dÃ©veloppement. Il nous suffit alors de configurer lâintÃ©gration continue
sur ce chemin pour vÃ©rifier que chaque dÃ©veloppement reste bien
synchrone avec le reste du projet.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Si tout cela vous semble encore bien acrobatique, faites comme nousÂ :
passez Ã  GitÂ ! Subversion est le seul gestionnaire de code Ã  ne pas
supporter nativement les notions de branches et de tag. Ce nâest ni la
seule, ni la meilleure raison de migrer, mais Ã§a peut en faire une de
plus.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Le jour de la release dâun des modules, il suffit de le considÃ©rer comme
un module isolÃ©, qui dispose de son propre cycle de vie. Et pour assurer
la mise Ã  jour des diverses versions dans nos diffÃ©rents projets, plutÃ´t
que de faire Ã§a Ã  la main, nous faisons appel au plugin versionsÂ : <code>mvn
versions:use-latest-snapshots</code> par exemple sâassure que nous utilisons
bien les derniÃ¨res versions SNAPSHOT, et inversement
<code>mvn versions:use-releases</code> pour utiliser la derniÃ¨re release disponible
dâun module ayant un cycle de vie indÃ©pendant.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Le plugin versions
(<a href="http://mojo.codehaus.org/versions-maven-plugin">http://mojo.codehaus.org/versions-maven-plugin</a>)
devient rapidement indispensable pour gÃ©rer de gros projets, incluant un
grand nombre de modules ou de dÃ©pendances. Il gÃ¨re les modifications de
numÃ©ro de version, SNAPSHOT ou non, sans risquer de faire de fausses
manipulations. Accessoirement, il gÃ¨re un fichier backup des POM
modifiÃ©s, qui permet Ã  tout moment de revenir en arriÃ¨re en cas de
fausse manipulation.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Au_dela_de_l_integration_continue">Au-delÃ  de l&#8217;intÃ©gration continue</h3>
<div class="paragraph">
<p>Nous avons dÃ©jÃ  mis en Åuvre l&#8217;automatisation de notre construction de
projet au sein d&#8217;un serveur d&#8217;intÃ©gration continue. Maintenant que nous
savons tout aussi bien automatiser la construction de nos livrables, il
est naturel de franchir un pas supplÃ©mentaire.</p>
</div>
<div class="paragraph">
<p>On parle parfois de production continue pour dÃ©crire cette nouvelle
Ã©tape dans l&#8217;automatisation, et c&#8217;est une pratique qui s&#8217;inscrit dans la
dÃ©marche d&#8217;usine logicielle que de nombreuses entreprises cherchent Ã 
appliquer Ã  leurs dÃ©veloppements informatiques pour Ã©chapper Ã  un monde
oÃ¹ rÃ¨gnent le bricolage et les manipulations hasardeuses. La
Figure 10-03 prÃ©sente le principe gÃ©nÃ©ral de cette approche.</p>
</div>
<div class="paragraph">
<div class="title">Figure 10-03</div>
<p><span class="image"><img src="illustrations/10-03.png" alt="10 03"></span></p>
</div>
<div class="paragraph">
<p>Production continue.</p>
</div>
<div class="paragraph">
<p>Le concept est finalement relativement simple. Nous disposons d&#8217;une
automatisation capable de construire, tester en profondeur et publier
les versions stables de notre logiciel, avec toute la rigueur et la
traÃ§abilitÃ© dont peut rÃªver n&#8217;importe quel ingÃ©nieur qualitÃ©. La seule
Ã©tape qui reste encore plus ou moins alÃ©atoire est l&#8217;installation sur
nos plateformes de recette puis de production. Pourtant, comme nous
l&#8217;avons vu au Chapitre 8, Maven â assistÃ© de Cargo â est tout Ã  fait
capable de dÃ©ployer nos applications JavaEE sur un serveur.</p>
</div>
<div class="paragraph">
<p>En production continue, nous allons ajouter dans la description du
projet (dans notre POM), ces Ã©tapes recette et de mise en production. Il
ne restera donc entre le dÃ©veloppeur, qui saisit son code, et
l&#8217;administrateur, qui installe la nouvelle version, aucune inconnue plus
ou moins bien documentÃ©e. Bien sÃ»r, nous devrons aussi intÃ©grer dans le
processus la gestion des migrations de donnÃ©es, la possibilitÃ© d&#8217;un
retour arriÃ¨re, mais ce n&#8217;est aprÃ¨s tout qu&#8217;un problÃ¨me d&#8217;automatisation
d&#8217;un processus que nous gÃ©rions jusqu&#8217;ici Ã  la main.</p>
</div>
<div class="paragraph">
<p>L&#8217;intÃ©gralitÃ© du processus de rÃ©alisation de notre logiciel est ainsi
embarquÃ©e dans le POM. Les tÃ¢ches de construction, de test, de
validation de nos rÃ¨gles de dÃ©veloppement, de qualification, de contrÃ´le
fonctionnel et d&#8217;installation sont entiÃ¨rement automatisÃ©es et ne
dÃ©pendent plus que de la dÃ©cision de l&#8217;administrateur de cliquer sur le
bouton vert, ou plutÃ´t de lancer un <code>mvn âPproduction monserver:deploy</code>.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: center"><img src="illustrations/green-keyboard-button-deploy.png" alt="green keyboard button deploy"></span></p>
</div>
<div class="paragraph">
<p>Si pour vous câest de la science-fiction, jetez un Åil du cÃ´tÃ© du projet
Jenkins qui propose une nouvelle release par semaine depuis plus de 400
versions, ou bien considÃ©rez des sites comme Flickr.com qui font plus de
10 mises en production par jour â ce quâils appellent, eux, un
Â«Â commitÂ Â», au sens littÃ©ral du termeÂ : Â«Â engagementÂ Â».</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaEmmanuel.png" alt="MangaEmmanuel"></span></p>
</div>
<div class="paragraph">
<p>Emmanuel est plus que satisfait et raconte avec un sourire nostalgique Ã 
nos stagiaires les journÃ©es rocambolesques des premiÃ¨res versions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_9">Conclusion</h3>
<div class="paragraph">
<p>L&#8217;automatisation des processus de dÃ©veloppement est une tÃ¢che qui
nÃ©cessite un gros effort initial, non seulement pour dÃ©passer les
contraintes techniques, mais surtout pour faire passer les mauvaises
habitudes et inculquer une nouvelle vision. N&#8217;espÃ©rez pas crÃ©er en
quelques jours une usine logicielle mettant en Åuvre des tests
unitaires, d&#8217;intÃ©gration et fonctionnels sur une grille de machines.
Commencez petit sur des projets pilotes, essuyez les plÃ¢tres de vos
premiÃ¨res erreurs et attendez un peu pour rÃ©colter les fruits d&#8217;un
processus enfin compris et dont les utilisateurs seront les meilleurs
Ã©vangÃ©listes.</p>
</div>
<div class="paragraph">
<p>La livraison fait partie de ces Ã©tapes qui concernent tout le monde avec
un haut niveau de stress. L&#8217;automatisation y prend toute sa force et
dÃ©montre son intÃ©rÃªt. Maven peut vous apporter de nombreux services,
structurer votre projet, mais c&#8217;est certainement sur un point aussi
stratÃ©gique qu&#8217;il s&#8217;imposera comme outil incontournable. Chaque
spÃ©cificitÃ© de votre projet Ã©tant automatisÃ©e, documentÃ©e et historisÃ©e
<em>via</em> votre fichier POM, vous pourrez enfin vous focaliser sur la seule
chose qui compte vraimentÂ : le fonctionnement de votre application.</p>
</div>
</div>
</div>
</div>
<h1 id="_partie_3" class="sect0">Partie 3</h1>
<div class="openblock partintro">
<div class="title">Encore plus loin avec Maven</div>
<div class="content">
<div class="paragraph">
<p>L&#8217;informatique d&#8217;entreprise ne se limite pas Ã  une utilisation raisonnÃ©e
et flexible des Â«Â ressourcesÂ Â». Elle doit aussi faire face Ã  des
contraintes qui viennent d&#8217;en haut, et auxquelles le projet doit se
plier, quelles que soient ses habitudes.</p>
</div>
<div class="paragraph">
<p>AprÃ¨s quelque temps de fonctionnement, notre start-up a atteint un joli
succÃ¨s. Les promesses de stock-options commencent Ã  nous titiller, quand
la nouvelle tombeÂ : nous avons Ã©tÃ© contactÃ©s par le groupe Geegol pour
venir complÃ©ter son offre de services. C&#8217;est une reconnaissance
inespÃ©rÃ©e pour notre travail, et nous prÃ©parons avec un mÃ©lange
d&#8217;enthousiasme et d&#8217;anxiÃ©tÃ© le passage du statut de start-up Ã  celui de
filiale d&#8217;un gÃ©ant international.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/Geegol-Shopping-List.png" alt="Geegol Shopping List"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Utiliser_un_outil_non_supporte">Chapitre 11Â : Utiliser un outil non supportÃ©</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jusqu&#8217;ici, nous avons toujours trouvÃ© pour chaque problÃ¨me que nous
avons rencontrÃ© un plugin Maven adaptÃ©. Le Â«Â mariageÂ Â» de notre projet
avec les rÃ¨gles du groupe Geegol va cependant nous obliger Ã  faire
quelques efforts supplÃ©mentaires.</p>
</div>
<div class="sect2">
<h3 id="_un_outil_maison">Un outil maison</h3>
<div class="paragraph">
<p>Le groupe utilise (pour des raisons que nous nâaborderons pas ici) un
serveur qu&#8217;il a dÃ©veloppÃ© lui-mÃªme, le Â«Â <em>Geegol Execution Architecture</em>Â Â»
â GEA pour les intimes. Il ne s&#8217;agit pas d&#8217;un serveur JavaEE
traditionnel, bien qu&#8217;il y ressemble beaucoup et propose des API de
programmation compatibles. Il prÃ©sente cependant quelques restrictions
spÃ©cifiques qu&#8217;il est nÃ©cessaire de respecter pour le bon fonctionnement
de l&#8217;application.</p>
</div>
<div class="paragraph">
<p>$ CentrÃ© $</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: center"><img src="illustrations/GEA.png" alt="GEA"></span></p>
</div>
<div class="paragraph">
<p>Pour s&#8217;assurer que ces contraintes sont respectÃ©es, plutÃ´t que
d&#8217;attendre les phases de validation du projet et un Ã©ventuel crash, le
groupe a dÃ©veloppÃ© un outil dÃ©diÃ© qui identifie dÃ¨s la conception du
code le non-respect de ces rÃ¨gles.</p>
</div>
<div class="paragraph">
<p>Notre projet, venant du monde extÃ©rieur, a dÃ» passer par cette
moulinette pour identifier les adaptations nÃ©cessaires, et la tÃ¢che de
mise Ã  niveau n&#8217;a pas Ã©tÃ© aisÃ©e. Aussi, nous voudrions Ã©viter de
replonger dans cette phase de reprise du code et intÃ©grer ce contrÃ´le au
plus tÃ´t, c&#8217;est-Ã -dire Ã  chaque nouvelle ligne de code ajoutÃ©e au
logiciel.</p>
</div>
<div class="paragraph">
<p>Inutile de rechercher sur Internet, nous ne trouverons pas de plugin
Maven tout prÃªt pour ce besoin spÃ©cifique. Nous sommes le premier projet
du groupe Ã  utiliser Maven, aussi il va falloir nous remonter les
manches.</p>
</div>
<div class="sect3">
<h4 id="reutiliser_l_existant">RÃ©utiliser l&#8217;existant</h4>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaHerve.png" alt="MangaHerve"></span></p>
</div>
<div class="paragraph">
<p>L&#8217;outil de Geegol est assez simple d&#8217;utilisation. Il est Ã©crit en Java,
et on lâinvoque depuis la ligne de commande en fournissant la liste des
fichiers sources .java Ã  analyser. Il faut Ã©galement que le classpath
soit configurÃ© pour inclure toutes les bibliothÃ¨ques rÃ©fÃ©rencÃ©es dans ce
code source. HervÃ© s&#8217;attaque donc Ã  lâapplication de ce nouvel outil sur
notre projet, en l&#8217;intÃ©grant dans notre processus de construction par
Maven.</p>
</div>
<div class="paragraph">
<p>Une Ã©tape prÃ©alable Ã  toute solution basÃ©e sur Maven est de mettre Ã  la
disposition de celui-ci la bibliothÃ¨que de notre outil gea-check sous
forme d&#8217;artefact Maven. Nous devons donc le placer dans notre dÃ©pÃ´t de
bibliothÃ¨ques, accompagnÃ© d&#8217;un fichier POM fournissant les mÃ©tadonnÃ©es
adÃ©quates, en particulier la liste prÃ©cise de ses dÃ©pendances. Nous
avons dÃ©jÃ  Ã©voquÃ© au Chapitre 2 l&#8217;identification des bibliothÃ¨ques et de
leur version. HervÃ© prÃ©pare soigneusement un fichier POM et le
tÃ©lÃ©charge avec l&#8217;archive JAR dans notre dÃ©pÃ´t de bibliothÃ¨ques.</p>
</div>
<div class="paragraph">
<p>De nombreux projets utilisent Ant pour leur construction â ou l&#8217;ont
utilisÃ© avant de passer Ã  Maven â avec les limites que nous avons dÃ©jÃ 
vues. Le groupe a dÃ©veloppÃ© pour son outil une tÃ¢che Ant qui lance la
gÃ©nÃ©ration documentaire, nous ne partons donc pas de rien.</p>
</div>
<div class="paragraph">
<p>La solution la plus rapide consiste Ã  utiliser la tÃ¢che Ant telle quelle
dans notre projet Maven. HervÃ© pourra ainsi rassurer tout le monde en
prouvant que le choix de Maven ne met pas des bÃ¢tons dans les roues.
Cela est possible grÃ¢ce Ã  un plugin standardÂ : AntRun, lequel, comme son
nom le suggÃ¨re, va exÃ©cuter un script Ant lors de la construction du
projet par Maven. VoilÃ  qui pourrait bien nous sauver la miseÂ ! Le
Listing 11.1 montre la configuration que nous avons ajoutÃ©e au projet
pour gÃ©rer cette Ã©tape.</p>
</div>
<div class="listingblock">
<div class="title">Listing 11.1 : Utilisation du plugin <em>AntRun</em></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
    &lt;artifactId&gt;maven-antrun-plugin&lt;/artifatcId&gt;
    &lt;version&gt;1.3&lt;/version&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;goals&gt;
                &lt;goal&gt;run&lt;/goal&gt;
            &lt;goals&gt;
            &lt;phase&gt;site&lt;/phase&gt;
            &lt;configuration&gt;
                &lt;tasks&gt;
                  &lt;classpath id="cp"&gt;
                     &lt;pathElement ref="${maven.plugin.dependencies}"/&gt;
                     &lt;pathElement ref="${maven.compile.dependencies}"/&gt;
                  &lt;/classpath&gt;
                  &lt;taskdef task="check"
                         class="com.geegol.GeegolProjectPlatformCheck"
                         classpathRef="cp"/&gt;
                  &lt;check src="${project.build.sourceDirectory}"
                         out="${project.build.directory}/check"/&gt;
                &lt;/tasks&gt;
            &lt;/configuration&gt;
            &lt;dependencies&gt;
                &lt;dependency&gt;
                    &lt;groupId&gt;com.geegol.gea&lt;/groupId&gt;
                    &lt;artifactId&gt;geacheck&lt;/artifactId&gt;
                    &lt;version&gt;1.2.0&lt;/version&gt;
                &lt;/dependency&gt;
            &lt;/dependencies&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ce fragment de script Ant rÃ©utilise des variables Maven pour pointer
vers les rÃ©pertoires du projet, conformÃ©ment aux conventions de Maven,
et manipuler les listes de dÃ©pendances du projet et du plugin. Par
dÃ©faut, le plugin AntRun ne propose dans le ClassPath d&#8217;exÃ©cution du
fragment de script que la bibliothÃ¨que Ant standard (la version dâAnt
utilisÃ©e par dÃ©faut dÃ©pend de la version du plugin, Antrun 1.3 utilise
par exemple Ant 1.7.1). Pour invoquer notre tÃ¢che spÃ©cifique, nous
devons y ajouter la bibliothÃ¨que maison GEACheck (et ses dÃ©pendances)
<em>via</em> un bloc &lt;dependency&gt;, appliquÃ© au plugin.</p>
</div>
<div class="paragraph">
<p>Cette petite manipulation nous permet donc d&#8217;utiliser sans souci les
outils en place. Fin du Chapitre 11Â ? Non, bien sÃ»r.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Dans le Listing 11.1, nous n&#8217;avons pas indiquÃ© d&#8217;identifiant de groupe
pour dÃ©clarer le plugin. Maven utilise en effet une liste de groupes
pour identifier les plugins lorsque cette information n&#8217;est pas fournie.
Par dÃ©faut, cette liste inclut org.apache.maven.plugins et
org.codehaus.mojo, soit les deux sources officielles de plugins de la
communautÃ© des dÃ©veloppeurs Maven. Cette liste peut Ãªtre enrichie de
nouvelles entrÃ©es (<em>via</em> leur identifiant de groupe) dans le fichier de
configuration de MavenÂ : settings.xml. Si votre entreprise utilise de
nombreux plugins maison, ce mÃ©canisme peut vous aider Ã  allÃ©ger votre
configuration, cependant cela suppose que chaque dÃ©veloppeur dispose
d&#8217;un fichier settings.xml correctement configurÃ©.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_retour_dans_un_monde_de_scripts">Retour dans un monde de scriptsÂ ?</h4>
<div class="paragraph">
<p>Cette solution est trÃ¨s pratique car elle permet de rÃ©utiliser en peu de
temps du code existant. Dans la mÃªme veine, nous pourrions exÃ©cuter un
script Groovy ou BeanShell. Cependant, cette pratique n&#8217;est pas tout Ã 
fait satisfaisanteÂ :</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaHerve.png" alt="MangaHerve"></span></p>
</div>
<div class="paragraph">
<p>HervÃ© n&#8217;est pas prÃªt Ã  se contenter de cette solution qui n&#8217;est, pour
lui, qu&#8217;un pis-allerÂ : d&#8217;une part, nous sacrifions l&#8217;idÃ©e phare de Maven
de ne pas devenir un niÃ¨me langage de script. OÃ¹ est l&#8217;approche
dÃ©clarative dans ce que nous venons de faireÂ ? D&#8217;autre part,
l&#8217;intÃ©gration de notre bout de script Ant dans Maven est trÃ¨s
imparfaite. Nous devons explicitement dÃ©clarer les dÃ©pendances de
l&#8217;outil de gÃ©nÃ©ration dans notre fichier POM â ce qui signifie que nous
devons les connaÃ®tre, donc aller consulter sa documentation pour en
extraire cette information. Cela ne vous rappelle rienÂ ? Alors,
retournez au Chapitre 2Â !</p>
</div>
<div class="paragraph">
<p>AntRun a Ã©tÃ© conÃ§u comme un outil de transition pour faciliter la vie
des projets basÃ©s sur Ant. Les concepteurs de Maven, conscients qu&#8217;il
Ã©tait impossible de proposer des plugins pour toutes les tÃ¢ches Ant
existantes, ont introduit ce plugin utilitaire, en insistant bien sur
son rÃ´le de roue de secours en attendant mieux. Nous l&#8217;utilisons donc
provisoirement pour rÃ©pondre aux exigences du groupe, mais lanÃ§ons
immÃ©diatement une nouvelle tÃ¢cheÂ : l&#8217;Ã©criture d&#8217;un plugin Maven pour
notre outil de gÃ©nÃ©ration documentaire. C&#8217;est donc Ã  cette tÃ¢che
qu&#8217;HervÃ© va s&#8217;attaquer Ã  prÃ©sent.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Creer_un_plugin">CrÃ©er un plugin</h3>
<div class="sect3">
<h4 id="_pas_de_panique">Pas de paniqueÂ !</h4>
<div class="paragraph">
<p>CrÃ©er de toutes piÃ¨ces un plugin peut faire peur <em>a priori</em>. Nous allons
voir, pourtant, que cela ne nous dÃ©paysera pas beaucoup de notre
dÃ©veloppement classique avec Maven. Nous allons dÃ©rouler, au cours des
paragraphes suivants, la construction pas Ã  pas de ce plugin.</p>
</div>
<div class="paragraph">
<p>La premiÃ¨re Ã©tape nÃ©cessite de crÃ©er un projet Maven pour notre plugin.
Ce projet est tout ce qu&#8217;il y a de plus classique, Ã  la seule exception
de son type d&#8217;assemblage, qui est maven-plugin.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Pour crÃ©er rapidement un plugin Maven, vous pouvez exploiter un
archÃ©type, mais nous en reparlerons au Chapitre 14, alors ne brÃ»lons pas
les Ã©tapesâ¦</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listing 11.2 : En-tÃªte POM du plugin documentaire</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.geegol.maven.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;geegol-doc-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
  &lt;packaging&gt;maven-plugin&lt;/packaging&gt;
  &lt;name&gt;Plugin de contrÃ´le GEA&lt;/name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Le reste du projet est tout ce qu&#8217;il y a de plus classique. RÃ©pertoires
de sources, de ressources et de tests, dÃ©pendances et compagnie. Pas de
quoi fouetter un chatÂ !</p>
</div>
<div class="paragraph">
<p>La tÃ¢che check que nous voulons crÃ©er dans notre plugin sera associÃ©e Ã 
une classe spÃ©cifique. Ces classes sont appelÃ©es dans le vocabulaire
Maven des mojos (<em>Maven Old Java Object</em>), par allusion au concept de
POJO <sup class="footnote">[<a id="_footnoteref_38" class="footnote" href="#_footnotedef_38" title="View footnote.">38</a>]</sup> qui a fait le succÃ¨s des bibliothÃ¨ques Spring et
Hibernate. Ce terme a aussi Ã©tÃ© choisi avec malice pour faire rÃ©fÃ©rence
au nom donnÃ© au Cameroun Ã  des amulettes â inutile de chercher un lien
avec le personnage de super-vilain associÃ© Ã  ce nom dans le comics
<em>X-Men</em>Â ;-).</p>
</div>
<div class="paragraph">
<p>En fait, ce sont de simples classes qui implÃ©mentent l&#8217;interface
org.apache.maven.plugin.Mojo, et, dans la trÃ¨s grande majoritÃ© des cas â
dont le nÃ´tre â, on se contente d&#8217;Ã©tendre la classe AbstractMojo. Le
Listing 11.3 prÃ©sente la structure gÃ©nÃ©rale de notre classe
GEACheckMojo.</p>
</div>
<div class="listingblock">
<div class="title">Listing 11.3 : Notre classe <em>Mojo</em> de base</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
 * TÃ¢che de gÃ©nÃ©ration de la documentation au format Geegol.
 *
 * @goal check
 * @phase process-sources
 */
public class GEACheckMojo
    extends AbstractMojo
{
    public void execute()
        throws MojoExecutionException
    {
        // ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Toutes les caractÃ©ristiques liÃ©es Ã  Maven sont dÃ©clarÃ©es dans des
balises Javadoc spÃ©ciales de notre classe Mojo. C&#8217;est ici qu&#8217;HervÃ© va
indiquer le nom de la tÃ¢che et Ã©ventuellement des indications sur les
contraintes que le projet doit respecter pour l&#8217;utiliser.</p>
</div>
<div class="paragraph">
<p>Le Listing 11.3 montre le bloc de commentaires Javadoc de notre mojo.
L&#8217;annotation @goal indique le nom de la tÃ¢che. @phase indique la phase
dans le cycle de vie pour laquelle notre mojo a Ã©tÃ© conÃ§u, et Ã  laquelle
il sera greffÃ© par dÃ©faut. Nous associons le plugin Ã  la phase d&#8217;analyse
des sources, qui a lieu avant la compilation.</p>
</div>
<div class="paragraph">
<p>Nous avons donc un projet Maven capable de produire un plugin qui
exÃ©cutera notre code Java lors de la phase process-sources. On vous
l&#8217;avait bien dit que ce n&#8217;Ã©tait pas bien compliquÃ©Â !</p>
</div>
</div>
<div class="sect3">
<h4 id="des_parametres_pour_le_plugin">Des paramÃ¨tres pour le plugin</h4>
<div class="paragraph">
<p>Le plugin d&#8217;HervÃ© est un peu tout seul dans son coin. On doit encore lui
associer des paramÃ¨tres qui permettront d&#8217;ajuster son fonctionnement aux
besoins de nos projets.</p>
</div>
<div class="paragraph">
<p>L&#8217;outil d&#8217;analyse que nous cherchons Ã  intÃ©grer produit un fichier de
compte-rendu. HervÃ© va dans un premier temps permettre Ã  l&#8217;utilisateur
de dÃ©finir le nom et l&#8217;emplacement de ce fichier, tout en proposant une
valeur par dÃ©faut qui devrait convenir Ã  la majoritÃ© des cas.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
 * Emplacement du fichier de compte-rendu
 * @parameter default-value="${project.build.directory}/check.html"
 */

private File output;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Comme la configuration gÃ©nÃ©rale du Mojo, les paramÃ¨tres sont dÃ©clarÃ©s
<em>via</em> des annotations Â«Â Ã  l&#8217;ancienneÂ Â» dans le Javadoc (aussi connu sous
le nom de doclets). Chaque paramÃ¨tre peut dÃ©finir une valeur par dÃ©faut,
qui servira donc de convention pour l&#8217;utilisation du plugin. Cette
valeur par dÃ©faut peut Ãªtre une expression faisant rÃ©fÃ©rence Ã  un
Ã©lÃ©ment du fichier POM. Dans l&#8217;exemple prÃ©cÃ©dent, nous identifions par
exemple le paramÃ¨tre output oÃ¹ l&#8217;outil d&#8217;analyse va Ã©crire son rapport.
Les utilisateurs de notre plugin pourront modifier ce paramÃ¨tre dans
leur fichier POM en ajoutant dans la configuration un Ã©lÃ©ment &lt;output&gt;
avec le chemin de leur choix.</p>
</div>
<div class="paragraph">
<p>L&#8217;expression dÃ©limitÃ©e par Â«Â ${Â Â» et Â«Â }Â Â» permet d&#8217;identifier des nÅuds du
modÃ¨le objet du projetÂ ; rappelez-vous que Maven charge les donnÃ©es XML
de notre POM en mÃ©moire sous forme d&#8217;un arbre d&#8217;objets, aprÃ¨s fusion
avec les parents dont il peut hÃ©riter et activation des profils.
project.build.directory Ã©quivaut ainsi Ã  l&#8217;Ã©lÃ©ment
&lt;project&gt;&lt;build&gt;&lt;directory&gt; du fichier POM.xml du projet, de son parent
ou de la valeur par dÃ©faut de cette propriÃ©tÃ©. Dans la trÃ¨s grande
majoritÃ© des cas, il s&#8217;agira du rÃ©pertoire target, mais ne prÃ©sumons pas
de la faÃ§on dont notre plugin sera utilisÃ© et des contraintes que vont
rencontrer nos projets. Conventions ne signifie pas obligationsÂ !</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Le plus souvent, les plugins Maven utilisent ces expressions pour ne pas
coder en dur les chemins qui correspondent aux conventions. Ce n&#8217;est
cependant pas garanti et cela dÃ©pend du degrÃ© de connaissance des
dÃ©veloppeurs de plugins, et c&#8217;est l&#8217;une des raisons pour lesquelles nous
vous encourageons Ã  utiliser ces conventions mÃªme si elles ne vous
plaisent pas complÃ¨tement.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="un_modele_dynamique">Un modÃ¨le dynamique</h4>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaHerve.png" alt="MangaHerve"></span></p>
</div>
<div class="paragraph">
<p>Dans sa premiÃ¨re version, le plugin d&#8217;HervÃ©, pour analyser notre code
source, utilisait un paramÃ¨tre basÃ© sur l&#8217;expression
project.build.sourceDirectory, qui renvoie pour un projet standard le
chemin src/main/java. HervÃ© lance donc son plugin sur le projet devant
nos yeux pleins d&#8217;impatience et il est fier de nous prÃ©senter le rapport
gÃ©nÃ©rÃ© quelques secondes plus tard dans le rÃ©pertoire target.
Applaudissements, puis dÃ©sillusionÂ : le code analysÃ© est bien celui de
notre projet, mais il en manque toute une partieÂ !</p>
</div>
<div class="paragraph">
<p>Notre projet utilise un plugin gÃ©nÃ©rateur de code, transformant un
modÃ¨le UML en code source Java. Ce code est crÃ©Ã© sous
target/generated-sources/plugin et n&#8217;a pas Ã©tÃ© exploitÃ© par l&#8217;outil
d&#8217;analyse. Oups, boulette. HervÃ© retourne rapidement Ã  son code, quelque
peu gÃªnÃ© par ce petit contretemps.</p>
</div>
<div class="paragraph">
<p>Un projet Maven comprend, au niveau du modÃ¨le du projet, non pas un
rÃ©pertoire source mais une liste dynamique d&#8217;emplacements. Chaque plugin
qui gÃ©nÃ¨re du code source va ajouter le rÃ©pertoire qu&#8217;il utilise sur
cette liste. De la mÃªme faÃ§on, les plugins qui exploitent le code
source, Ã  commencer par le plugin de compilation, vont reposer sur cette
liste dynamique de rÃ©pertoires.</p>
</div>
<div class="paragraph">
<p>Pour accÃ©der au modÃ¨le objet du projet et consulter le moment voulu
cette liste de rÃ©pertoires, nous devons manipuler directement l&#8217;objet
MavenProject que Maven met Ã  notre disposition. Nous dÃ©finissons donc un
nouveau paramÃ¨tre au plugin, bien que celui-ci soit un peu particulierÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
 * ModÃ¨le objet du projet Maven
 * @parameter expression=â${project}â
 * @required
 * @readonly
 */

private MavenProject project;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nous dÃ©couvrons en passant deux autres annotations qui peuvent
s&#8217;appliquer aux paramÃ¨tres. @required permet de stopper le build avec un
message d&#8217;erreur adÃ©quat si la configuration est incomplÃ¨te, et
@readonly signale que le paramÃ¨tre est extrait des structures internes
de Maven et non spÃ©cifiÃ© par l&#8217;utilisateur dans son POM.</p>
</div>
<div class="paragraph">
<p>Nous pouvons ainsi mettre un pied dans les API de Maven et sa
modÃ©lisation objet d&#8217;un projet. Selon la tÃ¢che Ã  rÃ©aliser, cela pourra
Ãªtre nÃ©cessaire. L&#8217;invocation de la mÃ©thode
project.getCompileSourceRoots() donnera la liste courante de tous les
rÃ©pertoires de fichiers sources.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;String&gt; sources = project.getCompileSourceRoots();
for (String root : sources)
{
    // TODO analyser chaque fichier source de ce rÃ©pertoire
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_plexus">Plexus</h4>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaHerve.png" alt="MangaHerve"></span></p>
</div>
<div class="paragraph">
<p>Pour Ã©toffer son plugin, HervÃ© veut dans notre cas proposer une archive
ZIP du rapport (trÃ¨s verbeux) gÃ©nÃ©rÃ© par l&#8217;outil d&#8217;analyse Geegol, pour
que l&#8217;utilisateur puisse plus facilement le tÃ©lÃ©charger et en conserver
l&#8217;historique. C&#8217;est ici qu&#8217;intervient la notion de composant, une brique
logicielle rÃ©utilisable. Les briques en question dÃ©pendent de la
technologie sur laquelle tourne une application.</p>
</div>
<div class="paragraph">
<p>Maven utilise le conteneur Plexus <sup class="footnote">[<a id="_footnoteref_39" class="footnote" href="#_footnotedef_39" title="View footnote.">39</a>]</sup> pour l&#8217;exÃ©cution de
ses composants. Vous Ãªtes probablement familiarisÃ© avec l&#8217;un de ses
concurrents qui remporte un grand succÃ¨s en entrepriseÂ :
SpringFramework. Le fonctionnement de Plexus est relativement
comparable, en dehors du mÃ©canisme d&#8217;annotations qui jusqu&#8217;il y a peu de
temps ne sâappuyait que sur des balises Javadoc Ã  la place des
annotations de Java 5.</p>
</div>
<div class="paragraph">
<p>Plexus et Maven mettent Ã  disposition un large choix de composants
utilitaires que vous pouvez rÃ©fÃ©rencer dans des plugins. HervÃ© a besoin
d&#8217;exploiter les capacitÃ©s d&#8217;un outil d&#8217;archivage, il ajoute en
dÃ©pendance Ã  son projet Maven la bibliothÃ¨que plexus-archiver. Il lui
reste Ã  prÃ©sent Ã  y accÃ©der depuis le plugin.</p>
</div>
<div class="paragraph">
<p>Comme Spring, Plexus met en Åuvre le patron d&#8217;injection de
dÃ©pendances <sup class="footnote">[<a id="_footnoteref_40" class="footnote" href="#_footnotedef_40" title="View footnote.">40</a>]</sup> (eh oui, bien que mÃ©connu, Plexus Ã©tait
trÃ¨s novateur en son tempsÂ !). Ce n&#8217;est donc pas le plugin qui va aller
chercher un composant mais le conteneur qui va initialiser le plugin
avec les composants dÃ©clarÃ©s comme indispensables. Un composant est
rÃ©fÃ©rencÃ© <em>via</em> l&#8217;annotation @component et sera injectÃ© lors de
l&#8217;exÃ©cution de Maven directement au niveau de l&#8217;attribut. Le composant
est identifiÃ© par une chaÃ®ne de caractÃ¨res qui est, par convention, le
nom complet de l&#8217;interface quâil rÃ©alise. Lorsque plusieurs variantes
sont disponibles, Plexus propose soit de complÃ©ter l&#8217;identificateur par
un qualificateur complÃ©mentaire identifiÃ© par le caractÃ¨re Â«Â #Â Â», soit de
prÃ©ciser plus explicitement un attribut hint (voir l&#8217;exemple suivant).
Pour faire appel Ã  un composant de dÃ©compression d&#8217;archive ZIP par
exemple, on ajoutera l&#8217;attribut suivant dans notre pluginÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
 * Permet de manipuler des archives ZIP
 * @component role="org.codehaus.plexus.archiver.Archiver" hint="zip"
 */

 private Archiver zipArchiver;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Il faudra Ã©videmment ajouter Ã  notre plugin une dÃ©pendance vers la
bibliothÃ¨que plexus-archiver qui contient ce composant. L&#8217;Ã©cosystÃ¨me
Plexus compte de trÃ¨s nombreux composants, permettant de traiter un
grand nombre de tÃ¢ches. La documentation de ces composants est
malheureusement souvent un peu minimaliste, et mÃªme leur liste complÃ¨te
est dÃ©licate Ã  obtenir en dehors du code source sous SVN.</p>
</div>
</div>
<div class="sect3">
<h4 id="_plexus_utils">Plexus-utils</h4>
<div class="paragraph">
<p>En plus des composants Plexus, HervÃ© a besoin de faire de nombreuses
manipulations de fichiers, entre autres pour sÃ©lectionner la liste des
fichiers .java dans nos rÃ©pertoires de code source.</p>
</div>
<div class="paragraph">
<p>Une bibliothÃ¨que un peu Ã  part dans l&#8217;Ã©cosystÃ¨me Plexus est
plexus-utils. Elle ne propose pas de composants au sens oÃ¹ nous l&#8217;avons
vu prÃ©cÃ©demment, mais un ensemble de classes utilitaires. En
particulier, on y trouve une sÃ©rie de mÃ©thodes de manipulation de
fichiers FileUtils ainsi qu&#8217;un DirectoryScanner, qui permet de
sÃ©lectionner des fichiers Ã  partir d&#8217;un rÃ©pertoire en fonction de
patrons Ant d&#8217;inclusion et d&#8217;exclusion.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private List&lt;File&gt; getJavaSources( File root )
{
    List&lt;File&gt; files = new ArrayList&lt;File&gt;();

    DirectoryScanner scanner = new DirectoryScanner();
    scanner.setBasedir( root );
    scanner.setIncludes( new String[] { "**/*.java" } );
    scanner.scan();

    for ( String relativeFilePath : scanner.getIncludedFiles() )
    {
        files.add( new File( root, relativeFilePath ) );
    }
    return files;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nous avons donc une mÃ©thode qui retourne la liste complÃ¨te des fichiers
sources Java de notre projet, code gÃ©nÃ©rÃ© inclusÂ ! Reste Ã  passer
l&#8217;outil de contrÃ´le Geegol dessus.</p>
</div>
</div>
<div class="sect3">
<h4 id="_des_classes_et_des_royaumes">Des classes et des royaumesâ¦</h4>
<div class="paragraph">
<p>Une difficultÃ© Ã  traiter est que le classpath de notre plugin sera
constituÃ© en fonction des dÃ©pendances qu&#8217;il dÃ©clare, et non en fonction
du projet sur lequel nous allons l&#8217;utiliser. Nous devrons donc
construire un ClassPath combinant le projet avec la dÃ©pendance gea-check
de notre plugin pour exÃ©cuter notre outil dans les conditions
nÃ©cessaires Ã  son bon fonctionnement.</p>
</div>
<div class="paragraph">
<p>Pour gÃ©rer la sÃ©paration de ses classes internes et de celles de ses
plugins, Maven repose sur la bibliothÃ¨que ClassWorlds <sup class="footnote">[<a id="_footnoteref_41" class="footnote" href="#_footnotedef_41" title="View footnote.">41</a>]</sup>.
Celle-ci dÃ©finit la notion de royaumes (<em>realm</em>) dans lesquels on vient
ajouter des Ã©lÃ©ments de classpath et, Ã©ventuellement, exporter des
packages. Maven met ainsi ses API Ã  disposition des plugins sans exposer
pour autant ses classes internes. Il est intÃ©ressant de voir que cette
mÃªme problÃ©matique est relevÃ©e de maniÃ¨re indÃ©pendante par OSGi, sur
lequel on aurait sans doute bÃ¢ti Maven s&#8217;il avait Ã©tÃ© crÃ©Ã© en 2009Â !</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Si vous n&#8217;Ãªtes pas du tout habituÃ© Ã  la notion de ClassLoader, vous
pouvez considÃ©rer que ce sont des boÃ®tes Ã©tanches qui disposent chacune
d&#8217;une liste de chemins et de bibliothÃ¨ques de classes. Plusieurs
ClassLoaders cohabitent dans la JVM et partagent un parent commun
correspondant au runtime Java standard. Il est possible pour des classes
issues de deux classloaders de collaborer si elles Ã©changent des classes
issues d&#8217;un mÃªme parent.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Vous avez sans doute dÃ©jÃ  rencontrÃ© des problÃ¨mes de ClassLoaders, de
sombres histoires de classes qui ne sont pas ce qu&#8217;elles disent Ãªtre, ou
encore des problÃ¨mes pour la configuration de la bibliothÃ¨que
commons-logging. C&#8217;est un sujet complexe, aussi nous ne nous attarderons
pasÂ ;).</p>
</div>
<div class="paragraph">
<p>Pour notre plugin, nous allons construire un realm dÃ©diÃ© Ã  l&#8217;exÃ©cution
de GEACheck, incluant ce dernier et ses dÃ©pendances ainsi que les
chemins d&#8217;accÃ¨s au code source. La figure 11-01 montre la structure que
nous devons mettre en place.</p>
</div>
<div class="paragraph">
<p>Figure 11-01
<span class="image"><img src="illustrations/11-01.png" alt="11 01"></span></p>
</div>
<div class="paragraph">
<p>Arbre des royaumes ClassWorlds.</p>
</div>
<div class="paragraph">
<p>Le Listing 11.4 montre le code du plugin pourÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>construire un nouveau ClassLoader (chargeur de classe)Â ;</p>
</li>
<li>
<p>lui associer les dÃ©pendances et rÃ©pertoires du projet sur lequel
il travailleÂ ;</p>
</li>
<li>
<p>lui associer la bibliothÃ¨que de l&#8217;outil que nous voulons
exÃ©cuterÂ ;</p>
</li>
<li>
<p>exÃ©cuter l&#8217;outil GEACheck Ã  l&#8217;intÃ©rieur de ce contexte.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Par souci de clartÃ©, nous nâavons pas indiquÃ© dans ce listing les
diverses gestions d&#8217;exception qui sont rendues nÃ©cessaires par la
manipulation d&#8217;URL. Cette gymnastique est la plus grande difficultÃ©
rencontrÃ©e lors du dÃ©veloppement d&#8217;un plugin Maven, d&#8217;une part parce que
le commun des dÃ©veloppeurs n&#8217;est pas suffisamment Ã  lâaise avec le
concept de ClassLoader, d&#8217;autre part parce que l&#8217;API Maven-project
manque de documentation.</p>
</div>
<div class="listingblock">
<div class="title">Listing 11.4 : Construction d&#8217;un royaume ClassWorlds dÃ©diÃ© Ã  l&#8217;exÃ©cution de GEACheck</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
 * DÃ©pendances du projet Maven qui utilise le plugin
 * @parameter expression=â${project.compileArtifacts}â
 */

private List&lt;Artifact&gt; projectArtifacts;

/**
 * DÃ©pendances du plugin lui-mÃªme
 * @parameter expression=â${pluginArtifacts}â
 */
private List&lt;Artifact&gt; pluginArtifacts;

    public ClassLoader createClassLoader()
        throws MalformedURLException, DuplicateRealmException
    {
        ClassWorld world = new ClassWorld();
        ClassRealm realm = world.newRealm( "gea-check" );

        // Ajout de tous les Ã©lÃ©ments du classpath "compile" du projet
        for ( Artifact artifact : projectArtifacts )
        {
            realm.addConstituent( artifact.getFile().toURL() );
        }

        // Ajout des dÃ©pendances du plugin, comprenant l'outil GEACheck
        for ( Artifact artifact : pluginArtifacts )
        {
            realm.addConstituent( artifact.getFile().toURL() );
        }

        return realm.getClassLoader();
    }</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>En Ã©tant puristes, nous aurions dÃ» construire notre royaume en n&#8217;y
incluant que gea-check et ses dÃ©pendances, alors que nous y plaÃ§ons
toutes les dÃ©pendances du plugin. Techniquement parlant, les API de
manipulation d&#8217;artefacts et de gestion des dÃ©pendances le permettent
mais c&#8217;est inutilement compliquÃ©. Dans notre cas, le plugin est
totalement fonctionnel et quelques classes en trop ne perturbent pas
GEACheck.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Il ne reste plus Ã  HervÃ© qu&#8217;Ã  utiliser le ClassLoader que nous venons de
construire pour charger l&#8217;outil GEACheck et Ã  l&#8217;invoquer avec la liste
de fichiers sources java que nous avons construite prÃ©cÃ©demment.
L&#8217;invocation d&#8217;une classe depuis un classloader diffÃ©rent du nÃ´tre nous
oblige Ã  passer par la rÃ©flexion Java (voir Listing 11.5).</p>
</div>
<div class="listingblock">
<div class="title">Listing 11.5 : Invocation par rÃ©flexion de l&#8217;outil <em>GEACheck</em></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    public void execute()
        throws MojoFailureException
    {
        try
        {
            ClassLoader cl = createClassLoader();
            Class checker = Class.forName(
"com.geegol.projectplatform.Checker", true, cl );
            Method main = checker.getMethod( "main", new Class[] {
String.class } );

            List&lt;String&gt; sources = (List&lt;String&gt;)
project.getCompileSourceRoots();

            for ( String root : sources )
            {
                List&lt;File&gt; files = getJavaSources( new File( root ) );
                Object[] args = new Object[files.size()];

                int i = 0;
                for ( File f : files )
                {
                    args[i++] = f.getAbsolutePath();
                }

                main.invoke( checker, args );
            }
        }
        catch ( Exception e )
        {
            throw new MojoFailureException( "Erreur lors de la
gÃ©nÃ©ration du rapport", e );
        }
    }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bye_bye_maven_2">Bye bye Maven 2</h4>
<div class="paragraph">
<p><span class="image"><img src="illustrations/Maven3.png" alt="Maven3"></span></p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaOlivier.png" alt="MangaOlivier"></span></p>
</div>
<div class="paragraph">
<p>Olivier revient tout juste dâune confÃ©rence sur lâavenir de Java et les
plans de dÃ©veloppement de JavaEE 7, et nous trouve tous au chevet de
notre plugin. Sa premiÃ¨re rÃ©action est la stupeurÂ : nous sommes en train
de dÃ©velopper du code en injectant des dÃ©pendances via des annotations
dans du JavaDoc, le genre de choses quâon faisait â¦ en 2004 avec Apache
commons-attributesÂ ! Nous avons mis dans notre projet le top du dernier
buzz en termes de technologies, et nous voilÃ  ramenÃ©s une dÃ©cennie en
arriÃ¨re.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="illustrations/Maven3.png" alt="Maven3"></span></p>
</div>
<div class="paragraph">
<p>La cause de ce choc technologique, câest que nous utilisons lâAPI Maven
2.0, qui date de la crÃ©ation de lâoutil. Pour offrir une compatibilitÃ©
sans faille Ã  ses utilisateurs, Maven 3 reste 100% compatible avec cette
API historique, alors quâen interne les choses ont beaucoup changÃ©.</p>
</div>
<div class="paragraph">
<p>Dans lâÃ©quipe, nous utilisons tous Maven3, Java7, JavaEE 6, pourquoi
sâencombrer de ce passÃ© obsolÃ¨teÂ ?</p>
</div>
<div class="paragraph">
<p>Olivier sâattaque donc Ã  moderniser notre socle technique. Bye Bye
Maven2, ce qui se traduit dans note POM par un prÃ©requis sans appelÂ :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"> &lt;prerequisites&gt;
      &lt;maven&gt;3.0.0&lt;/maven&gt;
  &lt;/prerequisites&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>VoilÃ  qui rappellera Ã  lâordre les Ã©ventuels distraits.</p>
</div>
<div class="paragraph">
<p>Dans notre plugin, Olivier convertit nos attributs JavaDoc dans leurs
Ã©quivalents en annotations Java, sur la base de lâAPI
maven-plugin-toolss-java5 et de lâinjection de dÃ©pendances @JSR-330.</p>
</div>
<div class="paragraph">
<p>Attention</p>
</div>
<div class="paragraph">
<p>Olivier se base sur du code qui nâest pas encore disponible en version
finale. Sonatype est trÃ¨s actif sur ce chantier (projet SisuÂ :
<a href="https://github.com/sonatype/sisu" class="bare">https://github.com/sonatype/sisu</a>) qui vise Ã  homogÃ©nÃ©iser son offre
logicielle, aussi Ã  lâheure oÃ¹ la seconde Ã©dition sortira des presses,
nous espÃ©rons que ce code sera intÃ©grÃ© dans la version courante de Maven
3.x</p>
</div>
<div class="listingblock">
<div class="title">Listing 11.6 : Le mojo <em>GEACheck</em> en version Maven3 / JSR-330</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
 * TÃ¢che de gÃ©nÃ©ration de la documentation au format Geegol.
 */
@Goal( name="check" )
@Phase( PROCESS-SOURCES )
@ThreadSafe
class GEACheckMojo extends SisuMavenMojo {

    @Inject Logger logger;

    /**
     * Emplacement du fichier de compte-rendu
     */
    @Inject @Named( "${ouput}" )
    @DefaultsTo( "${project.build.directory}/check.html" )
    private File output ;

    /**
     * ModÃ¨le objet du projet Maven
     */
    @Inject @Named( "${projet}" )
    private project

    @Inject @Named( "zip" )
    private Archiver zipArchiver;


    /**
     * DÃ©pendances du projet Maven qui utilise le plugin
     */
    @Inject @Named( "${project.compileArtifacts}" )
    private Set&lt;Artifact&gt; projectArtifacts;

    /*
     * DÃ©pendances du plugin lui-mÃªme
     */
    @Inject @Named( "${pluginArtifacts}" )
    private Set&lt;Artifact&gt; pluginArtifacts;

    public void execute() throws Exception {

        â¦

    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tester_notre_plugin">Tester notre plugin</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaHerve.png" alt="MangaHerve"></span></p>
</div>
<div class="paragraph">
<p>HervÃ© est fier de nous montrer le fonctionnement de son plugin, qui a
nÃ©cessitÃ© quelques acrobaties techniques avec les ClassLoaders mais qui
n&#8217;Ã©tait finalement pas si compliquÃ© que Ã§a Ã  dÃ©velopper, une fois ces
bases acquises. Par contre, il garde un mauvais souvenir de sa premiÃ¨re
dÃ©mo pour laquelle le rÃ©sultat Ã©tait incomplet. Il voudrait que son
projet de plugin puisse Ãªtre Ã©quipÃ© de tests, comme tout bon projet
MavenÂ !</p>
</div>
<div class="paragraph">
<p>Un moyen simple de tester le plugin est de l&#8217;assembler sous forme de JAR
et de l&#8217;invoquer manuellement depuis l&#8217;un de nos projets. Nous avons
cependant pris l&#8217;habitude des tests automatisÃ©s et de leur intÃ©rÃªt pour
assurer la stabilitÃ© de nos dÃ©veloppements. L&#8217;Ã©cosystÃ¨me Maven propose
plusieurs options pour outiller de tests notre plugin. Du fait que
celui-ci pourra Ãªtre utilisÃ© sur de nombreux projets, sa stabilitÃ© est
indispensable et une rÃ©gression peut Ãªtre trÃ¨s pÃ©nalisante, aussi, un
outillage de tests est indispensable.</p>
</div>
<div class="paragraph">
<p>Il faut avouer que les plugins Maven officiels ne sont pas forcÃ©ment les
meilleurs exemples pour aller piocher de bonnes pratiques, prÃ©fÃ©rant de
lourds tests d&#8217;intÃ©gration Ã  un outillage de tests propre Ã  chaque
plugin â ils ont au moins l&#8217;intÃ©rÃªt d&#8217;Ãªtre outillÃ©s de tests, ce qui
n&#8217;est pas le cas de nombreux autres plugins indÃ©pendants.</p>
</div>
<div class="paragraph">
<p>La plus grande difficultÃ© pour tester un plugin Maven rÃ©side dans
lâidentification correcte de ce qu&#8217;on dÃ©sire valider, en particulier
lorsque le plugin sert Ã  intÃ©grer un autre outilÂ : nous devons Ãªtre en
mesure de valider le fait que l&#8217;outil a bien Ã©tÃ© exÃ©cutÃ© avec le bon
paramÃ©trage et non pas que l&#8217;outil lui-mÃªme est exempt de bogues.</p>
</div>
<div class="sect3">
<h4 id="_plugin_testing_harness">Plugin testing harness</h4>
<div class="paragraph">
<p>Maven propose une suite de tests sous forme d&#8217;objets simulacres (Â«Â mockÂ Â»)
pour ses API et un mÃ©canisme simple pour configurer une instance du
plugin Ã  tester. Un extrait de fichier POM est utilisÃ© pour dÃ©finir la
configuration de test du plugin, et l&#8217;environnement de test se charge
d&#8217;exÃ©cuter le plugin.</p>
</div>
<div class="paragraph">
<p>La mise en Åuvre est simple, puisqu&#8217;il s&#8217;agit d&#8217;Ã©crire une classe de
test jUnit trÃ¨s classique et de faire appel au plugin-testing-harness
pour configurer le plugin que nous dÃ©sirons tester Ã  partir d&#8217;un
pseudo POM, limitÃ© Ã  sa seule section &lt;plugin&gt;. Le Listing 11.7 montre
le code de ce test, qui va exÃ©cuter le plugin et vÃ©rifier son
fonctionnement. Le Listing 11.8 montre le pseudo fichier POM qui lui
sert de base pour construire et configurer le plugin testÃ©.</p>
</div>
<div class="listingblock">
<div class="title">Listing 11.7 : Test unitaire pour un plugin, basÃ© sur le plugin-testing-harness</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class GEACheckMojoTestCase
    extends AbstractMojoTestCase
{
    public void testCheck()
        throws Exception
    {
        File testPom = new File( getBasedir(),
            "src/test/resources/testCheck.pom" );
        Mojo mojo = (Mojo) lookupMojo( "check", testPom );

        MavenProject project = new MavenProjectStub();
        setVariableValueToObject( project, "compileSourceRoots", new
ArrayList() );
        project.addCompileSourceRoot( new File( testRoot,
"src/main/java" ).getAbsolutePath() );
        setVariableValueToObject(mojo, "project", project );

        assertNotNull( "Failed to configure the plugin", mojo );

        mojo.execute();

        File expected = new File(getBasedir(),
            "target/test-target/check/repport.html" );
        assertTrue( "expected file not found", expected.exists() );
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 11.8 : Pseudo-POM chargÃ© lors du test</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;project&gt;
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;com.geegol.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;geacheck-maven-plugin&lt;/artifactId&gt;
        &lt;configuration&gt;
          &lt;outputDirectory&gt;target/test-target/check&lt;/outputDirectory&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Dans le Listing 11.7, nous utilisons un bouchon de la classe
MavenProject. Le plugin plugin-testing-harness propose Ã©galement des
objets bouchons pour de nombreuses autres classes de l&#8217;API Maven, ce qui
permet de construire des tests unitaires qui nÃ©cessitent (par exemple)
des manipulations d&#8217;artefacts.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_plugin_invoker">Plugin <em>invoker</em></h4>
<div class="paragraph">
<p>Une seconde option consiste Ã  exÃ©cuter la construction d&#8217;un projet Maven
de test, mais dans un mode automatisÃ©. C&#8217;est l&#8217;option retenue par le
plugin invoker, qui va enchaÃ®ner un build Maven parallÃ¨le lors de la
phase de test d&#8217;intÃ©gration de notre projet de plugin. Contrairement au
plugin plugin-testing-harness, il ne s&#8217;agit pas d&#8217;exÃ©cuter le plugin
dans un environnement de test Â«Â unitaireÂ Â», mais de lancer une
construction Maven complÃ¨te, indÃ©pendante et d&#8217;en valider <em>a posteriori</em>
la bonne exÃ©cution.</p>
</div>
<div class="paragraph">
<p>Recherchant les fichiers POM placÃ©s dans le rÃ©pertoire de tests src/it,
invoker va utiliser un script Groovy ou BeanShell pour vÃ©rifier le
rÃ©sultat de l&#8217;exÃ©cution. Ce script va typiquement s&#8217;assurer que des
fichiers attendus en rÃ©sultat de l&#8217;exÃ©cution sont prÃ©sents et/ou
correctement renseignÃ©s.</p>
</div>
<div class="paragraph">
<p>Le Listing 11.9 prÃ©sente la configuration du plugin invoker pour
exÃ©cuter un projet Maven de test. Le plugin recherche dans notre
rÃ©pertoire src/it tous les sous-rÃ©pertoires contenant un fichier
pom.xml, les recopie dans le rÃ©pertoire de travail et y exÃ©cute un build
Maven (jusqu&#8217;Ã  la phase package). Nous pouvons donc organiser notre
rÃ©pertoire de tests d&#8217;intÃ©gration en ayant un sous-rÃ©pertoire par test
d&#8217;intÃ©gration, contenant le projet Maven d&#8217;intÃ©gration Ã  tester. Le
Listing 11.10, quant Ã  lui, prÃ©sente le fichier groovy que nous
utilisons pour vÃ©rifier que l&#8217;exÃ©cution s&#8217;est dÃ©roulÃ©e comme prÃ©vu et
que le fonctionnement du plugin est donc correct.</p>
</div>
<div class="listingblock">
<div class="title">Listing 11.9 : Configuration du plugin <em>invoker</em></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;maven-invoker-plugin&lt;/artifactId&gt;
  &lt;version&gt;1.3&lt;/version&gt;
  &lt;configuration&gt;
    &lt;postBuildHookScript&gt;verify&lt;/postBuildHookScript&gt;
    &lt;localRepositoryPath&gt;${project.build.directory}/it-repo&lt;/localRepositoryPath&gt;
    &lt;settingsFile&gt;src/it/settings.xml&lt;/settingsFile&gt;
    &lt;cloneProjectsTo&gt;${project.build.directory}/it&lt;/cloneProjectsTo&gt;
  &lt;/configuration&gt;

  &lt;executions&gt;
    &lt;execution&gt;
      &lt;goals&gt;
        &lt;goal&gt;install&lt;/goal&gt;
        &lt;goal&gt;run&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 11.10 : Script <em>Groovy</em> de contrÃ´le de l&#8217;exÃ©cution</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">// GEACheck doit gÃ©nÃ©rer son rapport sous target/check
assert new File( basedir, 'target/check/report.html' ).exists();

return true;</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaHerve.png" alt="MangaHerve"></span></p>
</div>
<div class="paragraph">
<p>HervÃ© configure le serveur d&#8217;intÃ©gration continue pour surveiller, en
plus de notre projet, la bonne santÃ© de son plugin, lequel, outillÃ© de
tests, est maintenant prÃªt pour vivre sa vie et rÃ©pondre au besoin Ã  des
demandes d&#8217;Ã©volution ou de nouvelles contraintes. HervÃ© nâa plus qu&#8217;Ã 
documenter ce plugin et son utilisationâ¦ mais pour cela il devra
attendre le chapitre suivantÂ !</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_10">Conclusion</h3>
<div class="paragraph">
<p>Ce chapitre a dÃ©montrÃ© que l&#8217;Ã©criture d&#8217;un plugin Maven n&#8217;est pas une
tÃ¢che fondamentalement dÃ©licate, mÃªme si elle prÃ©sente quelques
subtilitÃ©s (voir d&#8217;ailleurs, Ã  ce sujet,
<strong><a href="http://maven.apache.org/plugin-developers/common-bugs.html" class="bare">http://maven.apache.org/plugin-developers/common-bugs.html</a></strong>). Dans de
nombreux cas, le dÃ©veloppement d&#8217;un plugin ne nÃ©cessite pas de soulever
le capot de Maven au-delÃ  de la classe AbstractMojo. Cependant,
l&#8217;utilisation des annotations Plexus et de l&#8217;API Maven peut rebuter de
nombreux dÃ©veloppeurs, et il faut bien reconnaÃ®tre que la documentation
sur le sujet n&#8217;est pas irrÃ©prochable. Les bons exemples ne manquent
cependant pas et la communautÃ© des dÃ©veloppeurs Maven est prÃªte Ã 
apporter tout le support nÃ©cessaire.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="L_assurance_qualite">Chapitre 12Â : L&#8217;assurance qualitÃ©</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Une application qui fonctionne, c&#8217;est bien. Mais du code qui est
correctement construit, Ã©volutif, lisible, maintenable, c&#8217;est mieux.
L&#8217;assurance qualitÃ© est un exercice dÃ©licat qui tente de canaliser la
crÃ©ativitÃ© dÃ©bordante des dÃ©veloppeurs pour Ã©viter l&#8217;anarchie sans pour
autant restreindre leur productivitÃ© ou leur capacitÃ© d&#8217;innovation.
MaÃ®triser un projet, c&#8217;est aussi savoir en extraire les indicateurs de
qualitÃ© adÃ©quats et se donner les moyens d&#8217;en suivre l&#8217;Ã©volution.</p>
</div>
<div class="sect2">
<h3 id="_audit_de_code">Audit de code</h3>
<div class="paragraph">
<p>Lors de notre intÃ©gration au sein de Geegol, notre projet a subi les
regards inquisiteurs de ceux qui allaient devenir nos collÃ¨gues.
Habitudes diffÃ©rentes obligent, certaines tournures de notre code ne
collaient pas avec la culture locale. Si la qualitÃ© d&#8217;un projet Ã©tait
Ã©valuÃ©e sur des critÃ¨res purement subjectifs de ce niveau, nous serions
bons pour une rÃ©Ã©criture complÃ¨te, coÃ»teuse et probablement inutile. Par
contre, certains aspects de notre projet mÃ©riteraient peut-Ãªtre une
analyse plus minutieuse â nous ne pouvons pas Ãªtre experts en toutÂ !</p>
</div>
<div class="paragraph">
<p>Les outils d&#8217;audit de code ont l&#8217;intÃ©rÃªt d&#8217;Ãªtre objectifs. Bien sÃ»r, les
rÃ¨gles qu&#8217;on leur demande de vÃ©rifier ont Ã©tÃ© choisies et pondÃ©rÃ©es
selon des critÃ¨res propres Ã  l&#8217;entreprise, mais au moins elles sont
clairement identifiÃ©es et justifiÃ©es. Si le groupe a fait le choix de
mettre l&#8217;accent sur la qualitÃ© de documentation, il poussera au maximum
les mÃ©triques concernant la Javadoc et le nombre de lignes de code sans
commentaire. Cela ne garantit en rien un code bien documentÃ©, mais cela
donne tout de mÃªme une indication Ã  partir de laquelle on peut
travailler.</p>
</div>
<div class="paragraph">
<p>Les outils d&#8217;audit sont lÃ©gion, et ils produisent des rapports plus ou
moins complexes Ã  analyser (du moins pour un dÃ©veloppeur lambda). Le
monde open source en fournit une jolie panoplie, dont le seul dÃ©faut est
de ne pas Ãªtre intÃ©grÃ©e. Chaque outil va produire un rapport, dans un
format propre, qu&#8217;il nous faudra Ã©plucher.</p>
</div>
<div class="paragraph">
<p>Par ailleurs, l&#8217;intÃ©rÃªt de ces outils n&#8217;est pas de faire des audits
ponctuels pour donner une note Ã  une Ã©quipe de dÃ©veloppement. Si on en
arrive lÃ , c&#8217;est qu&#8217;ils sont utilisÃ©s bien trop tard. Leur plus-value
apparaÃ®t dans les indicateurs synthÃ©tiques quâils fournissent et qu&#8217;on
peut suivre au cours de la vie du projet dÃ¨s que du code est Ã©crit,
signalant ainsi toute dÃ©rive malheureuse dans les bonnes pratiques de
dÃ©veloppement.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaVincentM.png" alt="MangaVincentM"></span></p>
</div>
<div class="paragraph">
<p>Vincent s&#8217;attaque Ã  outiller notre projet pour rÃ©pondre au mieux aux
attentes du groupe. Il Ã©pluche la longue liste des outils disponibles
pour en tirer le meilleur et proposer une boÃ®te Ã  outils conviviale et
pertinente. Son objectif est de dÃ©montrer notre capacitÃ© de rÃ©action,
avant que la cellule qualitÃ© ne rende son verdict aprÃ¨s dix jours
d&#8217;audit de notre code. Pour chaque problÃ¨me identifiÃ©, il veut Ãªtre
capable de rÃ©pondreÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>que nous l&#8217;avons Ã©galement identifiÃ©, Ã©ventuellement avec un poids
diffÃ©rent, et sommes donc tout Ã  fait en mesure de le traiterÂ ;</p>
</li>
<li>
<p>que nous disposons de l&#8217;outillage nÃ©cessaire pour nous assurer
qu&#8217;il ne se reproduise plusÂ ;</p>
</li>
<li>
<p>que nous sommes en mesure de fournir des indicateurs dÃ©montrant
l&#8217;amÃ©lioration progressive de notre code sur la base des critÃ¨res
identifiÃ©s par les responsables qualitÃ©.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Avec un dossier de dÃ©fense aussi bien ficelÃ©, nous devrions en principe
Ã©viter de voir trop de monde fourrer son nez dans notre code et nous
prendre de haut pour nous expliquer comment bien travailler. Nous avons
tout de mÃªme notre fiertÃ©, et <em>noubliepaslalistedescourses</em> reste notre
bÃ©bÃ©Â !</p>
</div>
<div class="sect3">
<h4 id="_analyse_statique">Analyse statique</h4>
<div class="paragraph">
<p>Une premiÃ¨re catÃ©gorie d&#8217;outillage concerne l&#8217;analyse statique du code.
Il s&#8217;agit d&#8217;une relecture du code par un outil qui va rechercher des
patrons particuliers et calculer des mÃ©triques. En Java, il existe
plusieurs outils de cette catÃ©gorie, lesquels peuvent extraireÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>une liste d&#8217;alertes signalant des mauvaises pratiques connues,
tournures de code maladroites ou bogues rÃ©currents liÃ©s Ã  l&#8217;imperfection
des dÃ©veloppeurs qui tombent tous dans les mÃªmes piÃ¨ges â et aucun de
nous ne fait exception Ã  ce constatÂ ;</p>
</li>
<li>
<p>des indicateurs sur la structure du code, jugeant sa modularitÃ©,
sa complexitÃ© ou son niveau d&#8217;abstraction.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Le premier type d&#8217;indication est Ã©videmment celui qui attire tout de
suite nos dÃ©cideursÂ : comment rÃ©sister Ã  un outil qui, en quelques
clics, va identifier tous les bogues si coÃ»teux que nous avons
nÃ©gligemment laissÃ©s traÃ®nerÂ ?</p>
</div>
<div class="sect4">
<h5 id="_checkstyle">Checkstyle</h5>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaVincentM.png" alt="MangaVincentM"></span></p>
</div>
<div class="paragraph">
<p>Vincent expÃ©rimente tout d&#8217;abord un outil open source de cette catÃ©gorie
sur notre codeÂ : Checkstyle. L&#8217;analyse est de niveau syntaxique et
signale les incohÃ©rences qui existent dans notre faÃ§on de travailler.
Une grande partie des rÃ¨gles de Checkstyle concerne le formatage du code
plus que son fond, l&#8217;outil semble donc Ã  la fois tatillon et sans grand
intÃ©rÃªt.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaVincentS.png" alt="MangaVincentS"></span></p>
</div>
<div class="paragraph">
<p>L&#8217;autre Vincent â si vous avez bien suivi les chapitres prÃ©cÃ©dents, vous
aurez notÃ© que notre Ã©quipe compte deux VincentÂ ;) â, qui suit de loin
le travail de son collÃ¨gue par pauses-cafÃ© interposÃ©es, n&#8217;est pas de cet
avis. Il a passÃ© deux heures Ã  fusionner ses derniÃ¨res modifications
avec celles d&#8217;HervÃ©, non pas parce que ce dernier travaille comme un
cochon (sans quoi, il ne serait pas dans l&#8217;Ã©quipeÂ !), mais tout
simplement parce qu&#8217;il utilise des rÃ¨gles de formatage de code
diffÃ©rentes (voir ListingÂ 12.1).</p>
</div>
<div class="paragraph">
<p>Listing 12.1Â : Comparaison de nos conventions de formatage du code</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image" style="float: center"><img src="illustrations/MangaVincentS.png" alt="MangaVincentS"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image" style="float: center"><img src="illustrations/MangaHerve.png" alt="MangaHerve"></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ListeDesCourses implements Data {

   private Set courses = new HashSet();

   public void addCourse(String course) throws IllegalStateException {
          courses.add(course);
   }

   public Collection getCourses() {
          return courses;
   }
â¦</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ListeDesCourses
    implements Data
{
    private Set courses = new HashSet();

    public void addCourse( String course )
        throws IllegalStateException
    {
        courses.add( course );
    }

    public Collection getCourses()
    {
        return courses;
    }</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>La diffÃ©rence entre ces deux fichiers sources est minime, cependant les
outils de fusion automatique ne savent pas la gÃ©rer et obligent Vincent
Ã  vÃ©rifier ligne par ligne la concordance des deux versions
concurrentes.</p>
</div>
<div class="paragraph">
<p>LâhomogÃ©nÃ©isation, surtout si elle est poussÃ©e Ã  outrance, peut Ãªtre
ressentie parfois comme une faÃ§on de brider l&#8217;appropriation du code par
les dÃ©veloppeurs. Vouloir que tout le monde travaille strictement de la
mÃªme faÃ§on c&#8217;est, en effet, faire de nous de simples machines Ã  coder
sans libertÃ© individuelle. Par contre, laisser chacun faire ce qu&#8217;il
veut Ã  sa sauce n&#8217;est pertinent que si cela ne vient pas perturber les
autres. Pour faire intellectuel, disons que Â«Â la libertÃ© des uns s&#8217;arrÃªte
lÃ  oÃ¹ commence celle des autresÂ Â».</p>
</div>
<div class="paragraph">
<p>MÃªme si cela va nÃ©cessiter de se poser pendant une heure et obliger
certains d&#8217;entre nous Ã  accepter un formalisme qu&#8217;ils n&#8217;apprÃ©cient pas
forcÃ©ment, se mettre d&#8217;accord sur des rÃ¨gles de ce type Ã©conomisera Ã 
chacun de longues heures d&#8217;un travail inutile, rÃ©barbatif et source
d&#8217;erreurs. Sans compter que notre IDE prÃ©fÃ©rÃ© sait nous aider Ã  formater
le code Ã  la volÃ©eÂ !</p>
</div>
<div class="paragraph">
<p>Les rÃ¨gles, mÃªme les plus superficielles, de Checkstyle ont donc leur
rÃ´le. L&#8217;analyse du code signalera directement que le petit dernier
arrivÃ© dans l&#8217;Ã©quipe ne respecte pas nos rÃ¨gles communes et va Ã  un
moment ou un autre provoquer le problÃ¨me rencontrÃ© par Vincent et HervÃ©.</p>
</div>
<div class="paragraph">
<p>Checkstyle compte Ã©galement de nombreuses rÃ¨gles qui valident le niveau
de documentation technique du code. Ici aussi, pas de rÃ¨gle gÃ©nÃ©raleÂ :
du code peut Ãªtre lourdement commentÃ© et totalement incomprÃ©hensible, le
commentaire peut d&#8217;ailleurs Ãªtre totalement obsolÃ¨te, et du code sans
commentaires est parfois extrÃªmement limpide et ne nÃ©cessite aucune
explication complÃ©mentaire. Cependant, si nous dÃ©finissons un niveau de
documentation que nous considÃ©rons souhaitable pour notre projet,
Checkstyle saura indiquer nos points faibles ou notre relÃ¢chement.</p>
</div>
<div class="paragraph">
<p>Enfin, Checkstyle propose quelques rÃ¨gles plus techniques sur
l&#8217;utilisation des mots clÃ©s et des structures de code. Une fois encore,
la sÃ©lection de ces rÃ¨gles et leur pondÃ©ration sont un travail que nous
devrons affiner au fur et Ã  mesure de notre utilisation de l&#8217;outil.
Activer toutes les rÃ¨gles n&#8217;apporte rien, l&#8217;information Ã©tant noyÃ©e dans
la masse. C&#8217;est mÃªme contre-productif, puisque Ã§a amÃ¨ne Ã  penser que
l&#8217;outillage est inutilisable car trop tatillon.</p>
</div>
</div>
<div class="sect4">
<h5 id="_findbugs">FindBugs</h5>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaVincentM.png" alt="MangaVincentM"></span></p>
</div>
<div class="paragraph">
<p>Vincent poursuit son expÃ©rimentation sur l&#8217;analyse statique du code avec
FindBugs. Comme son nom l&#8217;indique, cet outil se propose de trouver tout
seul les bogues dans notre code, lesquels correspondent Ã  des patrons de
codage fragiles et Ã  Ã©viter. MÃªme si un dÃ©veloppeur expÃ©rimentÃ© en est
conscient, il risque de les mettre en Åuvre par mÃ©garde.</p>
</div>
<div class="paragraph">
<p>PlutÃ´t que de le considÃ©rer comme un juge intransigeant, il faut voir
FindBugs comme un conseiller qui cumule la connaissance des erreurs
rÃ©alisÃ©es par des centaines de dÃ©veloppeurs et est capable de les
identifier. Sa base de donnÃ©es de choses Ã  ne pas faire se distribue
entre mauvaises pratiques, dÃ©fauts de performances, dysfonctionnements,
incompatibilitÃ© avec un mode multithreadÃ© et problÃ¨mes de sÃ©curitÃ©.</p>
</div>
<div class="paragraph">
<p>Une fois de plus, activer toutes ses rÃ¨gles sans se soucier du contexte
risque surtout de produire un rapport de milliers de lignes Ã  peine
exploitable. C&#8217;est Ã  nous de comprendre chacune de ses rÃ¨gles, de voir
si elle s&#8217;applique Ã  notre projet et lâimportance que nous lui donnons.
La simple lecture de ces rÃ¨gles est d&#8217;ailleurs trÃ¨s formatriceÂ !</p>
</div>
<div class="paragraph">
<p>Nous pouvons Ã©galement assister FindBugs dans son travail d&#8217;analyse pour
le rendre plus pertinent. Des annotations comme @NonNull peuvent Ãªtre
ajoutÃ©es dans le code pour prÃ©ciser, par exemple, qu&#8217;une mÃ©thode
n&#8217;accepte pas un appel sans un paramÃ¨tre correctement renseignÃ©
(fonctionnalitÃ© qui est d&#8217;ailleurs proposÃ©e pour JavaÂ 7). La prÃ©sence de
cette annotation permet Ã  l&#8217;outil de contrÃ´ler tous les endroits oÃ¹ elle
est invoquÃ©e et, en mÃªme temps, complÃ¨te la documentation de notre code
en prÃ©cisant nos intentions.</p>
</div>
<div class="paragraph">
<p>De la mÃªme faÃ§on, FindBugs peut exploiter les annotations dÃ©finies en
marge du livre <em>Programmation concurrente en Java</em>, de Brian Goetz â
chez le mÃªme Ã©diteur, excellent ouvrage que je vous recommande ;) â pour
identifier les problÃ¨mes de gestion concurrente en environnement
multithread.</p>
</div>
</div>
<div class="sect4">
<h5 id="_pmd">PMD</h5>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaVincentM.png" alt="MangaVincentM"></span></p>
</div>
<div class="paragraph">
<p>Vincent termine son tour d&#8217;horizon en installant un autre outil
d&#8217;analyse statiqueÂ : PMD. Celui-ci se place Ã  mi-chemin entre Checkstyle
et FindBugs. Moins formel que Checkstyle, il ne propose pas des rÃ¨gles
aussi poussÃ©es que FindBugs (aidÃ© par des annotations). Cela ne signifie
pas pour autant qu&#8217;il soit inutile. Il vient renforcer la pertinence de
l&#8217;analyse en proposant un autre regard sur notre code.</p>
</div>
<div class="paragraph">
<p>Il nous reste cependant Ã  dÃ©finir soigneusement ses rÃ¨gles d&#8217;analyse
pour qu&#8217;elles soient cohÃ©rentes avec nos deux autres outilsÂ !</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_analyse_dynamique">Analyse dynamique</h4>
<div class="paragraph">
<p>Les outils d&#8217;analyse statique font dÃ©jÃ  de grandes choses, mais ils ne
peuvent pas faire de miracle. En particulier, ils ne sont pas en mesure
de deviner comment est utilisÃ©e rÃ©ellement l&#8217;application. Pour cela, il
faut la faire tourner dans un environnement et une utilisation
rÃ©alistes. Or, nous avons dÃ©jÃ , depuis le ChapitreÂ 4, une belle panoplie
de tests qui exÃ©cutent notre application, par petits morceaux, en se
focalisant sur des scÃ©narios d&#8217;utilisation issus de nos besoins
fonctionnels (rappelez-vous les rÃ¨gles du dÃ©veloppement dirigÃ© par les
testsÂ !).</p>
</div>
<div class="paragraph">
<p>Cobertura, Clover ou Emma sont des outils d&#8217;analyse dynamique qui visent
Ã  dÃ©terminer quelle portion de notre code est exÃ©cutÃ©e au cours de nos
tests, censÃ©s couvrir les fonctionnalitÃ©s de notre application. Leurs
rapports indiquent le taux de couverture du code et remontent jusqu&#8217;au
code source pour nous indiquer quelle ligne a Ã©tÃ© exÃ©cutÃ©e au moins une
fois au cours d&#8217;un test.</p>
</div>
<div class="paragraph">
<p>Comment exploiter un tel outilÂ ?</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaOlivier.png" alt="MangaOlivier"></span></p>
</div>
<div class="paragraph">
<p>Olivier, qui est venu Ã©pauler Vincent, Ã©value avec lui ces outils et
l&#8217;information qu&#8217;ils fournissent. L&#8217;indication synthÃ©tique est un taux
de couverture de notre code par des testsÂ : 65Â %. Est-ce bien ou pasÂ ?</p>
</div>
<div class="paragraph">
<p>Brute, cette information n&#8217;a aucune utilitÃ© ou presque. Son intÃ©rÃªt est
plus de voir comment ces 65Â % se rÃ©partissent sur notre code. En
descendant Ã  un niveau de dÃ©tail plus fin, on dÃ©couvre dans le rapport
quâune majoritÃ© de nos packages sont couverts Ã  environ 70Â % et que deux
mauvais Ã©lÃ¨ves se contentent de 30Â %. Nous tenons nos coupablesÂ : deux
packages pas assez testÃ©s, ou mal testÃ©s, ou peut-Ãªtre mÃªme du code
inutileÂ !</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Le premier, remoting, est celui de nos interfaces de communication
avec d&#8217;autres systÃ¨mes. Pas le plus facile Ã  tester puisqu&#8217;il faut
quelqu&#8217;un (un simulateur) en face pour rÃ©pondre et valider le
fonctionnement du logiciel.</p>
</li>
<li>
<p>Le second, beans, correspond Ã  des classes de donnÃ©es sans valeur
ajoutÃ©eÂ : juste des beans ayant des accesseurs get/set, mais cela fait
dÃ©jÃ  pas mal de lignes de code, d&#8217;oÃ¹ le mauvais rÃ©sultat de la mesure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sur ce constat, reposons donc la questionÂ : comment exploiter un tel
outilÂ ?</p>
</div>
<div class="paragraph">
<p>Si nous Ã©tablissons comme rÃ¨gle d&#8217;or le taux de couverture des tests
doit dÃ©passer 75 %, que va-t-il trÃ¨s probablement se passerÂ ? Vous
pouvez parier que le package beans va rapidement Ãªtre testÃ© Ã  100 % afin
d&#8217;atteindre ce taux de 75 %. Le dÃ©veloppeur Ã©tant par nature feignant,
il choisira la solution de facilitÃ©, surtout si son chef l&#8217;assomme de
reproches sur le non-respect de la rÃ¨gle d&#8217;orÂ !</p>
</div>
<div class="paragraph">
<p>L&#8217;outil fournissait pourtant une information capitaleÂ : remoting, couche
critique de notre application, est celle qui est la moins bien testÃ©e.
Il nous encourage effectivement Ã  retrousser nos manches pour mieux
instrumenter ce code, peut-Ãªtre en le rÃ©arrangeant afin qu&#8217;il soit plus
modulaire et plus testable, peut-Ãªtre en dÃ©veloppant des simulateurs
plus faciles Ã  intÃ©grer dans un test unitaire.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaVincentM.png" alt="MangaVincentM"></span></p>
</div>
<div class="paragraph">
<p>Vincent prend cela en considÃ©ration et Ã©tablit notre premiÃ¨re rÃ¨gle
d&#8217;orÂ :</p>
</div>
<div class="paragraph">
<p>Un taux de couverture infÃ©rieur Ã  la moyenne doit Ãªtre justifiÃ©. Pas de
taux absolu et inexplicable Ã  atteindre, mais, par contre, interdiction
de dÃ©laisser une partie de l&#8217;application sans bonne raison.</p>
</div>
<div class="paragraph">
<p>Il considÃ¨re ensuite le reste de l&#8217;applicationÂ : la couverture de code
est homogÃ¨ne, mais est-elle suffisanteÂ ? Comment va-t-elle Ã©voluerÂ ?
Comment doit-elle Ã©voluerÂ ? Si nos classes de JavaBeans gonflent suite Ã 
l&#8217;ajout de mÃ©thodes get/set, notre taux va irrÃ©mÃ©diablement baisser, mais
ce ne sera pas significatif. Par contre, si l&#8217;ajout de nouvelles
fonctionnalitÃ©s dÃ©grade le taux de couverture, c&#8217;est que ces nouvelles
fonctionnalitÃ©s ne sont pas au moins aussi bien testÃ©es que le code en
place.</p>
</div>
<div class="paragraph">
<p>Cela inspire donc une seconde rÃ¨gle d&#8217;or, que nous pourrions qualifier
de protectionnisteÂ :</p>
</div>
<div class="paragraph">
<p>Le taux de couverture ne doit pas baisser avec le temps sans
justification.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaVincentM.png" alt="MangaVincentM"></span></p>
</div>
<div class="paragraph">
<p>Vincent arrive donc rapidement Ã  la conclusion qu&#8217;il va devoir trouver
un moyen pour contrÃ´ler l&#8217;Ã©volution dans le temps de nos indicateurs.
Ãtre capable d&#8217;estimer la couverture de test apporte des informations
utiles, mais savoir si elle est en perte de vitesse et sur quels
packages est bien plus important.</p>
</div>
<div class="paragraph">
<p>Notre boÃ®te Ã  outils est dÃ©sormais comprise et correctement configurÃ©e.
Il reste Ã  Vincent Ã  automatiser son utilisation pour mettre ces
indicateurs Ã  la disposition de tous et permettre leur suivi dans le
temps. L&#8217;assurance qualitÃ© ne fonctionne que si elle est la
prÃ©occupation de tous. Donner Ã  quelqu&#8217;un la tÃ¢che de suivre les
rapports d&#8217;analyse n&#8217;a aucun sens, il passerait rapidement pour le
casse-pieds de service. Mobiliser quelques instants d&#8217;attention de toute
l&#8217;Ã©quipe est peu coÃ»teux individuellement et nettement plus efficace.</p>
</div>
<div class="paragraph">
<p>Vincent pourrait continuer ainsi son tour de table des outils d&#8217;analyse
de code, mais toute cette instrumentation ne sera vraiment productive
que si elle vient s&#8217;intÃ©grer dans nos outils. Nous avons dÃ©jÃ  confiÃ© la
construction de nos binaires Ã  Maven, pouvons-nous Ã©galement lui passer
la main sur notre suivi qualitÃ©Â ?</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_les_rapports_maven">Les rapports Maven</h3>
<div class="paragraph">
<p>Comme toujours, l&#8217;intÃ©gration de nos outils d&#8217;analyse avec notre
construction de projet Maven passe par des plugins. Nous pouvons, par
exemple, lancer un <code>mvn checkstyle:check</code> pour vÃ©rifier le respect de nos
rÃ¨gles de codage, voire le configurer pour quâil s&#8217;exÃ©cute durant un
build normal si nous nous interdisons de ne pas suivre strictement ces
rÃ¨gles. Ãvidemment, c&#8217;est encore plus efficace si un tel outil d&#8217;analyse
peut Ãªtre intÃ©grÃ© dans l&#8217;IDE et fournir au dÃ©veloppeur une alerte dÃ¨s
que la ligne de code est saisieÂ !</p>
</div>
<div class="paragraph">
<p>Maven propose cependant une autre forme d&#8217;intÃ©gration pour les outils
qui visent Ã  complÃ©ter la documentation sur le projetÂ : les rapports.</p>
</div>
<div class="paragraph">
<p>Notre projet est accompagnÃ© d&#8217;une large documentation, expliquant son
utilisation, ses rÃ¨gles de dÃ©veloppement et l&#8217;explication de nos choix
techniques. Reste Ã  la diffuser efficacement auprÃ¨s de nos utilisateurs
et contributeurs.</p>
</div>
<div class="paragraph">
<p>Dans un premier temps, nous lâavons placÃ©e Ã  cÃ´tÃ© de notre projet dans
le gestionnaire de sources. Lors d&#8217;une livraison, nous accompagnons
ainsi l&#8217;exÃ©cutable de l&#8217;application de sa documentation Ã  jour. Cette
approche tout-en-un est pratique pour l&#8217;utilisateur qui a tÃ©lÃ©chargÃ©
notre logiciel, mais pas pour celui qui vient juste de le dÃ©couvrir et
voudrait en savoir plus avant de poursuivre. Un site web serait alors
une meilleure solution. Comment concilier ces deux formes de
documentationÂ ?</p>
</div>
<div class="paragraph">
<p>Par ailleurs, nous sommes fiers de notre systÃ¨me qualitÃ©Â ; aussi
voudrions-nous l&#8217;exposer plus Ã  nos utilisateurs pour dÃ©montrer notre
savoir-faire et gagner leur confiance. Enfin, notre code Ã©tant soumis Ã 
une licence libre, nous voulons qu&#8217;il soit aussi facilement consultable
que possible pour permettre Ã  chacun de proposer des enrichissements.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaLukas.png" alt="MangaLukas"></span></p>
</div>
<div class="paragraph">
<p>AprÃ¨s avoir testÃ© diverses solutions documentaires, Lukas cherche
toujours un moyen pour synthÃ©tiser les diverses sources d&#8217;information du
projet. D&#8217;une part, notre wiki, dont la syntaxe simple permet de
construire rapidement une documentation par enrichissement successif.
D&#8217;autre part, nos outils d&#8217;analyse qualitÃ©, dont les rapports sont
instructifs sur nos mÃ©thodes de travail. Ensuite, des indications
techniques sur notre projetÂ : licence, prÃ©requis, dÃ©pendances. Enfin,
une sÃ©rie de liens sur les aspects communautaires de notre projet :
Ã©quipe de dÃ©veloppement, liste de diffusion, systÃ¨me de suivi des
anomalies, etc. AgrÃ©ger toutes ces informations sous un point d&#8217;entrÃ©e
unique, toujours Ã  jour et homogÃ¨ne, voilÃ  une tÃ¢che ambitieuse qui
n&#8217;effraie pas Lukas.</p>
</div>
<div class="paragraph">
<p>Il dÃ©couvre rapidement que Maven, lui-mÃªme confrontÃ© Ã  ce problÃ¨me de
documentation, offre une solution complÃ¨te et trÃ¨s richeÂ : la gÃ©nÃ©ration
d&#8217;une documentation complÃ¨te du projet. En parallÃ¨le du cycle de vie de
construction du projet, Maven propose un cycle de vie documentaire
dÃ©clenchÃ© par la commande <code>mvn site</code>. Cette commande n&#8217;exÃ©cute qu&#8217;un seul
plugin, site, mais celui-ci est l&#8217;arbre qui cache la forÃªtÂ : son rÃ´le
est d&#8217;exÃ©cuter des rapports et d&#8217;en agrÃ©ger le contenu dans un document
unifiÃ© sous forme de site web.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="illustrations/Maven3.png" alt="Maven3"></span></p>
</div>
<div class="paragraph">
<p>Autant MavenÂ 3 est compatible Ã  99,99 % avec Maven 2 sur de nombreux
points, autant il y a un domaine qui a Ã©tÃ© revu de fond en comble, câest
la gestion du siteÂ ! Dans Maven 2, nos rapports sont eux-mÃªmes dÃ©clarÃ©s
dans notre POM, sous un Ã©lÃ©ment dÃ©diÃ© &lt;reporting&gt;. Ils ressemblent Ã  s&#8217;y
mÃ©prendre Ã  des dÃ©clarations de plugins et sont d&#8217;ailleurs le plus
souvent couplÃ©s avec un plugin Maven classique. Ils n&#8217;ont cependant pas
exactement le mÃªme fonctionnement et vont produire un rÃ©sultat (souvent
un rapport brut en XML) que le plugin site va mettre en forme au sein du
site du projet.</p>
</div>
<div class="paragraph">
<p>Par contre, un plugin de reporting ne tient pas compte des informations
dÃ©clarÃ©es dans le &lt;pluginManagement&gt;, balise qui permet de regrouper la
configuration de tous les plugins utilisÃ©s sur un projet. Il est donc
prÃ©fÃ©rable d&#8217;utiliser une propriÃ©tÃ© pour ne pas dupliquer l&#8217;information
de version et risquer de tomber dans des bogues Ã©tranges. Cette derniÃ¨re
sera utilisÃ©e dans la dÃ©claration du plugin dans la partie
&lt;pluginManagement&gt; et dans la partie &lt;reporting&gt;.</p>
</div>
<div class="paragraph">
<p>Par ailleurs, un plugin de reporting qui serait aussi utilisÃ© soit en
ligne de commande, soit dans le cycle de vie du build, hÃ©rite toujours
de la configuration dÃ©finie dans la partie &lt;reports&gt;. Aussi, dans ce
cas, et uniquement dans celui-lÃ , il est prÃ©fÃ©rable de dÃ©clarer sa
configuration globale dans la partie &lt;reporting&gt; plutÃ´t que d&#8217;utiliser
le &lt;pluginManagement&gt;.</p>
</div>
<div class="paragraph">
<p>Bref, deux poids, deux mesures. Sans compter que, techniquement, cette
gestion des plugins de rapports est une vÃ©ritable verrue dans le code de
Maven 2. Pour la nouvelle gÃ©nÃ©ration de Maven, tout ceci est donc passÃ©
Ã  la trappe, et un nouveau plugin site a dÃ» Ãªtre dÃ©veloppÃ©. La version
3.x de ce plugin utilise donc non pas le bloc &lt;reporting&gt; du POM, mais
des rapports quâon indique directement dans sa configuration, comme tout
autre plugin Maven. Le site de Maven 3 nâest plus un cas Ã  part, mais un
plugin comme les autres.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaHerve.png" alt="MangaHerve"></span></p>
</div>
<div class="paragraph">
<p>HervÃ© est ravi dâapprendre que Maven 3 a fait le mÃ©nage dans son code,
mais devoir gÃ©rer deux versions du plugin site en fonction de la version
de Maven qui construit le projet, sans parler de la dÃ©claration des
rapports, Ã§a lâamuse modÃ©rÃ©ment.</p>
</div>
<div class="paragraph">
<p>Heureusement, lâÃ©quipe de dÃ©veloppement Maven a pensÃ© Ã  lui et aux
nombreux utilisateurs dans son casÂ : le plugin site 3.x est capable de
dÃ©tecter lâutilisation de rapports Ã  lâancienne, dÃ©clarÃ©s dans le bloc
&lt;reporting&gt;, et les interprÃ¨te comme sâil Ã©tait placÃ© dans sa
configuration. Il se contente dâun WARNING pour nous rappeler que ce
nâest pas son mode de fonctionnement nominal, et que â si nous dÃ©sirons
utiliser officiellement Maven 3 â il serait prÃ©fÃ©rable de nous mettre Ã 
la page.</p>
</div>
<div class="paragraph">
<p>[WARNING] The &lt;reporting&gt; section is deprecated, please move the reports
to the &lt;configuration&gt; section of the new Maven Site Plugin.</p>
</div>
<div class="paragraph">
<p>Par ailleurs, depuis la version 3.0-beta-4, le plugin site gÃ¨re lui-mÃªme
la distinction entre Maven 2 et Maven 3, il est donc capable de basculer
dâune version Ã  lâautre sans douleur. Joli tour de forceÂ ! Finalement, la
configuration de nos rapports sâeffectue donc comme lâindique le listingÂ 12.2, et nous permet dâassocier au site web du projet la documentation
javadoc et le code source du projet, navigable sous forme de pages web
(Â« Cross Reference Â»).</p>
</div>
<div class="listingblock">
<div class="title">Listing 12.2 : Configuration de nos plugins de production de rapports</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-site-plugin&lt;/artifactId&gt;
        &lt;version&gt;3.0-beta-4&lt;/version&gt;
        &lt;configuration&gt;
         &lt;reportPlugins&gt;
            &lt;plugin&gt;
              &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
              &lt;artifactId&gt;maven-jxr-plugin&lt;/artifactId&gt;
              &lt;version&gt;2.2&lt;/version&gt;
              &lt;reports&gt;
                &lt;report&gt;jxr&lt;/report&gt;
              &lt;/reports&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
              &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
              &lt;artifactId&gt;maven-javadoc-plugin&lt;/artifactId&gt;
              &lt;version&gt;2.7&lt;/version&gt;
            &lt;/plugin&gt;
          &lt;/reportPlugins&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Le plugin site se base sur un fichier dÃ©diÃ©, src/site/site.xml, dans
lequel est dÃ©crite la structure gÃ©nÃ©rale de notre site web. Ce fichier
nous permet d&#8217;organiser le menu gÃ©nÃ©ral du site et de pointer vers nos
principales pages documentaires. Le Listing 12.3 montre celui mis en
place par Lukas pour notre projet.</p>
</div>
<div class="listingblock">
<div class="title">Listing 12.3 : Le descripteur de notre site</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;project xmlns="http://maven.apache.org/DECORATION/1.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/DECORATION/1.0.0
http://maven.apache.org/xsd/decoration-1.0.0.xsd"
    name="N'oublie pas la liste des courses"&gt;
  &lt;bannerLeft&gt;
    &lt;name&gt;N'oublie pas la liste des courses&lt;/name&gt;
    &lt;src&gt;http://www.noubliepaslalistedescourses.fr/images/logo.png&lt;/src&gt;
    &lt;href&gt;http://www.noubliepaslalistedescourses.fr&lt;/href&gt;
  &lt;/bannerLeft&gt;
  &lt;body&gt;
    &lt;links&gt;
      &lt;item name="Maven" href="http://maven.apache.org/"/&gt;
    &lt;/links&gt;
    &lt;menu name="Guide"&gt;
      &lt;item name="Introduction" href="user-guide/introduction.html"/&gt;
      &lt;item name="Setup" href="user-guide/setup.html"/&gt;
    &lt;/menu&gt;
    &lt;menu ref="reports"/&gt;
  &lt;/body&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>La structure simple de ce fichier se passe de commentaires. Le seul
point Ã  souligner est la prÃ©sence de la macrocommande &lt;menu
ref="reports"/&gt; qui indique au plugin l&#8217;emplacement oÃ¹ insÃ©rer les liens
vers nos rapports d&#8217;analyse du projet.</p>
</div>
<div class="paragraph">
<p>Les pages de notre site peuvent Ãªtre Ã©crites au choixÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>selon un format APT (<em>Almost Plain Text</em>), proche d&#8217;une syntaxe
wiki et rapidement assimilÃ©Â ;</p>
</li>
<li>
<p>en exploitant les pages d&#8217;un wiki Confluence, ou TWikiÂ ;</p>
</li>
<li>
<p>via le format documentaire DocBook (simplifiÃ©)Â ;</p>
</li>
<li>
<p>via le format documentaire XDoc supportÃ© de maniÃ¨re nativeÂ ;</p>
</li>
<li>
<p>tout simplement Ã  partir d&#8217;un document xHTMLÂ ;</p>
</li>
<li>
<p>ou encore, via un module d&#8217;extension, en exploitant tout autre
format. Le bac Ã  sable Maven comprend ainsi un module permettant
d&#8217;exploiter la syntaxe XWiki.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Au premier lancement de la commande <code>mvn site</code>, aprÃ¨s l&#8217;inÃ©vitable
tÃ©lÃ©chargement de nombreux plugins et bibliothÃ¨ques dans diverses
versions, nous obtenons effectivement sous target/site la structure d&#8217;un
site web pour notre projet.</p>
</div>
<div class="paragraph">
<p>La gÃ©nÃ©ration de ce site est dÃ©lÃ©guÃ©e par le plugin site Ã  un
sous-composant spÃ©cialisÃ©, Doxia <sup class="footnote">[<a id="_footnoteref_42" class="footnote" href="#_footnotedef_42" title="View footnote.">42</a>]</sup>. Cet outil prend en
charge toutes les conversions nÃ©cessaires entre les formats de documents
supportÃ©s et le document Ã  construire.</p>
</div>
<div class="sect3">
<h4 id="_autre_chose_que_du_html">Autre chose que du HTML</h4>
<div class="paragraph">
<p>Doxia est donc le moteur qui va formater notre documentation. UtilisÃ©
par le plugin site, il produit des pages HTML. UtilisÃ© par le plugin
pdf, il produit un fichier PDF regroupant toute la documentation du
projet. La commande <code>mvn pdf:pdf</code> permet ainsi de produire une
documentation format papier, toujours Ã  jour en fonction des diverses
sources que nous avons agrÃ©gÃ©es.</p>
</div>
<div class="paragraph">
<p>Comme le plugin site et son fichier site.xml, le plugin pdf sâappuie sur
un descripteur pdf.xml qui lui indique comment assembler les Ã©lÃ©ments
documentaires pour produire le rÃ©sultat. De la mÃªme faÃ§on, et avec les
moteurs de rendu adÃ©quats, Doxia pourrait produire notre documentation
dans tout un ensemble de formats qu&#8217;il reste Ã  imaginer (voir FigureÂ 12-01).</p>
</div>
<div class="paragraph">
<p>FigureÂ 12-01
<span class="image"><img src="illustrations/12-01.png" alt="12 01"></span></p>
</div>
<div class="paragraph">
<p>GÃ©nÃ©ration de la documentation en diffÃ©rents formats grÃ¢ce Ã  Doxia.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exploiter_notre_gestion_documentaire">Exploiter notre gestion documentaire</h3>
<div class="paragraph">
<p>Nous sommes donc dÃ©sormais en mesure d&#8217;analyser le code de notre projet
avec l&#8217;aide d&#8217;une large panoplie d&#8217;outils et d&#8217;agrÃ©ger le rÃ©sultat dans
une documentation complÃ©tÃ©e par ce que nous aurons pris le temps de
rÃ©diger dans des formats variÃ©s, le tout en une seule commande comme
Maven nous y a habituÃ©s.</p>
</div>
<div class="paragraph">
<p>Nous sommes tous attentifs Ã  ces rapports d&#8217;analyse de code que nous
pouvons dÃ©sormais construire sur notre poste de dÃ©veloppement, Ã  moins
de consulter le site gÃ©nÃ©rÃ© toutes les nuits sur notre serveur
d&#8217;intÃ©gration continue â il serait dommage qu&#8217;il reste inutilisÃ© pendant
cette pÃ©riode oÃ¹ nous, pauvres humains, devons nous reposer. Nous
pouvons identifier les Ã©lÃ©ments de code qui violent des rÃ¨gles et
corriger consciencieusement ces dÃ©fauts, espÃ©rant ainsi que les chiffres
du lendemain seront meilleurs.</p>
</div>
<div class="sect3">
<h4 id="_68_qui_dit_mieux">68 %, qui dit mieuxÂ ?</h4>
<div class="paragraph">
<p>Rapidement, un besoin nouveau s&#8217;exprimeÂ : lorsque nous constatons qu&#8217;un
Ã©lÃ©ment du projet est sous-documentÃ©, nous ajoutons quelques fichiers
APT pour combler le manque. La perception de ce dÃ©faut de documentation
est totalement subjective, mais nous arrivons rapidement Ã  un consensus
sur le niveau obtenu. Par contre, le rapport indiquant le taux de
couverture de nos tests est plus dÃ©licat Ã  interprÃ©ter. 68 %, est-ce
bienÂ ? Est-il utile de vouloir pousser ce taux au-delÃ , ce qui pourrait
rapidement nous amener Ã  Ã©crire des tests sans intÃ©rÃªt juste pour
approcher des 100 %. Pire, nous pourrions Ãªtre tentÃ©s d&#8217;Ã©crire de
nombreux tests faciles pour obtenir un bon chiffre en dÃ©laissant des
parties de code moins Ã©videntes Ã  tester.</p>
</div>
<div class="paragraph">
<p>68 %, Ã§a ne veut rien dire. Ce qui est intÃ©ressant, c&#8217;est de voir que le
mois dernier, nous Ã©tions pour le mÃªme package Ã  82 %Â ! Il semble que
nous avons laissÃ© cette partie du projet se dÃ©graderÂ ! Ã moins que nous
nâayons une bonne explication pour cette baisse, une action doit Ãªtre
entreprise pour corriger le tir.</p>
</div>
<div class="paragraph">
<p>Les indicateurs qualitÃ© sont rarement trÃ¨s pertinents tels quels, et, en
tout cas, la valeur cible Ã  respecter dÃ©pend du contexte du projet, de
ses objectifs et souvent de l&#8217;Ã©lÃ©ment technique considÃ©rÃ©. Notre code
d&#8217;accÃ¨s Ã  la base devrait Ãªtre proche de 100 % de couverture de test,
sinon cela voudrait dire que certaines requÃªtes ne font pas l&#8217;objet de
tests et qu&#8217;une modification dans notre modÃ¨le ne serait pas dÃ©tectÃ©e.
De mÃªme, tous les aspects fonctionnels (le code mÃ©tier utile) doivent
Ãªtre largement couverts. En revanche, d&#8217;autres parties de notre code,
prÃ©sentant de nombreux cas d&#8217;erreurs qui ne donnent pas lieu Ã  un
traitement prÃ©cis autre que Â«Â erreur interne, merci de rÃ©essayer plus
tardÂ Â», peuvent lÃ©gitimement obtenir une couverture moindre.</p>
</div>
</div>
<div class="sect3">
<h4 id="_lentropie_augmente">L&#8217;entropie augmente</h4>
<div class="paragraph">
<p>Il n&#8217;existe pas de juste milieu absolu. NÃ©anmoins, on constate
l&#8217;application universelle du second principe de la thermodynamiqueÂ : le
code tend toujours Ã  se dÃ©grader pour devenir moins organisÃ© et moins
bien testÃ©. Des tests obsolÃ¨tes sont supprimÃ©s, le nouveau code Ã©crit
dans la chaleur d&#8217;un coup de bourre est peu ou pas instrumentÃ©â¦ Juste
maintenir le code au mÃªme niveau demande une dÃ©bauche d&#8217;Ã©nergie, de
temps et donc de budgetÂ !</p>
</div>
<div class="paragraph">
<p>Pour dÃ©tecter rapidement une telle dÃ©rive, rien ne vaut un bon graphe
synthÃ©tique historisant l&#8217;Ã©volution du projet. De maniÃ¨re assez
amusante, on peut souvent deviner les dates de livraison sur de telles
courbesÂ : on constate un inflÃ©chissement de la courbe dans la semaine
qui prÃ©cÃ¨de la livraison et (dans le meilleur des cas) une reprise lente
dans les semaines qui suivent.</p>
</div>
</div>
<div class="sect3">
<h4 id="maitrise_de_s">MaÃ®trise de <em>S</em> <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></h4>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaVincentM.png" alt="MangaVincentM"></span></p>
</div>
<div class="paragraph">
<p>Le spÃ©cialiste en thermodynamique de l&#8217;Ã©quipe c&#8217;est Vincent, et c&#8217;est
donc lui qui nous propose spontanÃ©ment un outil pour Ãªtre en mesure de
mesurer l&#8217;entropie de notre projet. Il a dÃ©jÃ  passÃ© de longues heures Ã 
analyser les nombreux rapports produits par Maven dans notre site et a
rapidement compris que ce ne sont que des donnÃ©es brutes. Il faut Ãªtre
capable de les lire Ã  des altitudes diffÃ©rentesÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ã 30Â 000 pieds, on doit avoir en un coup d&#8217;Åil une vision globale
du projet, trÃ¨s imparfaite, mais parlante. Le projet est-il dans le rouge
ou non ? Quel est le type de violation le plus couramment constatÃ© et
sur lequel il faudra faire un effort de communication et de formationÂ ?</p>
</li>
<li>
<p>Ã 3Â 000 pieds, on doit Ãªtre en mesure d&#8217;identifier les modules et
de distinguer celui qui joue le mouton noir (espÃ©rons qu&#8217;il n&#8217;y en ait
qu&#8217;un seul), la rÃ¨gle de codage la moins bien respectÃ©e.</p>
</li>
<li>
<p>Ã 300 pieds, on peut pointer du doigt les packages dans lesquels
il serait bon de passer un peu plus de temps, ou la rÃ¨gle de codage dont
les dÃ©veloppeurs ont sans doute mal compris la portÃ©e.</p>
</li>
<li>
<p>Ã 30 pieds, on accÃ¨de au TopÂ 10 des classes Ã  problÃ¨me, et on
commence Ã  regarder les noms des auteurs des derniÃ¨res modifications
pour savoir avec qui il faudra discuter de maniÃ¨re aimable et
constructive lors de la prochaine pause-cafÃ©.</p>
</li>
<li>
<p>Ã 1 mÃ¨tre, on dÃ©roule le code source ligne par ligne et on y
identifie chaque violation. En binÃ´me avec le dÃ©veloppeur qui a eu la
maladresse d&#8217;Ã©crire ce code, on peut discuter du bien-fondÃ© de la rÃ¨gle
et des faÃ§ons d&#8217;Ã©crire un code plus propre et plus conforme Ã  nos
exigences.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ce Google Earth pour code existe, il s&#8217;appelle Sonar.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sonar">Sonar</h4>
<div class="paragraph">
<p>Sonar <sup class="footnote">[<a id="_footnoteref_43" class="footnote" href="#_footnotedef_43" title="View footnote.">43</a>]</sup> est une application web qui va stocker dans une
base de donnÃ©es tous les indicateurs et statistiques extraits par nos
rapports d&#8217;analyse de code. En outil convivial et soucieux de sa
simplicitÃ© d&#8217;utilisation, il est proposÃ© avec un serveur d&#8217;application
et une base de donnÃ©es embarquÃ©s, ce qui limite la procÃ©dure
d&#8217;installation au strict minimum. Pour une utilisation en entreprise de
maniÃ¨re plus stratÃ©gique, on pourra cependant le dÃ©ployer sur un serveur
et le configurer pour utiliser une base de donnÃ©es dÃ©diÃ©e.</p>
</div>
<div class="paragraph">
<p>Les donnÃ©es de Sonar sont accessibles <em>via</em> un frontal web synthÃ©tique,
qui donne les grandes tendances du projet. C&#8217;est notre vue Ã 
30Â 000 pieds du projet (voir FigureÂ 12-02).</p>
</div>
<div class="paragraph">
<div class="title">Figure 12-02</div>
<p><span class="image"><img src="illustrations/12-02.png" alt="12 02"></span></p>
</div>
<div class="paragraph">
<p>SynthÃ¨se de nos indicateurs qualitÃ© dans Sonar.</p>
</div>
<div class="paragraph">
<p>La reprÃ©sentation du projet en blocs colorÃ©s est particuliÃ¨rement
compacte et pertinente. Pour un critÃ¨re donnÃ© â ici, le respect des
rÃ¨gles de codage â, un bloc de grande surface correspond Ã  un grand
volume de code et la couleur au niveau de satisfaction du critÃ¨re. Un
petit bloc rouge dans un ensemble vert pourra donc Ãªtre acceptable si on
sait le justifier, alors qu&#8217;un grand bloc orange sera de trÃ¨s mauvais
augure. Chaque Ã©lÃ©ment de cette synthÃ¨se est un lien vers plus de
dÃ©tails. On va ainsi descendre de lien en lien jusqu&#8217;aux classes du
projet puis ouvrir son code source pour constater la ligne de code qui a
Ã©tÃ© identifiÃ©e par l&#8217;analyse de code (voir Figure 12-03).</p>
</div>
<div class="paragraph">
<div class="title">Figure 12-03</div>
<p><span class="image"><img src="illustrations/12-03.png" alt="12 03"></span></p>
</div>
<div class="paragraph">
<p>DÃ©tail des violations constatÃ©es par Sonar dans notre code source.</p>
</div>
<div class="paragraph">
<p>Sonar va extraire de notre projet Maven l&#8217;ensemble des indicateurs qu&#8217;il
prend en charge <em>via</em> un plugin dÃ©diÃ©. Celui-ci va directement enrichir
la base de donnÃ©es du serveur Sonar pour la construction en cours. Le
serveur exploitera ensuite les donnÃ©es pour fournir une synthÃ¨se ainsi
qu&#8217;un historique. Le Listing 12.4 montre la configuration de ce plugin
dans notre POM. Le plugin sonar utilisant de nombreuses propriÃ©tÃ©s, il
est plus simple de les configurer comme telles et d&#8217;invoquer la tÃ¢che
<code>mvn sonar:sonar</code>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 12.4 : Configuration du plugin <em>Sonar</em></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"> &lt;profile&gt;
      &lt;id&gt;sonar&lt;/id&gt;
      &lt;properties&gt;
        &lt;sonar.host.url&gt;http://sonar.geegol.com&lt;/sonar.host.url&gt;
        &lt;sonar.jdbc.url&gt;jdbc:mysql://mysql.geegol.com:3306/SONAR?autoReconnect=true&lt;/sonar.jdbc.url&gt;
        &lt;sonar.jdbc.driver&gt;com.mysql.jdbc.Driver&lt;/sonar.jdbc.driver&gt;
        &lt;sonar.jdbc.username&gt;sonar&lt;/sonar.jdbc.username&gt;
        &lt;sonar.jdbc.password&gt;sonar&lt;/sonar.jdbc.password&gt;
      &lt;/properties&gt;
    &lt;/profile&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pour produire ces mÃ©triques de notre projet Ã  intervalles rÃ©guliers,
nous dÃ©cidons de laisser notre serveur d&#8217;intÃ©gration continue effectuer
une construction dÃ©diÃ©e toutes les nuits â il faut bien rentabiliser la
machine. Sur notre serveur Hudson, nous avons la bonne surprise de
dÃ©couvrir un plugin dÃ©diÃ© Ã  Sonar, qui nous Ã©conomise la configuration
de cet outil dans notre POM. Il suffit de fournir quelques paramÃ¨tres
dans la console d&#8217;administration de Hudson et de configurer une
construction du projet Ã  heure fixe.</p>
</div>
<div class="paragraph">
<p>Nous constatons que la complexitÃ© mesurÃ©e de notre code grimpe
rÃ©guliÃ¨rement (voir Figure 12-04). C&#8217;est une dÃ©rive typique qui prend
pied de maniÃ¨re maligne, rÃ©partie un peu partout dans le code et sans
que personne s&#8217;en sente responsable. Il est temps de sensibiliser
l&#8217;Ã©quipe, par exemple en lui montrant cette simple courbe, sur
l&#8217;influence que peut avoir un petit effort quotidien de clarification et
de simplification du code.</p>
</div>
<div class="paragraph">
<div class="title">Figure 12-04</div>
<p><span class="image"><img src="illustrations/12-04.png" alt="12 04"></span></p>
</div>
<div class="paragraph">
<p>Ãvolution de nos indicateurs qualitÃ©.</p>
</div>
<div class="paragraph">
<p>La Figure 12-05 indique Ã©galement le Top 10 des violations constatÃ©es,
ce qui nous dira immÃ©diatement sur quoi nous devons mettre l&#8217;accent.
Notre session mensuelle de dÃ©briefing est dÃ©jÃ  toute tracÃ©eÂ !</p>
</div>
<div class="paragraph">
<p>Sonar n&#8217;est dÃ©finitivement pas un outil de flicage, c&#8217;est un assistant
extrÃªmement puissant pour accompagner le travail d&#8217;une Ã©quipe et pointer
du doigt ses dÃ©rives. Le dÃ©veloppeur parfait n&#8217;existe pas, mais le
dÃ©veloppeur bien outillÃ© peut tenter de s&#8217;amÃ©liorer.</p>
</div>
<div class="paragraph">
<div class="title">Figure 12-05</div>
<p><span class="image"><img src="illustrations/12-05.png" alt="12 05"></span></p>
</div>
<div class="paragraph">
<p>Classement des violations les plus souvent identifiÃ©es</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_11">Conclusion</h3>
<div class="paragraph">
<p>Accompagner notre projet d&#8217;un bon support documentaire et d&#8217;un bon suivi
qualitÃ© est une tÃ¢che ambitieuse, qui peut s&#8217;appuyer sur de trÃ¨s
nombreux outils. Inutile de vouloir se surÃ©quiper si on nâen a pas
compris l&#8217;utilisation. Maven aide Ã  mettre en place les outils
progressivement, Ã  apprendre Ã  les exploiter. Notre ingÃ©nieur qualitÃ©
devrait en toute logique nous aider Ã  accomplir cette initiation et, une
fois mÃ»rs, nous pourrons en tirer tout le bÃ©nÃ©fice.</p>
</div>
<div class="paragraph">
<p>Maven n&#8217;est ici que le catalyseur qui nous aide Ã  utiliser des outils
existants. Cependant, la facilitÃ© avec laquelle on introduit un outil
d&#8217;analyse dans un projet Maven encourage Ã  lâessayer, Ã  en dÃ©couvrir
l&#8217;usage, et progressivement Ã  mettre en place une culture du coder
proprement (livre de Robert C. Martin que je vous recommande chaudement,
chez le mÃªme Ã©diteur).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chapitre_13respecter_un_format_de_distribution">Chapitre 13Â :Â Respecter un format de distribution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nous avons produit avec Maven un ensemble de binaires respectant les
formats imposÃ©s par la plateforme Java et la norme JavaEE. Il nous reste
Ã  envoyer le rÃ©sultat de notre dur labeur pour la mise en production.
Nous entrons alors dans une longue procÃ©dure de dÃ©claration et de mise
en conformitÃ©. De toute Ã©vidence, l&#8217;Ã©quipe chargÃ©e d&#8217;installer, de
configurer et de surveiller les serveurs d&#8217;applications, a largement de
quoi s&#8217;occuper avec ses propres problÃ¨mes pour ne pas vouloir se plier Ã 
nos caprices. Ã nous de lui fournir un livrable qui colle Ã  ses outils
et Ã  ses bonnes pratiques pour une mise en production rÃ©ussie.</p>
</div>
<div class="sect2">
<h3 id="D_ou_vient_ce_jar">D&#8217;oÃ¹ vient ce JARÂ ?</h3>
<div class="paragraph">
<p>Depuis que nous avons mis en place un mÃ©canisme d&#8217;intÃ©gration continue,
nous en avons tirÃ© de nombreux avantages, parmi lesquels le fait de
disposer en permanence de la derniÃ¨re version stable et testÃ©e de nos
binaires, ce qui nous Ã©vite de construire l&#8217;intÃ©gralitÃ© du projet sur
nos postes de dÃ©veloppement. Le projet commenÃ§ant Ã  prendre de
l&#8217;embonpoint Ã  force d&#8217;explorer de multiples directions, c&#8217;est un
avantage important en termes de productivitÃ© â Ã  tel point que nous
avons rapidement pris l&#8217;habitude d&#8217;utiliser ces binaires issus de
l&#8217;intÃ©gration continue comme fourniture Ã  notre Ã©quipe de test pour
valider la bonne communication avec les systÃ¨mes partenaires et la tenue
des performances.</p>
</div>
<div class="paragraph">
<p>Le gain de temps et de stabilitÃ© est significatif. PlutÃ´t que de perdre
des heures Ã  prÃ©parer une version dÃ©diÃ©e aux tests, nous avons toujours
Ã  notre disposition un livrable prÃªt Ã  Ãªtre testÃ© â pas forcÃ©ment
complet, mais fonctionnel. Par ailleurs, nous sommes sÃ»rs que cette
fourniture respecte nos critÃ¨res qualitÃ© puisqu&#8217;elle est issue de notre
fabrique logicielle. Nous entrons ainsi dans une phase
d&#8217;industrialisation durant laquelle un processus automatisÃ© produit
notre livrable avec l&#8217;outillage qualitÃ© adÃ©quat.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaLukas.png" alt="MangaLukas"></span></p>
</div>
<div class="paragraph">
<p>Lukas a cependant fait les frais d&#8217;une automatisation maladroite de ce
processus. L&#8217;Ã©quipe de test vient de lui remonter une anomalie graveÂ :
au-delÃ  de cinquante requÃªtes par seconde, l&#8217;application semble se figer
et voit ses performances se dÃ©grader Ã  vue d&#8217;Åil. La version prÃ©cÃ©dente
n&#8217;avait rencontrÃ© aucun souci de ce type, et il est donc urgent
d&#8217;identifier le problÃ¨me. Le premier rÃ©flexe est de se demander ce qui a
changÃ© entre ces deux versions testÃ©es, et c&#8217;est lÃ  que Lukas se
retrouve seul face Ã  deux fichiers EAR, sans aucune information lui
permettant de faire rapidement le lien avec notre gestionnaire de code
source.</p>
</div>
<div class="paragraph">
<p>Pour pallier ce problÃ¨me, nous devons disposer au sein de l&#8217;archive EAR
d&#8217;une indication de l&#8217;emplacement exact dans l&#8217;historique de notre code
d&#8217;oÃ¹ elle a Ã©tÃ© tirÃ©e. Le mÃ©canisme de marques (tag) dans le
gestionnaire de code source est gÃ©nÃ©ralement utilisÃ© Ã  cet effet pour
faire le lien entre une version publiÃ©e et son code source. Cependant,
nous parlons ici de versions de tests que nous livrons une Ã  deux fois
par semaine Ã  l&#8217;analyse fÃ©roce de nos outils de tests de charge et
d&#8217;interopÃ©rabilitÃ©. Toutes ces versions portent le mÃªme numÃ©ro
1.2.0-SNAPSHOT qui reflÃ¨te bien que le projet n&#8217;est pas encore abouti.</p>
</div>
<div class="sect3">
<h4 id="numero_de_construction">NumÃ©ro de construction</h4>
<div class="paragraph">
<p>Une solution consiste Ã  produire des binaires dont le numÃ©ro de version
est complÃ©tÃ© par un compteur de construction, que le serveur
d&#8217;intÃ©gration continue incrÃ©mente Ã  chaque tentative de construction. Le
serveur d&#8217;intÃ©gration continue a le bon goÃ»t de nous fournir la valeur
courante sous forme d&#8217;une variable systÃ¨me, que nous pouvons donc
exploiter dans le build Maven. Le Listing 13.1 montre la configuration
de notre POM pour exploiter cette variable et produire les livrables en
consÃ©quence. Nous utilisons un profil qui n&#8217;est activÃ© que sur le
serveur d&#8217;intÃ©gration continue, afin de ne pas perturber les autres
environnements.</p>
</div>
<div class="listingblock">
<div class="title">Listing 13.1 : Exploiter le numÃ©ro de construction de Hudson</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;profile&gt;
  &lt;id&gt;integration-continue&lt;/id&gt;
  &lt;build&gt;
   &lt;finalName&gt;${project.artifactId}/${project.version}-build-${HUDSON_build}&lt;/finalName&gt;
  &lt;/build&gt;
&lt;/profile&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notre livrable est ainsi construit sous le nom
noubliepaslalistedescourses-1.2.0-SNAPSHOT-build-792. La consultation de
l&#8217;historique de notre intÃ©gration continue indiquerait immÃ©diatement Ã 
quel code source correspond ce build 792. Nous pouvons d&#8217;ailleurs
demander au serveur d&#8217;intÃ©gration continue de conserver soigneusement
les traces d&#8217;une construction dont nous livrons le rÃ©sultat Ã  l&#8217;Ã©quipe
de test et de placer une marque dans le gestionnaire de code source en
consÃ©quence.</p>
</div>
</div>
<div class="sect3">
<h4 id="numero_de_revision">NumÃ©ro de rÃ©vision</h4>
<div class="paragraph">
<p>Une solution alternative, liÃ©e Ã  l&#8217;utilisation du gestionnaire de code
source Subversion, est la notion de rÃ©vision. Sur Subversion, Ã  chaque
commit c&#8217;est tout le rÃ©fÃ©rentiel qui voit son numÃ©ro de rÃ©vision
incrÃ©mentÃ©, et pas juste le fichier modifiÃ©. On arrive ainsi rapidement
Ã  des numÃ©ros de rÃ©vision Ã  cinq ou six chiffres.</p>
</div>
<div class="paragraph">
<p>Si cela n&#8217;a aucune influence sur le dÃ©veloppeur, cela fournit un moyen
de lier un livrable Ã  son code source de maniÃ¨re extrÃªmement prÃ©ciseÂ :
si le binaire a Ã©tÃ© construit Ã  partir de la rÃ©vision 4704, il suffit
d&#8217;extraire de SVN l&#8217;Ã©tat du code source associÃ©. Nous pouvons d&#8217;ailleurs
demander a posteriori Ã  Subversion de poser une marque pour le code
associÃ© Ã  cette rÃ©vision particuliÃ¨re.</p>
</div>
<div class="paragraph">
<p>Avantage par rapport au numÃ©ro de construction, ce numÃ©ro de rÃ©vision
n&#8217;est pas liÃ© au serveur d&#8217;intÃ©gration continue et peut Ãªtre obtenu sur
n&#8217;importe quel poste de dÃ©veloppement. La mÃªme construction donnera donc
le mÃªme rÃ©sultat, ce qui est la moindre des chosesÂ ! Le Listing 13.2
montre l&#8217;utilisation du plugin buildnumber pour obtenir ce numÃ©ro de
rÃ©vision et l&#8217;exploiter sous forme de variable Maven. Ã noter qu&#8217;il est
dÃ©clenchÃ© dans la phase prepare-package disponible dans Maven 2.1 et
versions ultÃ©rieures.</p>
</div>
<div class="listingblock">
<div class="title">Listing 13.2 : Obtenir le numÃ©ro de rÃ©vision SVN</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;build&gt;
  &lt;plugins&gt;
     &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;buildnumber-maven-plugin&lt;/artifactId&gt;
        &lt;executions&gt;
           &lt;execution&gt;
              &lt;phase&gt;prepare-package&lt;/phase&gt;
              &lt;goals&gt;
                 &lt;goal&gt;create&lt;/goal&gt;
              &lt;/goals&gt;
           &lt;/execution&gt;
        &lt;/executions&gt;
       &lt;configuration&gt;
           &lt;doCheck&gt;false&lt;/doCheck&gt;
           &lt;doUpdate&gt;false&lt;/doUpdate&gt;
        &lt;/configuration&gt;
     &lt;/plugin&gt;
   &lt;/plugins&gt;
   &lt;finalName&gt;${project.artifactId}/${project.version}-rev-${svnnumber}&lt;/finalName&gt;
&lt;/build&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_utiliser_le_manifest">Utiliser le MANIFEST</h4>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaLukas.png" alt="MangaLukas"></span></p>
</div>
<div class="paragraph">
<p>DÃ©cidÃ© Ã  ne pas se faire avoir deux fois, Lukas met en place cette
solution et fait produire par notre serveur d&#8217;intÃ©gration continue des
binaires portant systÃ©matiquement l&#8217;indication de rÃ©vision SVN dans le
nom du fichier. Il est cependant rapidement ramenÃ© Ã  la dure rÃ©alitÃ©
lorsqu&#8217;il constate que la derniÃ¨re version disponible de l&#8217;EAR dans
notre gestionnaire de bibliothÃ¨que s&#8217;appelleâ¦
noubliepaslalistedescourses-1.2.0-SNAPSHOT.ear â oupsÂ !</p>
</div>
<div class="paragraph">
<p>Nous avons jusqu&#8217;ici cherchÃ© Ã  modifier le nom du fichier produit par
Maven. C&#8217;est oublier que la phase de dÃ©ploiement dans notre dÃ©pÃ´t de
bibliothÃ¨ques n&#8217;en tient pas compteÂ : le binaire qui est dÃ©ployÃ©
respecte scrupuleusement les indications d&#8217;artifactId et de versionÂ !
MalgrÃ© nos efforts, et mÃªme si le rÃ©pertoire target contient bien finalement
 un fichier
noubliepaslalistedescourses-1.2.0-SNAPSHOT-rev-4704.ear, le fichier que
nous retrouvons dans notre dÃ©pÃ´t ne possÃ¨de plus ce complÃ©ment
d&#8217;information.</p>
</div>
<div class="paragraph">
<p>En fait, nous avons aussi cherchÃ© Ã  rÃ©inventer la poudre. Le format
d&#8217;archive Java (JAR, WAR ou EAR) n&#8217;est pas juste une extension maison
pour une compression de type ZIP. Ce format dÃ©finit aussi un mÃ©canisme
de mÃ©tadonnÃ©es <em>via</em> le rÃ©pertoire spÃ©cialisÃ© META-INF, et en
particulier le descripteur MANIFEST.MF.</p>
</div>
<div class="paragraph">
<p>Ce fichier n&#8217;est rien d&#8217;autre qu&#8217;un fichier texte, dont le formalisme
est un peu dÃ©routant parfois, mais qui ressemble globalement aux fichiers
de propriÃ©tÃ©s que vous manipulez dÃ©jÃ  certainement. Pour une clÃ© donnÃ©e,
on associera une valeur, par exemple pour la clÃ© build le numÃ©ro de
construction de notre serveur d&#8217;intÃ©gration continue.</p>
</div>
<div class="paragraph">
<p>Comment complÃ©ter ce fichier MANIFESTÂ ? La construction de nos projets
par Maven en produit naturellement un, avec des informations
minimalistes. Il suffit de demander aux plugins jar, war ou ear
d&#8217;ajouter d&#8217;autres informations. Le Listing 13.3 montre la configuration
mise en place par Lukas pour aboutir Ã  une solution enfin satisfaisante
et pleinement reproductible. Notez aussi l&#8217;utilisation d&#8217;un profil dÃ©diÃ©
Ã  l&#8217;intÃ©gration continue qui permet de complÃ©ter ces mÃ©tadonnÃ©es,
lorsque des informations complÃ©mentaires sont disponibles, et de ne pas
perturber le fonctionnement de Maven sur les postes de dÃ©veloppement (le
plugin buildnumber <sup class="footnote">[<a id="_footnoteref_44" class="footnote" href="#_footnotedef_44" title="View footnote.">44</a>]</sup> n&#8217;est pas trÃ¨s performant).</p>
</div>
<div class="listingblock">
<div class="title">Listing 13.3 : Ajout de mÃ©tadonnÃ©es dans le MANIFEST</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">      &lt;profile&gt;
         &lt;id&gt;integration-continue&lt;/id&gt;
         &lt;build&gt;
            &lt;pluginManagement&gt;
               &lt;plugins&gt;
                  &lt;plugin&gt;
                     &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                     &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
                     &lt;configuration&gt;
                        &lt;archive&gt;
                           &lt;manifestEntries&gt;
                              &lt;Build&gt;${buildNumber}&lt;/Build&gt;
                           &lt;/manifestEntries&gt;
                        &lt;/archive&gt;
                     &lt;/configuration&gt;
                  &lt;/plugin&gt;
                  &lt;plugin&gt;
                     &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                     &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;
                     &lt;configuration&gt;
                        &lt;archive&gt;
                           &lt;manifestEntries&gt;
                              &lt;Build&gt;${buildNumber}&lt;/Build&gt;
                           &lt;/manifestEntries&gt;
                        &lt;/archive&gt;
                     &lt;/configuration&gt;
                  &lt;/plugin&gt;
               &lt;/plugins&gt;
            &lt;/pluginManagement&gt;
            &lt;plugins&gt;
               &lt;plugin&gt;
                  &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
                  &lt;artifactId&gt;buildnumber-maven-plugin&lt;/artifactId&gt;
                  &lt;executions&gt;
                     &lt;execution&gt;
                        &lt;phase&gt;prepare-package&lt;/phase&gt;
                        &lt;goals&gt;
                           &lt;goal&gt;create&lt;/goal&gt;
                        &lt;/goals&gt;
                     &lt;/execution&gt;
                  &lt;/executions&gt;
                  &lt;configuration&gt;
                     &lt;doCheck&gt;false&lt;/doCheck&gt;
                     &lt;doUpdate&gt;false&lt;/doUpdate&gt;
                  &lt;/configuration&gt;
               &lt;/plugin&gt;
            &lt;/plugins&gt;
         &lt;/build&gt;
      &lt;/profile&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Avec cette configuration, chacun de nos binaires portera dÃ©sormais les
informations complÃ¨tes de ses origines. En cas de besoin, il nous
suffira de les exploiter pour retrouver rapidement le code source
associÃ©, et Ã©ventuellement les traces de sa construction dans notre
serveur d&#8217;intÃ©gration continue.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="La_confiance_regne">La confiance rÃ¨gneâ¦</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaStephane.png" alt="MangaStephane"></span></p>
</div>
<div class="paragraph">
<p>StÃ©phane revient l&#8217;air sombre d&#8217;une longue rÃ©union avec les responsables
stratÃ©giques du groupe. Il leur a exposÃ© nos pratiques, nos outils et
les avantages en termes de productivitÃ© et de stabilitÃ© que nous tirons
du couple intÃ©gration continue/gestionnaire de dÃ©pÃ´t. Il s&#8217;est alors
cassÃ© les dents sur un expert en sÃ©curitÃ©, certifiÃ© CISSP-ISSMP, CISA,
etc., un adepte du chiffrage des clÃ©s asymÃ©triques et autres mÃ©canismes
que nous utilisons tous les jours sans nous en rendre compte, mais que
peu de monde est capable d&#8217;expliquer.</p>
</div>
<div class="paragraph">
<p>Notre M. SÃ©curitÃ© a juste tiquÃ© lorsque StÃ©phane a expliquÃ© que chaque
poste de dÃ©veloppement rÃ©cupÃ¨re depuis un serveur les bibliothÃ¨ques dans
leur derniÃ¨re version stable.</p>
</div>
<div class="paragraph">
<p>Â«Â Qui valide cette stabilitÃ©Â ?</p>
</div>
<div class="paragraph">
<p>â Le serveur d&#8217;intÃ©gration continue, avec son armada de tests, de
mÃ©triques et de rÃ¨gles qualitÃ©.</p>
</div>
<div class="paragraph">
<p>â Est-il le seul Ã  pouvoir publier des binaires sur ce serveurÂ ?</p>
</div>
<div class="paragraph">
<p>â En principe, tout dÃ©veloppeur peut Ã©galement publier les binaires du
projet sur lequel il travaille, Ã§a peut parfois Ãªtre utile d&#8217;ailleurs
pour propager rapidement une correction, mais en pratiqueâ¦</p>
</div>
<div class="paragraph">
<p>â Mais alors, il n&#8217;est pas possible de s&#8217;assurer de qui a produit le
binaireÂ ?</p>
</div>
<div class="paragraph">
<p>â Eh bien, nous pourrions l&#8217;ajouter dans le MANIFEST, justement
rÃ©cemment nous l&#8217;avons complÃ©tÃ© du numÃ©ro de rÃ©visionâ¦</p>
</div>
<div class="paragraph">
<p>â Mais comment Ãªtre sÃ»r que cette information est fiableÂ ?</p>
</div>
<div class="paragraph">
<p>â Euhâ¦ vous voulez dire que quelqu&#8217;un se ferait passer pour un autreÂ ?</p>
</div>
<div class="paragraph">
<p>â OuiÂ : un employÃ© ayant un compte Ã  rÃ©gler, ou pire, un pirate
informatiqueÂ !</p>
</div>
<div class="paragraph">
<p>â Eh bienâ¦Â Â»</p>
</div>
<div class="paragraph">
<p>Faut-il prÃ©ciser que StÃ©phane s&#8217;attendait Ã  de nombreuses questions,
mais certainement pas Ã  celles-lÃ . Sa prÃ©sentation Ã©tait orientÃ©e
productivitÃ©, fiabilitÃ©, rÃ©activitÃ© et travail d&#8217;Ã©quipe, pas flicage et
suspicion. Il faut dire que notre Ã©quipe est composÃ©e de bons camarades
et que nous ne connaissons pas les situations tendues de malveillances
informatiques. Mais il est vrai quâun JAR incluant des erreurs ou du
code malicieux, qui se retrouve automatiquement installÃ© sur tous les
postes de dÃ©veloppement avec l&#8217;aide du mÃ©canisme de SNAPSHOT, peut faire
perdre des journÃ©es entiÃ¨res de travail, multipliÃ©es par le nombre de
dÃ©veloppeurs concernÃ©sâ¦</p>
</div>
<div class="paragraph">
<p>La premiÃ¨re option est, bien sÃ»r, de sÃ©curiser notre dÃ©pÃ´t de
bibliothÃ¨ques. Un compte et un mot de passe sont dÃ©sormais nÃ©cessaires
pour pouvoir y dÃ©ployer des binaires. StÃ©phane est cependant un peu
anxieux de retourner au casse-pipe avec cette seule rÃ©ponse Ã  donner Ã 
notre M. SÃ©curitÃ©. Il cherche donc un moyen pour indiquer de maniÃ¨re
infalsifiable qui a produit une archive Java.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaOlivier.png" alt="MangaOlivier"></span></p>
</div>
<div class="paragraph">
<p>La rÃ©ponse lui vient indirectement d&#8217;Olivier. Celui-ci a pris l&#8217;habitude
de signer numÃ©riquement ses mails, sans doute plus pour le plaisir
d&#8217;installer l&#8217;extension nÃ©cessaire Ã  son navigateur et d&#8217;assumer ainsi
son appartenance indiscutable au monde des geeks. Cette signature
utilise l&#8217;algorithme GPG <sup class="footnote">[<a id="_footnoteref_45" class="footnote" href="#_footnotedef_45" title="View footnote.">45</a>]</sup>, qui a le double avantage
d&#8217;Ãªtre libre et basÃ© sur un couple de clÃ©s. La clÃ© publique permet Ã 
n&#8217;importe qui de valider l&#8217;identitÃ© de l&#8217;auteur, qui conserve
soigneusement sa clÃ© privÃ©e hors de portÃ©e de tout intrus.</p>
</div>
<div class="paragraph">
<p>InterrogÃ© sur le sujet, Olivier fait rapidement le lien avec le
plugin GPG disponible pour Maven et qui permet de signer un binaire de
la mÃªme faÃ§on qu&#8217;il signe ses messages. L&#8217;auteur, dÃ©clarÃ© dans le
fichier MANIFEST, est donc facilement contrÃ´lable <em>via</em> sa clÃ© publique.
Le Listing 13.4 montre la configuration de ce plugin mis en place par
Olivier et StÃ©phane.</p>
</div>
<div class="listingblock">
<div class="title">Listing 13.4 : Mise en place d&#8217;une signature GPG</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;project&gt;
  ...
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-gpg-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.0-alpha-4&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;sign-artifacts&lt;/id&gt;
            &lt;phase&gt;verify&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;sign&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
  ...
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Chaque dÃ©veloppeur qui dÃ©sire diffuser un binaire sur le dÃ©pÃ´t verra
ainsi son nom gravÃ© dans le marbre du MANIFEST et le fichier binaire
signÃ© numÃ©riquement par sa clÃ© GPG. VoilÃ  de quoi donner du rÃ©pondant Ã 
StÃ©phane pour sa prochaine rÃ©unionÂ !</p>
</div>
</div>
<div class="sect2">
<h3 id="_lear_ne_suffit_pas">L&#8217;EAR ne suffit pas</h3>
<div class="paragraph">
<p>Notre archive d&#8217;entreprise EAR ne se suffit pas. Elle doit Ãªtre
complÃ©tÃ©e par des fichiers de configuration, dans lesquels devront Ãªtre
indiquÃ©s des paramÃ¨tres techniques dÃ©pendant de l&#8217;environnement rÃ©seau,
du systÃ¨me hÃ´te, ou des ajustements liÃ©s Ã  la charge constatÃ©e sur le
serveurÂ : nombre de threads allouÃ©s Ã  nos tÃ¢ches de fond, <em>time-out</em> de
connexion Ã  nos serveurs partenairesâ¦</p>
</div>
<div class="paragraph">
<p>Pour des raisons d&#8217;assurance qualitÃ©, nous devons Ã©galement accompagner
notre application de tout le code source qui la compose. Cela peut
sembler bien paranoÃ¯aque, mais de trop nombreuses applications se sont
retrouvÃ©es en production alors que le code source Ã©tait
malencontreusement Ã©garÃ©, perdu au cours de la rÃ©affectation d&#8217;un
serveur de dÃ©veloppement ou de l&#8217;archivage un peu rapide de nos supports
de stockage.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>De nombreuses entreprises imposent pour la mÃªme raison, dans leurs
rÃ¨gles qualitÃ©, de recompiler tout logiciel open-source introduit dans
une application. Si cette rÃ¨gle est rarement appliquÃ©e (hou, les
vilains), vous devinez facilement de quelle expÃ©rience catastrophique
elle peut provenirâ¦ binaires non identifiÃ©s, sans code source, bugs
impossibles Ã  reproduire et donc Ã  corriger. Le passÃ© a dÃ» laisser Ã 
certains de cruelles blessures.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Nous ne pouvons donc pas nous contenter de produire notre EAR avec
Maven, il nous manque une Ã©tape, et vous imaginez que nous n&#8217;allons pas
arrÃªter notre dÃ©marche d&#8217;automatisation complÃ¨te du processus si prÃ¨s du
butÂ !</p>
</div>
<div class="sect3">
<h4 id="_assemblage_du_livrable">Assemblage du livrable</h4>
<div class="paragraph">
<p>La production rÃ©clame une archive Unix tar.gz rÃ©pondant Ã  une structure
trÃ¨s prÃ©ciseÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>L&#8217;archive EAR doit Ãªtre placÃ©e dans un sous-rÃ©pertoire
application.</p>
</li>
<li>
<p>Nos fichiers de configuration doivent Ãªtre regroupÃ©s dans un
sous-rÃ©pertoire configuration.</p>
</li>
<li>
<p>Le code source doit Ãªtre placÃ© dans un sous-rÃ©pertoire sources.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Nous avons dÃ©jÃ  vu un joli panel de plugins qui nous ont bien aidÃ©s dans
notre travailÂ ; nous allons faire appel au plugin assembly, l&#8217;un de
leurs petits frÃ¨res. Ce plugin va exploiter un fichier XML qui dÃ©crit le
livrable Ã  assembler. Dans ce fichier, nous indiquerons les constituants
de notre archive.</p>
</div>
<div class="paragraph">
<p>Le fichier <em>assembly</em> comptera trois parties, correspondant aux trois
constituants clÃ©s de notre archive cible. Ce fichier est structurÃ© par
un schÃ©ma XML qui nous aidera Ã  Ã©viter les erreurs de syntaxe. L&#8217;en-tÃªte
du fichier indique le format d&#8217;archive Ã  produireÂ : une archive TAR
compressÃ©e GZip. Nous pourrions aussi bien produire une archive ZIP ou
un TAR non compressÃ©.</p>
</div>
<div class="paragraph">
<p>La suite du fichier indique au plugin assembly les Ã©lÃ©ments du projet Ã 
ajouter dans l&#8217;archive. La premiÃ¨re partie va piocher dans notre projet
multimodule (voir le Chapitre 7) celui qui produit l&#8217;archive EAR. Nous
pourrions le dÃ©sarchiver ou le faire accompagner de ses dÃ©pendances. La
deuxiÃ¨me va inclure une liste de fichiers identifiÃ©s dans un rÃ©pertoire
prÃ©dÃ©fini. La derniÃ¨re va parcourir tous les modules du projet et en
extraire le code source. Le Listing 13.5 montre ce fichier magique qui
nous fera franchir la derniÃ¨re ligne droite avant une production 100Â %
automatisÃ©e de notre livrable.</p>
</div>
<div class="listingblock">
<div class="title">Listing 13.5 : Le fichier <em>assembly</em></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;assembly xmlns="http://maven.apache.org/POM/4.0.0"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
                      http://maven.apache.org/xsd/assembly-1.1.1.xsd"&gt;
  &lt;id&gt;livrable&lt;/id&gt;
  &lt;formats&gt;
    &lt;format&gt;tar.gz&lt;/format&gt;
  &lt;/formats&gt;
  &lt;includeBaseDirectory&gt;false&lt;/includeBaseDirectory&gt;
  &lt;moduleSets&gt;
    &lt;moduleSet&gt;
      &lt;!-- inclusion de l'EAR --&gt;
      &lt;includes&gt;
        &lt;include&gt;com.geegol.shoppinglist:shoppinglist-ear&lt;/include&gt;
      &lt;includes&gt;
      &lt;binaries&gt;
        &lt;unpack&gt;false&lt;/unpack&gt;
        &lt;outputFileNameMapping&gt;shoppinglist.ear&lt;/outputFileNameMapping&gt;
        &lt;outputDirectory&gt;application&lt;/outputDirectory&gt;
        &lt;includeDependencies&gt;false&lt;/includeDependencies&gt;
      &lt;/binaries&gt;
    &lt;/moduleSet&gt;
    &lt;moduleSet&gt;
      &lt;!-- inclusion des fichiers sources de chaque module --&gt;
      &lt;sources&gt;
        &lt;includeModuleDirectory&gt;false&lt;/includeModuleDirectory&gt;
      &lt;/sources&gt;
    &lt;/moduleSet&gt;
  &lt;/modulesSets&gt;
  &lt;fileSets&gt;
    &lt;!-- inclusion des fichiers de configuration --&gt;
    &lt;fileSet&gt;
      &lt;directory&gt;src/main/configuration&lt;/directory&gt;
      &lt;lineEnding&gt;unix&lt;/lineEnding&gt;
      &lt;outputDirectory&gt;configuration&lt;/outputDirectory&gt;
      &lt;includes&gt;
        &lt;include&gt;**/*.xml&lt;/include&gt;
        &lt;include&gt;**/*.properties&lt;/include&gt;
      &lt;/includes&gt;
      &lt;fileMode&gt;755&lt;/fileMode&gt;
    &lt;/fileSet&gt;
  &lt;/fileSets&gt;
&lt;/assembly&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Le format de ce fichier utilise un schÃ©ma XML qui nous assistera dans sa
saisie et qui est largement documentÃ© sur le site web du
plugin <sup class="footnote">[<a id="_footnoteref_46" class="footnote" href="#_footnotedef_46" title="View footnote.">46</a>]</sup>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Le plugin assembly propose quelques descripteurs types pour des usages
courants, comme produire, en parallÃ¨le du livrable, un ZIP des sources.
Un autre assembly qui pourra Ãªtre utile est le jar-with-dependencies qui
construit un gros JAR du projet avec toutes ses dÃ©pendances. C&#8217;est bien
pratique si on doit fournir des outils en ligne de commande (traitements
batch, par exemple), dont le lancement pourra alors se rÃ©sumer Ã  java
-jar monJar.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Pour produire notre livrable tant dÃ©sirÃ©, il nous suffit de lancer la
commande <code>mvn assembly:assembly</code>. Nous l&#8217;avons dÃ©jÃ  vu, cette syntaxe
correspond Ã  l&#8217;invocation d&#8217;une tÃ¢che spÃ©cifique d&#8217;un plugin et non
d&#8217;une phase de construction du projet. Cependant, ce plugin va provoquer
l&#8217;exÃ©cution de la phase package du projet (et de tous ses modules).
C&#8217;est au cours de cette exÃ©cution quâil dÃ©couvrira les constituants de
chaque projet et identifiera les rÃ©pertoires de code source (y compris
le code gÃ©nÃ©rÃ©) et les binaires produits.</p>
</div>
</div>
<div class="sect3">
<h4 id="l_integration_continue_produit_notre_livrable">L&#8217;intÃ©gration continue produit notre livrable</h4>
<div class="paragraph">
<p>Notre serveur d&#8217;intÃ©gration continue produit dÃ©jÃ , Ã  intervalles
rÃ©guliers, nos binaires, prÃªts Ã  Ãªtre testÃ©s au-delÃ  de ce que nos tests
automatisÃ©s savent contrÃ´ler. Il serait dommage de ne pas lui demander
de produire aussi notre livrable, ne serait-ce que pour nous donner un
moyen de vÃ©rifier le respect de son format.</p>
</div>
<div class="paragraph">
<p>L&#8217;idÃ©e paraÃ®t bonne, mais quelle cible Maven invoquerÂ ? Devons-nous
remplacer le <code>mvn install</code> par le fameux assembly:assembly. Nous voudrions
que la production de ce tar.gz soit mieux intÃ©grÃ©e dans la construction
du projet, qu&#8217;elle soit le rÃ©sultat de sa construction par dÃ©faut.</p>
</div>
<div class="paragraph">
<p>Le plugin assembly a la bonne idÃ©e de proposer une autre tÃ¢che, laquelle
est prÃ©vue pour s&#8217;exÃ©cuter au sein d&#8217;un cycle de construction du projet.
Ã la diffÃ©rence du assembly:assembly, nous pouvons associer
assembly:single Ã  une phase du projet, et il sera invoquÃ©
automatiquement lors de sa construction. Le Listing 13.6 indique la
configuration que nous appliquons.</p>
</div>
<div class="listingblock">
<div class="title">Listing 13.6 : Invocation du <em>assembly:single</em> au cours de la construction du projet</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugins&gt;
  &lt;plugin&gt;
    &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;
    &lt;version&gt;2.2-beta-4&lt;/version&gt;
    &lt;inherited&gt;false&lt;/inherited&gt;
    &lt;configuration&gt;
       &lt;descriptors&gt;
          &lt;descriptor&gt;src/assembly/livrable.xml&lt;/descriptor&gt;
       &lt;/descriptors&gt;
    &lt;/configuration&gt;
    &lt;executions&gt;
      &lt;execution&gt;
        &lt;goals&gt;
          &lt;goal&gt;single&lt;/goal&gt;
        &lt;/goals&gt;
        &lt;phase&gt;install&lt;/phase&gt;
      &lt;/execution&gt;
    &lt;/executions&gt;
  &lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Solution miracleÂ ? Eh bien non, Ã©chec cuisant. Le plugin assembly plante
lamentablement en indiquant qu&#8217;il ne trouve pas notre EARÂ :'(.</p>
</div>
</div>
<div class="sect3">
<h4 id="l_oeuf_ou_la_poule">L&#8217;Åuf ou la pouleÂ ?</h4>
<div class="paragraph">
<p>Quel est le problÃ¨meÂ ? Il nous faut comprendre un peu mieux les rouages
de Maven pour expliquer cet Ã©checÂ : nous avons mis en place l&#8217;hÃ©ritage
naturel sur le projet, c&#8217;est-Ã -dire que le mÃªme fichier POM sert Ã 
dÃ©clarer nos modules et de parent commun pour mutualiser la
configuration et les dÃ©pendances. Cette solution, bien pratique, est
largement appliquÃ©e, mais pose ici un problÃ¨meÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>En tant que support du plugin assembly, notre POM parent doit
passer en revue les modules du projet. Le plugin pourra ainsi en
extraire la structure et les binaires produits.</p>
</li>
<li>
<p>En tant que parent, notre POM doit Ãªtre totalement constituÃ© avant
que ses fils puissent Ãªtre construits. Cela signifie que Maven doit
exÃ©cuter son cycle de vie avant de pouvoir s&#8217;attaquer aux modules.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ces deux contraintes contradictoires sont une voie sans issue. Pour
contourner cette impasse, nous utilisons une astuce qui ressemble plus Ã 
un hack qu&#8217;Ã  une vraie solution, mais qui va bien nous dÃ©panner.</p>
</div>
<div class="paragraph">
<p>Nous crÃ©ons Ã  cÃ´tÃ© de notre fichier racine pom.xml un second fichier
POMÂ : pom-assembly.xml. Dans ce nouveau descripteur Maven, nous plaÃ§ons
la configuration du plugin assembly, ainsi que la dÃ©claration d&#8217;un
unique module qui pointe vers le pom initial. Le Listing 13.7 montre ce
nouveau fichier, particuliÃ¨rement simple comparÃ© au volume de XML que
Maven peut parfois nous demander de saisir.</p>
</div>
<div class="listingblock">
<div class="title">Listing 13.7 : Un POM dÃ©diÃ© Ã  l&#8217;assembly</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;project&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.geegol.shoppinglist&lt;/groupId&gt;
  &lt;artifactId&gt;shoppinglist-assembly&lt;/artifactId&gt;
  &lt;version&gt;1.7.1-SNAPSHOT&lt;/version&gt;
  &lt;packaging&gt;pom&lt;/packaging&gt;
  &lt;modules&gt;
    &lt;module&gt;.&lt;/module&gt; &lt;!-- le POM.XML qui est juste Ã  cÃ´tÃ© ! --&gt;
  &lt;/modules&gt;
  &lt;build&gt;
    &lt;defaultGoal&gt;install&lt;/defaultGoal&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;
(  ... )
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>En lanÃ§ant Maven avec l&#8217;option -f, nous pouvons indiquer le fichier POM
Ã  utiliser comme base de la construction du projet. mvn
assembly:assembly -f pom-assembly.xml va donc provoquer la construction
de ce POM minimaliste, l&#8217;exÃ©cution du plugin assembly, qui va, Ã  son
tour, provoquer la phase package sur l&#8217;ensemble des modules du projet.</p>
</div>
<div class="paragraph">
<p>Nous venons de rÃ©soudre le problÃ¨me de l&#8217;Åuf et de la pouleÂ !</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_12">Conclusion</h3>
<div class="paragraph">
<p>Notre software factory (c&#8217;est un mot Ã  la mode, mettez-le sur votre CV)
est dÃ©sormais bien rodÃ©e. Elle construit automatiquement un livrableÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>clairement identifiÃ©Â ;</p>
</li>
<li>
<p>testÃ© de maniÃ¨re unitaire, fonctionnelle, mais aussi en charge
et/ou en endurance selon les mÃ©canismes de test et nos contraintes.
Contrairement Ã  une idÃ©e trop rÃ©pandue, les outils ne sont pas le
facteur limitant dans ce domaineÂ ;</p>
</li>
<li>
<p>respectant nos critÃ¨res qualitÃ© et rÃ¨gles de codage, dont les
mÃ©triques sont historisÃ©esÂ ;</p>
</li>
<li>
<p>Fournissant toutes les indications nÃ©cessaires pour tracer son
origine.</p>
</li>
<li>
<p>mis Ã  disposition de tous les dÃ©veloppeurs qui veulent le tester
ou bÃ©nÃ©ficier des derniÃ¨res correctionsÂ ;</p>
</li>
<li>
<p>prÃªt pour une utilisation directe par les Ã©quipes de production.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Le chemin a Ã©tÃ© long depuis notre petit projet rigolo Ã©changÃ© par
e-mail, et l&#8217;outillage a largement progressÃ©. Si la taille de nos
fichiers pom.xml peut faire peur Ã  certains, il ne faut pas perdre de
vue le nombre de services que Maven propose <em>via</em> une commande unique.</p>
</div>
<div class="paragraph">
<p>Nous pourrions encore dÃ©ployer l&#8217;application de maniÃ¨re automatisÃ©e sur
un serveur JavaEE, sous rÃ©serve qu&#8217;il existe un plugin Maven adaptÃ© (ce
qui couvre quasiment tous les cas Ã  l&#8217;exception notable d&#8217;IBM
Websphere). L&#8217;Ã©quipe de production prÃ©fÃ¨re souvent conserver la main en
choisissant elle-mÃªme quand et par qui une mise Ã  jour est rÃ©alisÃ©e.
Cette retenue est comprÃ©hensible de la part de ceux qui sont en premiÃ¨re
ligne en cas de dysfonctionnement, et qui n&#8217;ont pas encore mesurÃ© le
gain de fiabilitÃ© que l&#8217;intÃ©gration continue, bien instrumentÃ©e, peut
nous apporter. Sans ce dernier rempart, nous passerions de l&#8217;intÃ©gration
continue Ã  la production continue, Ã©volution de l&#8217;industrie logicielle
qui n&#8217;est pas encore dans les mÅurs, mais que Maven peut dÃ©jÃ 
supporterÂ !</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Un_nouveau_projet_demarre">Chapitre 14 : Un nouveau projet dÃ©marre</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Avec tous nos efforts sur notre projet noubliepaslalistedescourses pour
mettre en Åuvre les meilleures pratiques et les outils les plus aboutis,
dans un souci constant d&#8217;intÃ©gration et d&#8217;automatisation, nous
commenÃ§ons Ã  faire parler de nous. Ã tel point que nous est confiÃ©e
lâÃ©laboration d&#8217;un nouveau projet dont les concepts sont proches du
nÃ´tre, malistedecadeauxpournoÃ«l. RaphaÃ«l se voit offrir la lourde tÃ¢che
dâen mettre en place les briques de base.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaRaphael.png" alt="MangaRaphael"></span></p>
</div>
<div class="paragraph">
<p>RaphaÃ«l se dit qu&#8217;on l&#8217;a peut-Ãªtre un peu trompÃ© sur la marchandise,
lorsqu&#8217;il dÃ©couvre le planning du projet. Les dÃ©lais de rÃ©alisation sont
plutÃ´t optimistes, et l&#8217;adoption de Scrum <sup class="footnote">[<a id="_footnoteref_47" class="footnote" href="#_footnotedef_47" title="View footnote.">47</a>]</sup> pour
conduire cette Ã©preuve ne suffira probablement pas Ã  faire des miracles
â si on vous vend les mÃ©thodes agiles sur ce seul critÃ¨re, mÃ©fiez-vous !
Toujours est-il qu&#8217;il va falloir mettre les bouchÃ©es doubles pour lancer
ce projet en un temps record.</p>
</div>
<div class="sect2">
<h3 id="_mutualiser_2">Mutualiser</h3>
<div class="paragraph">
<p>Une solution intelligente consiste Ã  mutualiser nos outils et nos bonnes
pratiques. <em>Via</em> le mÃ©canisme d&#8217;hÃ©ritage du POM, nous pouvons partager
un POM parent commun dans lequel seront remontÃ©s les dÃ©clarations de
plugins, de versions de dÃ©pendances et les autres paramÃ¨tres applicables
Ã  nos deux projets. De la mÃªme faÃ§on, nos classes peuvent Ãªtre dÃ©placÃ©es
dans un projet indÃ©pendant, dont nous partagerons le dÃ©veloppement.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>L&#8217;Ã©lÃ©ment &lt;dependencyManagement&gt; permet de dÃ©clarer de maniÃ¨re globale
les versions utilisÃ©es pour les dÃ©pendances. Un projet qui hÃ©rite de
dependencyManagement nâest affectÃ© dâaucune dÃ©pendance particuliÃ¨re ;
par contre, s&#8217;il dÃ©clare une dÃ©pendance sur cette liste sans prÃ©ciser de
version ou en utilisant une autre version, celle du dependencyManagement
prÃ©domine.</p>
</div>
<div class="paragraph">
<p>C&#8217;est un bon moyen pour mutualiser une liste de dÃ©pendances dont le
fonctionnement a Ã©tÃ© validÃ© et pour Ã©viter Ã  chacun de chercher quelle
version d&#8217;EHCache est compatible avec hibernate-entitymanager x.y.z.</p>
</div>
<div class="paragraph">
<p>Il en est de mÃªme avec les plugins <em>via</em> l&#8217;Ã©lÃ©ment pluginManagement.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_qui_paye">Qui paye ?</h4>
<div class="paragraph">
<p>Dans un monde parfait, cette solution serait optimale : une seule
source, un dÃ©veloppement profitant de l&#8217;attention de tous pour un
meilleur rÃ©sultat. C&#8217;est ce qu&#8217;essaie de faire la fondation Apache pour
ses propres projets en partageant un POM parent (relativement simple)
avec des informations communes comme la licence, les dÃ©pÃ´ts, les listes
de discussion. Elle fait de mÃªme pour le code Ã  travers le projet
commons.apache.org. Le rÃ©sultat est encourageant sans Ãªtre prodigieux.</p>
</div>
<div class="paragraph">
<p>Dans un monde d&#8217;entreprise, cette solution est surtout source de
conflits : qui assure la maintenance des composants communs ? Qui dÃ©cide
des Ã©volutions de ce composant ? Sur quel budget ? Qui supporte les
tests de non-rÃ©gression lorsqu&#8217;un composant mutualisÃ© Ã©volue, alors que
le projet qui l&#8217;utilise n&#8217;a aucune Ã©volution en cours qui pourrait
(discrÃ¨tement) en absorber le coÃ»t ? Sauf Ã  avoir une volontÃ© officielle
et financÃ©e de supporter cette mutualisation, c&#8217;est malheureusement une
voie sans issue qui va surtout Ã©puiser la bonne volontÃ© des premiers
contributeurs de ces composants communs.</p>
</div>
</div>
<div class="sect3">
<h4 id="_partager_un_pom_parent">Partager un POM parent</h4>
<div class="paragraph">
<p>Nous avons dÃ©jÃ  Ã©voquÃ© l&#8217;utilisation d&#8217;un POM d&#8217;entreprise, dans lequel
sont placÃ©es toutes les dÃ©clarations propres Ã  l&#8217;infrastructure et aux
rÃ¨gles de l&#8217;entreprise. On va pouvoir y rÃ©fÃ©rencer le serveur
d&#8217;intÃ©gration continue, le gestionnaire de dÃ©pÃ´t utilisÃ© pour publier
les artefacts. Il permet aussi de prÃ©configurer quelques plugins en
fonction de nos rÃ¨gles de dÃ©veloppement. Les plugins liÃ©s aux outils de
contrÃ´le qualitÃ© comme Checkstyle, PMD ou FindBugs, peuvent ainsi Ãªtre
associÃ©s aux rÃ¨gles dont les dÃ©veloppeurs ont assimilÃ© l&#8217;intÃ©rÃªt. Le
Listing 14.1 montre le POM parent que nous proposons pour Geegol.</p>
</div>
<div class="listingblock">
<div class="title">Listing 14.1 : Un POM d&#8217;entreprise pour Geegol</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
                       http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.geegol&lt;/groupId&gt;
  &lt;artifactId&gt;geegol&lt;/artifactId&gt;
  &lt;name&gt;Geegol corporate POM&lt;/name&gt;
  &lt;version&gt;1 &lt;/version&gt;
  &lt;packaging&gt;pom&lt;/packaging&gt;
  &lt;!-- informations liÃ©es Ã  l'infrastructure rÃ©seau de l'entreprise --&gt;
  &lt;ciManagement&gt;
    &lt;system&gt;hudson&lt;/system&gt;
    &lt;url&gt;http://hudson.geegol.com/&lt;/url&gt;
  &lt;/ciManagement&gt;
    &lt;scm&gt;
      &lt;connection&gt;scm:svn:http://svn.geegol.com/trunk&lt;/connection&gt;
      &lt;developerConnection&gt;scm:svn:https://svn.geegol.com/trunk&lt;/developerConnection&gt;
      &lt;url&gt;http://fisheye.geegol.com/&lt;/url&gt;
  &lt;/scm&gt;
  &lt;repositories&gt;
    &lt;repository&gt;
      &lt;id&gt;geegol.snapshots&lt;/id&gt;
      &lt;url&gt;http://nexus.geegol.com/content/groups/public-snapshots/&lt;/url&gt;
      &lt;snapshots&gt;
        &lt;enabled&gt;true&lt;/enabled&gt;
      &lt;/snapshots&gt;
    &lt;/repository&gt;
  &lt;/repositories&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ce POM commun simplifie un peu la dÃ©finition des projets dÃ©veloppÃ©s au
sein de l&#8217;entreprise, mais ne fait qu&#8217;effleurer la question. Commencer
un projet sur cette seule base ne va pas aider beaucoup l&#8217;Ã©quipe de
dÃ©veloppement pour un dÃ©marrage sur les chapeaux de roue.</p>
</div>
</div>
<div class="sect3">
<h4 id="_copier_coller">Copier-coller</h4>
<div class="paragraph">
<p>Autre option, qui vient Ã  l&#8217;esprit de tout le monde : le bon vieux
copier-coller. La copie est une opÃ©ration de base en informatique,
peut-Ãªtre la plus utilisÃ©e mais aussi la plus dÃ©nigrÃ©e par les
architectes : dans une copie, il y a toujours un Ã©lÃ©ment de trop !</p>
</div>
<div class="paragraph">
<p>Selon cette approche, RaphaÃ«l commence par reproduire la structure de
base de notre projet et par copier nos fichiers POM ainsi que nos
classes techniques, qui pourront donner de bonnes pistes pour la
rÃ©alisation. Rapidement, le travail devient titanesque car il faut
adapter ces copies : noms de package, groupId, artifactId et versions ne
correspondent pas. Le risque d&#8217;erreurs est grand, et obtenir un rÃ©sultat
stable et complet va prendre du temps !</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_copier_et_mutualiser">Copier et mutualiser !</h3>
<div class="paragraph">
<p>RaphaÃ«l ne se laisse pas dÃ©monter si facilement et propose une autre
solution : faire un copier-coller dont la phase d&#8217;adaptation au nouveau
projet est automatisÃ©e ! RaphaÃ«l est en fait tombÃ© sur la description du
plugin archetype.</p>
</div>
<div class="sect3">
<h4 id="un_plugin_qui_cree_des_projets">Un plugin qui crÃ©e des projets</h4>
<div class="paragraph">
<p>Pour nous convaincre, il nous fait rapidement une dÃ©monstration. Il se
propose ainsi de lancer un projet de plugin Maven, faisant ainsi
rÃ©fÃ©rence au travail que nous avons dÃ» accomplir au Chapitre 11. Nous
avons tous en mÃ©moire le temps qu&#8217;il nous a fallu pour cela. RaphaÃ«l
tape donc une commande dans sa console :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mvn archetype:generate</pre>
</div>
</div>
<div class="paragraph">
<p>Maven propose alors une liste impressionnante de composants, parmi
lesquels RaphaÃ«l identifie un archÃ©type mojo-archetype, qu&#8217;il
sÃ©lectionne. Maven lui demande de choisir pour son nouveau projet un
groupId, un artifactId et une version. AprÃ¨s quelques traces peu
comprÃ©hensibles dans la console, RaphaÃ«l nous lÃ¢che un majestueux "et
voilÃ ". Le Listing 14.2 montre l&#8217;exÃ©cution de cette commande. Nous avons
limitÃ© la liste des archÃ©types proposÃ©e pour ne pas occuper deux pages
supplÃ©mentaires. Le Listing 14.3 montre la structure de fichiers
rÃ©gÃ©nÃ©rÃ©e.</p>
</div>
<div class="listingblock">
<div class="title">Listing 14.2 : GÃ©nÃ©ration d&#8217;un nouveau projet Ã  partir d&#8217;un archÃ©type</div>
<div class="content">
<pre>D:\&gt;mvn archetype:generate
[INFO] Scanning for projects...
[INFO] Searching repository for plugin with prefix: 'archetype'.
[INFO] ------------------------------------------------------------------------
[INFO] Building Maven Default Project
[INFO]    task-segment: [archetype:generate] (aggregator-style)
[INFO] ------------------------------------------------------------------------
[INFO] Preparing archetype:generate
[INFO] No goals needed for project - skipping
[INFO] [archetype:generate {execution: default-cli}]
[INFO] Generating project in Interactive mode
[INFO] No archetype defined. Using maven-archetype-quickstart
(org.apache.maven.archetypes:maven-archetype-quickstart:1.0)
Choose archetype:
1: local -&gt; maven-archetype-echo-mojo (Un plugin Maven "hello world")
(...)
42: internal -&gt; gmaven-archetype-mojo (Groovy mojo archetype)
Choose a number:
(1/2/3/4/5/6/7/8/9/10/11/12/13/14/15/16/17/18/19/20/21/22/23/24/25/26/27/28/29/30/31/32/33/34/35/36/37/38/39/40/41/42) 16: : *1*
 [INFO] artifact org.apache.maven.archetypes:maven-archetype-mojo:
checking for updates from central
Define value for groupId: : *com.geegol.maven.plugins*
Define value for artifactId: : *demo-maven-plugin*
Define value for version:  1.0-SNAPSHOT: :
Define value for package:  com.geegol.maven.plugins: :
Confirm properties configuration:
groupId: com.geegol.maven.plugins
artifactId: demo-maven-plugin
version: 1.0-SNAPSHOT
package: com.geegol.maven.plugins
 Y: : *Y*
[INFO] ----------------------------------------------------------------------------
[INFO] Using following parameters for creating OldArchetype:
maven-archetype-mojo:RELEASE
[INFO] ----------------------------------------------------------------------------
[INFO] Parameter: groupId, Value: com.geegol.maven.plugins
[INFO] Parameter: packageName, Value: com.geegol.maven.plugins
[INFO] Parameter: package, Value: com.geegol.maven.plugins
[INFO] Parameter: artifactId, Value: echo-maven-plugin
[INFO] Parameter: basedir, Value: D:\
[INFO] Parameter: version, Value: 1.0-SNAPSHOT
[INFO] ********************* End of debug info from resources from
generated POM
 ***********************
[WARNING] org.apache.velocity.runtime.exception.ReferenceException:
reference :
template = archetype-resources/src/main/java/EchoMojo.java [line
38,column 31] : ${project.build.directory} is not a valid reference.
[INFO] OldArchetype created in dir: D:\demo-maven-plugin
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 14.3 : Structure de fichiers gÃ©nÃ©rÃ©e</div>
<div class="content">
<pre>D:\demo-maven-plugin&gt;dir
RÃ©pertoire de D:\demo-maven-plugin
04/09/2009  08:55    &lt;REP&gt;          .
04/09/2009  08:55    &lt;REP&gt;          ..
04/09/2009  08:55               845 pom.xml
04/09/2009  08:55    &lt;REP&gt;          src
D:\demo-maven-plugin&gt;tree
D:.
ââââsrc
    ââââmain
        ââââjava
            ââââcom
                ââââgeegol
                    ââââmaven
                        ââââplugins</pre>
</div>
</div>
<div class="paragraph">
<p>Pardon ? Tu rigoles ? Avec un petit sourire, RaphaÃ«l propose de compiler
son plugin et de l&#8217;exÃ©cuter. Un <code>mvn install</code> dans le rÃ©pertoire
nouvellement apparu, puis un mvn
com.geegol.maven.plugins:demo-maven-plugin:1.0-SNAPSHOT:echo et nous
pouvons voir apparaÃ®tre dans la console le rÃ©sultat simple mais tout de
mÃªme inespÃ©rÃ© :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[INFO] [demo:echo {execution: default-cli}]</pre>
</div>
</div>
<div class="paragraph">
<p>Hello World from Maven !</p>
</div>
<div class="paragraph">
<p>C&#8217;est sÃ»r que ce plugin n&#8217;est pas trÃ¨s impressionnant pour ce qu&#8217;il
fait, mais tout de mÃªme il ne nous aura pas coÃ»tÃ© beaucoup d&#8217;efforts et
est totalement fonctionnel. RaphaÃ«l enchaÃ®ne donc avec l&#8217;explication.</p>
</div>
</div>
<div class="sect3">
<h4 id="un_archetype">Un archÃ©type ?</h4>
<div class="paragraph">
<p>Un archÃ©type est la faÃ§on Ã  la Maven de faire de la mutualisation, avec
un bonus considÃ©rable : son utilisateur peut, par la suite, faire
Ã©voluer le code comme bon lui semble, voire ne toucher Ã  rien pendant
des annÃ©es s&#8217;il n&#8217;en voit pas l&#8217;intÃ©rÃªt. Il peut proposer des Ã©volutions
de l&#8217;archÃ©type s&#8217;il a de bonnes idÃ©es ou des corrections Ã  apporter,
mais son code ne sera jamais impactÃ© sans son accord.</p>
</div>
<div class="paragraph">
<p>Contrairement Ã  une dÃ©pendance, pour laquelle on rÃ©cupÃ¨re le rÃ©sultat
final binaire, un archÃ©type fournit du code source, sur la base d&#8217;un
modÃ¨le. Noms de packages, chemins et mÃ©tadonnÃ©es Maven sont adaptÃ©s au
projet utilisateur. Le modÃ¨le lui-mÃªme est gÃ©rÃ© comme un projet Maven Ã 
part entiÃ¨re, dispose d&#8217;une version et peut Ãªtre enrichi par ceux qui
ont du temps (et du budget) pour s&#8217;en occuper. Les Ã©quipes peuvent
proposer de reporter dans le modÃ¨le soit des corrections qu&#8217;elles ont
faites pour Ã©viter Ã  d&#8217;autres de tomber dans les mÃªmes embÃ»ches, soit
des enrichissements pour capitaliser sur le travail rÃ©alisÃ©.</p>
</div>
</div>
<div class="sect3">
<h4 id="construire_ses_propres_archetypes">Construire ses propres archÃ©types</h4>
<div class="paragraph">
<p>La structure d&#8217;un archÃ©type n&#8217;est pas trÃ¨s attirante a priori. Il s&#8217;agit
d&#8217;un projet Maven comprenant un niÃ¨me descripteur XML et une sÃ©rie de
fichiers modÃ¨les sous forme de ressources. Le projet qui va en dÃ©couler
ne sera donc pas trÃ¨s facilement accessible, et l&#8217;Ã©dition d&#8217;un tel
format pas trÃ¨s simple.</p>
</div>
<div class="paragraph">
<p>Sauf si l&#8217;on consulte la description du plugin archetype, et en
particulier sa tÃ¢che create-from-project. Comme son nom le suggÃ¨re,
celle-ci propose de construire un archÃ©type Ã  partir d&#8217;un projet normal,
pas nÃ©cessairement conÃ§u pour servir d&#8217;archÃ©type. En quelque sorte, il
s&#8217;agit d&#8217;une rÃ©tro-ingÃ©nierie qui va extraire un modÃ¨le Ã  partir d&#8217;une
implÃ©mentation concrÃ¨te.</p>
</div>
<div class="paragraph">
<p>La version 1.2.6 de noubliepaslalistedescourses est particuliÃ¨rement
rÃ©ussie. AprÃ¨s cinq versions correctives, le code est trÃ¨s stable, et
nous sommes trÃ¨s confiants sur la bonne intÃ©gration de tous les outils
mis en Åuvre. Pour construire un archÃ©type sur cette base, il nous
suffit de partir de son code source et de lancer la commande magique.
Celle-ci va identifier dans tous nos fichiers de configuration et nos
sources l&#8217;utilisation du nom de package fr.noubliepaslalistedescourses
et assembler un archÃ©type basÃ© sur tous nos fichiers dÃ©spÃ©cialisÃ©s du
nom de notre projet.</p>
</div>
<div class="paragraph">
<p>LâarchÃ©type est prÃªt en quelques minutes dans le rÃ©pertoire
target/generated-sources/archetype (il est sous sa forme de projet
Maven ; il nous suffit de lancer, depuis cet emplacement, un trÃ¨s
classique <code>mvn install</code> pour le convertir en binaire utilisable) !</p>
</div>
<div class="paragraph">
<p>RaphaÃ«l n&#8217;a plus qu&#8217;Ã  lancer la commande complÃ©mentaire : mvn
archetype:generate, en prÃ©cisant l&#8217;argument -Dcatalog=local signalant
qu&#8217;il veut utiliser ses propres archÃ©types, prÃ©sents sur son poste de
dÃ©veloppement, et pas ceux mis Ã  disposition par la communautÃ© Maven.
Quelques instants plus tard, le projet malistedecadeauxpournoel est prÃªt
pour Ãªtre enregistrÃ© dans son propre gestionnaire de sources Subversion,
avec un code fonctionnel qu&#8217;il ne restera plus qu&#8217;Ã  adapter aux besoins
spÃ©cifiques du nouveau projet.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Gerer_un_projet_de_reference">GÃ©rer un projet de rÃ©fÃ©rence</h3>
<div class="paragraph">
<p>Nous avons donc trouvÃ© une solution trÃ¨s Ã©lÃ©gante pour repartir d&#8217;un
projet existant dont nous apprÃ©cions les qualitÃ©s pour lancer une
nouvelle production. malistedecadeauxpournoÃ«l profitera ainsi des
longues heures de mise au point et de l&#8217;expÃ©rience acquise sur le projet
qui l&#8217;a prÃ©cÃ©dÃ©.</p>
</div>
<div class="paragraph">
<p>Dans de nombreux cas cependant, c&#8217;est l&#8217;infrastructure du projet â aussi
bien sa configuration Maven que les nombreux frameworks utilisÃ©s â qui
est intÃ©ressante pour le nouveau dÃ©veloppement, les aspects fonctionnels
Ã©tant probablement assez Ã©loignÃ©s. Au mieux, quelques classes
utilitaires seront Ã  reprendre, mais certainement pas les centaines de
classes que nous avons accumulÃ©es depuis le dÃ©but du projet.</p>
</div>
<div class="sect3">
<h4 id="donner_le_meilleur_de_nous_meme">Donner le meilleur de nous-mÃªmes</h4>
<div class="paragraph">
<p>Le mÃ©canisme extrÃªmement simple qui permet de crÃ©er un archÃ©type
encourage une pratique simple : dÃ©velopper un projet de rÃ©fÃ©rence, une
application blanche, dans laquelle nous mettrons en place toute notre
expertise. Cette application utilisera une sÃ©lection de frameworks
correspondant Ã  l&#8217;Ã©tat de l&#8217;art, avec une prÃ©configuration claire et
largement documentÃ©e.</p>
</div>
<div class="paragraph">
<p>Vous avez probablement dÃ©jÃ  vu ces fichiers de propriÃ©tÃ©s suffixÃ©s
-sample qui contiennent nettement plus de commentaires explicatifs que
de valeurs de configuration. Pour notre application blanche, nous
mettons un point d&#8217;honneur Ã  ce que chaque fichier de configuration,
classe ou POM prÃ©sente une explication dÃ©taillÃ©e de ce qu&#8217;il rÃ©alise,
pourquoi et comment. Nous accompagnons chaque framework d&#8217;une classe
d&#8217;exemple, qui sert de point de dÃ©part Ã  tout dÃ©veloppeur novice qui le
connaÃ®trait mal, afin de le mettre sur la bonne piste. Le dÃ©veloppement
se faisant beaucoup par imitation, les premiÃ¨res lignes de code
disponibles sur le projet sont capitales.</p>
</div>
</div>
<div class="sect3">
<h4 id="demarrer_sur_les_bons_rails">DÃ©marrer sur les bons rails</h4>
<div class="paragraph">
<p>UtilisÃ©e comme archÃ©type, notre application blanche met Ã  la disposition
des projets Ã  venir un ensemble cohÃ©rent, finement outillÃ© et documentÃ©,
qui pourra Ãªtre, par la suite, adaptÃ© Ã  des besoins spÃ©cifiques, mais Ã 
partir d&#8217;une base validÃ©e.</p>
</div>
<div class="paragraph">
<p>Ãtant elle-mÃªme un projet Maven Ã  part entiÃ¨re, notre application
blanche peut bÃ©nÃ©ficier de l&#8217;outillage d&#8217;intÃ©gration continue pour
valider son niveau de qualitÃ© et sa stabilitÃ©. Son dÃ©veloppement et son
Ã©volution sont donc assez simples. Si un projet qui l&#8217;a utilisÃ©e comme
archÃ©type a expÃ©rimentÃ© avec succÃ¨s une nouvelle technologie, il lui
suffit de proposer l&#8217;Ã©volution associÃ©e. Notre outillage de contrÃ´le
qualitÃ© faisant le reste pour assurer la cohÃ©rence de l&#8217;ensemble.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaSebastien.png" alt="MangaSebastien"></span></p>
</div>
<div class="paragraph">
<p>SÃ©bastien passe nous voir, en espÃ©rant cette fois ne pas nous trouver au
milieu d&#8217;une bataille de chiffonniers (voir le Chapitre 9). Il vient
nous demander conseil pour lancer une petite application expÃ©rimentale.
Il ne veut pas s&#8217;embarquer dans une Ã©tude d&#8217;architecture pour si peu
mais simplement partir sur les bons outils du moment, si possible avec
quelques pistes pour ne pas perdre de temps. VoilÃ  qui ne pouvait pas
mieux tomber ! Notre application blanche est encore Ã  l&#8217;Ã©tat d&#8217;Ã©bauche,
et nous y avons transfÃ©rÃ© quelques morceaux choisis de
noubliepaslalistedescourses, en constatant au passage que nous aurions
pu faire un petit effort en termes de commentaires pour rendre ses
aspects techniques plus comprÃ©hensibles.</p>
</div>
<div class="paragraph">
<p>Un rapide archetype:create-from-projet suivi de son petit frÃ¨re
archetype:generate et SÃ©bastien peut repartir avec un socle encore trÃ¨s
imparfait mais dÃ©jÃ  bien plus avancÃ© et intÃ©grÃ© que ce qu&#8217;il aurait pu
obtenir en accumulant les conseils et fragments de code piochÃ©s Ã  droite
Ã  gauche.</p>
</div>
</div>
<div class="sect3">
<h4 id="un_support_pour_experimenter">Un support pour expÃ©rimenter</h4>
<div class="paragraph">
<p>Dernier Ã©lÃ©ment, un tel projet peut Ãªtre fÃ©dÃ©rateur au sein de
l&#8217;entreprise, en dÃ©montrant un savoir-faire et en servant de point
d&#8217;Ã©change sur les technologies.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaNicolas.png" alt="MangaNicolas"></span>
<span class="image" style="float: left"><img src="illustrations/MangaCarlos.png" alt="MangaCarlos"></span>
<span class="image" style="float: left"><img src="illustrations/MangaVincentM.png" alt="MangaVincentM"></span>
$ cÃ´te Ã  cote$</p>
</div>
<div class="paragraph">
<p>Au dÃ©marrage de notre projet, s&#8217;est posÃ©e la question du choix d&#8217;un
framework web. Dans cette situation, chacun tente d&#8217;imposer son
champion, d&#8217;abord en mettant en avant ses points forts, puis en
dÃ©nigrant les concurrents lorsque les arguments commencent Ã  manquer, et
au final par une petite guerre d&#8217;influence et de dÃ©sinformation :</p>
</div>
<div class="paragraph">
<p><em>JSF c&#8217;est naze,</em></p>
</div>
<div class="paragraph">
<p><em>GWT c&#8217;est super lourd,</em></p>
</div>
<div class="paragraph">
<p><em>Struts 2 c&#8217;est_has been</em>._</p>
</div>
<div class="paragraph">
<p>Bref, rien de vraiment constructif.</p>
</div>
<div class="paragraph">
<p>Pourquoi ne pas proposer dans l&#8217;application blanche trois versions de la
couche web (sous forme de modules Maven dÃ©diÃ©s) ? Sur un exemple de
base, nous pouvons demander Ã  chaque framework de dÃ©montrer sa
plus-value et sa force.</p>
</div>
<div class="paragraph">
<p>Nous mettons en concurrence de maniÃ¨re constructive nos trois experts,
qui fourniront ainsi ce qu&#8217;ils considÃ¨rent comme l&#8217;Ã©tat de l&#8217;art de leur
technologie prÃ©fÃ©rÃ©e, accompagnÃ© des meilleurs exemples pour bien
dÃ©marrer. PlutÃ´t qu&#8217;une querelle de spÃ©cialistes qui n&#8217;aboutirait Ã  rien
de positif, nous pourrons ainsi proposer Ã  chaque nouveau projet de
faire son propre choix, en fonction des personnes disponibles, de leurs
compÃ©tences, des exigences du projet, etc.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaFrancois.png" alt="MangaFrancois"></span></p>
</div>
<div class="paragraph">
<p>Lorsque FranÃ§ois revient nous voir pour nous fÃ©liciter du succÃ¨s de
noubliepaslalistedescourses, il ne peut s&#8217;empÃªcher de nous taquiner en
ayant l&#8217;air surpris de notre rÃ©ussite alors que nous n&#8217;avons pas
expÃ©rimentÃ© plus avant la solution Flex, dont il est convaincu de la
supÃ©rioritÃ©. Si nous n&#8217;avons pas choisi cette voie aujourd&#8217;hui, d&#8217;autres
le feront peut-Ãªtre sur une autre application, et les quelques lignes
d&#8217;exemple de FranÃ§ois intÃ©grÃ©es dans notre application blanche seront
dÃ©jÃ  un meilleur dÃ©but qu&#8217;une page blanche.</p>
</div>
<div class="paragraph">
<p>L&#8217;application blanche peut ainsi servir de support pour expÃ©rimenter une
technologie directement dans le contexte de nos mÃ©thodes de travail.
Faire fonctionner une application Flex, c&#8217;est trÃ¨s bien et sans doute
facile avec le bon outillage. RÃ©ussir Ã  en dÃ©velopper une en bonne
entente avec le reste de nos outils est une autre paire de manches.
Comment construire l&#8217;application avec le mÃªme outillage et les mÃªmes
commandes ? Comment intÃ©grer cette technologie avec notre infrastructure
mÃ©tier basÃ©e sur Spring ? L&#8217;application blanche met dÃ¨s le dÃ©but ces
questions sur le tapis, y rÃ©pondre au plus tÃ´t permettra d&#8217;introduire
Flex sur un nouveau projet sans buter sur ces problÃ¨mes.</p>
</div>
</div>
<div class="sect3">
<h4 id="un_support_de_demonstration">Un support de dÃ©monstration</h4>
<div class="paragraph">
<p>Pour ceux qui n&#8217;ont aucune prÃ©fÃ©rence, l&#8217;application blanche lancÃ©e en
mode dÃ©monstration permet de se faire une idÃ©e du rÃ©sultat obtenu pour
un code source donnÃ©, et donc de discuter sur un exemple concret pour
prendre une dÃ©cision raisonnÃ©e.</p>
</div>
<div class="paragraph">
<p>Elle peut Ã©galement servir de support de formation.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaJerome.png" alt="MangaJerome"></span></p>
</div>
<div class="paragraph">
<p>JÃ©rÃ´me veut dÃ©marrer un projet fondÃ© sur Struts 2 et Spring, et former
dans le mÃªme temps les dÃ©veloppeurs novices Ã  ces technologies. Pour les
sessions de formation qu&#8217;il va animer, il pourrait partir des projets
d&#8217;exemple qui accompagnent ces deux frameworks et donner les pistes pour
que chacun fasse le lien avec l&#8217;application Ã  dÃ©velopper. AprÃ¨s tout,
ces exemples sont conÃ§us pour cela et en principe taillÃ©s pour mettre en
valeur les bonnes pratiques. Cependant, ils ne collent pas exactement Ã 
la rÃ©alitÃ© de l&#8217;application et des nombreux outils qu&#8217;elle intÃ¨gre.
Spring propose par exemple de nombreux mÃ©canismes de configuration,
alors que nous n&#8217;en exploitons qu&#8217;un seul â le but n&#8217;est pas de former
des experts en Spring, mais des dÃ©veloppeurs confiants et guidÃ©s dans
leur travail.</p>
</div>
<div class="paragraph">
<p>JÃ©rÃ´me prÃ©fÃ¨re donc partir de notre application blanche, y ajouter la
configuration et une sÃ©lection d&#8217;exemples adÃ©quats. Il crÃ©e ensuite un
archÃ©type.</p>
</div>
<div class="paragraph">
<p>Chaque junior qui participe Ã  la formation va alors gÃ©nÃ©rer, Ã  partir de
l&#8217;archÃ©type, sa propre application de dÃ©monstration/expÃ©rimentation et
se lancer dans ses premiÃ¨res lignes de code sur cette base. Les classes
de l&#8217;application blanche donneront lâassise de nos exercices de
formation, et les exemples permettront d&#8217;expliquer les mÃ©canismes en
jeu.</p>
</div>
<div class="paragraph">
<p>Au terme de la formation, lorsqu&#8217;ils commenceront Ã  travailler sur le
projet, nos dÃ©veloppeurs tout juste formÃ©s ne seront pas dÃ©boussolÃ©s de
retrouver la mÃªme structure de projet et gagneront ainsi en efficacitÃ©.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Bien que les archÃ©types soient un moyen rapide de rÃ©utiliser une
application existante, et donc un encouragement Ã  dÃ©finir des
applications blanches, celles-ci prÃ©sentent quelques Ã©cueils :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>La maintenance.</strong> Cela revient vite cher Ã  faire vivre.</p>
</li>
<li>
<p><strong>La cohÃ©rence.</strong> Cela devient vite un fourre-tout dans lequel on
dÃ©verse tout ce qui traÃ®ne.</p>
</li>
<li>
<p><strong>L&#8217;obÃ©sitÃ© des applications gÃ©nÃ©rÃ©es.</strong> Une bonne partie du code
rÃ©cupÃ©rÃ© par les nouveaux projets n&#8217;est pas utilisÃ©e et reste en place
comme code mort.</p>
</li>
<li>
<p><strong>La complexitÃ© du modÃ¨le.</strong> Trop de technologies sont mÃ©langÃ©es et
trop de choses sont Ã  dÃ©montrer en mÃªme temps.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>MÃªme si l&#8217;application blanche est utile, il faut que son usage soit
indiscutable dans le contexte de votre entreprise, c&#8217;est-Ã -dire que l&#8217;on
crÃ©e <em>vÃ©ritablement</em> des projets similaires. Il faut faire trÃ¨s
attention Ã  son dÃ©veloppement et Ã  sa maintenance pour qu&#8217;elle reste une
vitrine lÃ©gÃ¨re et homogÃ¨ne des bonnes pratiques Ã  suivre.</p>
</div>
<div class="paragraph">
<p>MoralitÃ© : privilÃ©gier les petits exemples (et donc les petits
archÃ©types) qui vont dÃ©montrer une problÃ©matique donnÃ©e.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_13">Conclusion</h3>
<div class="paragraph">
<p>Maven nous avait jusqu&#8217;ici aidÃ©s Ã  structurer notre projet et Ã  lui
apporter rapidement de nombreux outils qui en ont amÃ©liorÃ© le niveau
gÃ©nÃ©ral. PlutÃ´t que de laisser chaque Ã©quipe refaire cette dÃ©marche
individuellement, nous offrons, grÃ¢ce aux archÃ©types la capitalisation
de notre expÃ©rience et, cela, de faÃ§on corporative. En poussant un peu
plus loin la logique du bon exemple, nous pouvons proposer aux projets
futurs un modÃ¨le tout prÃªt du meilleur de nos compÃ©tences, agrÃ©mentÃ© de
tous les exemples nÃ©cessaires Ã  une mise en Åuvre rapide.</p>
</div>
<div class="paragraph">
<p>Dans un esprit de rÃ©duction de coÃ»ts, d&#8217;amÃ©lioration de la productivitÃ©,
d&#8217;homogÃ©nÃ©itÃ© des outils et de vÃ©locitÃ© des dÃ©veloppements,
l&#8217;utilisation intelligente des archÃ©types est clairement un Ã©lÃ©ment
dÃ©cisif. Elle fait de Maven une fois de plus un outil complet, capable
d&#8217;aider le dÃ©veloppeur Java pendant toutes les phases de son projet.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chapitre_15_avons_nous_fait_le_bon_choix">Chapitre 15 : Avons-nous fait le bon choix ?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le service Geegol Shopping List (dÃ©sormais disponible dans 27 langues,
dont le breton) est devenu un service phare du groupe. Projet
expÃ©rimental au dÃ©part, il est aujourd&#8217;hui un Ã©lÃ©ment stratÃ©gique et les
dÃ©cideurs du groupe veulent quelques garanties sur nos mÃ©thodes de
travail et notre outillage.</p>
</div>
<div class="paragraph">
<p>Maven a rÃ©pondu prÃ©sent pour chaque problÃ¨me que nous avons rencontrÃ©.
Si nous sommes contents de notre choix, qu&#8217;en sera-t-il dans six mois,
un an, puis dans cinq ? Maven est un bon outil, mais n&#8217;est pas pour
autant le Saint-Graal et n&#8217;est pas exempt de dÃ©fauts.</p>
</div>
<div class="paragraph">
<p>Toute l&#8217;Ã©quipe est donc rÃ©unie pour dÃ©fendre ce choix face Ã  un comitÃ©
d&#8217;experts qui ne veut pas laisser un si beau projet reposer sur des
outils non fiables, mal documentÃ©s ou dont l&#8217;avenir est incertain.
Ã nous de nous montrer convaincantsâ¦</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/comite.png" alt="comite"></span></p>
</div>
<div class="sect2">
<h3 id="_les_limites">Les limites</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaFabrice.png" alt="MangaFabrice"></span></p>
</div>
<div class="paragraph">
<p>Fabrice prend les devants et expose d&#8217;office les limites que nous avons
constatÃ©es lors de l&#8217;utilisation de Maven. Nous ne sommes pas face Ã  des
dÃ©butants prÃªts Ã  croire que Maven est la solution Ã  tout, autant jouer
franc-jeu pour dÃ©samorcer ce sujet dÃ¨s le dÃ©but.</p>
</div>
<div class="paragraph">
<p>Maven n&#8217;est pas l&#8217;outil magique qui va traiter tous nos problÃ¨mes avant
mÃªme qu&#8217;ils nâarrivent â si vous cherchez ce genre de solution, essayez
l&#8217;annotation @Abracadabra dans votre code. Comme tout outil, il a ses
forces mais aussi ses faiblesses et ses limites, et il faut apprendre Ã 
faire avec et Ã  les contourner intelligemment.</p>
</div>
<div class="sect3">
<h4 id="_points_faibles">Points faibles</h4>
<div class="paragraph">
<p>Il y a une critique, en particulier, qui vous a probablement dÃ©jÃ 
titillÃ© : la syntaxe XML inutilement verbeuse. L&#8217;intÃ©gration dans les
IDE tend Ã  gommer ce dÃ©tail, mais il est nÃ©anmoins bien prÃ©sent dÃ¨s
qu&#8217;on s&#8217;attaque Ã  configurer un gros plugin comme Cargo (voir
Chapitre 8).</p>
</div>
<div class="paragraph">
<p>Qu&#8217;est-ce qui empÃªche de modifier ce format POM pour le rendre plus
compact, ou lui ajouter des fonctionnalitÃ©s ? Le code qui analyse ces
fichiers XML est actuellement liÃ© Ã  une version de Maven. Si un nouveau
Maven sortait avec un format POM plus souple ou intÃ©grant une nouvelle
fonctionnalitÃ©, il ne serait exploitable que par les utilisateurs de
cette nouvelle version de Maven. Au sein d&#8217;une Ã©quipe de dÃ©veloppement,
cela ne serait pas un gros problÃ¨me ; la difficultÃ© concerne les POM
dÃ©ployÃ©s par des projets dans un dÃ©pÃ´t d&#8217;artefacts, en particulier les
projets open-source qui dÃ©ploient sur central. Leur utilisation ne
serait alors possible que pour les utilisateurs du nouveau Maven. Une
prise en otage inacceptable !</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaStephane.png" alt="MangaStephane"></span></p>
</div>
<div class="paragraph">
<p>Une deuxiÃ¨me limite de Maven concerne son fonctionnement en mode
multimodule, en particulier lorsqu&#8217;on exploite l&#8217;hÃ©ritage naturel : la
construction du projet POM parent doit se terminer avant que celle de
ses modules ne commence, afin qu&#8217;ils puissent y faire rÃ©fÃ©rence. Il
n&#8217;est donc pas possible d&#8217;intÃ©grer dans notre projet parent un plugin
qui s&#8217;exÃ©cuterait _aprÃ¨s_la construction des modules. Ce problÃ¨me,
StÃ©phane l&#8217;a rencontrÃ© et contournÃ© au Chapitre 13. Il peut sembler
anecdotique mais sa correction complÃ¨te nÃ©cessite une refonte assez
profonde de Maven et de sa gestion du cycle de vie.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaEmmanuel.png" alt="MangaEmmanuel"></span></p>
</div>
<div class="paragraph">
<p>Un autre souci concerne les expressions, qui permettent de mutualiser
des numÃ©ros de version comme dans l&#8217;exemple ci-aprÃ¨s :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;groupId&gt;org.springframework&lt;/groupId&gt;
&lt;artifactId&gt;spring-jms&lt;/artifactId&gt;
&lt;version&gt;${spring.version}&lt;/version&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>En utilisant systÃ©matiquement cette propriÃ©tÃ©, nous pouvons Ãªtre sÃ»rs
que toutes nos rÃ©fÃ©rences aux diffÃ©rents modules de spring utilisent une
mÃªme version cohÃ©rente, c&#8217;est donc bien pratique. Cependant, la
propriÃ©tÃ© spring.version peut Ãªtre dÃ©clarÃ©e ailleurs dans le POM, mais
aussi dans son parent, dans un profil, dans le fichier settings de
l&#8217;utilisateur ou <em>via</em> la ligne de commande. Si elle est dÃ©ployÃ©e telle
quelle, comment pouvons-nous Ãªtre sÃ»rs qu&#8217;elle sera interprÃ©tÃ©e Ã 
l&#8217;identique dans un contexte trÃ¨s diffÃ©rent ? En tant que responsable de
notre livrable, Emmanuel a dÃ» se battre contre les comportements qui
dÃ©pendent de l&#8217;environnement. Une construction de projet fiable doit
Ãªtre totalement reproductible.</p>
</div>
<div class="paragraph">
<p>La liste est encore longue des fonctionnalitÃ©s manquantes, mal fichues,
des bogues et autres anomalies, et peu sont simples Ã  traiterâ¦</p>
</div>
<div class="paragraph">
<p>Sortons des limites liÃ©es au fonctionnement propre de Maven et
intÃ©ressons-nous Ã  la norme OSGi qui connaÃ®t un intÃ©rÃªt croissant.
Celle-ci accompagne une archive Java (un bundle en terminologie OSGi) de
mÃ©tadonnÃ©es dans un format propre, mais qui ressemblent beaucoup aux
concepts de dÃ©pendances de Maven.</p>
</div>
<div class="paragraph">
<p>Comment Ã©viter de dupliquer l&#8217;information ou, du moins, comment assurer
la cohÃ©rence entre ces deux mondes ? MÃªme constat pour la norme Java
modules qui fait l&#8217;objet d&#8217;une JSR et devrait Ãªtre intÃ©grÃ©e Ã  Java 7
(JSR-277). Comment Maven gÃ©rera-t-il ces nouveaux formats qui viennent
marcher sur les plates-bandes de la gestion des dÃ©pendances, en
particulier le standard OSGi dont l&#8217;ordre de rÃ©solution des conflits
n&#8217;est pas exactement Ã©quivalent ?</p>
</div>
</div>
<div class="sect3">
<h4 id="_les_plugins">Les plugins</h4>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaOlivier.png" alt="MangaOlivier"></span></p>
</div>
<div class="paragraph">
<p>Olivier signale Ã©galement la difficultÃ© pour identifier un plugin qui
rÃ©ponde Ã  un besoin prÃ©cis et pour en qualifier la pÃ©rennitÃ©. Or, Maven
ne vit que par ses nombreux plugins. Les besoins prÃ©cis sont soit une
intÃ©gration d&#8217;une nouvelle technologie dans le build (comme GWT), soit
une optimisation du build propre Ã  un projet (comme compiler, dÃ©ployer
sur un serveur Tomcat tout en modifiant sa configurationâ¦).</p>
</div>
<div class="paragraph">
<p>Le projet Apache Maven n&#8217;hÃ©berge officiellement qu&#8217;un nombre rÃ©duit de
ces plugins, utilisÃ©s pour sa propre construction ou pour des besoins
fondamentaux du dÃ©veloppement Java. Il s&#8217;ensuit que les plugins, qui
sont finalement lâÃ©lÃ©ment principal manipulÃ© par l&#8217;utilisateur final,
sont plus ou moins laissÃ©s dans la nature, attendant le bon vouloir
d&#8217;une communautÃ© hÃ©tÃ©roclite. Le projet Mojo encourage un regroupement
visant Ã  donner Ã  ces plugins un cadre et une culture communautaire,
mais le dÃ©veloppement reste peu structurÃ© et dÃ©pend du temps libre ou
des intÃ©rÃªts des dÃ©veloppeurs impliquÃ©s. De nombreux plugins peuvent
ainsi rester des annÃ©es dans le bac Ã  sable, zone de test permettant de
faire naÃ®tre de nouvelles idÃ©es, sans passer Ã  un Ã©tat stable qui leur
donnerait une plus grande crÃ©dibilitÃ©.</p>
</div>
<div class="paragraph">
<p>Par ailleurs, de nombreux dÃ©veloppeurs peuvent Ãªtre tentÃ©s de crÃ©er leur
propre plugin en dehors de la communautÃ© officielle Maven, et les
hÃ©berger sur SourceForge, GoogleCode ou en interne dans leur entreprise.
Ces efforts non coordonnÃ©s peuvent encourager une certaine crÃ©ativitÃ©
mais laissent surtout passer l&#8217;occasion de construire une solution plus
viable avec un accueil plus large par la communautÃ© des utilisateurs.</p>
</div>
<div class="paragraph">
<p>De maniÃ¨re plus gÃ©nÃ©rale, l&#8217;utilisateur qui ne trouve le plugin adÃ©quat
pour un besoin donnÃ© ni dans ceux de Maven, ni sur la liste des plugins
stables de Mojo, est confrontÃ© Ã  un choix dÃ©licat :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>se laisser tenter par un plugin du bac Ã  sable Mojo, en espÃ©rant
que son dÃ©veloppement soit encore actif, et sans aucune garantie de voir
un jour une version stable en sortir ;</p>
</li>
<li>
<p>chercher en dehors de ces sources officielles un plugin adaptÃ©,
mais avec le risque de ne trouver que des solutions partielles sans
support et mÃ©connues de la communautÃ© ;</p>
</li>
<li>
<p>se lancer dans une solution interne, dont il faudra supporter le
coÃ»t de dÃ©veloppement et qui ne bÃ©nÃ©ficiera pas de l&#8217;enrichissement
d&#8217;une communautÃ© de centaines d&#8217;utilisateurs.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>PrÃ©cisons que le projet Mojo est ouvert aux contributions et toujours
enthousiaste Ã  accueillir des dÃ©veloppeurs qui veulent prendre en charge
un plugin Ã  l&#8217;abandon ou proposer leur propre travail Ã  la communautÃ©.
C&#8217;est en tout cas la politique que nous dÃ©fendons, mÃªme si nous ne
sommes pas seuls Ã  bord. N&#8217;hÃ©sitez pas Ã  venir nous parler de vos
projets et envies sur la liste de diffusion : <a href="mailto:user@mojo.codehaus.org">user@mojo.codehaus.org</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_le_support">Le support</h4>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaVincentM.png" alt="MangaVincentM"></span></p>
</div>
<div class="paragraph">
<p>L&#8217;utilisation de Maven est simple si on suit ses conventions et qu&#8217;on
dispose des bons plugins ; elle peut devenir assez vite dÃ©licate, si on
n&#8217;a pas les bons rÃ©flexes, voire totalement insurmontable, si on tente
de plier Maven Ã  des utilisations pour lesquelles il n&#8217;a pas Ã©tÃ© prÃ©vu.
Le support est donc un Ã©lÃ©ment clÃ© de son utilisation, et Vincent ne
manque pas de le souligner (la question allait venir d&#8217;elle-mÃªme de
toute faÃ§on). Il ne fait aucun doute que vous y aurez recours Ã  un
moment ou un autre mÃªme en ayant lu avec attention les pages de ce
livre.</p>
</div>
<div class="paragraph">
<p>Le support de Maven est centralisÃ© sur une liste de diffusion
(<a href="mailto:users@maven.apache.org">users@maven.apache.org</a>) qui rÃ©unit ses utilisateurs et une majoritÃ© de
ses dÃ©veloppeurs. Les messages y sont nombreux, touchent tous les
sujets, et les rÃ©ponses viennent rapidement en raison du grand nombre
d&#8217;utilisateurs en ligne. Il n&#8217;y a cependant aucune obligation de
rÃ©sultat et aucun moyen d&#8217;accentuer l&#8217;appel au secours, sauf Ã  relancer
sa question au risque de se faire rejeter plutÃ´t qu&#8217;aider par les
membres bÃ©nÃ©voles.</p>
</div>
<div class="paragraph">
<p>Si vous faites appel Ã  la communautÃ©, pensez Ã  poser des questions
prÃ©cises en dÃ©taillant clairement votre besoin, votre environnement
(vous pouvez toujours lire ce petit guide <sup class="footnote">[<a id="_footnoteref_48" class="footnote" href="#_footnotedef_48" title="View footnote.">48</a>]</sup>, et
n&#8217;hÃ©sitez pas Ã  rÃ©pondre aux autres utilisateurs : nous avons tous
commencÃ© de cette faÃ§on et c&#8217;est ainsi qu&#8217;on apprend le mieux Ã  utiliser
Maven. La liste des utilisateurs de Maven a dÃ©passÃ© la taille critique
et s&#8217;autoalimente : les utilisateurs avertis aident les novices.
L&#8217;Ã©quipe des dÃ©veloppeurs n&#8217;a plus besoin d&#8217;assurer elle-mÃªme le support
de premier niveau et peut donc se concentrer sur les dÃ©veloppements et
les corrections.</p>
</div>
<div class="paragraph">
<p>Vous pouvez aussi retrouver une partie des dÃ©veloppeurs du projet ainsi
que des utilisateurs sur l&#8217;IRC <sup class="footnote">[<a id="_footnoteref_49" class="footnote" href="#_footnotedef_49" title="View footnote.">49</a>]</sup> (serveur
irc.codehaus.org, canal : #maven). Ce mÃ©dia a l&#8217;avantage d&#8217;Ãªtre en
direct et peut donc vous apporter des rÃ©ponses plus rapidement que la
liste de diffusion, si vous avez la chance de tomber sur les bons
interlocuteurs. Par contre, contrairement Ã  cette derniÃ¨re, comme il
n&#8217;est pas possible d&#8217;accÃ©der aux discussions qui ont eu lieu pendant une
dÃ©connexion, n&#8217;espÃ©rez pas qu&#8217;une personne vous rÃ©ponde si elle n&#8217;Ã©tait
pas lÃ  au moment oÃ¹ vous avez posÃ© votre question. Enfin, n&#8217;oubliez pas
qu&#8217;il y a beaucoup de personnes dans l&#8217;Ã©quipe Maven qui ne sont pas sur
le mÃªme fuseau horaire que nous. N&#8217;espÃ©rez pas contacter les membres
outre-Atlantique le matin heure franÃ§aise.</p>
</div>
<div class="paragraph">
<p>Seule contrainte : tous ces Ã©changes se font en anglais, parfois avec
une syntaxe qui doit dÃ©sespÃ©rer ceux dont c&#8217;est la langue maternelle.
Heureusement, les francophones sont rÃ©putÃ©s pour leur compÃ©tence en
langues Ã©trangÃ¨res ;). Si, malgrÃ© tout, ce n&#8217;est pas votre cas, le site
developpez.com hÃ©berge un forum francophone consacrÃ© Ã 
Maven <sup class="footnote">[<a id="_footnoteref_50" class="footnote" href="#_footnotedef_50" title="View footnote.">50</a>]</sup>, ainsi qu&#8217;une FAQ <sup class="footnote">[<a id="_footnoteref_51" class="footnote" href="#_footnotedef_51" title="View footnote.">51</a>]</sup> bien
remplie.</p>
</div>
</div>
<div class="sect3">
<h4 id="le_cout_de_maven">Le coÃ»t de Maven</h4>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaHerve.png" alt="MangaHerve"></span></p>
</div>
<div class="paragraph">
<p>HervÃ© rebondit sur la question du support en Ã©voquant le prix de revient
de Maven sur un projet. Maven est un projet libre, tÃ©lÃ©chargeable et
utilisable gratuitement. Son coÃ»t d&#8217;utilisation n&#8217;est cependant pas nul,
comme tout projet open-source. Le simple fait que vous ayez ce livre
entre les mains est dÃ©jÃ  un Ã©lÃ©ment de rÃ©ponse : il n&#8217;est pas si facile
Ã  utiliser et nÃ©cessite un certain apprentissage. Il ne s&#8217;applique pas Ã 
n&#8217;importe quel projet et sans un certain effort d&#8217;organisation. Il
nÃ©cessite donc un minimum d&#8217;expÃ©rience. Les sociÃ©tÃ©s de services ne s&#8217;y
sont d&#8217;ailleurs pas trompÃ©es et vendent consultants et formations autour
de ce sujet.</p>
</div>
<div class="paragraph">
<p>Comme de nombreux outils, Maven coÃ»te bien plus cher par la formation
qu&#8217;il induit que par son prix d&#8217;achat (qui est particuliÃ¨rement
attrayant dans le cas d&#8217;un projet libre). Sa documentation en ligne est
perfectible mais elle est Ã©paulÃ©e par de nombreuses autres sources. Ce
livre fait partie de cet effort et vient complÃ©ter les livres <em>Better
Builds with Maven</em> <sup class="footnote">[<a id="_footnoteref_52" class="footnote" href="#_footnotedef_52" title="View footnote.">52</a>]</sup> et <em>Maven â the definitive
guide</em>, bible de 500 pages qui prÃ©sente tous les aspects de Maven, sans
compter les innombrables blogs, articles, forums et tutoriels qui
dÃ©crivent des points plus spÃ©cifiques de son utilisation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_la_concurrence">La concurrence</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaVincentS.png" alt="MangaVincentS"></span></p>
</div>
<div class="paragraph">
<p>AprÃ¨s cette autocritique, Vincent prend en main la contre-attaque :
quelle autre solution avons-nous pour la gestion de notre projet ? Nous
avons Ã©voquÃ© Ant au Chapitre 1, mais la concurrence Ã  laquelle Maven
s&#8217;expose ne s&#8217;arrÃªte pas lÃ . Certains outils ont d&#8217;ailleurs capitalisÃ©
sur les bonnes pratiques reconnues de Maven et ont tentÃ© de crÃ©er une
nouvelle solution plus productive sur cette base.</p>
</div>
<div class="paragraph">
<p>Cette Ã©mancipation, bÃ©nÃ©fique Ã  tous, est encouragÃ©e par les
dÃ©veloppeurs de Maven, mÃªme s&#8217;ils acceptent forcÃ©ment assez mal les
critiques si elles ne sont pas enrobÃ©es par la politesse et les
justifications nÃ©cessaires. Un outil, en particulier open-source, ne
peut pas tenir ses utilisateurs en otage. Il est contraint Ã 
l&#8217;excellence pour occuper le dessus du panier. Les critiques, plus ou
moins constructives ou honnÃªtes, sont inÃ©vitables mais doivent toujours
Ãªtre considÃ©rÃ©es avec attention.</p>
</div>
<div class="sect3">
<h4 id="_maven_bon_partout">Maven bon partout ?</h4>
<div class="paragraph">
<p>Nous avons tentÃ© au cours des chapitres prÃ©cÃ©dents de vous dÃ©montrer en
quoi l&#8217;approche proposÃ©e par Maven est d&#8217;un niveau supÃ©rieur au simple
script de construction de projet. Il faut cependant admettre que Maven
n&#8217;est pas bon partout et mal adaptÃ© Ã  certains projets.</p>
</div>
<div class="paragraph">
<p>Maven part du principe que 99 % des projets ont des besoins comparables
et peuvent sâappuyer sur les mÃªmes outils et bonnes pratiques s&#8217;ils
acceptent des conventions communes. Il reste cependant 1 % de projets
qui ont des besoins vraiment trÃ¨s spÃ©cifiques â tout le monde dira que
son projet est diffÃ©rent des autres, mais soyons honnÃªtes, Ã  part
quelques cas extrÃªmes, nous faisons tous plus ou moins la mÃªme chose.
Nous pourrions comparer la standardisation de la construction Ã  celle du
dÃ©marrage : qui de nous a besoin d&#8217;une JVM customisÃ©e avec 12 paramÃ¨tres
en "-XX:" pour lancer son application ?</p>
</div>
<div class="paragraph">
<p>Google Web Toolkit rentre dans les projets "spÃ©cifiques". La compilation
des sources doit marier du code natif pour Windows, Linux et Mac OS,
l&#8217;inclusion de code source Java dans l&#8217;archive JAR, et bien d&#8217;autres
subtilitÃ©s. Construire un tel projet avec Maven serait possible, mais il
faudrait alors considÃ©rer la plus-value qu&#8217;il apporterait aux
dÃ©veloppeurs. Le mÃ©canisme de test de ce projet est ultra-spÃ©cifique,
les artefacts construits â si, au final, ils sont des archives JAR â
sont composÃ©s d&#8217;Ã©lÃ©ments peu courants. La configuration nÃ©cessaire dans
Maven pour obtenir un rÃ©sultat convaincant serait significative. Ce
projet ne rentre pas dans le cadre des 99 %.</p>
</div>
<div class="paragraph">
<p>Spring 2 a lui aussi choisi de ne pas utiliser Maven pour sa
construction. Pour ce projet devant mixer la compilation de classes
destinÃ©es Ã  Java 1.4 et Java 5, en plus de divers raffinements dont la
compatibilitÃ© OSGi, il faut bien reconnaÃ®tre que Maven se serait assez
mal prÃªtÃ© au jeu.</p>
</div>
<div class="paragraph">
<p>Enfin, d&#8217;autres projets de dÃ©veloppement basÃ©s sur des outils
propriÃ©taires ou non (pensons Ã  Liferay ou Alfresco) imposent
gÃ©nÃ©ralement leurs propres scripts de compilation et donc ces types de
projets rentrent, lÃ  encore, dans le 1 %.</p>
</div>
<div class="paragraph">
<p>Maintenant, nous ne sommes pas nombreux Ã  travailler sur des projets
aussi particuliers. Cela n&#8217;interdit pas de regarder ce qui se fait
ailleurs pour dÃ©terminer si Maven est le meilleur choix. Il est
intÃ©ressant de noter que Spring 3 sÃ©pare ses packages principaux en
modules dÃ©diÃ©s et intÃ¨gre mÃªme un fichier POM
expÃ©rimental <sup class="footnote">[<a id="_footnoteref_53" class="footnote" href="#_footnotedef_53" title="View footnote.">53</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>This POM cannot be used to build Spring; it is a work in progress and
should only be used as part of a Maven repository upload bundle using
artifacts created by the spring build system.</p>
</div>
<div class="paragraph">
<p>Comme quoi, l&#8217;idÃ©e fait tout de mÃªme son cheminâ¦</p>
</div>
</div>
<div class="sect3">
<h4 id="_ant_et_ivy">Ant et Ivy</h4>
<div class="paragraph">
<p>Nous avons dÃ©jÃ  parlÃ© dâApache Ant, qui a Ã©tÃ© longtemps le standard de
fait pour la construction de projets en Java. Ivy est un projet qui lui
apporte une gestion des dÃ©pendances trÃ¨s proche de ce que Maven propose
â Ivy sait d&#8217;ailleurs exploiter les POM de Maven et ses dÃ©pÃ´ts de
bibliothÃ¨ques. Le couple Ant + Ivy permet donc de faire globalement la
mÃªme chose que Maven pour ce qui est de la gestion des bibliothÃ¨ques.</p>
</div>
<div class="paragraph">
<p>Par contre, cela n&#8217;apporte rien en termes d&#8217;homogÃ©nÃ©itÃ© des projets, de
conventions d&#8217;organisation du code ou de rÃ©utilisation des scripts Ant.
Ivy apporte Ã  Ant une fonctionnalitÃ© clÃ© de Maven mais ne change en rien
sa philosophie gÃ©nÃ©rale. La comparaison entre Ant et Maven ne doit pas
se faire en comptant le nombre de lignes de XML nÃ©cessaires pour
compiler des classes, mais en fonction de l&#8217;esprit gÃ©nÃ©ral de l&#8217;outil et
de ce qu&#8217;il apporte ou impose sur un projet.</p>
</div>
<div class="paragraph">
<p>On peut faire le choix dâAnt, de la libertÃ© qu&#8217;apporte un langage de
script pour faire Ã  peu prÃ¨s tout ce qu&#8217;on veut. Il ne faudra alors pas
s&#8217;Ã©tonner que cette libertÃ© ait un prix en maintenance et en Ã©volutivitÃ©
du projet.</p>
</div>
</div>
<div class="sect3">
<h4 id="_easyant">EasyAnt</h4>
<div class="paragraph">
<p>EasyAnt <sup class="footnote">[<a id="_footnoteref_54" class="footnote" href="#_footnotedef_54" title="View footnote.">54</a>]</sup>, comme son nom le suggÃ¨re, vise Ã  simplifier
l&#8217;utilisation dâAnt. Il propose une surcouche qui intÃ¨gre Ivy et un
certain nombre de conventions, permettant de passer des commandes de
construction sans avoir Ã  Ã©tablir une configuration rÃ©pÃ©titive d&#8217;un
projet Ã  l&#8217;autre. Un mÃ©canisme de plugins permet de prÃ©parer des
fragments de script Ant pour Ãªtre partagÃ©s entre projets.</p>
</div>
<div class="paragraph">
<p>L&#8217;approche est intÃ©ressante dans le sens oÃ¹ elle rejoint le constat qui
est Ã  l&#8217;origine de Maven : des projets comparables doivent sans cesse
rÃ©Ã©crire la mÃªme configuration, alors qu&#8217;ils vont dÃ©rouler globalement
les mÃªmes procÃ©dures. EasyAnt n&#8217;est cependant pas aussi easy qu&#8217;il le
prÃ©tend si l&#8217;on considÃ¨re qu&#8217;il exploite les namespace dans un langage
de script XML, ce qui n&#8217;est pas d&#8217;une grande lisibilitÃ© pour le
dÃ©veloppeur novice. De ce point de vue, Gradle est nettement plus
innovant.</p>
</div>
</div>
<div class="sect3">
<h4 id="_gradle">Gradle</h4>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaGregory.png" alt="MangaGregory"></span></p>
</div>
<div class="paragraph">
<p>Depuis des mois dÃ©jÃ , GrÃ©gory nous interpelle sur notre projet en
dÃ©nonÃ§ant la lourdeur du fichier XML de notre outil de build et son
manque de flexibilitÃ©. Lui voudrait bien imposer Gradle, son outil de
prÃ©dilection.</p>
</div>
<div class="paragraph">
<p>Gradle <sup class="footnote">[<a id="_footnoteref_55" class="footnote" href="#_footnotedef_55" title="View footnote.">55</a>]</sup> sâappuie lui aussi sur Ant et Ivy, et met en
place un esprit de construction par conventions. BasÃ© sur Groovy plutÃ´t
que XML, un script Gradle manipule des tÃ¢ches Ant traditionnelles qui
sont ses briques de base. Groovy est mis Ã  contribution pour crÃ©er un
Domain Specific Language (DSL), un langage de programmation dÃ©diÃ© Ã  une
tÃ¢che particuliÃ¨re : la construction de projet. L&#8217;intÃ©gration d&#8217;Ivy dans
Gradle se fait <em>via</em> ce DSL plutÃ´t que par les tÃ¢ches Ant Ivy, ce qui
simplifie sa manipulation.</p>
</div>
<div class="paragraph">
<p>Gradle dÃ©finit Ã©galement la notion de plugin, plus ou moins comparable
avec la signification de ce terme dans Maven. Un plugin Gradle est
plutÃ´t un ensemble de conventions, tÃ¢ches et extensions Gradle rÃ©unies
et rÃ©utilisables sur plusieurs projets.</p>
</div>
<div class="paragraph">
<p>Le Listing 15.1 donne un exemple de script Gradle que nous prÃ©sente
GrÃ©gory pour la mise en place dâun projet Java. La syntaxe est
particuliÃ¨rement compacte.</p>
</div>
<div class="listingblock">
<div class="title">Listing 15.1 : Un script simple de build Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">usePlugin 'java'
sourceCompatibility = 1.5
version = '1.0'
manifest.mainAttributes(
    'Implementation-Title': 'Gradle Quickstart',
    'Implementation-Version': version
)
repositories {
    mavenCentral()
}
dependencies {
    compile group: 'commons-collections', name: 'commons-collections',
version: '3.2'
    testCompile group: 'junit', name: 'junit', version: '4.+'
}
test {
    options.systemProperties['property'] = 'value'
}
uploadArchives {
    repositories {
       flatDir(dirs: file('repos'))
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nous ne rentrerons pas plus en dÃ©tail dans Gradle, dont la documentation
en ligne <sup class="footnote">[<a id="_footnoteref_56" class="footnote" href="#_footnotedef_56" title="View footnote.">56</a>]</sup> est trÃ¨s complÃ¨te si cette alternative vous
intÃ©resse. Gradle reprend beaucoup dâÃ©lÃ©ments de Maven en termes de
conventions plutÃ´t que configuration, cycle de vie, approvisionnement Ã 
partir de dÃ©pÃ´ts, plugins â¦ Par contre, Gradle rÃ©habilite en mÃªme temps
le concept de scripting, permettant dâembarquer des tÃ¢ches spÃ©cifiques
dans le build. Par ailleur, Gradle est un outil encore trÃ¨s jeune et
disposant de peu de plugins (comparÃ© Ã  lâÃ©cosystÃ¨me Maven ou Ant), aussi
lâÃ©criture de scripts est quasiment nÃ©cessaire pour en tirer quelque
chose.</p>
</div>
<div class="paragraph">
<p>En tant qu&#8217;anciens de la communautÃ© Maven, autant EasyAnt que Gradle
nous rappellent Ã©normÃ©ment une vieille connaissance : Maven 1.</p>
</div>
</div>
<div class="sect3">
<h4 id="_maven_1">Maven 1</h4>
<div class="paragraph">
<p>Maven 1 avait pour objectif de fournir au-dessus dâAnt une gestion de
dÃ©pendances (Ivy n&#8217;existant alors pas encore) et une approche par
conventions. Il utilisait des fichiers de script XML basÃ©s sur Ant et
sur un langage de programmation XML (jelly). Les tÃ¢ches les plus
courantes Ã©taient regroupÃ©es dans des plugins, qu&#8217;on pouvait importer et
invoquer dans les projets.</p>
</div>
<div class="paragraph">
<p>Maven 1 a eu ses heures de succÃ¨s en dÃ©montrant les apports de la
standardisation, puis a montrÃ© ses limites quand les scripts des plugins
ont commencÃ© Ã  se complexifier pour Ã©viter des effets de bord et des
interactions mutuelles. Ce demi-Ã©chec a Ã©tÃ© Ã  l&#8217;origine de Maven 2,
construit sur un modÃ¨le nettement plus robuste.</p>
</div>
<div class="paragraph">
<p>Le concept mis en Åuvre dans EasyAnt nous semble ainsi obsolÃ¨te, car
nous avons dÃ©jÃ  explorÃ© cette voie et rencontrÃ© des obstacles bien
dÃ©licats Ã  franchir.</p>
</div>
<div class="paragraph">
<p>Notre avis concernant Gradle est plus ambigu ; construit sur des outils
modernes, avec une syntaxe claire et compacte, il partage avec Maven
certains concepts forts. La syntaxe de Gradle est compacte, claire et
trÃ¨s spÃ©cialisÃ©e grÃ¢ce Ã  Groovy et Ã  sa capacitÃ© naturelle Ã  construire
des DSL. GrÃ©gory nous promet monts et merveilles, nous dÃ©montre
lâextrÃªme richesse du DSL Gradle Ã  travers quelques exemples bien
choisis, pour lesquels lâoutil est effectivement nettement moins verbeux
que Maven, mais nâarrive pas Ã  nous convaincre.</p>
</div>
<div class="paragraph">
<p>En ouvrant la boite de pandore du langage de script, mÃªme avec un
fonctionnement Â« par dÃ©faut Â» proche de ce que propose Maven, Gradle
vous tend la perche pour accumuler les astuces et autres bizareries qui
font de votre projet une usine Ã  gaz, rien que pour produire le
livrable. Dans le mÃªme esprit, Maven propose depuis ses dÃ©but un plugin
permettant dâexÃ©cuter des tÃ¢ches Ant ou Groovy, mais ces Â« astuces Â» ne
sont considÃ©rÃ©es que comme un pis-aller pour faciliter une migration
rapide vers Maven le temps de trouver une solution plus propre.</p>
</div>
</div>
<div class="sect3">
<h4 id="_buildr">Buildr</h4>
<div class="paragraph">
<p>Apache aime bien dÃ©velopper des outils de build ! En plus de Maven et
d&#8217;Ant, il existe aussi le projet Buildr <sup class="footnote">[<a id="_footnoteref_57" class="footnote" href="#_footnotedef_57" title="View footnote.">57</a>]</sup>, se
positionnant dans l&#8217;organisation des projets comme Maven. Il utilise le
langage Ruby au lieu du XML, les conventions de Maven et s&#8217;intÃ¨gre avec
Ant et les dÃ©pÃ´ts Maven.</p>
</div>
<div class="paragraph">
<p>Nous ne dÃ©taillerons pas ce dernier candidat, sachant que nous en avons
laissÃ© dâautres en retrait, nombreux, qui se proclament tous aussi
rÃ©volutionnaires et intuitifs les uns que les autres. Rappelons
simplement l&#8217;un des reproches le plus souvent faits Ã  Maven : l&#8217;absence
d&#8217;une bonne intÃ©gration sous Eclipse. Si on considÃ¨re les autres
solutions, l&#8217;intÃ©gration est quasi inexistante ou limitÃ©e au lancement
des tÃ¢ches de construction. Reste comme seul argument la syntaxe XML du
fichier POM, argument parfaitement recevable mais qui est un peu court
pour sÃ©lectionner un outil aussi important pour un projet.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_un_outil_reconnu">Un outil reconnu</h3>
<div class="paragraph">
<p>Il existe donc de nombreux concurrents face Ã  Maven, alors pourquoi le
choisir a priori plutÃ´t qu&#8217;une autre ? Un Ã©lÃ©ment de rÃ©ponse simple se
trouve dans la maturitÃ© de l&#8217;outil et la taille de sa communautÃ©, ou
plutÃ´t dans son niveau de pÃ©nÃ©tration en entreprise, comme toute
Ã©valuation de projet open-source. Il sera plus facile de trouver
rapidement des personnes compÃ©tentes sur un outil largement utilisÃ©,
mÃªme s&#8217;il est imparfait, que de galÃ©rer avec un bijou technologique que
trois personnes au monde savent faire fonctionner.</p>
</div>
<div class="sect3">
<h4 id="la_communaute">La communautÃ©</h4>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaArnaud.png" alt="MangaArnaud"></span></p>
</div>
<div class="paragraph">
<p>Arnaud poursuit le travail d&#8217;Ã©vangÃ©lisation en dÃ©montrant que nous ne
sommes pas de dangereux geeks qui ont misÃ© sur un outil qui finira aux
oubliettes dÃ¨s que la mode sera passÃ©e.</p>
</div>
<div class="paragraph">
<p>Maven ne vit qu&#8217;au travers de la communautÃ© de ses utilisateurs, qui
assurent lâessentiel du support de l&#8217;outil. Les dÃ©veloppeurs ne sont
plus eux-mÃªmes mis systÃ©matiquement Ã  contribution vu la trÃ¨s large base
d&#8217;utilisateurs avancÃ©s qui participent activement aux discussions en
ligne. La Figure 15-01 prÃ©sente le nombre d&#8217;utilisateurs de la liste
<a href="mailto:users@maven.apache.org">users@maven.apache.org</a> ainsi que le nombre de messages par jour. Cette
liste est trÃ¨s active et rÃ©pond aux nombreuses questions de toute nature
que les utilisateurs de tous niveaux formulent, parfois dans un anglais
assez approximatif (c&#8217;est un moyen simple pour reconnaÃ®tre des collÃ¨gues
francophones).</p>
</div>
<div class="paragraph">
<div class="title">Figure 15-01</div>
<p><span class="image"><img src="illustrations/15-01.png" alt="15 01"></span></p>
</div>
<div class="paragraph">
<p>Trafic de la liste <a href="mailto:users@maven.apache.org">users@maven.apache.org</a> â en rouge le nombre de
messages et en bleu le nombre d&#8217;inscrits.</p>
</div>
<div class="paragraph">
<p>Autre indicateur, le trafic sur le site web maven.apache.org. Les
Figures 15-02 et 15-03 affichent le compte rendu des visites pendant un
mois, ce qui donne une bonne idÃ©e du nombre d&#8217;utilisateurs de Maven
amenÃ©s Ã  configurer leurs plugins (le site web Ã©tant la principale
source d&#8217;information sur cet aspect). La Figure 15-04 indique le nombre
de tÃ©lÃ©chargements de Maven au cours de l&#8217;annÃ©e, toutes versions
confondues. Ici encore, les chiffres dÃ©montrent une trÃ¨s large
communautÃ©.</p>
</div>
<div class="paragraph">
<div class="title">Figure 15-02</div>
<p><span class="image"><img src="illustrations/15-02.png" alt="15 02"></span></p>
</div>
<div class="paragraph">
<p>Origine gÃ©ographique des visiteurs de maven.apache.org.</p>
</div>
<div class="paragraph">
<div class="title">Figure 15-03</div>
<p><span class="image"><img src="illustrations/15-03.png" alt="15 03"></span></p>
</div>
<div class="paragraph">
<p>Trafic sur le site web maven.apache.org.</p>
</div>
<div class="paragraph">
<div class="title">Figure 15-04</div>
<p><span class="image"><img src="illustrations/15-04.png" alt="15 04"></span></p>
</div>
<div class="paragraph">
<p>TÃ©lÃ©chargements mensuels de Maven sur un an, toutes versions confondues.</p>
</div>
<div class="paragraph">
<p>Si vous choisissez Maven, vous ne serez donc pas tout seul et vous
trouverez rapidement des collÃ¨gues utilisant le mÃªme outil. Nous avons
peut-Ãªtre tous tort par rapport Ã  une autre solution parfaite ou
presque, mais au moins nous pouvons nous serrer les coudes et avancer
ensemble.</p>
</div>
</div>
<div class="sect3">
<h4 id="l_equipe_de_developpement">L&#8217;Ã©quipe de dÃ©veloppement</h4>
<div class="paragraph">
<p>Arnaud poursuit en prÃ©sentant le cÅur du projet Apache Maven, ceux qui
le dÃ©veloppement et dont nous dÃ©pendons au final.</p>
</div>
<div class="paragraph">
<p>Maven, c&#8217;est aujourd&#8217;hui 55 dÃ©veloppeurs, dont une bonne vingtaine trÃ¨s
actifs en 2009, et une trÃ¨s longue liste de contributeurs qui rapportent
des bogues, proposent des correctifs ou discutent des Ã©volutions. Maven,
c&#8217;est surtout un trÃ¨s large choix de plugins qui impliquent tout autant
de dÃ©veloppeurs de toutes origines.</p>
</div>
<div class="paragraph">
<p>Cette Ã©quipe motivÃ©e est Ã  l&#8217;origine de plusieurs ouvrages, dont celui
que vous tenez entre les mains, auquel vous pouvez ajouter le Definitive
Guide et Better Build with Maven, tous deux disponibles en ligne
gratuitement, et Apache Maven 2 Effective Implementations, proposÃ© en
ligne, chapitre par chapitre, au fur et Ã  mesure de sa rÃ©daction.</p>
</div>
<div class="paragraph">
<p>LimitÃ© au monde francophone, Maven c&#8217;est encore dix membres bien de chez
nous qui ont participÃ© Ã  cet ouvrage en corrigeant nos erreurs. C&#8217;est
aussi une volontÃ© de communiquer avec les utilisateurs, comme l&#8217;a
dÃ©montrÃ©e notre prÃ©sence active dans les Java User Groups.</p>
</div>
<div class="paragraph">
<p>Maven est donc un projet trÃ¨s dynamique, et si les versions ne
s&#8217;enchaÃ®nent pas aussi vite qu&#8217;on pourrait le dÃ©sirer, c&#8217;est surtout
parce que la qualitÃ© de nos livrables est constamment amÃ©liorÃ©e et
quâune politique trÃ¨s scrupuleuse (et trÃ¨s complexe) de compatibilitÃ©
avec l&#8217;existant est suivie.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ladoption_en_entreprise">L&#8217;adoption en entreprise</h4>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaJerome.png" alt="MangaJerome"></span></p>
</div>
<div class="paragraph">
<p>Votre Honneur, j&#8217;appelle Ã  la barre notre premier tÃ©moin : JÃ©rÃ´me.</p>
</div>
<div class="paragraph">
<p>JÃ©rÃ´me a testÃ© Maven suite Ã  nos recommandations pour lancer une
nouvelle application et former son Ã©quipe. Il est en quelque sorte notre
cobaye pour valider l&#8217;adoption de Maven sur d&#8217;autres projets.</p>
</div>
<div class="paragraph">
<p>Pourquoi Maven rÃ©ussit-il une percÃ©e en entreprise ? Nous l&#8217;avons vu au
cours des chapitres qui ont prÃ©cÃ©dÃ©, Maven est un fÃ©dÃ©rateur d&#8217;outils.
La mÃªme ligne de commande permet de construire n&#8217;importe quel projet
Maven bien configurÃ©.</p>
</div>
<div class="paragraph">
<p>Quel chef de projet ne rÃªve pas de pouvoir affecter un nouveau
dÃ©veloppeur dans l&#8217;urgence sans devoir perdre dans le mÃªme temps une
ressource, le temps de lui expliquer toutes les ficelles du projet ?
Avec des projets correctement construits avec Maven, le passage d&#8217;un
projet Ã  un autre se rÃ©sume Ã  un checkout depuis le gestionnaire de code
source. JÃ©rÃ´me abonde dans ce sens en expliquant comment nous avons pu
lui apporter une aide rapide en jetant juste un rapide coup d&#8217;Åil sur
son projet. <em>Via</em> une structure comparable, il est plus facile de
s&#8217;approprier en peu de temps un projet dÃ©veloppÃ© ailleurs.</p>
</div>
<div class="paragraph">
<p>JÃ©rÃ´me souligne ensuite les bonnes pratiques que vÃ©hicule Maven : une
gestion stricte des dÃ©pendances, des tests qui font corps avec le
dÃ©veloppement et non comme tÃ¢che Ã  part, l&#8217;intÃ©gration des outils de
qualitÃ© logicielle, le support de l&#8217;intÃ©gration continue, etc. Pour
avoir trop souvent pilotÃ© des projets peu scrupuleux et rÃ©alisÃ©s sans
filet, reposant sur les Ã©paules de quelques personnes, il apprÃ©cie
d&#8217;avoir enfin un cadre solide et homogÃ¨ne.</p>
</div>
<div class="paragraph">
<p>En entreprise, Maven est un Ã©lÃ©ment clÃ© de ce socle qu&#8217;on appelle
software factory, qui vise Ã  proposer une solution industrialisÃ©e,
reproductible et stabilisÃ©e pour les dÃ©veloppements logiciels, sortant
de plusieurs dÃ©cennies de bricolage. JÃ©rÃ´me, en s&#8217;inspirant de notre
exemple, est en train de mettre en Åuvre le mÃªme type d&#8217;outillage et
bÃ©nÃ©ficie des infrastructures que nous avons dÃ©jÃ  mises en place :
gestionnaire du dÃ©pÃ´t d&#8217;artefacts, serveur d&#8217;intÃ©gration continue.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_lavenir_de_maven">L&#8217;avenir de Maven</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaJim.png" alt="MangaJim"></span></p>
</div>
<div class="paragraph">
<p>Mission impossible ?</p>
</div>
<div class="paragraph">
<p>Bonjour, Monsieur Phelps. Votre mission, si vous l&#8217;acceptez, est de
prÃ©senter Ã  nos lecteurs l&#8217;avenir de Maven. Comme tout projet
open-source, son dÃ©veloppement n&#8217;est guidÃ© par aucun plan gravÃ© dans le
marbre et toute annonce prÃ©liminaire peut Ãªtre contredite par les faits.
Pour Ã©viter Ã  nos lecteurs de se bÃ¢tir une opinion sur des informations
erronÃ©es, prenez soin d&#8217;annoter les donnÃ©es les plus spÃ©culatives de
votre logo Impossible Mission Force.</p>
</div>
<div class="paragraph">
<p>Si vous ou l&#8217;un de vos agents Ã©tait capturÃ© ou tuÃ©, les auteurs
nieraient avoir eu connaissance de vos agissements. Bonne chance, Jimâ¦</p>
</div>
<div class="paragraph">
<p>Cet encadrÃ© s&#8217;autodÃ©truira dans dix secondesâ¦ PChittttttt !</p>
</div>
<div class="sect3">
<h4 id="_maven_2_x">Maven 2.x</h4>
<div class="paragraph">
<p>Maven 2 ne bÃ©nÃ©ficiera au mieux que de quelques versions correctrices,
et encore sous rÃ©server que des dÃ©veloppeurs prennent le temps de se
pencher Ã  son chevÃªt ! Maven 3.x est la branche active qui bÃ©nÃ©ficie de
toute lâattention de lâÃ©quipe.</p>
</div>
<div class="paragraph">
<p>Les Ã©quipes qui utilisent Maven 2.x seront encore nombreuses, soit pour
des raisons dâincompatibilitÃ© sur un projet ancien, soit par
mÃ©connaissance de la compatibilitÃ© des versions successives de Maven (ou
par manque de temps pour sâen assurer). Quelle que soit la raison qui
vous pousse Ã  continuer dâutliser Maven 2.x, n&#8217;attendez rien de nouveau
de ce cÃ´tÃ©. Cependant, pour nos lecteurs qui serait contraint Ã  cette
version pour une raison qui leur appartient, un rapide Ã©tat des lieux :</p>
</div>
<div class="sect4">
<h5 id="_maven_2_1">Maven 2.1</h5>
<div class="paragraph">
<p>Maven 2.1 a Ã©tÃ© la premiÃ¨re version Ã  profiter de cet Ã©lan. Les
nouvelles fonctionnalitÃ©s qu&#8217;il apporte peuvent sembler superficielles
mais l&#8217;importance est avant tout le redÃ©marrage de cette branche de
dÃ©veloppement en parallÃ¨le de Maven 3. Maven 2.1 introduit :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>La possibilitÃ© de sÃ©curiser les mots de passe dÃ©finis dans le
fichier settings.xml de l&#8217;utilisateur, et donc un peu trop ouvertement
exposÃ©s aux regards indiscrets. Ceux-ci peuvent dÃ©sormais Ãªtre chiffrÃ©s
et la clÃ© stockÃ©e, par exemple, sur une clÃ© USB et donc inexploitable en
l&#8217;absence de son utilisateur lÃ©gitime (pensez au cas de vol de
l&#8217;ordinateur portable d&#8217;un dÃ©veloppeur Maven, un quidam pourrait venir
l&#8217;enrichir et le corriger Ã  nos dÃ©pens J).</p>
</li>
<li>
<p>Le tÃ©lÃ©chargement des dÃ©pendances en parallÃ¨le. Cela n&#8217;a pas un
grand intÃ©rÃªt pour le dÃ©veloppeur qui ne va tÃ©lÃ©charger ses dÃ©pendances
qu&#8217;une seule fois â quoique, lors de la premiÃ¨re utilisation, quand
Maven "tÃ©lÃ©charge la moitiÃ© d&#8217;Internet", cela puisse se sentir. Sur un
serveur d&#8217;intÃ©gration continue, par contre, si on dÃ©sire utiliser un
dÃ©pÃ´t local vierge avant chaque construction pour faire les choses bien
proprement, le gain de temps peut Ãªtre significatif.</p>
</li>
<li>
<p>La construction multimodule par morceaux. Il est possible de
demander Ã  Maven 2.1 de ne construire que certains modules du projet, et
Ã©ventuellement tous les modules dont il dÃ©pend ou encore tous les
modules qui dÃ©pendent de lui. Cette fonctionnalitÃ© Ã©tait dÃ©jÃ  prÃ©sente
sous forme d&#8217;un plugin dÃ©diÃ© reactor, elle est dÃ©sormais disponible au
cÅur de Maven.</p>
</li>
<li>
<p>Sans oublier une nette amÃ©lioration des performances sur
l&#8217;initialisation de Maven dans un contexte avec de nombreux modules.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_maven_2_2">Maven 2.2</h5>
<div class="paragraph">
<p>DeuxiÃ¨me de la lignÃ©e, Maven 2.2 est apte Ã  :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Corriger plusieurs bogues, dont un liÃ© Ã  la manipulation des
${variables} lorsque le POM est installÃ© dans le dÃ©pÃ´t local ou
dÃ©ployÃ©. Cette fonctionnalitÃ© introduite dans Maven 2.1.0 a entraÃ®nÃ© des
rÃ©gressions sur certains plugins, notamment celui de signature GPG â
elle a donc Ã©tÃ© retirÃ©e au profit d&#8217;une gestion plus stricte.</p>
</li>
<li>
<p>Apporter quelques amÃ©liorations mineures.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>C&#8217;est tout ? Ãa fait un peu maigre, mÃªme pour une version mineure. On
dirait plutÃ´t une petite version corrective ! La raison principale de ce
changement de version est que Maven 2.2 nÃ©cessite dÃ©sormais Java 5. La
compatibilitÃ© avec Java 1.4 a Ã©tÃ© longtemps conservÃ©e pour ne pas
dÃ©ranger les utilisateurs, Java 5 est nÃ©cessaire pour corriger certains
bogues. Cela n&#8217;interdit pas de construire des projets pour Java 1.4,
voire des versions antÃ©rieures, mais le poste de dÃ©veloppement doit
disposer d&#8217;un JDK 5 pour exÃ©cuter Maven lui-mÃªme.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_maven_3_x">Maven 3.x</h4>
<div class="paragraph">
<p><span class="image"><img src="illustrations/Maven3.png" alt="Maven3"></span></p>
</div>
<div class="paragraph">
<p>Maven 3 a longtemps Ã©tÃ© connu sous le nom de Maven 2.1. Son
dÃ©veloppement correspond Ã  une refonte profonde du cÅur de Maven,
travaux importants menÃ©s de maniÃ¨re trÃ¨s active par l&#8217;Ã©quipe de
Sonatype, sociÃ©tÃ© fondÃ©e par Jason Van Zyl, dÃ©veloppeur initial de
Maven. Cette reprise lourde du code a, dans un premier temps, paralysÃ©
les Ã©volutions sur Maven 2.0 car tout le monde attendait plus ou moins
la suite. Les choses ne vont cependant jamais assez vite et
l&#8217;ex-Maven 2.1 a Ã©tÃ© renommÃ© Maven 3.x pour bien indiquer la rupture et
laisser de la place pour de nouvelles versions de Maven 2.</p>
</div>
<div class="paragraph">
<p>L&#8217;un des plus gros chantier de Maven 3, et qui explique en grande partie
son retard, est la compatibilitÃ© avec l&#8217;existant. Un ensemble de tests
d&#8217;intÃ©gration a Ã©tÃ© Ã©crit pour mettre en scÃ¨ne Maven confrontÃ© Ã  la
plupart de ses cas d&#8217;utilisation. Projets simples, multi-modules,
plugins plus ou moins complexes, sont ainsi exÃ©cutÃ©s en boucle par un
harnais de sÃ©curitÃ© anti-rÃ©gression de plus de 450 tests. Ce n&#8217;est pas
une garantie absolue, mais c&#8217;est une sÃ©curitÃ© que peu de projets peuvent
proposer.</p>
</div>
<div class="paragraph">
<p>La seconde difficultÃ© dans le dÃ©veloppement de Maven 3 touche Ã  la
pÃ©rennitÃ© des API internes de Maven, utilisÃ©es par certains plugins, et
que l&#8217;Ã©quipe de dÃ©veloppement voudrait pouvoir retravailler. La limite
entre public et interne dans Maven 2 est en effet assez floue, et pour
traiter certains besoins particuliers, les dÃ©veloppeurs de plugins ont
parfois fait appel Ã  du code assez profond de Maven 2. Sonatype a donc
dÃ©veloppÃ© une couche de traduction entre les API historiques de Maven 2
et leur Ã©quivalent dans le code modernisÃ© de Maven 3.</p>
</div>
<div class="paragraph">
<p>En rÃ©sumÃ©, Maven 3 câest un peu un Ã©pisode spÃ©cial de Extreme makeover :
Maven edition <sup class="footnote">[<a id="_footnoteref_58" class="footnote" href="#_footnotedef_58" title="View footnote.">58</a>]</sup>.  On prend votre outillage existant,
mais on refait tout de la cave au grenier !</p>
</div>
<div class="paragraph">
<div class="title">Figure 15-05</div>
<p><span class="image"><img src="illustrations/15-05.png" alt="15 05"></span></p>
</div>
<div class="sect4">
<h5 id="_quoi_de_neuf">Quoi de neuf ?</h5>
<div class="paragraph">
<p>Le changement le plus notable dans Maven 3 est la possibilitÃ© de
l&#8217;intÃ©grer dans un autre outil. Ceci ouvre la voie Ã  de nombreuses
utilisations en dehors de la ligne de commande classique que nous avons
rencontrÃ© jusquâici.</p>
</div>
<div class="paragraph">
<p>Maven 3 peut Ãªtre intÃ©grÃ© au sein dâun autre outil, et câest ce que font
nos IDE. Disposer dâun Maven Â« embarquÃ© Â» leur permet de manipuler le
POM, le cycle de vie, les plugins, et lâarbre de dÃ©pendance.  Maven 3
peut ainsi se greffer Ã  la construction incrÃ©mentale dâun projet
Eclipse, câest Ã  dire ne procÃ©der  Ã  la reconsturction du projet que
pour les parties impactÃ©es par la derniÃ¨re modification pour plus de
rÃ©activitÃ©. Lorsque vous Ã©ditez un fichier source, lâIDE ne va pas
reconstruire tout l&#8217;espace de travail en effaÃ§ant tout l&#8217;existant, mais
travailler par diffÃ©rence avec ce qui Ã©tait dÃ©jÃ  construit et juste
recompiler ce qui est impactÃ© par votre modification. Avec la gestion de
la construction incrÃ©mentale et une bonne gestion du Maven intÃ©grÃ©, il
est  possible de laisser l&#8217;IDE faire certaines de ces tÃ¢ches tout en
exploitant les plugins Maven pour d&#8217;autres, comme c&#8217;est dÃ©jÃ  le cas pour
la compilation du code source.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaOlivier.png" alt="MangaOlivier"></span></p>
</div>
<div class="paragraph">
<p>Olivier nous signale dâailleurs que notre IDE nâest pas le seul Ã 
exploiter cette possibilitÃ© dâembarquer Maven en interne. Notre serveur
dâintÃ©gration continue fait de mÃªme ! En pouvant manipuler Maven comme
un composant interne, Hudson peut lui greffer ses propres extensions et
proposer une intÃ©gration fine. Les builds Maven quâil exÃ©cute sont alors
mis sous surveillance et Hudson peut nous indiquer lâavancement de
chaque module du projet.</p>
</div>
<div class="paragraph">
<p>Mais ce ne sont que quelques exemples. LâintÃ©gration de Maven permet de
construire des outils innovants, comme le shell Maven proposÃ© par
sonatype. Au lieu de la console de base de votre systÃ¨me, MavenShell
propose une console avec coloration syntaxique, assistance Ã  la saisie
des mots clÃ©s, et maintien en mÃ©moire des POM et des mÃ©tadonnÃ©es de
votre projet. Il en rÃ©sulte un Maven plus rÃ©actif Ã  vos commandes.</p>
</div>
<div class="paragraph">
<div class="title">Figure 15-06</div>
<p><span class="image"><img src="illustrations/15-06.png" alt="15 06"></span></p>
</div>
<div class="paragraph">
<p>Sonatype MavenShell.</p>
</div>
<div class="paragraph">
<p>Maven 3 offre la possibilitÃ© pour le POM d&#8217;utiliser un format
alternatif. Nous avons vu que le format XML actuel est particuliÃ¨rement
verbeux ; Polyglot Maven est une version dÃ©rivÃ©e de Maven, dÃ©veloppÃ©e
par Sonatype, visant Ã  proposer une syntaxe diffÃ©rente du POM, basÃ©e par
exemple sur Groovy, Clojure, ou Scala â pour exprimer les mÃªmes
mÃ©tadonnÃ©es, comme le monte le Listing 15.2. Attention cependant,
lâoutillage avancÃ© permettant dâÃ©diter le POM dans votre IDE nâest pas
compatible avec cette syntaxe.</p>
</div>
<div class="listingblock">
<div class="title">Listing 15.2 : Un POM Maven 3 exprimÃ© en Scala</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">// pom.scala
project( "com.macompagnie:monprojet:1.0-SNAPSHOT" { proj =&gt;
   // ajoute la bibliothÃ¨que scala et le plugin scala compiler
   proj includeScalaSources "2.7.7"
   proj dependency "apache-httpclient:commons-httpclient:3.0.1"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cette Ã©colution vise un public trÃ¨s prÃ©cis: ceux qui nâutilisent pas
Maven mais travaillent dans un langage de dÃ©veloppement tournant sur la
JVM. En leur proposant dâexprimer le POM dans leur langage et avec les
possibilities dâextension qui lui sont propres, Polyglot essaie de
couper lâherbe sous le pied des outils alternatifs.</p>
</div>
</div>
<div class="sect4">
<h5 id="_maven_3_1">Maven 3.1</h5>
<div class="paragraph">
<p><span class="image"><img src="illustrations/IMF.png" alt="IMF"></span></p>
</div>
<div class="paragraph">
<p>Maven 3 permet de dÃ©solidariser Maven (lâoutil) de la lecture du modÃ¨le
POM : lâÃ©lÃ©ment modelVersion va pouvoir jouer son rÃ´le et permettre
dâintroduire des Ã©volutions dans ce format, sans empÃªcher les
utilisateurs de lâutiliser depuis une autre version de Maven â il
suffira dâobtenir depuis le dÃ©p*Ã´*t la version associÃ©e du modÃ¨le. On
attend ainsi la simplification de certaines opÃ©rations pÃ©nibles sur les
POM, comme lâexclusion globale dâun artefact (plutÃ´t que de devoir
rÃ©pÃ©ter des dizaines de fois le mÃªme bloc exclusions.</p>
</div>
<div class="paragraph">
<p>Autre Ã©volution prÃ©vue de longue date : les mixins. Ils vont permettre
de rÃ©cupÃ©rer une configuration maven depuis un fichier POM sans passer
par un hÃ©ritage. La composition dâun POM se fera alors par composition
de mixins ; un mixin pour la gestion de la persistence Hibernate, un
mixin pour la gestion de lâapplication web, un mixin pour notre
outillage Q&amp;A, etc.</p>
</div>
<div class="paragraph">
<p>En parallÃ¨le du dÃ©veloppement de Maven 3.x, Sonatype dÃ©veloppe une offre
globale de forge logicielle, incluant le build, lâintÃ©gration continue,
lâhÃ©bergement des binaires, lâapprovisionnement des plateformes de
dÃ©veloppement et la mise en production. De nombreuses Ã©volutions dans
Apache Maven seront donc issues de ces dÃ©veloppements.</p>
</div>
</div>
<div class="sect4">
<h5 id="_sonatype_maven">Sonatype Maven</h5>
<div class="paragraph">
<p>Sonatype a annoncÃ© lors de la confÃ©rence EclipseCon 2011, par la voix de
Jason van Zyl son responsable technique et fondateur, ses projets pour
le dÃ©veloppement de son offre autour de Maven, Eclipse et Hudson. La
diapo prÃ©sentÃ©e en figure 15-06, extraite de cette prÃ©sentation, dÃ©finit
la position de Sonatype par rapport au projet Apache Maven. La fondation
Apache utilise un gestionnaire de code source Subversion, qui est
intÃ©grÃ© en mirroir sur un compte GitHub. Sonatype utilise
lâimpressionnante puissance de Git pour assurer la synchronisation de
ses dÃ©veloppements internes avec la version open-source Apache. Cela va
permettre Ã  Sonatype de poursuivre ses objectifs dâinnovation et
dâavancer au rythme quâil dÃ©sire imposer au projet, tout en conservant
le lien avec le projet et le mode de fonctionnement de la fondation
Apache. Aisni, si ces annonces concernent avant tout les outils de
Sonatype, dont certains sont disponibles en double licence open-source /
propriÃ©taire, une partie sera reversÃ©e Ã  la communautÃ© et viendra
enrichir le socle technique Maven.</p>
</div>
<div class="paragraph">
<p>Figure 15-07
<span class="image"><img src="illustrations/15-07.png" alt="15 07"></span></p>
</div>
<div class="paragraph">
<p>le positionnement de Sonatype par rapport au projet de la fondation
Apache</p>
</div>
<div class="paragraph">
<p>Pour ce qui concerne Maven, lâÃ©diteur affiche ses ambitions :</p>
</div>
<div class="paragraph">
<p>Dâune part, la gÃ©nÃ©ralisation de lâutilisation des annotations Java5 et
de lâinjection de dÃ©pendance JSR-330. Nous lâavons dÃ©jÃ  croisÃ© au
chapitre 11 lorsquâOlivier est venu dÃ©poussiÃ©rer le code de notre
plugin.</p>
</div>
<div class="paragraph">
<p>La norme JSR-330 est intÃ©grÃ©e Ã  JavaEE 6 et apporte Ã  la pile Java
dâentreprise lâinjection de dÃ©pendance dÃ©mocratisÃ©e par le succÃ¨s de
SpringFramework. Cette norme va rapidement devenir la rÃ©fÃ©rence sur le
sujet, dÃ©jÃ  supportÃ©e par Spring 3 et Google Guice mÃªme en dehors du
contexte JavaEE. LâidÃ©e de Sonatype est de capitaliser sur ce succÃ¨s en
appliquant ce modÃ¨le aux plugins Maven, ainsi quâÃ  ses autres outils que
sont Nexus et Hudson. On retrouvera ainsi dans tous nos dÃ©veloppements
la mÃªme logique de liaison entre les composants via une simple
annotation @Inject.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="illustrations/IMF.png" alt="IMF"></span></p>
</div>
<div class="paragraph">
<p>Autre annonce, un gros effort dâintÃ©gration de Maven dans Eclipse Ã 
travers le projet m2eclipse. En dehors de lâamÃ©lioration du plugin, de
son ergonomie et de ses fonctionnalitÃ©s, Maven peut Ã©voluer pour mieux
supporter le mode incrÃ©mental dâEclipse, Ã  savoir ne plus partir de zÃ©ro
Ã  chaque nouveau build. LâIDE pourrait tirer partie de ces Ã©volutions,
mais aussi tout lâÃ©cosystÃ¨me Maven. LâintÃ©gration continue pourrait par
exemple elle aussi utiliser un build incrÃ©mental pour plus de
rÃ©activitÃ©.</p>
</div>
<div class="paragraph">
<p>Sur la gestion des dÃ©pendances et lâaccÃ¨s aux dÃ©pÃ´ts, Sonatype a dÃ©jÃ 
pris la main en intÃ©grant dans Maven 3 sa brique Aether. DÃ©veloppÃ©e sous
licence Eclipse dans les labos Sonatype, celle-ci remplace intÃ©gralement
le code Ã©quivalent de Maven 2. De nombreuses Ã©volutions sont attendues
sur ce composant :</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="illustrations/IMF.png" alt="IMF"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Le support des accÃ¨s concurrents dans le dÃ©pÃ´t local. Cela est
nÃ©cessaire pour permettre lâexÃ©cution parallÃ¨le de Maven et des autres
outils basÃ©s sur Aether.</p>
</li>
<li>
<p>LâintÃ©gration avec m2eclipse, ce qui signifie le support dans
Aether des dÃ©pÃ´ts OSGi P2 dâEclipse et le modÃ¨le de version associÃ©.
Cette Ã©volution permettra a termes de crÃ©er des passerelles entre les
deux grands modÃ¨les de dÃ©pÃ´ts dâartefacts et dâapprovisionnement de
bibliothÃ¨ques du monde Java. Avec le projet JigSaw (Â« java modules Â»)
qui vise Ã  intÃ©grer cette fonctionnalitÃ© directement dans la plateforme
Java, ce chantier risque de faire couler beaucoup dâencre.</p>
</li>
<li>
<p>Utiliser un client HTTP asynchrone permettant Ã  Aether de mieux
communiquer avec les dÃ©pÃ´ts distants. En parallÃ©lisant les requÃªtes,
Aether peut rÃ©pondre plus rapidement aux demandes de rÃ©solution des
dÃ©pendances. PlutÃ´t que de dÃ©marrer de nombreux processus, les
entrÃ©es/sorties asynchrones permettent dâutiliser juste ce quâil faut de
ressources.</p>
</li>
<li>
<p>Une dÃ©rivation du client HTTP asynchrone dÃ©diÃ©e Ã  Maven, utilisant
lâAPI Wagon dÃ©finie par Maven pour le dÃ©ploiement dâartefacts dans un
dÃ©pÃ´t. Cette API remonte Ã  Maven2 et a Ã©tÃ© dÃ©rivÃ©e pour supporter HTTP,
SCP, WebDav, FTP, les partages windows SMB et mÃªme SVN ! PlutÃ´t que de
rÃ©inventer une nouvelle API, Sonatype prÃ©fÃ¨re conserver cette faÃ§ade et
travailler sous le capÃ´t pour en amÃ©liorer les performances.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sonatype prÃ©voit aussi dâautres Ã©volutions, sous forme de points
dâextension et de modÃ¨le Ã©vÃ©nementiel, inspirÃ© par les besoins
dâintÃ©gration de m2eclipse. Il ne sâagit Ã©videmment que des plans
annoncÃ©s, qui peuvent Ã©voluer et sâenrichir en fonction du contexte et
des difficultÃ©s que rencontreront les Ã©quipes de dÃ©veloppement.</p>
</div>
</div>
<div class="sect4">
<h5 id="_maven_4">Maven 4 ?</h5>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaArnaud.png" alt="MangaArnaud"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="illustrations/IMF.png" alt="IMF"></span></p>
</div>
<div class="paragraph">
<p>Arnaud est tout Ã©moustillÃ© par ces nombreuses annonces, et dÃ©cide de se
lancer Ã  son tour dans le jeu des prÃ©dictions. Il nous annonce alors la
fusion des projets Apache Maven et Gradle, prenant la rigueur du premier
et la syntaxe moderne du second, et nous prÃ©sente le tout premier Ã©cran
de Graven, lâoutil de build ultime. Humâ¦ dÃ©cidÃ©ment, tout le monde ne
peut pas faire partie de lâÃ©quipe de Mission Impossible</p>
</div>
<div class="paragraph">
<p>Figure 15-08
<span class="image"><img src="illustrations/15-08.png" alt="15 08"></span></p>
</div>
<div class="paragraph">
<p>Graven, une crÃ©ation originale dâArnaud visant Ã  marier Maven et Gradle</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a_qui_appartient_maven">Ã qui appartient Maven ?</h3>
<div class="paragraph">
<p>Le comitÃ© est presque convaincu mais il a tout de mÃªme quelques
rÃ©ticences. L&#8217;outil semble bon, promis Ã  un bel avenir, mais dans les
mains de qui mettons-nous l&#8217;avenir de ce qui est en train de devenir le
projet n<sup>o</sup> 1 de Geegol ?</p>
</div>
<div class="sect3">
<h4 id="_la_fondation_apache">La fondation Apache</h4>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaRaphael.png" alt="MangaRaphael"></span></p>
</div>
<div class="paragraph">
<p>RaphaÃ«l se fait un plaisir en expliquant le monde open-source et les
garanties intrinsÃ¨ques qu&#8217;apporte ce modÃ¨le.</p>
</div>
<div class="paragraph">
<p>Maven est l&#8217;un des nombreux projets hÃ©bergÃ©s par la fondation Apache,
surtout connue pour son excellent serveur HTTP (Ã  tel point qu&#8217;on parle
souvent d&#8217;un serveur apache, sans plus de prÃ©cision). Cette fondation
assure par son statut l&#8217;indÃ©pendance des projets hÃ©bergÃ©s vis-Ã -vis d&#8217;un
Ã©diteur et encourage le dÃ©veloppement communautaire.</p>
</div>
<div class="paragraph">
<p>Un projet Apache est conduit par un comitÃ© de pilotage, pour lequel
chaque membre dispose d&#8217;un droit de veto sur les dÃ©cisions prises, et oÃ¹
chaque dÃ©cision majeure doit Ãªtre soumise au vote et obtenir au moins
trois avis favorables. Cette rÃ¨gle de conduite assure la stabilitÃ© des
projets et le soutien de ses membres majeurs. Les autres membres du
projet, qui ne font pas partie du comitÃ© et ne disposent pas d&#8217;un droit
de veto, peuvent exprimer leur avis librement lors des votes. Il est
rare que la dÃ©cision finale ne soit pas le reflet d&#8217;un compromis acceptÃ©
par tous.</p>
</div>
<div class="paragraph">
<p>Maven s&#8217;est dÃ©veloppÃ© dans cet esprit, chaque grande dÃ©cision Ã©tant
soumise Ã  la communautÃ© des dÃ©veloppeurs et reflÃ©tant leurs choix
communs. Au sein de la fondation Apache, il n&#8217;y a donc pas de
propriÃ©taire du projet, en dehors du comitÃ© dont les membres ont des
attaches trÃ¨s variÃ©es.</p>
</div>
<div class="paragraph">
<p>C&#8217;est une distinction notable par rapport Ã  d&#8217;autres projets open-source
dont les dÃ©cisions ne sont pas si ouvertes. SpringFramework, par
exemple, est un projet ouvert aux suggestions de ses utilisateurs et
dont le code est libre, mais dont le dÃ©veloppement est gÃ©rÃ© par la
sociÃ©tÃ© SpringSource <sup class="footnote">[<a id="_footnoteref_59" class="footnote" href="#_footnotedef_59" title="View footnote.">59</a>]</sup>. L&#8217;excellente Ã©quipe de
dÃ©veloppeurs que SpringSource a rÃ©ussi Ã  rÃ©unir propose un outil de
grande qualitÃ©, tandis que le soin apportÃ© pour rÃ©pondre aux rapports
d&#8217;anomalies et aux suggestions de la communautÃ© d&#8217;utilisateurs est
exemplaire. L&#8217;ouverture de ce projet reste cependant un petit cran en
dessous de ce que peut proposer un logiciel hÃ©bergÃ© par la fondation
Apache et soumis Ã  une gestion communautaire multipartite.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sonatype">Sonatype</h4>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaNicolas.png" alt="MangaNicolas"></span></p>
</div>
<div class="paragraph">
<p>Nicolas poursuit en constatant une certaine incrÃ©dulitÃ© de notre
auditoire. Le monde merveilleux de l&#8217;open-source tout gratuit, oÃ¹ des
dÃ©veloppeurs-bisounours-bÃ©nÃ©voles offrent leur temps et leur code Ã  la
communautÃ©, les laisse perplexes. DerriÃ¨re Maven, comme partout, il y a
des gens Ã  payer et des machines qui tournent.</p>
</div>
<div class="paragraph">
<p>Vous aurez notÃ© dans les pages qui prÃ©cÃ¨dent la trÃ¨s forte adhÃ©rence
entre le dÃ©veloppement de Maven et la sociÃ©tÃ© Sonatype. Maven est en
effet un projet complexe, englobant des solutions techniques trÃ¨s
spÃ©cifiques â pensez, par exemple, Ã  la gestion de chargeurs de classes
isolÃ©s pour chaque plugin, concept qui reste assez thÃ©orique pour une
grande majoritÃ© de dÃ©veloppeurs.</p>
</div>
<div class="paragraph">
<p>Parce que Sonatype met des dÃ©veloppeurs de talent Ã  temps plein sur le
dÃ©veloppement de Maven, le prix Ã  payer pour suivre les dÃ©veloppements
en tant que simple contributeur est dÃ©mesurÃ©. Les technologies engagÃ©es
sont nombreuses et nÃ©cessitent un gros investissement en temps.
L&#8217;Ã©volution du dÃ©veloppement est rapide et peu documentÃ©, il est donc
difficile de se faire en peu de temps une idÃ©e prÃ©cise des tÃ¢ches en
cours et de leur avancement.</p>
</div>
<div class="paragraph">
<p>Maven est cependant un projet de la fondation Apache, dont nous avons vu
les rÃ¨gles de conduite, et, Ã  ce titre, on peut trouver choquant de le
voir mÃªlÃ© de si prÃ¨s au nom d&#8217;une seule sociÃ©tÃ©.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="illustrations/Maven3.png" alt="Maven3"></span></p>
</div>
<div class="paragraph">
<p>En fait, en creusant un peu, on constate mÃªme rapidement que Sonatype
est bien plus quâun contributeur de Maven : des composants majeurs de
Maven 3 ne sont pas dÃ©veloppÃ©s et hÃ©bergÃ©s par la fondation Apache, mais
sous le compte GitHub de Sonatype !</p>
</div>
</div>
<div class="sect3">
<h4 id="un_peu_de_strategie">Un peu de stratÃ©gie</h4>
<div class="paragraph">
<p>Parmi la refonte rÃ©alisÃ©e pour Maven 3, un Ã©lÃ©ment clÃ© est la rÃ©Ã©criture
complÃ¨te de la gestion des dÃ©pendances. AprÃ¨s deux tentatives
infructueuses, Sonatype a proposÃ© un dÃ©veloppement interne,
Aether <sup class="footnote">[<a id="_footnoteref_60" class="footnote" href="#_footnotedef_60" title="View footnote.">60</a>]</sup>, hÃ©bergÃ© en open-source dans sa propre forge,
et contribuÃ© Ã  la fondation Eclipse. Il en est de mÃªme de
Sisu <sup class="footnote">[<a id="_footnoteref_61" class="footnote" href="#_footnotedef_61" title="View footnote.">61</a>]</sup>, qui permet Ã  Maven3 de fonctionner sur la base
du conteneur Google Guice tout en restant compatible avec Plexus, qui
jouait ce rÃ´le dans Maven 2 et est encore trÃ¨s prÃ©sent dans de nombreux
composants.</p>
</div>
<div class="paragraph">
<p>Sonatype, qui pilote donc seul ces projets cruciaux pour Maven, a choisi
d&#8217;en faire une solution open-source. Bien sÃ»r, Sonatype prend une
longueur d&#8217;avance sur tout concurrent qui voudrait occuper ce terrain,
et sâouvre les portes de la fondation Eclipse et la reconnaissance
associÃ©e, mais la dÃ©marche doit tout de mÃªme Ãªtre soulignÃ©e. De
nombreuses autres sociÃ©tÃ©s, moins imprÃ©gnÃ©es par le modÃ¨le open-source,
n&#8217;auraient pas suivi cette voie et auraient tentÃ© de monnayer leur
compÃ©tence.</p>
</div>
<div class="paragraph">
<p>Verrouiller lâaccÃ¨s Ã  Maven serait contre-productif. Une majoritÃ© des
utilisateurs â et donc des clients potentiels â se tournerait vers des
solutions libres, Ã©ventuellement moins bien intÃ©grÃ©es. Le monde Java est
particuliÃ¨rement marquÃ© par le modÃ¨le open-source, et le seul argument
financier ne suffit pas Ã  expliquer cet engouement. Aller contre les
attentes du public pour une sociÃ©tÃ© comme Sonatype serait comme couper
la branche sur laquelle on est assis. Par contre, une fois devenu le
standard de fait, monnayer lâexpertise et le support autour dâun outil
devenu stratÃ©gique pour beaucoup dâentreprises est un avantage
commercial sans Ã©quivalent, quitte Ã  se froisser un peu avec les membres
de la fondation Apache.</p>
</div>
</div>
<div class="sect3">
<h4 id="_open_source">Open-source</h4>
<div class="paragraph">
<p>En dehors de cette considÃ©ration purement stratÃ©gique, il ne faut pas
non plus oublier qui constitue l&#8217;Ã©quipe de Sonatype. Vous avez affaire Ã 
des gens techno-addicts, pas Ã  des financiers. Des gens qui se
passionnent pour le code et les nouveautÃ©s technologiques, et qui ne
laisseraient Ã  personne le soin de coder Ã  leur place. Ces gens sont
imprÃ©gnÃ©s par le modÃ¨le open-source et n&#8217;auraient pas l&#8217;idÃ©e de lancer
un nouvel outil en dehors de cet esprit. Ils sont au cÅur du projet
qu&#8217;ils ont construit et vu s&#8217;imposer, rien ne leur ferait plus mal que
de voir leur bÃ©bÃ© devenir une marchandise de plus.</p>
</div>
<div class="paragraph">
<p>Par contre, ils nâaiment pas forcÃ©ment se faire dicter leur conduite par
des personnes qui nâapportent rien de plus que des critiques. Aussi, le
modÃ¨le de dÃ©veloppement Apache, basÃ© sur le compromis et le consensus,
est rÃ©guliÃ¨rement mis Ã  mal par des dÃ©cisions unilatÃ©rales. Autant le
code reste ouvert et protÃ©gÃ© par le mÃ©canisme de licences, autant
lâouverture propre au dÃ©veloppement communautaire nâest pas
systÃ©matique.</p>
</div>
<div class="paragraph">
<p>Cependant, l&#8217;Ã©quipe de dÃ©veloppement de Maven ne se rÃ©sume pas Ã  ces
quelques personnes. L&#8217;Ã©quipe complÃ¨te <sup class="footnote">[<a id="_footnoteref_62" class="footnote" href="#_footnotedef_62" title="View footnote.">62</a>]</sup> compte des
individus d&#8217;origines trÃ¨s variÃ©es et rattachÃ©s Ã  des employeurs de
toutes sortes. Pris individuellement, ils sont peu visibles, mais, comme
pour tout projet open-source, c&#8217;est ensemble qu&#8217;ils ont donnÃ© vie au
projet Maven, et en particulier Ã  son large Ã©cosystÃ¨me de plugins.</p>
</div>
</div>
<div class="sect3">
<h4 id="_la_garantie_par_lopen_source">La garantie par l&#8217;open-source</h4>
<div class="paragraph">
<p>Si Sonatype se comporte aujourd&#8217;hui comme un exemple dans sa dÃ©marche de
contribution Ã  l&#8217;open-source, qu&#8217;en sera-t-il Ã  l&#8217;avenir ? Que
deviendrait Maven si cette sociÃ©tÃ© venait Ã  Ãªtre rachetÃ©e par un groupe
aux intentions plus lucratives ? AprÃ¨s tout, en moins d&#8217;un an, nous
avons vu Oracle racheter Bea puis SUN pendant que VMware rachetait
SpringSource qui venait dâabsorber G2One. Qu&#8217;en pensent ceux qui ont
misÃ© sur la machine virtuelle Java alternative JRockit et qui ne peuvent
mÃªme plus la tÃ©lÃ©charger sans passer par le service de support
d&#8217;Oracle ?</p>
</div>
<div class="paragraph">
<p>Ne perdons pas de vue deux Ã©lÃ©ments clÃ©s :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven est dÃ©veloppÃ© sous licence libre Apache. Quoi qu&#8217;il arrive,
personne ne pourra vous rÃ©clamer de droits si vous prenez ce code pour
en faire ce que bon vous semble. En particulier, si une sociÃ©tÃ©
investissait massivement dans le dÃ©veloppement pour crÃ©er un Maven
Professional payant (ce que la licence Apache n&#8217;interdirait pas), cela
ne ferait que vous priver des fonctionnalitÃ©s ajoutÃ©es Ã  la version
libre. Si la diffÃ©rence est rÃ©ellement une plus-value significative, le
prix qui en serait demandÃ© serait peut-Ãªtre justifiÃ©. Dans le cas
contraire, la version libre restera libre et pourra tenter de dÃ©velopper
les mÃªmes services, voire mieux, ce qui s&#8217;est dÃ©jÃ  vu.</p>
</li>
<li>
<p>Le dÃ©veloppement de Maven est portÃ© par ses dÃ©veloppeurs. Le droit
Ã  modifier le code source de Maven est attribuÃ© Ã  des personnes
reconnues pour la qualitÃ© de leur contribution Ã  la communautÃ© et pour
leur capacitÃ© Ã  travailler selon un modÃ¨le communautaire. En aucun cas,
une sociÃ©tÃ© ne peut prÃ©tendre possÃ©der Maven ou son Ã©quipe de
dÃ©veloppement (Ã  moins de tous les embaucher). Des dÃ©veloppeurs
open-source qui verraient leur sociÃ©tÃ© prendre une position trop
lucrative ne manqueraient pas d&#8217;aller voir ailleurs, emportant avec eux
la clÃ© d&#8217;accÃ¨s au SVN de Maven. Sauf crise grave sur le marchÃ© de
l&#8217;emploi en informatique, il restera toujours des dÃ©veloppeurs
indÃ©pendants ou raisonnablement liÃ©s Ã  leur sociÃ©tÃ© pour faire de Maven
un projet libre.</p>
</li>
<li>
<p>Dans le pire des cas, rien n&#8217;interdit un autre groupe de
dÃ©veloppeurs, libres ou liÃ©s par une sociÃ©tÃ© concurrente, de repartir du
code existant et de crÃ©er un nouveau projet dÃ©rivÃ© de Maven, comme IBM
l&#8217;a fait avec IBM HTTP Server en partant de Apache HTTPd. Cette
situation extrÃªme a dÃ©jÃ  Ã©tÃ© rencontrÃ©e dans le monde open-source et est
qualifiÃ©e de fork. Il s&#8217;agit cependant d&#8217;une situation rare, une sorte
de solution de la derniÃ¨re chance lorsque des conflits internes ne
peuvent Ãªtre rÃ©glÃ©s Ã  l&#8217;amiable, mais ce nâest pas une porte de sortie
thÃ©orique : elle a dÃ©jÃ  Ã©tÃ© employÃ©e Ã  de nombreuses reprises. Cela
reste une sÃ©curitÃ© non nÃ©gligeable que tout projet open-source offre :
si le dÃ©veloppement commence Ã  prendre une voie qui dÃ©plaÃ®t Ã  une partie
de l&#8217;Ã©quipe, ils peuvent faire le choix de mettre en pratique leurs
propres idÃ©es, certes avec des effets nÃ©fastes sur l&#8217;image du projet,
mais dÃ©montrant ainsi la force du modÃ¨le libre. Jenkins est nÃ© de cette
faÃ§on, comme LibreOffice ou ChiliProject â¦</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_14">Conclusion</h3>
<div class="paragraph">
<p>Le comitÃ© nous remercie et s&#8217;apprÃªte Ã  dÃ©libÃ©rer. Nous n&#8217;aurons sa
conclusion qu&#8217;aprÃ¨s quelques jours (ce sont des gens trÃ¨s occupÃ©s) : feu
vert.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/comite-feuvert.png" alt="comite feuvert"></span></p>
</div>
<div class="paragraph">
<p>Maven ne rÃ©pond pas Ã  toutes les exigences sans quelques efforts, et il
ne sait pas non plus faire le cafÃ©. Son utilisation nÃ©cessite un
apprentissage, peut dÃ©raper vers un grand n&#8217;importe quoi si on n&#8217;y fait
pas attention et nÃ©cessite une prise de conscience de son
fonctionnement. Si vous lisez ces lignes, vous en Ãªtes probablement dÃ©jÃ 
convaincu.</p>
</div>
<div class="paragraph">
<p>Maven est aussi un projet vivant, toujours ouvert Ã  de nouvelles idÃ©es,
mÃªme si elles nâaboutissent pas en quelques semaines. Un outil utilisÃ©
par des milliers de projets ne se modifie pas Ã  la lÃ©gÃ¨re. L&#8217;avenir de
Maven est encore flou, toute prÃ©diction de la disponibilitÃ© des
prochaines Ã©volutions Ã©tant totalement alÃ©atoire, cependant il n&#8217;est pas
prÃ¨s de s&#8217;arrÃªter en si bon chemin. La communautÃ© ne cesse de croÃ®tre,
supportÃ©e par de nouvelles sociÃ©tÃ©s dont il est le cÅur de mÃ©tier. Son
succÃ¨s en entreprise dÃ©montre un rÃ©el besoin d&#8217;homogÃ©nÃ©itÃ© des outils de
dÃ©veloppement, et de ce fait sa logique interne fait mouche. Le modÃ¨le
open-source ne fait plus peur comme il y a quelques annÃ©es, et ceux qui
sont Ã  sa base ne sont plus des idÃ©alistes barbus en sandales<br>
chaussettes mais des professionnels pragmatiques.</p>
</div>
<div class="paragraph">
<p>LÃ  oÃ¹ les outils basÃ©s sur des scripts donnent de la flexibilitÃ©, Maven
oppose une logique de maÃ®trise du processus et de ses Ã©tapes clÃ©s. Le
nombre de lignes nÃ©cessaires pour rÃ©aliser telle tÃ¢che n&#8217;a aucune
importance, ce qui compte c&#8217;est que l&#8217;outil soit cohÃ©rent. La
concurrence commence Ã  suivre Ã©galement cette piste, apportant des idÃ©es
nouvelles qui pourront tout autant profiter Ã  Maven.</p>
</div>
<div class="paragraph">
<p>Nous sommes convaincus que Maven a encore de trÃ¨s beaux jours devant
lui. Maven 3 promet des Ã©volutions importantes qui feront sauter de
nombreux verrous, comme en tÃ©moigne son intÃ©gration dans nos IDE. Quant
Ã  l&#8217;armada de plugins qui gravitent autour, elle ne fait quâaugmenter et
prend une place croissante dans les dÃ©veloppements de nouveaux outils.
Jusqu&#8217;ici, il n&#8217;Ã©tait pas envisageable de proposer un outil sans une
tÃ¢che Ant. Il devient dÃ©licat de ne pas proposer Ã©galement un plugin
Maven, sous peine de crouler sous les rÃ©clamations rÃ©pÃ©tÃ©es des
utilisateurs.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Au_dela_de_Maven">Chapitre 16 : Au delÃ  de Maven</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Maven nous a accompagnÃ© pendant ces 14 chapitres en rÃ©pondant Ã  chaque
fois Ã  nos attentes. Nous avons du parfois faire appel Ã  des plugins
trÃ¨s spÃ©cifiques ou introduire de larges portions de XML, mais rien de
bloquant. Il reste cependant quelques domaines oÃ¹ la place de Maven
reste contestÃ©e.</p>
</div>
<div class="sect2">
<h3 id="_osgi">OSGi</h3>
<div class="paragraph">
<p>OSGi est un monde Ã  lui tout seul. CrÃ©Ã© par le microcosme de
lâinformatique embarquÃ©e, avec des contraintes trÃ¨s spÃ©cifiques, il est
devenu omniprÃ©sent en devenant la base technique de lâIDE Eclipse.
SpringSource a choisi de lâaccompagner en OSGi-fiant son framework et en
lui dÃ©veloppement une plateforme serveur dÃ©diÃ©e.</p>
</div>
<div class="paragraph">
<p>OSGi a la particularitÃ© de prendre en charge la notion de dÃ©pendances,
de versions, les conflits qui vont avec, et lâapprovisionnement de la
plateforme dâexÃ©cution Ã  partir de dÃ©pÃ´ts spÃ©cifiques. DÃ©velopper une
application OSGi, câest dÃ©couvrir un monde trÃ¨s diffÃ©rent de ce que nous
avons vu jusquâici avec Maven, et câest ce que Pascal sâapprÃªte Ã 
affronter.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaPascal.png" alt="MangaPascal"></span></p>
</div>
<div class="paragraph">
<p>Pascal vient de rejoindre notre Ã©quipe, car nous ajoutons une nouvelle
corde Ã  notre arc : le petit projet nâoublie pas la liste des courses a
bien Ã©voluÃ©, et nous sommes maintenant connectÃ©s aux systÃ¨mes
dâinformation des boutiques partenaires qui prÃ©parent les courses de nos
utilisateurs Ã  lâavance (et en profitent pour glisser quelques pubs et
coupons de rÃ©duction bien ciblÃ©s). Toute cette gestion suppose cependant
un outillage riche et nous explorons une nouvelle piste, celle du client
lourd ; Eclipse Rich Client Platform sera donc notre nouveau terrain de
jeu !</p>
</div>
<div class="paragraph">
<p>Eclipse est basÃ© sur la norme OSGi, qui dÃ©finit un socle pour
lâexÃ©cution de composants, la gestion de leur cycle de vie, lâinjection
de leurs dÃ©pendances, lâexposition de service, etc. OSGi a Ã©tÃ© conÃ§u
avec comme objectif de redÃ©ployer Ã  chaud des modules (Â« bundle Â» dans
le vocabulaire OSGi) en prenant en charge la reconfiguration de la
plateforme et sans nÃ©cessiter de redÃ©marrage. Le cahier des charges est
ambitieux, mais a fait ses preuves depuis plus de 10 ans. Eclipse est
construit sur cette base technique, et ses nombreux plugins peuvent
ainsi se combiner pour enrichir toujours plus lâenvironnement.</p>
</div>
<div class="paragraph">
<p>Mais Eclipse ce nâest pas quâun IDE, câest avant tout une plateforme
dâexÃ©cution et un moteur graphique, ce qui permet de dÃ©velopper des
application de gestion ou de modÃ©lisation sur un socle reconnu et avec
un outillage consÃ©quent. Pascal, trÃ¨s Ã  lâaise dans cet Ã©cosystÃ¨me,
vient de Â« subir Â» notre formation interne Ã  Maven et sâattaque donc Ã 
appliquer nos principes et notre outil Ã  son environnement. Il part
confiant, car de nombreux points que nous avons abordÃ©s lui sont
familiers : dÃ©claration des dÃ©pendances, identification des versions,
gestion de conflits, packagingâ¦ toutes ces notions quâOSGi propose lui
aussi.</p>
</div>
<div class="sect3">
<h4 id="_pom_damour">POM dâamour</h4>
<div class="paragraph">
<p>Pascal tente dans un premier temps de monter un projet Maven tout neuf,
pour construire la structure nÃ©cessaire Ã  un bundle OSGi, quâil puisse
ensuite intÃ©grer avec son environnement de dÃ©veloppement habituel. Cette
approche Â« POM-first Â» lâoblige Ã  trouver un Ã©quivalent en termes
dâoutillage Maven pour gÃ©rer plugins, fragments, features, update-sites,
et toutes ces subtilitÃ©s qui font la particularitÃ© du dÃ©veloppement
Eclipse RCP.</p>
</div>
<div class="paragraph">
<p>OSGi utilise Ã©galement le fichier MANIFEST, rappelez-vous, celui que
nous avons rencontrÃ© au chapitre 2 et qui permet Ã  un JAR dâindiquer des
mÃ©tadonnÃ©es sur son contenu, comme sa version. OSGi enrichit ce fichier
pour ajouter les informations dâidentification du bundle, de version, de
dÃ©pendances entre bundles, de services exposÃ©s ou consommÃ©s. Une partie
de ces informations est redondante avec ce que nous dÃ©clarons
habituellement dans le POM. Ici aussi, il va falloir trouver lâoutillage
pour transcrire les dÃ©clarations du POM Maven dans le format attendu par
OSGi.</p>
</div>
<div class="paragraph">
<p>Les recherches de Pascal pour identifier les plugins Maven adÃ©quats
lâamÃ¨nent au projet Apache Felix (une implÃ©mentation dâOSGi) et Ã  son
plugin apache-felix-maven-bundle-plugin-bnd. Celui-ci incorpore lâoutil
bnd <sup class="footnote">[<a id="_footnoteref_63" class="footnote" href="#_footnotedef_63" title="View footnote.">63</a>]</sup>, qui gÃ©nÃ¨re le MANIFEST OSGi Ã  partir dâun projet
Java standard, en dÃ©clarant simplement les packages privÃ©s et exportÃ©s.
Ce plugin nous propose donc de transcrire le MANIFEST OSGi dans le
formalisme XML du POM, comme le montre le listing 16.1.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Il existe un autre outil dÃ©veloppÃ© sur le mÃªme principe par
SpringSource, bundlor
(<a href="http://www.springsource.org/bundlor">http://www.springsource.org/bundlor</a>).
Si vous voulez suivre cette piste, jetez y un Åil car lâÃ©quipe de Spring
sâen est servi avec succÃ¨s pour convertir en bundles une large gamme de
projets, dans le cadre du projet Spring Dynamic Modules.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listing 16.1 gÃ©nÃ©ration du MANIFEST OSGi depuis Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;
    &lt;artifactId&gt;maven-bundle-plugin&lt;/artifactId&gt;
    &lt;version&gt;&lt;/version&gt;
    &lt;extensions&gt;true&lt;/extensions&gt;
    &lt;configuration&gt;
      &lt;instructions&gt;
        &lt;Export-Package&gt;fr.noubliepaslalistedescourses.api&lt;/Export-Package&gt;
        &lt;Private-Package&gt;fr.noubliepaslalistedescourses.*&lt;/Private-Package&gt;
        &lt;Bundle-Activator&gt;fr.noubliepaslalistedecourses.Activator&lt;/Bundle-Activator&gt;
      &lt;/instructions&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ce plugin permet de convertir assez facilement un projet Java classique
en bundle OSGi, par contre Pascal rencontre encore quelques
difficultÃ©s :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dâune part, son application Eclipse RCP nâutilise pas uniquement
des bundles, mais les concepts propres Ã  Eclipse que sont les features,
update-site et products. Lâoutillage est donc encore incomplet</p>
</li>
<li>
<p>Dâautre part, Pascal est habituÃ© au trÃ¨s bon outillage dâEclipse
pour gÃ©rer finement le MANIFEST, et devoir reporter toutes ces infos
dans le pom.xml sous peine de voir Maven Ã©craser sauvagement sa
configuration ne lui plait quâÃ  moitiÃ©.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_retour_au_pde">Retour au PDE</h4>
<div class="paragraph">
<p>Pas vraiment satisfait, Pascal tente une seconde approche. Il part donc
de son environnement de dÃ©veloppement classique pour dÃ©velopper un
plugin, Eclipse PDE (Platform Development Envionment) et tente dây
ajouter nos bibliothÃ¨ques shoppinglist. Un Bundle OSGi a deux options
pour intÃ©grer une dÃ©pendance :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Faire rÃ©fÃ©rence Ã  un autre bundle, en supposant donc que la
bibliothÃ¨que cible soit prÃ©vue pour une intÃ©gration OSGi, ce qui nâest
pas notre cas</p>
</li>
<li>
<p>Contenir directement le JAR de la bibliothÃ¨que</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La figure 16-01 montre par exemple le bundle Apache Ant, disponible par
dÃ©faut avec votre installation dâEclipse. Ce plugin incorpore lâoutil
Ant et ses dÃ©pendances dans son rÃ©pertoire /lib. Pour Ãªtre en mesure de
construire un bundle, Pascal va donc devoir configurer Maven pour
reproduire cette structure, Ã  lâaide du plugin maven-dependency-plugin
et de sa tÃ¢che copy-dependencies.</p>
</div>
<div class="paragraph">
<p>Figure 16-01
<span class="image"><img src="illustrations/16-01.png" alt="16 01"></span></p>
</div>
<div class="paragraph">
<p>Le bundle Apache Ant dans une distribution eclipse</p>
</div>
<div class="paragraph">
<p>Eclipse dispose dâun outillage complet pour le packaging des bundles,
quâil va falloir intÃ©grer dans notre build Maven. Comme nous lâavons
fait de nombreuses fois dÃ©jÃ , nous partons en quÃªte du plugin adÃ©quat et
â bingo â trouvons rapidement le plugin
pde-maven-plugin <sup class="footnote">[<a id="_footnoteref_64" class="footnote" href="#_footnotedef_64" title="View footnote.">64</a>]</sup> du projet Mojo. Ce plugin lance
Eclipse en mode Â« headless Â» (sans interface graphique) et exÃ©cute la
chaÃ®ne dâassemblage du bundle.</p>
</div>
<div class="paragraph">
<p>AprÃ¨s de longues, trop longues heures de mise au point, Pascal arrive
enfin Ã  construire son bundle avec Maven. Tout cela lui semble tout de
mÃªme bien compliquÃ© pour un rÃ©sultat sans grande plus-value.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tant_pis_pour_maven">Tant pis pour Maven !</h4>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaPascal.png" alt="MangaPascal"></span></p>
</div>
<div class="paragraph">
<p>La semaine suivante, Pascal prend part Ã  notre stand-up hebdomadaire
pour nous exposer ses progrÃ¨s. Il lÃ¢che le morceau : la solution quâil a
retenu, câest de ne pas utiliser Mavenâ¦ Indignation, hurlements, la
cacophonie qui sâen suit ne permet pas Ã  Pascal de terminer sa phrase.
Cependant, le calme quâil affiche semble montrer quâil ne craint pas
pour sa pÃ©riode dâessai et a donc quelque chose Ã  ajouter. Nous
finissons donc pas lâÃ©couter. Son argumentaire est le suivant :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven comme OSGi gÃ¨rent la rÃ©solution de dÃ©pendances. Celui dâOSGi
est cependant trÃ¨s spÃ©cifique (Pascal hÃ©site Ã  dire Â« meilleur Â» mais ne
veut pas en rajouter pour le moment) et apporte des fonctionnalitÃ©s
propres aux besoins du dÃ©veloppement Eclipse RCP qui nâont pas
dâÃ©quivalent avec Maven.</p>
</li>
<li>
<p>Tout lâoutillage de dÃ©veloppement Eclipse PDE est basÃ© sur
lâÃ©dition du fichier MANIFEST. MÃªme en dÃ©veloppant notre propre plugin
Maven, passer par le POM pour gÃ©rer ces informations ferait perdre
sensiblement en productivitÃ©.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Admettons, et alors ? Pascal nous montre alors le fichier POM quâil a
utilisÃ© pour construire le prototype de notre client lourd, prÃ©sentÃ© au
listing 16.2.</p>
</div>
<div class="listingblock">
<div class="title">Listing 16.2 : POM suffisant pour construire nos composants Eclipse PDE avec Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;project&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.geegol.shopinglist&lt;/groupId&gt;
        &lt;artifactId&gt;rcp-parent&lt;/artifactId&gt;
        &lt;version&gt;1&lt;/version&gt;
    &lt;/parent&gt;
    &lt;artifactId&gt;com.geegol.shopinglist.rcp-ui&lt;/artifactId&gt;
    &lt;packaging&gt;eclipse-plugin&lt;/packaging&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Non, ne cherchez pas, il ne manque pas une page Ã  ce livre, câest bien
tout ce quâil suffit dans le POM pour gÃ©rer ce plugin Eclipse. Le secret
de Pascal, câest quâil nâutilise pas le mÃªme Maven que nous : il utilise
Sonatype Tycho.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tycho">Tycho</h4>
<div class="paragraph">
<p>Maven 3</p>
</div>
<div class="paragraph">
<p>Tycho est un des nombreux projets satellite de Maven, sur lequel
Sonatype a Ã©normÃ©ment investit. LâidÃ©e de Tycho est de couper la poire
en deux : laisser Maven faire ce quâil sait bien faire, et laisser
Eclipse PDE gÃ©rer les aspects dâOSGi pour lequel il est imbattable.
Cette hybridation est rendue possible par le socle technique Maven 3,
qui isole beaucoup mieux que son prÃ©dÃ©cesseur chaque composant de Maven
et permet donc de les remplacer par une version alternative. Tycho
abandonne donc la gestion de dÃ©pendance traditionnelle de Maven pour
utiliser celle dâOSGi. Les dÃ©pendances ne sont donc plus dÃ©clarÃ©es dans
le POM mais dans le MANIFEST OGSi.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Tycho ne fonctionne donc que avec Maven 3. Le lourd travail de refonte
technique entre Maven 2 et Maven 3 montre ici ses fruits : la souplesse
de la plateforme technique de Maven 3 lui permet de sâadapter Ã  des
environnements trÃ¨s spÃ©cifiques et de sâenrichir de fonctionnalitÃ©s
puissantes.</p>
</div>
<div class="paragraph">
<p>Si vous Ãªtes contraint dâutiliser Maven 2, par exemple pou respecter des
recommandations corporate (je vous laisse libre de juger de la
pertinence de ce type de rÃ¨gles, mais vous devinez ce que jâen pense),
les approches prÃ©sentÃ©es aux paragraphes ci-dessus restent valides.
Cependant, vous trouverez bien peu de documentation, et nâattendez pas
un grand support sur les plugins associÃ©s.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Pascal a un peu trichÃ© dans sa dÃ©monstration, car il a en rÃ©alitÃ© placÃ©
la configuration nÃ©cessaire dans le projet parent â petit cachotier va.</p>
</div>
<div class="paragraph">
<p>Dâune part, le composant principal de Tycho, tycho-maven-plugin, qui se
charge dâÃ©tendre et de reconfigurer Maven pour utiliser les mÃ©canismes
OSGi lÃ  oÃ¹ ils sont plus judicieux que le build Maven standard :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.sonatype.tycho&lt;/groupId&gt;
    &lt;artifactId&gt;tycho-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;0.9.0&lt;/version&gt;
    &lt;extensions&gt;true&lt;/extensions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cette simple dÃ©claration, dÃ©clarÃ©e comme extension, ajoute Ã  Maven la
gestion des cycles de vie eclipse-plugin, eclipse-feature et
eclipse-repository. Câest globalement le mÃªme principe que nous avait
montrÃ© FranÃ§ois au chapitre 3 pour intÃ©grer un dÃ©veloppement Flex. Entre
autres complÃ©ments au build que ce plugin incorpore, la gestion de
dÃ©pendance est enrichie dâun nouveau format de dÃ©pÃ´t, en plus du default
et du legacy (dÃ©pÃ´ts maven1, obsolÃ¨tes et plus supportÃ©s par Maven 3),
le format p2. Câest ce qui permet Ã  Pascal de rÃ©fÃ©rencer les bundles
dâEclipse Indigo, sur lequel est basÃ© son client Eclipse RCP.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;repositories&gt;
       &lt;repository&gt;
        &lt;id&gt;gallileo&lt;/id&gt;
        &lt;layout&gt;p2&lt;/layout&gt;
        &lt;url&gt;http://download.eclipse.org/releases/indigo&lt;/url&gt;
&lt;/repository&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Equinox P2 est le mÃ©canisme dâapprovisionnement de la plateforme OSGi
Equinox quâutilise Eclipse RCP, introduit avec la version 3.4 dâEclipse
Â« Ganymede Â». P2 gÃ¨re de multiples dÃ©pÃ´ts distants, la sÃ©lection de
miroirs, le tÃ©lÃ©chargement en parallÃ¨le, la validation et gestion de
conflits de versions, â¦ autrement dit, câest un concurrent farouche pour
la rÃ©solution de dÃ©pendances de Maven !</p>
</div>
<div class="paragraph">
<p><a href="http://wiki.eclipse.org/Equinox_p2" class="bare">http://wiki.eclipse.org/Equinox_p2</a></p>
</div>
<div class="paragraph">
<p>P2 permet Ã©galement de gÃ©rer des installations complÃ¨tes, incluant les
exÃ©cutables, et non seulement les bundles OSGi. P2 peut donc Ãªtre
utilisÃ© pour assurer du dÃ©ploiement dâapplication, ce que Sonatype met Ã 
profit dans son offre Â« developer onbard Â» permettant de mettre Ã 
disposition des environnements de dÃ©veloppement prÃªts Ã  fonctionner en
un simple clic.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Autre composant du cocktail, le plugin target-platform-configuration se
charge dâidentifier la plateforme OSGi cible. Dâune certaine faÃ§on, il
sâagit dâun Ã©quivalent du dÃ©pÃ´t local Maven Ã  la sauce OSGi, regroupant
tous les bundles OSGi rÃ©fÃ©rencÃ©s pendant le dÃ©veloppement. Tycho va
ainsi initialiser la plateforme dâexÃ©cution du bundle, et peut pour cela
exploiter le support des dÃ©pÃ´ts P2, ou bien le classique dÃ©pÃ´t Maven, ou
bien les deux, quand on aime on ne compte pas. Câest ce qui permettra
par exemple dâaccÃ©der aux bundles OSGi de Spring qui sont distribuÃ©s
dans un dÃ©pÃ´t Maven.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.sonatype.tycho&lt;/groupId&gt;
    &lt;artifactId&gt;target-platform-configuration&lt;/artifactId&gt;
    &lt;version&gt;0.9.0&lt;/version&gt;
    &lt;configuration&gt;
        &lt;resolver&gt;p2&lt;/resolver&gt;
        &lt;pomDependencies&gt;consider&lt;/pomDependencies&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tycho identifie la version et la constitution de la plateforme
OSGi/Eclipse sur la base des fichiers MANIFEST et feature.xml prÃ©sents
dans le projet de plugin. A partir de cela, il constitue le classpath et
la configuration nÃ©cessaires Ã  lâexÃ©cution de lâoutillage.</p>
</div>
<div class="paragraph">
<p>Cet outillage est implicitement apportÃ© par le packaging eclipse-plugin
que Pascal a utilisÃ©. Il associe au projet un cycle de vie particulier
qui remplace celui que nous avons jusquâici toujours utilisÃ©, et donc
les plugins habituels du build Maven. La compilation du code java est
par exemple confiÃ©e Ã  un plugin spÃ©cialisÃ©, maven-osgi-compiler-plugin,
qui tient compte des spÃ©cificitÃ©s de la plateforme en termes de
visibilitÃ© des classes dÃ©clarÃ©es dans les bundles. Comme le plugin
maven-compiler-plugin, nous pouvons au besoin le dÃ©clarer explicitement
pour enrichir sa configuration, par exemple activer le support Java 7,
parce que mince, on est plus au moyen Ã¢ge :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
         &lt;groupId&gt;org.sonatype.tycho&lt;/groupId&gt;
         &lt;artifactId&gt;maven-osgi-compiler-plugin&lt;/artifactId&gt;
         &lt;version&gt;0.10.0&lt;/version&gt;
         &lt;configuration&gt;
           &lt;source&gt;7&lt;/source&gt;
           &lt;target&gt;7&lt;/target&gt;
         &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>De la mÃªme faÃ§on, lâexÃ©cution des tests passe par un plugin dÃ©diÃ©
maven-osgi-test-plugin, Eclipse PDE nous imposant de sÃ©parer
physiquement les tests dans un bundle dÃ©diÃ© pour ne pas polluer le
MANIFEST du bundle principal.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaPascal.png" alt="MangaPascal"></span></p>
</div>
<div class="paragraph">
<p>Pascal nous a bluffÃ©, et mÃªme si nous avons encore un peu de mal Ã 
admettre que notre magnifique gestion de dÃ©pendance Maven vient de se
faire moucher, son build Eclipse RCP est propre, simple, fonctionnel, et
lui permet de dÃ©velopper confortablement le client riche que notre
marketing nous rÃ©clame avec insistance. Nous donnons rendez-vous Ã 
Pascal pour le prochain stand-up, et courons emprunter Â« Eclipse -
Principe, patterns et plug-in Â» (chez le mÃªme Ã©diteur) Ã  la
bibliothÃ¨ques technique de Geegol pour une rapide mise Ã  niveau histoire
dâavoir lâair moins bÃªte la semaine prochaine.</p>
</div>
<div class="paragraph">
<p>Quelques semaines plus tard, le travail de Pascal a bien avancÃ©, et il
nous prÃ©sente maintenant son build complet, qui inclue dÃ©sormais la
production complÃ¨te de lâapplication RCP, incluant de nombreux plugins,
bundles et features pour rÃ©pondre au moindre dÃ©sir de nos clients. La
petite nouveautÃ© du jour, câest le packaging de lâapplication pour
chaque environnement cible. Une fois de plus, les plugins apportÃ©s par
tycho permettent de limiter cette tÃ¢che complexe Ã  quelques dÃ©clarations
simples, comme le montre le listing 16.3.</p>
</div>
<div class="listingblock">
<div class="title">Listing 16.3 : Gestion du packaging OSGi avec un plugin Tycho dÃ©diÃ©</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.sonatype.tycho&lt;/groupId&gt;
    &lt;artifactId&gt;maven-osgi-packaging-plugin&lt;/artifactId&gt;
    &lt;version&gt;0.9.0&lt;/version&gt;
    &lt;configuration&gt;
        &lt;packaging&gt;eclipse-repository&lt;/packaging&gt;
        &lt;productConfigurationFile&gt;
            shopinglist.product
        &lt;/productConfigurationFile&gt;
        &lt;environments&gt;
            &lt;environment&gt;
                &lt;os&gt;linux&lt;/os&gt;
                &lt;ws&gt;gtk&lt;/ws&gt;
                &lt;arch&gt;x86&lt;/arch&gt;
            &lt;/environment&gt;
            &lt;environment&gt;
                &lt;os&gt;win32&lt;/os&gt;
                &lt;ws&gt;win32&lt;/ws&gt;
                &lt;arch&gt;x86&lt;/arch&gt;
            &lt;/environment&gt;
        &lt;/environments&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Par lâuniverselle commande <code>mvn install</code>, Pascal est dÃ©sormais en mesure
de produire les versions Linux et Windows de notre client riche. DÃ©fis
relevÃ© avec panache, merci Pascal !</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_java_modules">Java Modules</h3>
<div class="paragraph">
<p>Geegol Shopping List a reÃ§u de la part du public un accueil sans
prÃ©cÃ©dent. BalayÃ© Facebook, oubliÃ© Twitter, tout le monde ne parle plus
que de ShoppingList, Shop comme disent les dâjeuns : Â« Je vais Shopper
le dernier album de Riana Â». Cette notoriÃ©tÃ© nous vaut une invitation
pour prÃ©senter notre infrastructure Ã  Devoxx, la grand-messe annuelle de
la communautÃ© Java, organisÃ©e avec brio sur une semaine complÃ¨te par le
Java User Group Belge. Lors de cette confÃ©rence, nous croisons de grands
noms du monde Java, des Ã©diteurs, des crÃ©ateurs de projets open-source,
et bien sÃ»r des centaines dâanonymes qui viennent sâabreuver de
connaissance.</p>
</div>
<div class="paragraph">
<p>Nous faisons ainsi la connaissance de Mark <sup class="footnote">[<a id="_footnoteref_65" class="footnote" href="#_footnotedef_65" title="View footnote.">65</a>]</sup>, ingÃ©nieur
chez Oracle. Il travaille sur un projet qui vise Ã  modulariser la
plateforme Java, nom de code jigsaw.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaMark.png" alt="MangaMark"></span></p>
</div>
<div class="paragraph">
<p>Depuis des annÃ©es, Java Ã©volue en ajoutant de nouvelles API,
alourdissant toujours plus la plateforme. MalgrÃ© lâamÃ©lioration des
techniques de compression, le runtime Java 6 pÃ¨se 14 MÃ©ga-octets (sans
parler du JDK qui dÃ©passe les 60 Mo). Il en rÃ©sulte que Java est lent Ã 
dÃ©marrer, car il doit charger un volume consÃ©quent de classes, alors que
trÃ¨s peu dâentre elles sont nÃ©cessaires pour la plupart des tÃ¢ches. Un
outil en ligne de commande Java nâa par exemple pas besoin de la couche
graphique Swing !</p>
</div>
<div class="paragraph">
<p>Il en rÃ©sulte Ã©galement que les Ã©lÃ©ments de Java sont de plus en plus
interconnectÃ©s, augmentant sa complexitÃ© et les difficultÃ©s de
maintenance. Partant de ce constat, jigsaw vise Ã  modulariser Java, pour
le rÃ©duire au strict minimum et que chaque contexte dâutilisation puisse
indiquer les briques qui lui sont nÃ©cessaires. Ce projet fait lâobjet
dâune spÃ©cification au sein du Java Community Process, qui standardisera
le mÃ©canisme de modularisation.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaPascal.png" alt="MangaPascal"></span>
<span class="image" style="float: left"><img src="illustrations/MangaArnaud.png" alt="MangaArnaud"></span></p>
</div>
<div class="paragraph">
<p>Pascal, sâÃ©tonne de lâenthousiasme de Mark Ã  incorporer ce Â« nouveau
concept Â» dans la plateforme Java. OSGi propose dÃ©jÃ  cela depuis plus de
10 ans ! Quand Ã  Arnaud, il sâinterroge sur le fameux Â« mÃ©canisme Â» que
la spÃ©cification va normaliser. Modulariser câest bien, mais comment va
faire JigSaw pour identifier les modules et approvisionner
lâenvironnement ? AprÃ¨s tout, câest ce que fait dÃ©jÃ  Maven avec les
bibliothÃ¨ques, P2 avec les bundles, et il semble peut probable que Java
8 incorpore Tycho.</p>
</div>
<div class="sect3">
<h4 id="_jigsaw">Jigsaw</h4>
<div class="paragraph">
<p>Lâobjectif de la JSR 294 est ambitieux, car il amÃ¨ne au sein de la
plateforme un service quâon avait jusquâici confiÃ© Ã  notre outillage.
Dans un premier temps, les travaux ont amenÃ©s Ã  envisager un nouveau
systÃ¨me de packaging, les Java Modules (JSR 294). Les utilisateurs
dâOSGi nâont pas tardÃ© Ã  se faire entendre en moquant cette norme qui
arrivait pÃ©niblement Ã  la cheville de leur outillage dÃ©jÃ  Ã©prouvÃ©. Cette
piste a Ã©tÃ© gelÃ©e, et la JSR 294 a Ã©tÃ© revue pour Ã©largir les
participants et trouver une solution plus consensuelle.</p>
</div>
<div class="paragraph">
<p>Jigsaw vise Ã  faire disparaÃ®tre la notion de chemin des classes
(classpath) au profit dâune approche dÃ©clarative et totalement
automatisÃ©e. Mark nous prÃ©sente un exemple de descripteur de
dÃ©pendance :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>module com.myapp @ 1.0.0 {
    requieres org.foo &gt;= 3.0;
    requieres net.bar @ 1.1;
}</pre>
</div>
</div>
<div class="paragraph">
<p>Ce nâest certes pas un fichier POM, mais Ã  la syntaxe prÃ¨s, Ã§a y
ressemble tout de mÃªme fortement ! Mark nous indique que plusieurs
versions dâun mÃªme module pourront coexister en mÃ©moire, pour rÃ©pondre
aux contraintes de dÃ©pendances dÃ©finies par chaque module. Câest en
effet quelque chose qui est hors de portÃ©e de Maven, mais quâOSGi gÃ¨re
de longue date.</p>
</div>
<div class="paragraph">
<p>Mark nous prÃ©sente aussi le prototype que constitue
jigsaw <sup class="footnote">[<a id="_footnoteref_66" class="footnote" href="#_footnotedef_66" title="View footnote.">66</a>]</sup>, et la commande jmod destinÃ©e Ã  rejoindre le
JDK. Mimant les outils de gestion de paquet quâon trouve sur les
systÃ¨mes Linux (rpm, deb) ou encore les environnements Ruby (gem), jmod
permet dâinstaller un composant et ses dÃ©pendances :</p>
</div>
<div class="paragraph">
<p>jmod install org.openjdk.aggregator-1.0.jar</p>
</div>
<div class="paragraph">
<p>Hum, voilÃ  qui nous laisse bien perplexes, en particulier Olivier qui se
permet de citer jpkg, lâoutil GNU/Linux qui permet de crÃ©er des paquets
systÃ¨me Ã  partir dâune bibliothÃ¨que Java. Bien quâimbattable sur le
terrain technique, nous ne voyons pas bien oÃ¹ Mark tente de nous emmener
avec son projet.</p>
</div>
</div>
<div class="sect3">
<h4 id="a_quoi_ca_sert">A quoi Ã§a sert ?</h4>
<div class="paragraph">
<p>LâidÃ©e de la modularisation est sÃ©duisante. Nous avons en effet
largement prÃ©sentÃ© lâintÃ©rÃªt de la gestion de dÃ©pendances, oÃ¹ chaque
bibliothÃ¨que de haut niveau indique les composants plus fondamentaux qui
sont nÃ©cessaires Ã  son fonctionnement.</p>
</div>
<div class="paragraph">
<p>Si on regarde le fonctionnement de Java, de nombreuses API sont
prÃ©sentes de longue date, et bien que dÃ©prÃ©ciÃ©es elles ne peuvent
disparaÃ®tre avec la version suivante de Java, car Java nous assure la
compatibilitÃ© ascendante : notre runtime Java 7 est en mesure dâexÃ©cuter
du code de 1999 Ã©crit en Java 1.1, comme ce fameux projet retrouvÃ© sur
une disquette au dÃ©but de ce livre.</p>
</div>
<div class="paragraph">
<p>En tant quâutilisateur de Maven, nous pouvons dire que notre code
utilise Spring 3 ou plus. Nous nâavons pas Ã  nous soucier de
compatibilitÃ© avec des versions prÃ©cÃ©dentes de Spring, car toute
application qui fait rÃ©fÃ©rence Ã  notre POM devra implicitement utiliser
au moins Spring 3, point barre.</p>
</div>
<div class="paragraph">
<p>La modularisation permet ainsi dâallÃ©ger chaque partie du runtime Java
en Ã©liminant un lourd hÃ©ritage, et Ã  chaque application de cibler
prÃ©cisÃ©ment quels Ã©lÃ©ments de Java elle exploite. La maintenance et
lâÃ©volution de Java en seraient grandement facilitÃ©es, au mÃªme titre que
les performances de notre application qui embarquerait moins de code
inutile.</p>
</div>
<div class="paragraph">
<p>JigSaw ne rÃ©pond pas au besoin de Monsieur tout-le-mode, mais Ã  celui
trÃ¨s spÃ©cifique des mainteneurs de Java. Avec 8 versions de la
plateforme empilÃ©es, la prochaine release de la plateforme va encore
ajouter de la complexitÃ©, il est donc largement temps de trouver une
solution pour faire le mÃ©nage. Les outils de modularisation que sont
OSGi ou Maven se basent dÃ©jÃ  sur Java. Pourtant il nâest, par exemple,
pas possible de les utiliser pour dÃ©solidariser lâinterface
java.util.List de ses implÃ©mentations concurrentes dÃ©diÃ©es Ã  la
programmation parallÃ¨le.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaMark.png" alt="MangaMark"></span></p>
</div>
<div class="paragraph">
<p>Mark a lâhabitude de trouver un accueil un peu frais Ã  ses explications,
et a donc gardÃ© pour la fin les Ã©lÃ©ments qui vont peut Ãªtre nous faire
comprendre lâintÃ©rÃªt de la modularisation au sein mÃªme de la plateforme
Java.</p>
</div>
<div class="paragraph">
<p>Dâune part, la vÃ©rification des dÃ©pendances se fait au runtime, et non Ã 
la compilation. Plus de NoClassDefFoundException parce quâil manque un
JAR dans votre application web ! Sur ce terrain, Maven ne peut pas grand
chose pour nous, Ã  part espÃ©rer que les mÃ©tadonnÃ©es quâil exploite
soient correctes.</p>
</div>
<div class="paragraph">
<p>Le format de fichier .class va dâailleurs Ã©voluer. La notion dâarchive
JAR nâÃ©tant pas adaptÃ©e Ã  la modularisation, câest directement le format
des classes qui va permettre la modularisation et lâaccÃ©lÃ©ration du
chargement du code Java compilÃ©. Câest Ã©galement le choix fait par
Google pour la plateforme AndroÃ¯d, afin de ne pas surconsommer les
ressources des appareils mobiles.</p>
</div>
<div class="paragraph">
<p>Le contexte dâexÃ©cution Ã©tant plus prÃ©dictible que dans le cas du
classpath, oÃ¹ lâemplacement physique dâune classe ne peut Ãªtre connu Ã 
lâavance, la rÃ©solution statique va pouvoir Ãªtre utilisÃ©e et
significativement amÃ©liorer les performances. Câest dÃ©jÃ  ce qui a Ã©tÃ©
employÃ© dans le cadre de Java Card pour amÃ©liorer les performances dans
un environnement trÃ¨s limitÃ© en resources.</p>
</div>
<div class="paragraph">
<p>La vÃ©rification des classes, Ã©tape que nous ne voyons pas, mais qui
consiste pour la JVM Ã  valider la cohÃ©rence de chaque fichier .class
quâelle charge en mÃ©moire, sera effectuÃ©e Ã  lâinstallation du module,
une fois pour toute. Ici encore, la vitesse de dÃ©marrage de Java pourra
ainsi Ãªtre amÃ©liorÃ©e. CumulÃ©e avec les autres techniques quâil nous a
indiquÃ©, Mark nous annonce un gain sur le temps de chargement pouvant
atteindre 70% !</p>
</div>
<div class="paragraph">
<p>Ensuite, le chargement des modules peut Ãªtre incrÃ©mental. Lâapplication
peut donc Ãªtre disponible Ã  son utilisateur en un temps record et
attendre un peu pour charger la suite de ses composants. Ceci peut
permettre Ã  Java de perdre son image de langage lent, tout juste bon Ã 
dÃ©velopper de complexes applications cÃ´tÃ© serveur.</p>
</div>
<div class="paragraph">
<p>Un module pourra enfin Ãªtre liÃ© Ã  une architecture matÃ©rielle et se
substituer au lancement en fonction de lâenvironnement sur lequel
sâexÃ©cute lâapplication.</p>
</div>
</div>
<div class="sect3">
<h4 id="_quel_avenir">Quel avenir ?</h4>
<div class="paragraph">
<p>MÃªme notre ami Jim se refuse Ã  faire des prÃ©dictions sur ce que donnera
JigSaw confrontÃ© Ã  la rÃ©alitÃ© que sont OSGi et Maven. JigSaw est prÃ©vu
pour sâintÃ©grer dans Java 8, planifiÃ© pour fin 2012 â mais bon, un
projet informatique qui se termine dans les temps, Ã§a ne sâest jamais
vu.  Ami lecteur, si tu lis ces lignes Ã  cette date, envoie nous un
petit message pour nous dire si Mark a tenu sa promesse.</p>
</div>
<div class="paragraph">
<p>Nous sommes tous trÃ¨s dubitatif sur ce que JigSaw va donner sur notre
Ã©cosystÃ¨me et notre outillage. Il faudra dÃ©jÃ  attendre une forte
adoption de Java8, puis la mise Ã  jour des frameworks majeurs que sont
Spring, Hibernate et consorts, avant de pouvoir estimer son impact. Mark
nous rassure avec une derniÃ¨re dÃ©monstration. Utilisant jmod, il ajoute
Ã  son environnement des bibliothÃ¨ques classiques, et pour cela doit
indiquer un dÃ©pÃ´t qui serve de source, comme le montre le listing 16.4.</p>
</div>
<div class="listingblock">
<div class="title">Listing 16.4 : Utilisation de jmod pour provisionner lâenvironnement avec des bibliothÃ¨ques Java</div>
<div class="content">
<pre>$ jmod install fr.noubliepaslalistedecourses-1.0.jar
Cannot resolve jdom @ 1.0
Cannot resolve joda-time @ 1.6
$ jmod add-repo http://repo1.maven.org/maven2[http://repo1.maven.org/maven2]
$ jmod install fr.noubliepaslalistedecourses-1.0.jar
Fetching jdom @ 1.0 â¦. 150KB
Fetching joda-time @ 1.6 â¦. 150KB
http://repo1.maven.org/maven2[http://repo1.maven.org/maven2]</pre>
</div>
</div>
<div class="paragraph">
<p>, voici une
URL que nous connaissons bien, celle du dÃ©pÃ´t Maven central !
Finalement, laissons Ã  JigSaw le temps dâarriver Ã  maturitÃ©. AprÃ¨s tout,
marier Maven Ã  OSGi semblait bien difficile, et finalement Tycho nous a
apportÃ© une solution simple et performante.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_15">Conclusion</h3>
<div class="paragraph">
<p>ConfrontÃ© Ã  des environnements qui ont leur propre outillage, leurs
propres rÃ¨gles, Maven peut montrer ses limites et se heurter Ã  des murs
en apparence infranchissables. LâexpÃ©rience montre cependant que ces
problÃ¨mes se rÃ©solvent progressivement, pas forcÃ©ment de la maniÃ¨re dont
on les avait approchÃ© initialement, et aboutissent Ã  des solutions
opÃ©rationnelles. DÃ©velopper des plugins Eclipse et utiliser Maven nâest
plus aujourdâhui un art de haut vol, mais une rÃ©alitÃ©.</p>
</div>
<div class="paragraph">
<p>Lâimpact de jigSaw sur notre environnement nâest pas facile Ã  anticiper.
Peut Ãªtre verrons-nous apparaÃ®tre un maven-jmod-plugin, ou bien dâici lÃ 
peut Ãªtre que dâautres avancÃ©es auront bouleversÃ© la donne. Une seule
chose est sÃ»re, Maven sera de la partie !</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chapitre_17_nos_recommandations">Chapitre 17 : Nos recommandations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>L&#8217;activitÃ© de noubliepaslalistedescourses ne cessant de croÃ®tre, nous
augmentons rÃ©guliÃ¨rement la taille des Ã©quipes chargÃ©es des
dÃ©veloppements, de la maintenance de notre application et de ses dÃ©rivÃ©s
(voir le Chapitre 14). Avec une dizaine de nouvelles recrues lors du
dernier trimestre, il devient nÃ©cessaire d&#8217;organiser et d&#8217;accÃ©lÃ©rer le
passage de connaissances. C&#8217;est Nicolas qui prend dÃ©sormais en charge
l&#8217;accueil des nouveaux et organise rÃ©guliÃ¨rement des formations pour que
les Ã©quipes aient un niveau minimal homogÃ¨ne. La partie des formations
rÃ©servÃ©e Ã  Maven se veut minimaliste mais efficace. Le but n&#8217;est pas de
faire de toute l&#8217;Ã©quipe des experts capables de dÃ©velopper des plugins,
des nouveaux packagings ou encore de dÃ©boguer au besoin l&#8217;outil. Ce que
nous souhaitons, c&#8217;est que tous soient Ã  l&#8217;aise avec son fonctionnement
et qu&#8217;ils suivent nos recommandations afin d&#8217;Ã©viter les Ã©cueils que nous
avons dÃ©jÃ  pu rencontrer.</p>
</div>
<div class="sect2">
<h3 id="_les_bonnes_bases">Les bonnes bases</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaNicolas.png" alt="MangaNicolas"></span></p>
</div>
<div class="paragraph">
<p>Bienvenue pour cette session de formation Maven 101 â essentials.
L&#8217;objectif de cette formation n&#8217;est pas de vous transformer en gurus de
Maven, connaissant la moindre de ses ficelles. HonnÃªtement, Ã§a ne vous
apporterait pas grand-chose. Ce que nous voulons, c&#8217;est faire de vous
des dÃ©veloppeurs efficaces, Ã  l&#8217;aise avec cet outil que vous allez
utiliser au quotidien. Nous voulons surtout vous empÃªcher de partir sur
de mauvaises pistes et de finir, dans quelque temps, par regretter
d&#8217;avoir choisi Maven. Au contraire, nous allons vous donner les clÃ©s
pour en faire un alliÃ© de poids dans vos dÃ©veloppements et dans
l&#8217;industrialisation de votre travail d&#8217;ingÃ©nierie.</p>
</div>
<div class="paragraph">
<p>D&#8217;aprÃ¨s nous, le meilleur moyen pour vous Ã©viter Ã  l&#8217;avenir de mettre le
pied sur une peau de banane, c&#8217;est de vous les montrer tout de suite. La
plupart des formateurs montrent de beaux exemples bien ficelÃ©s qui
collent parfaitement Ã  la technologie dont ils vantent les mÃ©rites. Si
c&#8217;est ce que vous cherchez, jetez un Åil Ã  notre application blanche,
c&#8217;est un chef-d&#8217;Åuvre du genre. Nous allons ici faire un tour des
embÃ»ches que nous avons rencontrÃ©es en utilisant Maven sur de nombreux
projets.</p>
</div>
<div class="paragraph">
<p>Voici donc les 10 commandements de l&#8217;utilisateur de Maven.</p>
</div>
<div class="sect3">
<h4 id="_commandement_no_1_les_conventions_de_maven_tu_suivras">Commandement n<sup>o</sup> 1 : Les conventions de Maven tu suivras.</h4>
<div class="paragraph">
<p>Maven propose ses propres conventions mais ne les impose pas. Un projet
que nous avons fait migrer sous Maven utilisait comme rÃ©pertoire de
sources le chemin src/java et pour les tests test/java. Les POM ont donc
Ã©tÃ© adaptÃ©s pour coller Ã  cette convention.</p>
</div>
<div class="paragraph">
<p>Nous avons perdu un temps prÃ©cieux Ã  reconfigurer de nombreux plugins,
qui ont la mauvaise idÃ©e d&#8217;utiliser le chemin src/main/java en dur et
pas la variable ${build.sourceDirectory}. Notre POM ne gagne pas en
lisibilitÃ©, et c&#8217;est cher payÃ© pour un petit caprice esthÃ©tique.</p>
</div>
<div class="paragraph">
<p>De la mÃªme faÃ§on, ne considÃ©rez jamais les conventions comme acquises.
Utiliser le chemin /target/classes pour indiquer le rÃ©pertoire de
compilation du projet, c&#8217;est potentiellement s&#8217;exposer Ã  un
dysfonctionnement. Nous en avons fait la mauvaise expÃ©rience en
configurant notre application pour utiliser Sonar (voir le Chapitre 12).
La convention pour ce chemin est portÃ©e par la variable
${project.build.outputDirectory}. C&#8217;est un peu plus long Ã  Ã©crire, mais
c&#8217;est une garantie d&#8217;homogÃ©nÃ©itÃ© des mÃ©tadonnÃ©es du projet.</p>
</div>
<div class="paragraph">
<p>Le respect des conventions permet :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>de simplifier de l&#8217;utilisation de Maven ;</p>
</li>
<li>
<p>de simplifier l&#8217;intÃ©gration de nouveaux dÃ©veloppeurs ;</p>
</li>
<li>
<p>d&#8217;Ã©viter de tomber dans des problÃ¨mes ou des bogues qui font
perdre un temps prÃ©cieux.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="commandement_no_2_simplicite_tu_choisiras">Commandement n<sup>o</sup> 2 : SimplicitÃ© tu choisiras.</h4>
<div class="paragraph">
<p>Notre premier mauvais Ã©lÃ¨ve est un projet que nous avons voulu faire
migrer dâAnt vers Maven. Les technologies en Åuvre avaient toutes le
plugin Maven adÃ©quat, mais la structure initiale du projet Ã©tait
particuliÃ¨rement hÃ©tÃ©roclite. Notre erreur a Ã©tÃ© de vouloir la conserver
telle quelle, ce qui imposait :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>plusieurs Ã©tapes de compilation entre divers rÃ©pertoires de
sources interdÃ©pendants ;</p>
</li>
<li>
<p>plusieurs phases d&#8217;instrumentation du code ;</p>
</li>
<li>
<p>une exÃ©cution sÃ©parÃ©e pour le calcul du taux de couverture des
tests ;</p>
</li>
<li>
<p>un assemblage de multiples sous-versions du mÃªme projet, incluant
diverses options et le code optionnel associÃ©.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Inutile de dire que la migration vers Maven a Ã©tÃ© laborieuse et pas du
tout convaincante, tant que nous n&#8217;avons pas pris la dÃ©cision de revoir
fondamentalement la structure du projet : des modules simples, ciblÃ©s
sur une technologie ou sur un domaine fonctionnel prÃ©cis, et rÃ©pondant Ã 
une logique de construction standard.</p>
</div>
<div class="paragraph">
<p>Il existe quelques projets qui refusent d&#8217;utiliser Maven, sous prÃ©texte
qu&#8217;ils nÃ©cessitent d&#8217;innombrables lignes XML pour obtenir le rÃ©sultat
attendu, lorsque c&#8217;est possible. Spring 2 en est un exemple, le
framework Ã©tant toujours construit avec le bon vieux Ant. Ce n&#8217;est
pourtant pas une fatalitÃ©, et cela a Ã©tÃ© dÃ©montrÃ© dans Better Builds
With Maven (disponible librement en ligne), qui propose un POM
permettant de construire Spring sans acrobaties particuliÃ¨res.</p>
</div>
<div class="paragraph">
<p>Les dÃ©veloppeurs de Spring sont-ils tordus ? Non ! Par contre, ils ont
fait des choix qui vont Ã  contresens des prÃ©conisations de Maven. Par
exemple, Spring est disponible Ã  la fois comme un unique JAR et comme un
ensemble de sous-bibliothÃ¨ques spÃ©cialisÃ©es. Ensuite, le cÅur de
Spring 2 est compatible Ã  la fois Java 1.3 et Java 5, ce qui nÃ©cessite
une double compilation puis le regroupement du rÃ©sultat dans une unique
archive JAR.</p>
</div>
<div class="paragraph">
<p>Bien que Spring ait rÃ©coltÃ© un grand succÃ¨s pour ses qualitÃ©s
techniques, les structures de son code source et de son script de
compilation le rendent inutilement complexe. AprÃ¨s tout, si vous
travaillez sur Java 5, vous pouvez trÃ¨s bien dÃ©clarer une dÃ©pendance
vers spring:2.0.8:tiger <sup class="footnote">[<a id="_footnoteref_67" class="footnote" href="#_footnotedef_67" title="View footnote.">67</a>]</sup> Ã  la place de spring:2.0.8.
Les dÃ©pendances transitives feront le reste.</p>
</div>
<div class="paragraph">
<p>La morale de cette histoire, c&#8217;est qu&#8217;il ne faut pas chercher Ã  plier
Maven Ã  des besoins complexes mais plutÃ´t essayer de comprendre comment
traiter nos besoins selon la philosophie de Maven. Autant Ant permet de
faire Ã  peu prÃ¨s tout et n&#8217;importe quoi, autant Maven suppose qu&#8217;on
adhÃ¨re Ã  sa logique pour en tirer tout le bÃ©nÃ©fice.</p>
</div>
<div class="paragraph">
<p>Des projets comme Alfresco ou Liferay ne s&#8217;accommodent pas facilement de
Maven. Il faut prendre le temps d&#8217;analyser les besoins et d&#8217;organiser au
mieux le projet pour Ãªtre efficace.</p>
</div>
</div>
<div class="sect3">
<h4 id="commandement_no_3_au_fur_et_a_mesure_de_tes_besion_les_outils_necessaires_tu_mettras_en_place">Commandement n<sup>o</sup> 3 : Au fur et Ã  mesure de tes besoins, les outils</h4>
<div class="paragraph">
<p>nÃ©cessaires tu mettras en place.</p>
</div>
<div class="paragraph">
<p>La plÃ©thore de plugins d&#8217;analyse de code disponibles nous encourage Ã 
mettre en place un suivi qualitÃ© de haut niveau. Il est si simple de
lancer l&#8217;un de ces nombreux outils pour analyser le code et identifier
des problÃ¨mes automatiquement â il est juste dommage qu&#8217;il ne les
corrige pas aussi automatiquement !</p>
</div>
<div class="paragraph">
<p>Nous avons ainsi pris un projet rÃ©cemment adaptÃ© Ã  Maven et produit
quelques mÃ©gaoctets de rapports variÃ©s. Mais que faire de ces pages et
des indicateurs en tout genre que nous obtenons ? Comment traiter des
rÃ¨gles parfois incompatibles ou, en tout cas, dont nous ne voyons pas
forcÃ©ment l&#8217;intÃ©rÃªt ?</p>
</div>
<div class="paragraph">
<p>Si nous utilisons les rÃ¨gles par dÃ©faut de Checkstyle, Ã©tablies sur les
recommandations de codage SUN â qui datent des dÃ©buts de Java â,
celui-ci nous insultera pour chaque mÃ©thode qui ne dispose pas de
commentaire Javadoc. Issue d&#8217;une Ã©poque rÃ©volue, cette rÃ¨gle part du
principe que tout code public doit Ãªtre accompagnÃ© d&#8217;un commentaire
explicatif. Elle va nous amener Ã  Ã©crire ce genre de chose :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
 * affecte le prenom
 * @param prenom le nouveau prenom
 */
public void setPrenom( String prenom ) { ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>VoilÃ  un magnifique commentaire dont l&#8217;utilitÃ© est sans appel ! Soit
vous gÃ©nÃ©rez l&#8217;ensemble des commentaires pour satisfaire Checkstyle,
soit vous dÃ©finissez une rÃ¨gle qui prÃ©conise la forme plutÃ´t que la
pertinence du commentaire ou la clartÃ© du nom de la mÃ©thode !
SincÃ¨rement, tout dÃ©veloppeur prÃ©fÃ©rera, mÃªme sans commentaire Javadoc,
une mÃ©thode nommÃ©e :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">resilierContrat( long idContrat ) throws ImpayesEnCoursException</code></pre>
</div>
</div>
<div class="paragraph">
<p>PlutÃ´t qu&#8217;une mÃ©thode Ã©quivalente utilisant un vocabulaire obscur, mais
largement accompagnÃ©e de commentaires et qui satisfait nos outils
d&#8217;analyse :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
 * RÃ©siliation du contrat
 * @param l l'identifiant de contrat
 * ...
 */
resCtr( long l ) throws ResErrorException</code></pre>
</div>
</div>
<div class="paragraph">
<p>Choisir des rÃ¨gles de dÃ©veloppement est une tÃ¢che qui nÃ©cessite une
culture et un historique de mise en Åuvre du langage. La tendance est
aux noms de mÃ©thodes et de variables clairs, explicites, quitte Ã  faire
long â les Ã©crans 16:9 ont probablement aidÃ© Ã  cette Ã©volution. Fini le
code sur 80 colonnes ou l&#8217;utilisation des tabulations !</p>
</div>
<div class="paragraph">
<p>Utiliser l&#8217;outillage que Maven met Ã  notre disposition n&#8217;est pas une fin
en soi. Ce doit Ãªtre l&#8217;aboutissement d&#8217;une dÃ©marche qui dÃ©finit les
rÃ¨gles que nous voulons vÃ©rifier ou les outils que nous voulons mettre
en Åuvre. Introduits sur le projet un par un, ces outils seront bien
perÃ§us et leur plus-value reconnue. ImposÃ©s tout d&#8217;un coup sans
explication, ils seront vÃ©cus comme une contrainte inutile et
deviendront vite inutilisÃ©s, voire contre-productifs.</p>
</div>
<div class="paragraph">
<p>De la mÃªme faÃ§on, installer un serveur d&#8217;intÃ©gration continue n&#8217;a de
sens que pour des Ã©quipes dÃ©jÃ  familiarisÃ©es avec l&#8217;outillage de tests
automatisÃ©s et la pratique du dÃ©veloppement dirigÃ© par les tests, et
sensibilisÃ©es au surcoÃ»t d&#8217;un projet dont le code est instable.</p>
</div>
<div class="paragraph">
<p>Inutile donc de barder notre POM de plugins en tout genre et de
dÃ©clarations sans fin, juste parce que le format du fichier le permet.
Si personne ne les exploite ou ne sait comment en tirer parti, ce sera
du temps perdu, un travail contre-productif. Maven n&#8217;est qu&#8217;un moyen qui
nous aide Ã  mettre en Åuvre les bonnes pratiques actuelles du
dÃ©veloppement de logiciels. Il n&#8217;est en aucun cas une solution magique.
Il permet de mettre en place diffÃ©rentes stratÃ©gies de tests (unitaires,
d&#8217;intÃ©grationâ¦) mais il ne le fera jamais Ã  la place de nos Ã©quipes.
Elles seules peuvent s&#8217;assurer que les bonnes pratiques sont suivies.</p>
</div>
</div>
<div class="sect3">
<h4 id="_commandement_no_4_de_la_sur_conception_point_tu_ne_feras">Commandement n<sup>o</sup> 4 : De la sur-conception point tu ne feras.</h4>
<div class="paragraph">
<p>L&#8217;application maxiMaousse <sup class="footnote">[<a id="_footnoteref_68" class="footnote" href="#_footnotedef_68" title="View footnote.">68</a>]</sup>, elle aussi basÃ©e sur Maven,
comprend 58 modules ! Elle suit une dÃ©composition en couches techniques
ainsi qu&#8217;un redÃ©coupage en modules fonctionnels. Une modification
fonctionnelle touche ainsi rarement plus d&#8217;un ou deux modules, rÃ©duisant
â thÃ©oriquement â le travail de non-rÃ©gression.</p>
</div>
<div class="paragraph">
<p>En pratique, cette application est ingÃ©rable dans notre IDE en raison de
l&#8217;avalanche de modules. Les Ã©volutions touchent rarement un seul module,
et les interdÃ©pendances sont nombreuses. La construction du projet sur
un poste de dÃ©veloppement incluant les tests unitaires et de qualitÃ©
devient un vrai cauchemar, elle est surtout contre-productive et
l&#8217;identification du code un vrai casse-tÃªte. Certains modules ne
comptent que quelques classes ! Ici, on a visiblement confondu la notion
de package et de module Maven.</p>
</div>
<div class="paragraph">
<p>La gestion multimodule de Maven est puissante, ce n&#8217;est pas une raison
pour l&#8217;appliquer juste parce qu&#8217;elle existe. Nous ne crÃ©ons un nouveau
module que lorsqu&#8217;un nouveau besoin apparaÃ®t. Cela arrive dÃ©jÃ 
suffisamment assez vite : par exemple, pour rÃ©pondre Ã  une contrainte
technique ou pour diffÃ©rencier deux modules qui travaillent sur des
technologies diffÃ©rentes et dont nous voulons clairement scinder la
gestion. Si la dÃ©composition en modules fins peut avoir du sens pour une
bibliothÃ¨que utilitaire, elle apporte rarement de la simplicitÃ© sur une
application. Au mieux, on pourra dÃ©couper celle-ci en fonction de ses
couches techniques afin de permettre Ã  des Ã©quipes de compÃ©tences
diffÃ©rentes d&#8217;intervenir de maniÃ¨re plus isolÃ©e. Cependant, les modules
resteront fortement dÃ©pendants ; aussi, pourquoi ne pas simplement
utiliser des packages dÃ©diÃ©s dans le mÃªme projet ?</p>
</div>
<div class="paragraph">
<p>Le seul cas pratique oÃ¹ la dÃ©composition en modules peut apporter une
certaine plus-value concerne la gÃ©nÃ©ration de code. Lorsqu&#8217;un projet est
basÃ© sur de nombreux services web, l&#8217;analyse des WSDL et la gÃ©nÃ©ration
de code prennent du temps, mÃªme pour constater que le code gÃ©nÃ©rÃ© est Ã 
jour. Pour ne pas pÃ©naliser les dÃ©veloppeurs sur leur poste, isoler ce
code dans un sous-module peut Ãªtre une bonne idÃ©e. AprÃ¨s tout, on ne
change pas de WSDL tous les matins !</p>
</div>
<div class="paragraph">
<p>Bref, les occasions de justifier le dÃ©coupage d&#8217;un module en plusieurs
modules sont nombreuses. Alors, n&#8217;en faites pas plus que nÃ©cessaire.
Vous testerez le rÃ©acteur de Maven bien assez tÃ´t.</p>
</div>
</div>
<div class="sect3">
<h4 id="commandement_no_5_tes_outils_et_ton_build_a_jour_tu_maintiendras">Commandement n<sup>o</sup> 5 : Tes outils et ton build Ã  jour tu maintiendras.</h4>
<div class="paragraph">
<p>MÃªme si mettre en place l&#8217;outillage de dÃ©veloppement n&#8217;est pas une fin
en soi, c&#8217;est un mal nÃ©cessaire, au coÃ»t non nÃ©gligeable, permettant
dâoffrir Ã  l&#8217;Ã©quipe un environnement aussi agrÃ©able que possible et
optimisÃ© pour travailler. De trÃ¨s nombreux outils peuvent y figurer :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven, le programme en tant que tel mais aussi tous les plugins
qu&#8217;il utilise ;</p>
</li>
<li>
<p>le gestionnaire de versions de sources (Subversion, Gitâ¦) ;</p>
</li>
<li>
<p>le gestionnaire de tÃ¢ches et de bogues (Jira, Mantisâ¦) ;</p>
</li>
<li>
<p>le repo (nexus, artifactory, archiva) ;</p>
</li>
<li>
<p>le serveur d&#8217;intÃ©gration continue (Hudson, Continuum, Bambooâ¦) ;</p>
</li>
<li>
<p>les outils de tests (Selenium, Fitnesseâ¦) ;</p>
</li>
<li>
<p>l&#8217;environnement de dÃ©veloppement intÃ©grÃ© (Eclipse, NetBeans,
Intellijâ¦) ;</p>
</li>
<li>
<p>et bien d&#8217;autres encore.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Il est important que ces outils soient maÃ®trisÃ©s, mais il est encore
plus important qu&#8217;ils soient mis Ã  jour et que leur intÃ©gration soit
poussÃ©e Ã  son maximum. Celle-ci permet, par exemple, <em>via</em> le numÃ©ro du
bogue placÃ© dans le commentaire d&#8217;un commit sur le gestionnaire de
sources, de faire le lien depuis le gestionnaire d&#8217;anomalies pour
afficher les lignes modifiÃ©es par la correction. Ce genre d&#8217;intÃ©gration
fait gagner beaucoup de temps pour la revue des corrections de bogues.
Et les intÃ©grations entre produits sont nombreuses. Celles unifiant tous
les services au sein de l&#8217;IDE sont probablement celles qui amÃ©lioreront
le plus la productivitÃ©.</p>
</div>
<div class="paragraph">
<p>Les mises Ã  jour de chaque outil sont importantes. Prenez l&#8217;exemple de
Maven. Sur un projet multimodule monstrueux provenant tout droit de
l&#8217;Ã¨re jurassique (plus de 150 modules), Maven 2.0.10 mettait prÃ¨s de
huit minutes rien que pour s&#8217;initialiser et gÃ©nÃ©rer l&#8217;ordre de
construction des modules. Avec Maven 2.1.0 et supÃ©rieur, cela prend
moins d&#8217;une minute. MÃªme si ce cas est extrÃªme (mais bien rÃ©el), il est
reprÃ©sentatif des gains que l&#8217;on peut obtenir en faisant l&#8217;effort de
maintenir Ã  jour ses outils.</p>
</div>
<div class="paragraph">
<p>Les projets durent longtemps et les outils Ã©voluent vite. Les maintenir
Ã  jour permet d&#8217;en obtenir le meilleur. Cela entraÃ®ne un coÃ»t rÃ©current
mais qui est finalement vite rentabilisÃ© par les gains de productivitÃ©
de l&#8217;Ã©quipe.</p>
</div>
</div>
<div class="sect3">
<h4 id="commandement_no_6_dans_un_projet_la_meme_version_tous_les_modules_auront">Commandement n<sup>o</sup> 6 : Dans un projet, la mÃªme version tous les modules</h4>
<div class="paragraph">
<p>auront.</p>
</div>
<div class="paragraph">
<p>Sur un projet de messagerie, nous avons dÃ©veloppÃ© une couche complÃ¨te
d&#8217;abstraction autour de l&#8217;envoi/rÃ©ception de messages, indÃ©pendante du
fonctionnel. Nous avons voulu capitaliser dessus et la proposer Ã 
d&#8217;autres projets. Une fois ce code dÃ©placÃ© dans un module, il devenait
exploitable sur une autre application qui profitait ainsi de nos longues
heures de mise au point.</p>
</div>
<div class="paragraph">
<p>La rÃ©utilisation est un rÃªve de tout chef de projet. Seulement,
lorsqu&#8217;une application nous a demandÃ© d&#8217;utiliser ce module, s&#8217;est posÃ©
le problÃ¨me de la gestion de sa version. Notre demandeur ne voulait pas
utiliser un SNAPSHOT ; sa livraison Ã©tant prÃ©vue sous peu, il lui
fallait un code stable. Notre code rÃ©pondait Ã  cette attente, mais Ã©tant
liÃ© Ã  notre application, il partageait son numÃ©ro de version. Nous
pouvions faire une livraison isolÃ©e de ce module, mais alors celui-ci
rÃ©fÃ©renÃ§ait un parent encore en SNAPSHOT !</p>
</div>
<div class="paragraph">
<p>Nous avons donc dÃ» figer notre POM parent dans une version 1, livrer le
fameux module mutualisÃ© en version 1.0.0 et continuer notre application
en version 1.0.0-SNAPSHOT. Ã ce petit jeu, nous nous sommes rapidement
retrouvÃ©s avec des versions dans tous les sens dans les POM des
diffÃ©rents modules et l&#8217;impossibilitÃ© d&#8217;utiliser le processus de
livraison dÃ©taillÃ© au Chapitre 11.</p>
</div>
<div class="paragraph">
<p>La morale de cette histoire, c&#8217;est que les modules d&#8217;un projet devraient
toujours partager la mÃªme version, sans quoi la gestion manuelle des
numÃ©ros de version devient infernale. Le plus simple pour satisfaire ce
besoin est de ne dÃ©finir cette version que dans le POM parent du projet
et dans les rÃ©fÃ©rences &lt;parent&gt;. Toutes les autres rÃ©fÃ©rences se font
<em>via</em> la variable ${project.version}. Ainsi, pas de risque de se
tromper.</p>
</div>
<div class="paragraph">
<p>Pour dÃ©clarer du code comme bibliothÃ¨que commune, nous devons crÃ©er un
nouveau projet Maven indÃ©pendant : POM dÃ©diÃ©, gestion de version dÃ©diÃ©e,
gestionnaire de code dÃ©diÃ©, etc. Une fois notre code utilitaire prÃ©parÃ©
pour Ãªtre rÃ©utilisable ailleurs, sous forme d&#8217;un projet Ã  part entiÃ¨re,
il ne peut plus Ãªtre considÃ©rÃ© comme un Ã©lÃ©ment de notre application,
mÃªme si celle-ci devient un contributeur privilÃ©giÃ© de ce composant
commun.</p>
</div>
</div>
<div class="sect3">
<h4 id="_commandement_no_7_la_gestion_des_versions_tu_centraliseras">Commandement n<sup>o</sup> 7 : La gestion des versions tu centraliseras.</h4>
<div class="paragraph">
<p>Dans un projet basÃ© sur de nombreux modules, un travail vite pÃ©nible
consiste Ã  assurer la cohÃ©rence de versions des dÃ©pendances. Des plugins
peuvent nous aider dans cette tÃ¢che, mais il existe une solution bien
plus simple : le &lt;dependencyManagement&gt;. Cet Ã©lÃ©ment, que nous allons
ajouter dans le POM parent du projet, dÃ©clare pour chaque dÃ©pendance la
version de rÃ©fÃ©rence Ã  utiliser sur le projet. Dans les modules, nous
dÃ©clarons alors les dÃ©pendances sans prÃ©ciser de version, Ã©liminant
ainsi le problÃ¨me.</p>
</div>
<div class="paragraph">
<p>Le &lt;pluginManagement&gt; permet de faire la mÃªme chose pour les plugins
avec, en plus, la possibilitÃ© de dÃ©finir une configuration centralisÃ©e,
mais qui ne sera appliquÃ©e que sur les modules qui utilisent le plugin.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Les plugins dÃ©clarÃ©s pour le reporting ne profitent cependant pas de
cette gestion centralisÃ©e et doivent donc explicitement contenir un
numÃ©ro de version. Il s&#8217;agit en quelque sorte d&#8217;un bogue de conception
de Maven, mais le corriger supposerait de modifier le comportement
gÃ©nÃ©ral de Maven vis-Ã -vis de la gestion des versions. L&#8217;Ã©quipe de
dÃ©veloppement est trÃ¨s rÃ©ticente Ã  changer cette gestion qui peut avoir
de lourds impacts sur les projets existants.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="commandement_no_8_comme_la_peste_les_dependances_optionnelles_tu_eviteras">Commandement n<sup>o</sup> 8 : Comme la peste les dÃ©pendances optionnelles tu</h4>
<div class="paragraph">
<p>Ã©viteras.</p>
</div>
<div class="paragraph">
<p>Nous avons crÃ©Ã© une belle bibliothÃ¨que utilitaire commons-geegol dont
l&#8217;objectif est d&#8217;apporter Ã  tous nos projets des classes utilitaires,
facilitant l&#8217;accÃ¨s Ã  de nombreux outils. Ce code dÃ©pend donc de trÃ¨s
nombreuses dÃ©pendances, mais seule une sous-partie est utile pour un
utilisateur, qui ne va exploiter que quelques classes de notre
bibliothÃ¨que. Nous pouvons :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DÃ©clarer toutes ces dÃ©pendances, auquel cas les utilisateurs vont
nous huer, se plaindre que Maven tÃ©lÃ©charge des centaines de JAR
inutiles et perdre des heures Ã  configurer des &lt;exclusions&gt;.</p>
</li>
<li>
<p>DÃ©clarer ces dÃ©pendances &lt;optional&gt;, ce qui les rend juste
indicatives. Nos utilisateurs ne vont pas nous huer tout de suite, mais
plus tard quand, lors de lâexÃ©cution, ils constateront qu&#8217;une dÃ©pendance
manque.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La philosophie de Maven nous encourage Ã  utiliser un module dÃ©diÃ© pour
chaque technologie ou outil que nous voulons supporter. Si cela veut
dire avoir dix modules, ce n&#8217;est pas un problÃ¨me. La gestion des
dÃ©pendances et de la livraison Ã©tant automatisÃ©e, cela n&#8217;a aucun impact
sur le temps passÃ© par le dÃ©veloppeur sur son travail, la seule chose
qui compte au final. Par contre, nous gagnerons dans la finesse de nos
mÃ©tadonnÃ©es et dans la bonne dÃ©composition de notre code.</p>
</div>
</div>
<div class="sect3">
<h4 id="_commandement_no_9_les_snapshot_tu_utiliseras">Commandement n<sup>o</sup> 9 : Les SNAPSHOT tu utiliseras.</h4>
<div class="paragraph">
<p>Sur un projet comptant plusieurs (dizaines de) modules et de trÃ¨s
nombreuses classes, il peut Ãªtre pÃ©nalisant d&#8217;avoir tout le code
accessible sous forme de projet dans l&#8217;IDE. Nous pouvons, par exemple,
exploiter certains modules sous forme de SNAPSHOT, comme celui contenant
le code gÃ©nÃ©rÃ© de nos schÃ©mas XSD. Le conserver dans notre IDE n&#8217;apporte
rien et pÃ©nalise l&#8217;intÃ©gration Maven qui va devoir sans cesse
reconstruire ce code, ou du moins s&#8217;assurer qu&#8217;il est Ã  jour â perte de
temps que le dÃ©veloppeur ressentira trÃ¨s nettement :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Attendre la compilation moins d&#8217;une seconde c&#8217;est fantastique,
mais rarissime.</p>
</li>
<li>
<p>Attendre cinq Ã  dix secondes, c&#8217;est le temps nÃ©cessaire pour voir
qu&#8217;il se passe quelque chose et se reposer les poignets.</p>
</li>
<li>
<p>Attendre trente secondes que le projet compile, cela incite Ã 
affubler son IDE de noms d&#8217;oiseaux.</p>
</li>
<li>
<p>Attendre plus d&#8217;une minute Ã  chaque construction, c&#8217;est s&#8217;exposer
Ã  une montÃ©e d&#8217;Ã©nervement, souvent accompagnÃ©e d&#8217;une augmentation
alarmante de la consommation de cafÃ©, qui ne suffit pourtant pas Ã 
expliquer le premier phÃ©nomÃ¨ne. Peut-on alors encore parler de
productivitÃ© ?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>En reposant sur les SNAPSHOT pour tous les modules dans lesquels nous ne
faisons aucune modification et qui correspondent Ã  du code Ã©voluant trÃ¨s
peu, nous allÃ©geons d&#8217;autant le travail de l&#8217;IDE. Notre serveur
d&#8217;intÃ©gration continue a le mÃ©rite de ne prendre ni pause ni cafÃ©. Il
peut construire pour nous les SNAPSHOT de nos modules au fur et Ã  mesure
qu&#8217;une construction rÃ©ussie est atteinte.</p>
</div>
</div>
<div class="sect3">
<h4 id="commandement_no_10_l_ide_toujours_tu_privilegieras">Commandement n<sup>o</sup> 10 : L&#8217;IDE toujours tu privilÃ©gieras.</h4>
<div class="paragraph">
<p>Cela fait trÃ¨s expert de scruter la console et de taper Ã  une vitesse
folle des commandes incomprÃ©hensibles. Si vous envisagez un rÃ´le dans
une sÃ©rie amÃ©ricaine, pourquoi pas ? mais si vous voulez travailler
confortablement et former rapidement vos Ã©quipes, cherchez plutÃ´t de
l&#8217;aide du cÃ´tÃ© de votre environnement de dÃ©veloppement.</p>
</div>
<div class="paragraph">
<p>Trop souvent, nous perdons du temps sur les postes de dÃ©veloppement
suite Ã  un comportement bizarre de Maven. Le cas typique se traduit par
un appel Ã  l&#8217;aide du type : "J&#8217;ai beau lancer des <code>mvn clean install</code>,
project clean sous Eclipse, et build all, je n&#8217;arrive pas Ã  dÃ©marrer mon
serveur Tomcat Ã  cause d&#8217;une NoClassDefFoundError."</p>
</div>
<div class="paragraph">
<p>Le but du dÃ©veloppeur n&#8217;est pas de passer son temps <em>devant la</em>
Matrice <sup class="footnote">[<a id="_footnoteref_69" class="footnote" href="#_footnotedef_69" title="View footnote.">69</a>]</sup>, surtout en mode cryptÃ© (de toute faÃ§on,
Ã§a fatigue vite les yeux). Il faut toujours privilÃ©gier la productivitÃ©
de l&#8217;Ã©quipe, sans quoi les belles mÃ©thodes et les outils prÃ©conisÃ©s
seront vite oubliÃ©s dans le feu de l&#8217;action.</p>
</div>
<div class="paragraph">
<p>Nous avons vu au Chapitre 9 que cette intÃ©gration est dÃ©jÃ  trÃ¨s correcte
et progresse mÃªme rapidement sous Eclipse, qui est trop longtemps restÃ©
Ã  la traÃ®ne. Apprenez Ã  bien utiliser le support de Maven dans les IDE
pour fournir Ã  l&#8217;Ã©quipe un outil aussi transparent que possible. Les
versions rÃ©centes de m2eclipse proposent, par exemple, la variable
m2eclipse qui permet de diffÃ©rencier un build classique d&#8217;un build sous
Eclipse. Un bon moyen de rendre l&#8217;IDE plus rÃ©actif est d&#8217;en profiter
pour dÃ©sactiver les Ã©tapes non indispensables de la construction du
projet. Le Listing 16.1 montre l&#8217;activation d&#8217;un profil exclusivement en
dehors de m2eclipse.</p>
</div>
<div class="listingblock">
<div class="title">Listing 16.1 un profil pour Ã©viter les plugins trop consommateurs sous m2eclipse</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;profile&gt;
  &lt;id&gt;not-m2e&lt;/id&gt;
  &lt;activation&gt;
    &lt;property&gt;
      &lt;name&gt;!m2e.version&lt;/name&gt;
    &lt;/property&gt;
  &lt;/activation&gt;
  &lt;build&gt;
  &lt;!-- plugins trop consommateurs lors des builds m2Eclipse --&gt;
  &lt;/build&gt;
&lt;/profile&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Une autre option consiste Ã  exploiter l&#8217;intÃ©gration avancÃ©e sous Eclipse
que permet le mode incrÃ©mental de m2eclipse. Le Listing 16.2 montre une
telle configuration pour associer le plugin adaptÃ© Ã  la phase de recopie
des fichiers de ressources. L&#8217;astuce consiste, lors d&#8217;un build
m2eclipse, Ã  utiliser la version SNAPSHOT du plugin de gestion des
ressources (qui gÃ¨re ce mode incrÃ©mental) et Ã  activer le configurateur
m2eclipse associÃ© aux projets Java.</p>
</div>
<div class="listingblock">
<div class="title">Listing 16.2 un profil pour activer le cycles de vie reconfigurable de m2eclise 0.9.9</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;profile&gt;
      &lt;id&gt;m2e&lt;/id&gt;
      &lt;activation&gt;
        &lt;property&gt;
          &lt;name&gt;m2e.version&lt;/name&gt;
        &lt;/property&gt;
      &lt;/activation&gt;
      &lt;build&gt;
        &lt;plugins&gt;
         &lt;plugin&gt;
           &lt;groupId&gt;org.maven.ide.eclipse&lt;/groupId&gt;
           &lt;artifactId&gt;lifecycle-mapping&lt;/artifactId&gt;
           &lt;version&gt;0.9.9&lt;/version&gt;
           &lt;configuration&gt;
             &lt;mappingId&gt;customizable&lt;/mappingId&gt;
             &lt;configurators&gt;
               &lt;configurator id='org.maven.ide.eclipse.jdt.javaConfigurator'/&gt;
             &lt;/configurators&gt;
             &lt;mojoExecutions&gt;
               &lt;mojoExecution&gt;org.apache.maven.plugins:maven-resources-plugin::&lt;/mojoExecution&gt;
             &lt;/mojoExecutions&gt;
           &lt;/configuration&gt;
         &lt;/plugin&gt;
        &lt;/plugins&gt;
        &lt;pluginManagement&gt;
          &lt;plugins&gt;
           &lt;plugin&gt;
             &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
             &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;
             &lt;version&gt;2.4&lt;/version&gt;
           &lt;/plugin&gt;
          &lt;/plugins&gt;
        &lt;/pluginManagement&gt;
      &lt;/build&gt;
    &lt;/profile&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_16">Conclusion</h3>
<div class="paragraph">
<p>En rÃ©sumÃ©, une rÃ¨gle simple : n&#8217;essayez pas d&#8217;aller contre Maven. Les
conventions ont Ã©tÃ© choisies pour reflÃ©ter les bonnes pratiques et des
rÃ¨gles simples d&#8217;organisation. S&#8217;il suit une logique qui va contre vos
objectifs, c&#8217;est que vous n&#8217;avez pas saisi son mode de fonctionnement.
Soyez critiques sur l&#8217;organisation de votre projet et de votre code.
Pourquoi Maven veut-il vous imposer tel mode de fonctionnement ? Vous
arriverez sans doute Ã  repenser votre structure pour quelque chose de
plus simple, ordonnÃ© de maniÃ¨re homogÃ¨ne, et qui se plie mieux au mode
de pensÃ©e de Maven. Au final, vos projets n&#8217;en seront que plus clairs et
plus comprÃ©hensibles.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Epilogue">Chapitre 18 : Ãpilogue</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le dernier numÃ©ro de Fortune vient de paraÃ®tre. Dans son grand dossier
central, il prÃ©sente le projet Geegol Shopping List dont la rÃ©ussite est
inversement proportionnelle Ã  l&#8217;effort de dÃ©veloppement qui lui a Ã©tÃ©
consacrÃ©. L&#8217;article met en avant les qualitÃ©s hors du commun de l&#8217;Ã©quipe
de dÃ©veloppement, de quoi faire baver tous les directeurs informatique
de la planÃ¨te. Nous ne comptons plus les offres d&#8217;emploi, que nous
recevons par centaines chaque jour, toutes plus appÃ©tissantes les unes
que les autres.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: center"><img src="illustrations/theEnd.png" alt="theEnd"></span></p>
</div>
<div class="paragraph">
<p>Dans la vraie vie, les choses sont souvent moins roses. Les contes de
fÃ©es et les histoires fantastiques sont malheureusement rÃ©servÃ©s Ã  nos
enfants. Pourtant, Maven peut tout de mÃªme nous aider Ã  conduire nos
projets dans de bonnes conditions, mÃªme ceux qui ne sont pas de
merveilleuses prouesses technologiques ou le sujet d&#8217;enjeux
stratÃ©giques.</p>
</div>
<div class="sect2">
<h3 id="Recapitulons">RÃ©capitulons</h3>
<div class="paragraph">
<p>Bien que quelque peu embellie, l&#8217;histoire que nous venons de raconter
est tirÃ©e de situations rÃ©elles, que nous avons tous vÃ©cues Ã  un moment
ou Ã  un autre de nos carriÃ¨res sur divers projets. Dans chaque cas, la
plupart de nos problÃ¨mes Ã©taient liÃ©s Ã  un manque de rigueur dans notre
outillage ou alors Ã  un dÃ©faut de maÃ®trise de ce dernier. Reposant sur
les qualitÃ©s individuelles ou sur les connaissances de quelques
personnes, un projet peut vite tomber dans la tragÃ©die Ã  l&#8217;occasion d&#8217;un
congÃ© (volontaire ou non). Maven est un catalyseur pour structurer les
dÃ©veloppements autour d&#8217;un outil unique et d&#8217;une conception simple et
homogÃ¨ne du projet.</p>
</div>
<div class="paragraph">
<p>Maven ne serait pas ce qu&#8217;il est sans les efforts de toute son Ã©quipe.
La communautÃ© francophone y est largement reprÃ©sentÃ©e avec Arnaud,
Carlos, Emmanuel, Fabrice, HervÃ©, Lukas, Nicolas, Olivier, RaphaÃ«l,
StÃ©phane et les deux Vincent. Tous, Ã  leur niveau et Ã  des moments
diffÃ©rents de leur parcours professionnel, ont mis un doigt dans le
monde open-source et en sont maintenant imprÃ©gnÃ©s. Maven ne serait pas
ce qu&#8217;il est non plus sans Antonio, FranÃ§ois, Guillaume, SÃ©bastien,
JÃ©rÃ´me et les millions d&#8217;autres personnes qui chaque jour l&#8217;utilisent,
participent Ã  son support, dÃ©battent de son avenir, rapportent des
anomalies et proposent des correctifs.</p>
</div>
<div class="paragraph">
<p>Maven est avant tout une trÃ¨s large communautÃ© de dÃ©veloppeurs, son cÅur
ne servant que de centre gravitationnel pour une galaxie entiÃ¨re de
plugins. Certains sont structurÃ©s autour de la communautÃ© <em>via</em> le
projet Mojo, d&#8217;autres vivent leur vie indÃ©pendamment. Tous contribuent Ã 
faire de Maven un outil toujours plus riche.</p>
</div>
<div class="paragraph">
<p>Maven devient peu Ã  peu un outil stratÃ©gique en entreprise en apportant
enfin une homogÃ©nÃ©itÃ© aux dÃ©veloppements. Un dÃ©veloppeur peut passer
d&#8217;un projet Ã  l&#8217;autre, voire d&#8217;une entreprise Ã  l&#8217;autre, sans remettre
fondamentalement en question ses habitudes de travail. L&#8217;expÃ©rience
aidant, les Ã©quipes de dÃ©veloppement apprendront Ã  mieux utiliser les
outils que Maven permet de greffer en quelques lignes de configuration
sur n&#8217;importe quel projet.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sortez_de_lamateurisme">Sortez de l&#8217;amateurisme</h3>
<div class="paragraph">
<p>Certains parlent d&#8217;industrialisation du dÃ©veloppement, d&#8217;autres
simplement de renoncer Ã  des pratiques qui tiennent du pur bricolage.
Anecdote :</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaNicolas.png" alt="MangaNicolas"></span></p>
</div>
<div class="paragraph">
<p>Nicolas, en tant qu&#8217;expert Maven, est consultÃ© pour un projet en tierce
maintenance. La procÃ©dure de compilation est la suivante :</p>
</div>
<div class="paragraph">
<p>"Lancer la commande ant jar. La construction Ã©choue, c&#8217;est normal.
DÃ©marrer Eclipse, attendre un certain temps puis quitter Eclipse. Lancer
alors Ã  nouveau ant jar."</p>
</div>
<div class="paragraph">
<p>Cela semble complÃ¨tement dÃ©lirant, mais c&#8217;est Ã©crit noir sur blanc dans
un document officiel â document qui est parfaitement conforme Ã  toutes
les normes qualitÃ© ISO 9001, AFAQ et compagnie ;).</p>
</div>
<div class="paragraph">
<p>Pour la petite histoire, le projet comprend une classe qui ne compile
pas (elle fait rÃ©fÃ©rence Ã  des classes inconnues). Le compilateur
exÃ©cutÃ© par ant Ã©choue, alors qu&#8217;Eclipse produit tout de mÃªme un fichier
.class (incomplet). Le compilateur ne cherchant pas Ã  recompiler une
classe dÃ©jÃ  compilÃ©e, le deuxiÃ¨me passage de ant produit le rÃ©sultat
dÃ©sirÃ©. Heureusement, cette classe est du code mort non utilisÃ©, mais
tout de mÃªme !</p>
</div>
<div class="paragraph">
<p>Que retenir de ce cas extrÃªme, mais qui vous rappelle peut-Ãªtre des
situations qui ne vous font pas honneur ? Simplement que le processus de
construction du projet est un Ã©lÃ©ment majeur de l&#8217;organisation de votre
travail. Utiliser un mÃ©canisme instable, dÃ©pendant de l&#8217;environnement ou
de manipulations manuelles, c&#8217;est forcÃ©ment s&#8217;exposer Ã  des problÃ¨mes Ã 
un moment ou Ã  un autre, en gÃ©nÃ©ral le vendredi soir juste avant votre
dÃ©part en vacances. Maven ne rÃ©soudra pas tous vos problÃ¨mes, mais il
vous fournit un socle pour bÃ¢tir des solutions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_le_mot_de_la_fin">Le mot de la fin</h3>
<div class="paragraph">
<p>Pour conclure, sachez que le Definitive Guide, ouvrage communautaire
traduit dans de nombreuses langues (la version franÃ§aise est en cours de
rÃ©alisation Ã  l&#8217;heure oÃ¹ nous rÃ©digeons ces lignes), est lui-mÃªme rÃ©digÃ©
puis assemblÃ© <em>via</em> Maven. Pour produire les 500 pages du PDF que vous
pouvez consulter en ligne <sup class="footnote">[<a id="_footnoteref_70" class="footnote" href="#_footnotedef_70" title="View footnote.">70</a>]</sup>, il suffit de lancer la
commande universelle <code>mvn install</code> !</p>
</div>
</div>
<div class="sect2">
<h3 id="_qui_est_qui">Qui est qui ?</h3>
<div class="paragraph">
<p>Vous vous demandez qui sont ces personnages qui peuplent les pages de ce
livre ?</p>
</div>
<div class="sect3">
<h4 id="les_membres_francophones_de_l_equipe_maven">Les membres francophones de l&#8217;Ã©quipe Maven</h4>
<div class="paragraph">
<p>Lorsque nous avons dÃ©cidÃ© de romancer notre ouvrage, nous nous sommes
posÃ© la question de savoir qui seraient les personnages qui allaient
nous entourer dans notre aventure. La rÃ©ponse fut vite trouvÃ©e. Quoi de
mieux que de rendre hommage Ã  notre faÃ§on aux membres francophones de
l&#8217;Ã©quipe de dÃ©veloppement du projet Maven ?</p>
</div>
<div class="paragraph">
<p>Laissons-les se prÃ©senter (par ordre alphabÃ©tique du prÃ©nom, comme Ã§a,
pas de jaloux).</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaCarlos.png" alt="MangaCarlos"></span></p>
</div>
<div class="sect4">
<h5 id="_carlos_sanchez">Carlos Sanchez</h5>
<div class="paragraph">
<p>Carlos Sanchez, espagnol, 31 ans.</p>
</div>
<div class="paragraph">
<p>Je travaille pour MaestroDev aprÃ¨s avoir travaillÃ© chez Mergere /
DevZuz, en donnant des services professionnels au-dessus de
Maven/Continuum/Archiva. J&#8217;ai encore pour nos clients beaucoup de
travail avec ces produits. J&#8217;ai commencÃ© avec le projet Maven en 2004,
en participant au dÃ©veloppement des plugins, du noyau et en gÃ©rant le
repository central. AprÃ¨s, j&#8217;ai contribuÃ© aux autres projets
open-source, Apache Archiva, Continuum et Felix, Spring Security,
Eclipse IAMâ¦ Maintenant, je travaille sur des projets liÃ©s au cloud
computing et DevOps, et en tirant le plus grand avantage de celui-ci
pour le dÃ©veloppement logiciel, les tests et les bonnes pratiques.</p>
</div>
<div class="paragraph">
<p>J&#8217;habite Ã  La Corogne, Espagne oÃ¹ j&#8217;ai Ã©tudiÃ© le franÃ§ais, et je suis
allÃ© en France de nombreuses fois : PyrÃ©nÃ©es, Alpes, Bretagne, Paris.
Mais j&#8217;ai beaucoup oubliÃ© mon franÃ§ais en parlant toujours en anglais
:(.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaEmmanuel.png" alt="MangaEmmanuel"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="_emmanuel_venisse">Emmanuel Venisse</h5>
<div class="paragraph">
<p>Salut,</p>
</div>
<div class="paragraph">
<p>Emmanuel Venisse, 37  ans.</p>
</div>
<div class="paragraph">
<p>Je suis free lance depuis 2005, tout d&#8217;abord pour Mergere/DevZuz avec
nos autres amis de la communautÃ© Maven, mais depuis fin 2007, pour
divers clients avec notamment la mise en place d&#8217;environnement de build
(Maven/Continuum/Archiva) et de l&#8217;architecture logicielle.</p>
</div>
<div class="paragraph">
<p>Je suis committer sur Maven depuis les premiÃ¨res bÃªta en 2002 (merci Ã 
Vincent Massol de m&#8217;avoir prÃ©sentÃ© Maven Ã  cette Ã©poque), mais Ã©galement
Continuum et Archiva. Malheureusement avec de moins en moins de temps
disponible maintenant :-(.</p>
</div>
<div class="paragraph">
<p>Dans le passÃ©, j&#8217;ai travaillÃ© dans la mÃªme SSII que Nicolas, mais Ã 
Paris oÃ¹ j&#8217;avais introduit Ã©galement Maven ;-).</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaFabrice.png" alt="MangaFabrice"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="_fabrice_bellingard">Fabrice Bellingard</h5>
<div class="paragraph">
<p>Hey !</p>
</div>
<div class="paragraph">
<p>Fabrice Bellingard, la trentaine, HyÃ©rois depuis peu&#8230;&#8203; Je suis tombÃ©
dans l&#8217;open-source quand j&#8217;ai bossÃ© chez OTI (maintenant IBM Ottawa Lab)
en 2001, dans l&#8217;Ã©quipe Eclipse Core oÃ¹ j&#8217;ai fait la premiÃ¨re version du
plugin Ant. J&#8217;ai ensuite fait beaucoup "mumuse" en dÃ©veloppant tout
plein de plugins (notamment crÃ©ateur du plugin C# et committer du plugin
Checkstyle), mais pas forcÃ©ment tous utiles ;-).</p>
</div>
<div class="paragraph">
<p>Utilisateur Maven depuis 2003, j&#8217;ai choisi Maven en 2004 pour crÃ©er la
plateforme d&#8217;intÃ©gration d&#8217;un grand groupe franÃ§ais, et je suis
finalement devenu committer en 2005. Puis vint Archiva en 2008
(committer et PMC). Tech lead du projet open-source Squale Ã  partir de
2008, j&#8217;ai dÃ©cidÃ© fin 2010 de continuer toujours plus dans le domaine
OSS et qualitÃ© logicielle en intÃ©grant la sociÃ©tÃ© Sonar Source en tant
que VP Project Manager. Aventure qui m&#8217;emmÃ¨ne bien plus loin que prÃ©vu :
je bosse sur le coeur de Sonar, mais aussi sur les plugins C#, voire&#8230;&#8203;
Cobol ! Si on m&#8217;avait dit un jour que l&#8217;OSS m&#8217;amÃ¨nerait Ã  Cobol&#8230;&#8203; ;-)</p>
</div>
<div class="paragraph">
<p>CÃ´tÃ© personnel : passionnÃ© avant tout par la nature, j&#8217;ai passÃ© les
vingt premiÃ¨res annÃ©es de ma vie Ã  Limoges, c&#8217;est pour dire ;-).
BÃ©nÃ©vole WWF et ambassadeur de l&#8217;ONG PlanÃ¨te Urgence : ma vraie passion,
c&#8217;est la protection de l&#8217;environnement et la solidaritÃ© internationale.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaHerve.png" alt="MangaHerve"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="herve_boutemy">HervÃ© Boutemy</h5>
<div class="paragraph">
<p>HervÃ© Boutemy, j&#8217;ai 39 ans, une femme et une fille, et je vis du cÃ´tÃ© de
La DÃ©fense en rÃ©gion parisienne.</p>
</div>
<div class="paragraph">
<p>Je travaille depuis onze ans dans un grand groupe bancaire franÃ§ais.
J&#8217;ai dÃ©butÃ© par un stage de R&amp;D sur Java (avant la 1.0, des applets sur
Netscape, optimisÃ©es pour un modem 14.4Kâ¦) pour aujourd&#8217;hui outiller de
grands projets stratÃ©giques, avec des Ã©quipes rÃ©parties Ã 
l&#8217;international, des accÃ¨s mainframe, du couplage tÃ©lÃ©phonie
informatique, des progiciels et autres subtilitÃ©s de la rÃ©alitÃ© d&#8217;un SI
bancaire.</p>
</div>
<div class="paragraph">
<p>Si Maven 1 est restÃ© au stade de test sur un projet open-source perso,
j&#8217;ai eu suffisamment confiance en Maven 2 pour vouloir l&#8217;intÃ©grer en
entreprise. Disposant d&#8217;un build Ant existant standardisÃ© et trÃ¨s
diffusÃ©, mon choix s&#8217;est portÃ© sur les Maven Ant Tasks. Elles Ã©taient
plutÃ´t boguÃ©es, et cela a donc Ã©tÃ© l&#8217;occasion de proposer des patchs et
de dÃ©couvrir l&#8217;envers du dÃ©cor : beaucoup de code, beaucoup de gens
intÃ©ressants et pointus. Mais finalement beaucoup d&#8217;endroits aussi oÃ¹ il
reste des choses Ã  faire. Je suis donc devenu committer en 2007 puis
j&#8217;ai Ã©tÃ© intÃ©grÃ© dans le PMC en 2008.</p>
</div>
<div class="paragraph">
<p>AprÃ¨s les Maven Ant Tasks, je me suis concentrÃ© sur la gestion de
l&#8217;encoding (pour ne plus avoir mon prÃ©nom mutilÃ© par Maven), puis
Modello. Un petit passage par Doxia pour aider Vincent S. et Lukas :
l&#8217;expÃ©rience technique s&#8217;accompagne de rencontres humaines des plus
variÃ©es.</p>
</div>
<div class="paragraph">
<p>Ce livre original est un exemple de plus de toute la richesse de la
communautÃ© francophone autour de Maven.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaLukas.png" alt="MangaLukas"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="_lukas_theussl">Lukas Theussl</h5>
<div class="paragraph">
<p>Salut Ã  tous,</p>
</div>
<div class="paragraph">
<p>Je m&#8217;appelle Lukas Theussl, 38 ans, autrichien et depuis pas trÃ¨s
longtemps rÃ©sidant en Autriche Ã  Vienne. J&#8217;ai aussi une petite famille,
une femme et deux enfants.</p>
</div>
<div class="paragraph">
<p>CÃ´tÃ© boulot, je crois que je suis le seul membre non informaticien parmi
tous les committers de Maven et je me suis toujours considÃ©rÃ© comme un
outsider. AprÃ¨s une thÃ¨se en physique thÃ©orique (spÃ©cialitÃ© physique
nuclÃ©aire et particules Ã©lÃ©mentaires), j&#8217;ai passÃ© plusieurs annÃ©es dans
des Ã©quipes de recherche, en France, en Espagne, au Danmark et au
Canada. Actuellement, je ne fais plus la recherche moi-mÃªme, je suis
dans l&#8217;administration de l&#8217;Academie des Sciences Slovaque Ã  Bratislava
et je m&#8217;occupe de la gestion des divers projets de recherche (europÃ©ens
et internationaux).</p>
</div>
<div class="paragraph">
<p>Comment un physicien est arrivÃ© Ã  s&#8217;implanter parmi les dÃ©veloppeurs de
Maven ? Ã l&#8217;Ã©poque, on Ã©crivait un programme d&#8217;application en physique
des particules, et on a dÃ©cidÃ© d&#8217;utiliser Maven qui Ã©tait assez nouveau
Ã  ce moment-lÃ . J&#8217;ai Ã©tÃ© surtout attirÃ© par la possibilitÃ© de gÃ©rer le
programme et la documentation (site web, pdf) en mÃªme temps, mais trÃ¨s
vite les divers bogues m&#8217;ont amenÃ© Ã  corriger Maven lui-mÃªme et Ã 
soumettre ces patchs, quâArnaud avait la volontÃ© d&#8217;appliquer. Le reste,
c&#8217;est l&#8217;histoireâ¦ J&#8217;ai ensuite aidÃ© Arnaud Ã  enterrer Maven 1.1, et
maintenant je participe surtout au sous-projet Doxia et particuliÃ¨rement
Ã  la version du plugin pdf pour Maven 2.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaOlivier.png" alt="MangaOlivier"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="_olivier_lamy">Olivier Lamy</h5>
<div class="paragraph">
<p>Bonjour,</p>
</div>
<div class="paragraph">
<p>Olivier Lamy, bientÃ´t 38 ans (une femme et trois enfants).</p>
</div>
<div class="paragraph">
<p>Amateur de bons plats et de bons vins :-). Je suis employÃ© par Talend
(depuis le 1er AoÃ»t) dans l&#8217;Apache Team. J&#8217;ai introduit Maven (en
version 0.7 bÃªta pour ce que je me souviens) fin 2002 dans mon ancien
emploi (groupe hÃ´telier Accor).</p>
</div>
<div class="paragraph">
<p>Au dÃ©but, dans les projets dont j&#8217;avais la charge mais aprÃ¨s je fus en
quelque sorte "support" Maven dans le groupe. J&#8217;ai commencÃ© par
Continuum (Ã  l&#8217;Ã©poque oÃ¹ c&#8217;Ã©tait un sous-projet de Maven) et un jour
Emmanuel en a eu marre de committer mes patchs et m&#8217;a donc proposÃ© de
rejoindre l&#8217;Ã©quipe.</p>
</div>
<div class="paragraph">
<p>Maintenant, je me consacre :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>aux plugins Maven (un peu au core pour la 3.x notamment la rÃ©Ã©criture
du site plugin)</p>
</li>
<li>
<p>intÃ©gration de Maven dans le serveur d&#8217;intÃ©gration continue Jenkins.</p>
</li>
<li>
<p>et puis d&#8217;autres trucs :-) (Maven scm, divers mojo chez codehaus)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaRaphael.png" alt="MangaRaphael"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="raphael_pieroni">RaphaÃ«l PiÃ©roni</h5>
<div class="paragraph">
<p>J&#8217;ai 37 ans. J&#8217;ai commencÃ© Ã  utiliser Maven 1 en 2002 ou 2003 (je ne me
souviens plus), et pour Maven 2 depuis sa bÃªta 1.</p>
</div>
<div class="paragraph">
<p>VoilÃ . Je suis trÃ¨s pÃ©nible pour la typographie bien que je fasse un bon
tas de fautes d&#8217;orthographe.</p>
</div>
<div class="paragraph">
<p>Je dispose Ã  la maison du Lexique des rÃ¨gles typographiques en usage Ã 
l&#8217;Imprimerie nationale â 3<sup>e</sup> Ã©dition. Nicolas, je peux te le prÃªter en
cas de besoin ;).</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaStephane.png" alt="MangaStephane"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="stephane_nicoll">StÃ©phane Nicoll</h5>
<div class="paragraph">
<p>J&#8217;ai 33 ans depuis peu, je vis dans une rÃ©gion magnifique Ã  l&#8217;est de la
Belgique.</p>
</div>
<div class="paragraph">
<p>Je travaille comme expert technique chez un grand Ã©diteur de progiciels
financiers, oÃ¹ je suis responsable de l&#8217;Ã©volution des frameworks et de
l&#8217;infrastructure logicielle. Je m&#8217;intÃ©resse aussi fortement aux
techniques et outils de dÃ©veloppement, ainsi qu&#8217;Ã  la qualitÃ© logicielle</p>
</div>
<div class="paragraph">
<p>Mon premier contact avec Maven date de 2003, j&#8217;ai commencÃ© Ã  contribuer
au dÃ©veloppement de Maven 1 en travaillant sur les plugins liÃ©s aux
dÃ©livrables J2EE. Je fais partie du Project Management Commitee de Maven
depuis 2006, je m&#8217;occupe toujours des plugins de packaging, mais
Ã©galement des aspects de flexibilitÃ© et de configurabilitÃ© d&#8217;un projet.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaVincentM.png" alt="MangaVincentM"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="_vincent_massol">Vincent Massol</h5>
<div class="paragraph">
<p>Bon puisqu&#8217;on dit notre Ã¢ge je me lanceâ¦ 40 ans :) [le premier qui dit
papy se prend une baffe], amateur de tondeuse robot (choupette va fÃªter
ses 5 ans), boit maintenant de d&#8217;alcool (et oui tout chose arrive !),
vit Ã  la campagne et travaille depuis la maison, du cÃ´tÃ© de Chantilly
avec femme et trois enfantsâ¦</p>
</div>
<div class="paragraph">
<p>Onze ans d&#8217;open-source dÃ©jÃ  : Maven, Cactus, Cargo, MockObjects, XWiki
et autres.</p>
</div>
<div class="paragraph">
<p>CÃ´tÃ© Maven, j&#8217;ai rejoint le projet vers 2001-2002 alors qu&#8217;il n&#8217;existait
que sous la forme d&#8217;un sous-projet de build du projet Jakarta Turbine.
D&#8217;abord en tant qu&#8217;utilisateur (j&#8217;en avais marre de maintenir des
dizaines de fichiers Ant de mille lignes de long chacun !), puis en tant
que committer plus tard afin de rendre l&#8217;utilisation de Maven plus
solide et dâajouter des fonctionnalitÃ©s manquantes, notamment au travers
du dÃ©veloppement de plugins (plus de dÃ©tails sur <a href="http://massol.net" class="bare">http://massol.net</a>).
Plus tard, j&#8217;ai participÃ© aux longues discussions de design sur Maven2â¦</p>
</div>
<div class="paragraph">
<p>J&#8217;ai (co-)Ã©crit trois livres dont deux sur Maven : <em>JUnit in Action</em>,
aux Ã©ditions Manning, <em>Better Builds with Maven</em> publiÃ© par l&#8217;ex-Mergere
(maintenant Exist) et <em>Maven : A Developer&#8217;s Notebook</em>, publiÃ© par
O&#8217;Reilly.</p>
</div>
<div class="paragraph">
<p>Depuis 2007, j&#8217;ai dÃ©crochÃ© du projet Maven (plus le temps) car je me
suis donnÃ© corps et Ã¢me Ã  un nouveau projet open-source:
XWiki <sup class="footnote">[<a id="_footnoteref_71" class="footnote" href="#_footnotedef_71" title="View footnote.">71</a>]</sup> un wiki d&#8217;entreprise de deuxiÃ¨me gÃ©nÃ©ration
(voire troisiÃ¨me ;)). J&#8217;y bosse la nuit (classique), mais aussi le jour
(moins classique) puisque je suis directeur technique de la sociÃ©tÃ©
XWiki SAS qui offre des services, du support et du dÃ©veloppement
spÃ©cifique au-dessus du projet open-source XWiki.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaVincentS.png" alt="MangaVincentS"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="_vincent_siveton">Vincent Siveton</h5>
<div class="paragraph">
<p>J&#8217;avais passÃ© le cap de l&#8217;Ã¢ge du Christ au dÃ©but de l&#8217;aventure de la
premiÃ¨re Ã©dition de ce livre, soit 21 en hexadÃ©cimal ; d&#8217;accord, c&#8217;est
trÃ¨s geek, mais avouez que Ã§a rajeunit :). Pour la deuxiÃ¨me Ã©dition jâai
arrÃ©tÃ© de compter.</p>
</div>
<div class="paragraph">
<p>FranÃ§ais d&#8217;origine, je vis actuellement Ã  MontrÃ©al au Canada avec une
fabuleuse femme. Sans enfant au dÃ©but de la rÃ©daction du premier opus,
je me suis retrouvÃ© pÃ¨re d&#8217;un petit garÃ§on (le plus beau, bien sÃ»r !) Ã 
sa sortie. Aujourdâhui il a 20 moisâ¦ et câest toujours le plus beau !</p>
</div>
<div class="paragraph">
<p>Avec presque dix ans d&#8217;expÃ©rience en entreprise, je travaille
actuellement dans un centre de recherche et ma mission se rÃ©sume Ã  aider
les entreprises dans les mÃ©thodologies agiles, la gestion de projet,
l&#8217;assurance qualitÃ©, les nouvelles technologies et, bien sÃ»r,
l&#8217;open-source.</p>
</div>
<div class="paragraph">
<p>Concernant Maven, j&#8217;ai commencÃ© Ã  utiliser la version 1 vers le milieu
2003, lors d&#8217;un mandat dans une entreprise de bioinformatique, aprÃ¨s une
implÃ©mentation fastidieuse de la fourmi. Ensuite, parcours classique
chez ASF : patchs acceptÃ©s (merci Arnaud !), committer, PMC (merci
Brett !), utilisation de Maven dans d&#8217;autres projets d&#8217;ASF (PMC
Shindig), etc. Mon intÃ©rÃªt pour Maven se situe principalement dans la
gÃ©nÃ©ration de documentation (Doxia avec Lukas !) et les plugins de
reporting et de QA.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="les_membres_de_la_communaute_Java">Les membres de la communautÃ© Java</h4>
<div class="paragraph">
<p>Pour complÃ©ter notre fine Ã©quipe par quelques profils moins
"Maven-addicted", nous avons invitÃ© quelques-unes de nos connaissances
de la communautÃ© Java francophone.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaAntonio.png" alt="MangaAntonio"></span></p>
</div>
<div class="sect4">
<h5 id="_antonio_goncalves">Antonio Goncalves</h5>
<div class="paragraph">
<p>J&#8217;ai le mÃªme Ã¢ge que Vincent M. mais tout le monde me donne l&#8217;Ã¢ge de
Fabrice. Le secret de cette fontaine de jouvence ? Maven ! Eh oui,
chaque <code>mvn install</code> vous fait gagner du temps, donc, plus je compile avec
Maven, plus je rajeunis. Vous avez lu le <em>Portrait de Dorian Gray</em> ? Eh
bien, lisez un de mes livres, voire les deux (<em>Java EE 5</em>, aux Ã©ditions
Eyrolles, et <em>Java EE 6</em> chez Apress) et vous paraÃ®trez plus jeune. Il y
a aussi ma fille de six ans qui adore Mavenâ¦ en effet, puisque je gagne
du temps avec Maven, eh bien j&#8217;en passe plus Ã  jouer avec elle. Vous
voyez, Maven, on l&#8217;aime de 7 (6 pour ma fille) Ã  77 ans (si vous
connaissez quelqu&#8217;un qui a 77 ans, proposez-lui de dÃ©couvrir Maven, il
en sera rÃ©joui).</p>
</div>
<div class="paragraph">
<p>Consultant indÃ©pendant et Java Champion, je suis tantÃ´t architecte ou
dÃ©veloppeur, chez mes clients (de la startup Ã  la grande entreprise).
Non, non, je ne suis pas chef de projet. J&#8217;ai dÃ©couvert Java en 1998,
puis J2EE en 1999 lorsque je travaillais pour BEA Systems, et j&#8217;ai
continuÃ© dans la lancÃ©e de l&#8217;Enterprise Edition (ou Java EE) jusqu&#8217;Ã 
intÃ©grer le JCP en travaillant sur la spÃ©cification Java EE 6 et
aujourdâhui Java EE 7. AprÃ¨s avoir travaillÃ© partout dans le monde
(enfin, trois ou quatre pays), je suis revenu Ã  Paris
(<em>intra-muros</em>,__bien sÃ»r), oÃ¹ j&#8217;ai commencÃ© Ã  enseigner au Cnam puis
crÃ©Ã© le Paris Java User Group. J&#8217;ai Ã©crit plusieurs articles, deux
livres (je l&#8217;ai dÃ©jÃ  dit, mais c&#8217;est pour que vous vous souveniez de les
acheter), je parle pas mal aux confÃ©rences (je parle beaucoup de maniÃ¨re
gÃ©nÃ©rale) et j&#8217;adore Maven (Ã§a, c&#8217;est pour Nicolas et Arnaud). Je fais
aussi partie de la bande des Cast Codeurs. Quoi ? Vous ne connaissez pas
les Cast Codeurs ? Eh bien, retrouvez tout cela sur mon site personnel
pour de plus amples informations : <a href="http://www.antoniogoncalves.org" class="bare">http://www.antoniogoncalves.org</a>.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaFrancois.png" alt="MangaFrancois"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="francois_le_droff">FranÃ§ois Le Droff</h5>
<div class="paragraph">
<p>Brestois d&#8217;origine, parisien d&#8217;adoption, j&#8217;ai connu le Minitel mais je
suis plus jeune que Vincent M., j&#8217;ai commencÃ© Ã  jouer/coder sur le HP 85
de Papa dans les annÃ©es 80. Depuis 2007, je suis ingÃ©nieur logiciel chez
Adobe, aprÃ¨s neuf ans d&#8217;expÃ©rience dans le dÃ©veloppement d&#8217;application
Java/JavaEE chez Schlumberger puis AtosOrigin Open Source Competence
Center.</p>
</div>
<div class="paragraph">
<p>Si, depuis plusieurs annÃ©es, j&#8217;utilise Maven sur la plupart de mes
projets (y compris mes projets hybrides, Flex et Java), c&#8217;est Ã  cause de
Vincent M., dâArnaud et des autres contributeurs que j&#8217;ai eu la chance
de rencontrer (Ã  JavaPolis, Ã  l&#8217;OSSGTP, au ParisJUG, ou Ã  un comptoir) :
leur enthousiasme et leur passion sont en effet contagieuxâ¦</p>
</div>
<div class="paragraph">
<p>PS : je suis Ã©galement l&#8217;auteur d&#8217;un blog technique autour des
technologies Java et Flex (<a href="http://www.droff.com" class="bare">http://www.droff.com</a>).</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaGregory.png" alt="MangaGregory"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="gregory_boissinot">GrÃ©gory Boissinot</h5>
<div class="paragraph">
<p>Jâai 30 ans et je travaille depuis 3 ans chez Zenika en tant que
consultant et formateur sur les technologies Java/JEE. SpÃ©cialiste du
build, je suis aussi en charge du pÃ´le IntÃ©gration continue et
jâinterviens chez de nombreux clients pour la mise en place en place de
lâintÃ©gration continue. De plus, jâoccupe une grande partie de mon temps
professionnel et personnel Ã  contribuer au serveur dâintÃ©gration
continue Jenkins.</p>
</div>
<div class="paragraph">
<p>Concernant les outils de build, jâai dÃ©butÃ© avec Ant dans les annÃ©es
2000 et mon aventure Maven en 2005 comme utilisateur de Maven 1. En
2006, jâai mis en place Maven 2 pour lâensemble des projets au sein
dâune grande banque FranÃ§aise. CouplÃ© Ã  Continuum, cela convenait Ã 
lâÃ©poque parfaitement aux diffÃ©rents besoins.</p>
</div>
<div class="paragraph">
<p>Mais câest en 2008 avec mon nouveau client industriel quâil a Ã©tÃ© mis en
lumiÃ¨re toutes les limitations de Maven et lâimpossibilitÃ© de mettre en
place avec Maven une solution simple pour des besoins trÃ¨s spÃ©cifiques
et complexes. Jâai alors trÃ¨s vite investi sur le nouveau nÃ© des outils
de build, le systÃ¨me Gradle. Il procure puissance, souplesse de mise en
place, performance et conserve des scripts faciles Ã  maintenir.</p>
</div>
<div class="paragraph">
<p>Au fil du temps, de plus en plus convaincu par les concepts, je suis
devenu  Ã©vangÃ©liste de Gradle en France, Ã  travers lâÃ©criture dâarticles
et lâanimation de confÃ©rences. Cependant, je reste trÃ¨s actif dans la
communautÃ© Maven en rÃ©alisant de nombreuses missions de conseil et des
formations sur cet outil et son Ã©cosystÃ¨me.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaGuillaume.png" alt="MangaGuillaume"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="_guillaume_laforge">Guillaume Laforge</h5>
<div class="paragraph">
<p>Au dernier compte, j&#8217;en arrivais Ã  34 ans, dÃ©jÃ .</p>
</div>
<div class="paragraph">
<p>Je fais de l&#8217;open-source depuis 2003, en travaillant puis en dirigeant
le projet Groovy, le langage dynamique pour la JVM le plus populaire
actuellement auprÃ¨s des dÃ©veloppeurs Java, et Ã©galement en lanÃ§ant le
framework web Grails.</p>
</div>
<div class="paragraph">
<p>AprÃ¨s quelques annÃ©es chez des Ã©diteurs logiciels et des sociÃ©tÃ©s de
services, je me suis lancÃ©, j&#8217;ai crÃ©Ã© ma boÃ®te, G2One, autour des
technologies Groovy et Grails, qui a ensuite Ã©tÃ© rachetÃ©e par
SpringSource, et ce dernier par VMWare â un bel exemple de chaÃ®ne
alimentaire ou des poupÃ©es russes !</p>
</div>
<div class="paragraph">
<p>J&#8217;ai beaucoup souffert avec Maven 1, mais je n&#8217;ai pas eu beaucoup
l&#8217;occasion de jouer avec Maven 2, seulement avec le plugin GMaven qui
rend Maven un peu plus agrÃ©able Ã  utiliser Ã  mon goÃ»t ! Mais j&#8217;espÃ¨re
que ce livre rabibochera les dÃ©veloppeurs allergiques Ã  Maven avec ce
puissant outil de build !</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaJerome.png" alt="MangaJerome"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="jerome_van_der_linden">JÃ©rÃ´me Van der Linden</h5>
<div class="paragraph">
<p>29 ans, architecte JavaEE chez Octo Technology depuis cinq ans, oÃ¹ j&#8217;ai
rencontrÃ© Arnaud et dÃ©couvert Maven (la version 1.0.2 Ã  l&#8217;Ã©poque).</p>
</div>
<div class="paragraph">
<p>Ni commiter, ni PMC, je suis un simple utilisateur mais fervent
dÃ©fenseur de l&#8217;outil. J&#8217;ai mis en place plusieurs "usines de
dÃ©veloppement" (intÃ©gration continue, tests et bonnes pratiques autour
de tout Ã§a), dispensÃ© des formations chez divers clients, Ã©crit quelques
articles sur le sujet et surtout j&#8217;utilise Maven au quotidien ! La
version 1 m&#8217;avait paru intÃ©ressante comparÃ©e Ã  Ant mais c&#8217;est surtout la
version 2 et toutes ses conventions qui me semblent apporter Ã©normÃ©ment
au dÃ©veloppement !</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaPascal.png" alt="MangaPascal"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="_pascal_leclercq">Pascal Leclercq</h5>
<div class="paragraph">
<p>Pascal peut Ãªtre dÃ©fini avant tout comme un scientifique passionnÃ©
d&#8217;Histoire. En tant que professionnel, il est freelance et fondateur de
opensagres (en mÃ©moire de la Â« Fort de Sagres Â», l&#8217;un des premiers
centres de recherche de l&#8217;humanitÃ©).</p>
</div>
<div class="paragraph">
<p>Ses principaux centre d&#8217;intÃ©rÃªts et compÃ©tences sont Maven, Eclipse RCP,
Spring et OSGi. Il essaie de OSGi-fier tous les modules java utiles
prÃ©sents dans notre galaxie</p>
</div>
<div class="paragraph">
<p>Une de ses principales qualitÃ©s est son insatiable curiositÃ©.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaSebastien.png" alt="MangaSebastien"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="sebastien_le_marechal">SÃ©bastien Le MarÃ©chal</h5>
<div class="paragraph">
<p>Breton d&#8217;origine, je vis actuellement Ã  Casablanca avec ma petite tribu
familiale.</p>
</div>
<div class="paragraph">
<p>AprÃ¨s douze ans d&#8217;expÃ©rience en entreprise dans des domaines
fonctionnels et techniques variÃ©s, je travaille actuellement sur un
projet Java/J2E oÃ¹ Maven est largement mis en Åuvre (merci Nico ;-)).</p>
</div>
<div class="paragraph">
<p>Quand j&#8217;ai installÃ© mon environnement, la consternation :</p>
</div>
<div class="paragraph">
<p>&lt;mode panique : on&gt;</p>
</div>
<div class="paragraph">
<p>â "Hou lÃ  lÃ  ! Mais j&#8217;ai plein de tÃ©lÃ©chargements Ã©tranges quand je
lance une commande Maven !"</p>
</div>
<div class="paragraph">
<p>â "Mais c&#8217;est quoi ces fichiers pom.xml partout dans mon workspace ? En
plus, j&#8217;y comprends rien, moi, Ã  ces fichiers."</p>
</div>
<div class="paragraph">
<p>â "Argh ! Mais ils sont passÃ©s oÃ¹ les fichiers build ?"</p>
</div>
<div class="paragraph">
<p>â "Comment Ã§a, on a abandonnÃ© Ant ? Mais pourquoi on a abandonnÃ© Ant ?
J&#8217;aimais bien moi Ant et en plus je comprenais !"</p>
</div>
<div class="paragraph">
<p>â "Au secours Nico !!!!"</p>
</div>
<div class="paragraph">
<p>&lt;mode panique : off&gt;</p>
</div>
<div class="paragraph">
<p>Par consÃ©quent, pour moi (et donc pour Nico), ce livre est une
bÃ©nÃ©diction :-).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_post_scriptum">Post-scriptum</h4>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaNicolas.png" alt="MangaNicolas"></span></p>
</div>
<div class="sect4">
<h5 id="_nicolas_de_loof">Nicolas de Loof</h5>
<div class="paragraph">
<p>Je ne remercierai jamais assez Arnaud d&#8217;avoir acceptÃ© de m&#8217;accompagner
dans cette aventure. Ãcrire un livre sur Maven sans en faire un pavÃ©
inintÃ©ressant n&#8217;Ã©tait pas une mince affaire. Il a su protÃ©ger ce rÃ©cit
des appels si tentants du cÃ´tÃ© obscur de la force.</p>
</div>
<div class="paragraph">
<p>Merci Ã  Pearson et en particulier Ã  Patricia de nous avoir donnÃ© notre
chance pour ajouter un titre Ã  la trop courte liste des ouvrages Ã©crits
dans la langue de MoliÃ¨re.</p>
</div>
<div class="paragraph">
<p>Merci aussi Ã  tous les membres de la communautÃ© Maven qui ont participÃ©
de prÃ¨s ou de loin Ã  la relecture de cet ouvrage et nous ont suggÃ©rÃ© de
nombreuses amÃ©liorations. Leur aide et leur tÃ©nacitÃ© ont Ã©tÃ© un
excellent moteur.</p>
</div>
<div class="paragraph">
<p>Merci enfin Ã  mes p&#8217;tits loups qui supportent que leur papa passe tant
d&#8217;heures devant son Ã©cran, ainsi quâÃ  lâange qui mâaccompagne et
ensoleille chaque jour ma vie.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="illustrations/MangaArnaud.png" alt="MangaArnaud"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="arnaud_heritier">Arnaud HÃ©ritier</h5>
<div class="paragraph">
<p>Je remercie grandement Nicolas de m&#8217;avoir proposÃ© ce challenge. Le
manque d&#8217;une bonne documentation en franÃ§ais sur Maven me titillait
depuis des annÃ©es. Il faut avouer que nous ne sommes pas vraiment
reconnus pour notre bon niveau en anglais, et cela se voit sur le
terrain. Cependant, je n&#8217;aurais jamais eu le courage de me lancer tout
seul. Je le remercie encore plus pour la quantitÃ© de travail qu&#8217;il a
abattu (l&#8217;essentiel en fait). Je suis trÃ¨s fier de cet ouvrage qui est
bien diffÃ©rent de ce que l&#8217;on peut voir d&#8217;ordinaire dans la lecture
spÃ©cialisÃ©e. J&#8217;espÃ¨re que vous prendrez autant de plaisir Ã  le lire que
nous en avons eu Ã  l&#8217;Ã©crire.</p>
</div>
<div class="paragraph">
<p>Merci Ã  notre Ã©diteur Pearson, et Ã  son Ã©quipe, Patricia, Amandine,
Laurence, Jennifer et tous ceux qui nous ont accompagnÃ©s dans cette
premiÃ¨re expÃ©rience en tant qu&#8217;auteurs. Il faut avouer que, pour des
geeks comme nous, sortir <strong class="line-through">la plume</strong> $ "la plume" en
texte barrÃ©, SVP$ le traitement de texte (en plus celui de Bilou !) et
en faire l&#8217;ouvrage que vous tenez dans les mains est un vÃ©ritable
exploit.</p>
</div>
<div class="paragraph">
<p>Merci Ã  nos relecteurs et Ã  toute la communautÃ© Maven. ParticuliÃ¨rement
Ã  ses membres francophones qui ont pu trouver le temps de nous Ã©pauler
pour faire de cet ouvrage une Åuvre de qualitÃ©.</p>
</div>
<div class="paragraph">
<p>Enfin, je dirai un grand grand grand merci Ã  mon exceptionnelle femme et
Ã  mes trois enfants qui supportent autant que possible le temps que je
peux passer sur l&#8217;open-source et ces derniers temps sur cet ouvrage.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chapitre_19_lexique">Chapitre 19 : Lexique</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ami lecteur, tu es arrivÃ© jusqu&#8217;ici et notre rÃ©cit te laisse un goÃ»t
amer de "mais enfin, de quoi parlent-ils ?". Il est vrai que
l&#8217;informatique possÃ¨de un jargon riche, souvent impÃ©nÃ©trable et
anglophoneâ¦ Voici donc notre petit dictionnaire Maven â FranÃ§ais.</p>
</div>
<div class="sect2">
<h3 id="_le_petit_monde_open_source">Le petit monde open-source</h3>
<div class="paragraph">
<p>Apache <sup class="footnote">[<a id="_footnoteref_72" class="footnote" href="#_footnotedef_72" title="View footnote.">72</a>]</sup></p>
</div>
<div class="paragraph">
<p>La fondation Apache (ASF, Apache Software Foundation) est un organisme
amÃ©ricain Ã  but non lucratif qui hÃ©berge les infrastructures pour le
dÃ©veloppement de nombreux logiciels libres, dont le trÃ¨s cÃ©lÃ¨bre serveur
HTTP Apache. La fondation encourage la constitution d&#8217;une communautÃ©
pour soutenir un projet donnÃ© plutÃ´t que les pures qualitÃ©s techniques
de celui-ci, mÃªme si elles font rarement dÃ©faut - des centaines d&#8217;yeux
braquÃ©s sur le code sont une bonne garantie de qualitÃ© ! Les
responsabilitÃ©s dans un projet Apache sont basÃ©es sur le concept de
mÃ©ritocratie : un membre actif, talentueux et respectueux de la
diversitÃ© de la communautÃ© se verra attribuer plus de responsabilitÃ©s et
de titres (Committer PMC), jusqu&#8217;au titre suprÃªme de membre de la
fondation Apache.</p>
</div>
<div class="paragraph">
<p>Committer <sup class="footnote">[<a id="_footnoteref_73" class="footnote" href="#_footnotedef_73" title="View footnote.">73</a>]</sup></p>
</div>
<div class="paragraph">
<p>Le monde open-source identifie les personnes qui ont un accÃ¨s libre en
modification sur un projet comme committer, c&#8217;est-Ã -dire autorisÃ© Ã 
effectuer un commit sur le gestionnaire de code source du projet. Ce
statut est accordÃ© aux membres actifs du projet qui ont dÃ©montrÃ© en tant
qu&#8217;utilisateurs avertis leur bonne connaissance technique ainsi que leur
capacitÃ© Ã  collaborer dans le respect de leurs pairs.</p>
</div>
<div class="paragraph">
<p>JIRA <sup class="footnote">[<a id="_footnoteref_74" class="footnote" href="#_footnotedef_74" title="View footnote.">74</a>]</sup></p>
</div>
<div class="paragraph">
<p>La sociÃ©tÃ© Atlassian propose aux fondations qui hÃ©bergent des logiciels
libres une licence gratuite de son outil de gestion de tÃ¢ches et
d&#8217;anomalies, JIRA. Cet outil est une application web trÃ¨s conviviale qui
permet de suivre les actions en cours sur le projet et d&#8217;interagir avec
l&#8217;Ã©quipe de dÃ©veloppement. Si vous rencontrez des comportements
anormaux, faites une recherche prÃ©alable sur le projet JIRA de
Maven <sup class="footnote">[<a id="_footnoteref_75" class="footnote" href="#_footnotedef_75" title="View footnote.">75</a>]</sup> ainsi que sur ceux des
plugins <sup class="footnote">[<a id="_footnoteref_76" class="footnote" href="#_footnotedef_76" title="View footnote.">76</a>]</sup>. Vous pouvez d&#8217;ailleurs contribuer aux
corrections par ce biais, en attachant un mini-projet dÃ©montrant le
problÃ¨me, et potentiellement un patch qui le corrige. Atlassian offre
d&#8217;autres produits comme Confluence <sup class="footnote">[<a id="_footnoteref_77" class="footnote" href="#_footnotedef_77" title="View footnote.">77</a>]</sup>, un Wiki trÃ¨s
rÃ©putÃ©.</p>
</div>
<div class="paragraph">
<p>Mailing-list</p>
</div>
<div class="paragraph">
<p>Le support de Maven (comme beaucoup d&#8217;autres projets open-source) passe
principalement par une liste de diffusion (Mailing-list) des
utilisateurs (<a href="mailto:users@maven.apache.org">users@maven.apache.org</a> dans son cas). Une seconde liste
<a href="mailto:dev@maven.apache.org">dev@maven.apache.org</a> permet de discuter des Ã©volutions de l&#8217;outil et de
ses plugins. La liste <a href="mailto:announce@maven.apache.org">announce@maven.apache.org</a> permet de connaitre
l&#8217;ensemble des livraisons. Il existe beaucoup d&#8217;autres liste de
diffusions en fonction des sous projets de Maven <sup class="footnote">[<a id="_footnoteref_78" class="footnote" href="#_footnotedef_78" title="View footnote.">78</a>]</sup>.
Enfin, en cas de besoin urgent, vous pouvez essayer de contacter une
partie de l&#8217;Ã©quipe de dÃ©veloppement sur irc <sup class="footnote">[<a id="_footnoteref_79" class="footnote" href="#_footnotedef_79" title="View footnote.">79</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>Open-source (logiciel libre)</p>
</div>
<div class="paragraph">
<p>Logiciel dont le code source est accessible. Vous pouvez, si besoin est,
y jeter un Åil pour comprendre comment il marche. Les logiciels
open-source sont aussi qualifiÃ©s de logiciels libres. Mais cela ne
signifie pas pour autant que vous pouvez faire absolument tout ce que
vous voulez avec : il existe de nombreuses licences avec des contraintes
trÃ¨s variÃ©es. La licence Apache (ASL v2) utilisÃ©e par Maven est l&#8217;une
des plus souples puisqu&#8217;elle vous donne le droit d&#8217;utiliser, de
modifier, de diffuser, voire mÃªme de vendre le logiciel comme bon vous
semble â tant que vous gardez un petit encart rappelant l&#8217;origine
initiale du code. Un des meilleurs exemples de ce cas est le IBM HTTP
Server <sup class="footnote">[<a id="_footnoteref_80" class="footnote" href="#_footnotedef_80" title="View footnote.">80</a>]</sup>, qui est une adaptation du serveur HTTP
d&#8217;Apache.</p>
</div>
<div class="paragraph">
<p>PMC <sup class="footnote">[<a id="_footnoteref_81" class="footnote" href="#_footnotedef_81" title="View footnote.">81</a>]</sup></p>
</div>
<div class="paragraph">
<p>La fondation Apache, pour la gestion des projets open-source qu&#8217;elle
hÃ©berge, dÃ©finit un Project Management Commitee, constituÃ© de committers
plus expÃ©rimentÃ©s ou plus actifs que les autres et qui peuvent ainsi
dÃ©finir de maniÃ¨re efficace les orientations du projet. Le PMC a ainsi
la responsabilitÃ© de voter la livraison d&#8217;une nouvelle version, ou
d&#8217;inviter de nouveaux membres comme committers.</p>
</div>
</div>
<div class="sect2">
<h3 id="_les_concepts_maven">Les concepts Maven</h3>
<div class="paragraph">
<p>API</p>
</div>
<div class="paragraph">
<p>Acronyme de <em>Application Programming Interface</em>, il s&#8217;agit de l&#8217;ensemble
des classes qui dÃ©finit comment manipuler un programme ; elles sont donc
documentÃ©es et stables dans le temps (les classes internes pouvant
Ã©voluer sans prÃ©venir). Maven propose ses propres API, en particulier
pour l&#8217;Ã©criture de plugins, les fameux Mojos, mais aussi pour la
manipulation des Artefacts et des Repository.</p>
</div>
<div class="paragraph">
<p>Aether</p>
</div>
<div class="paragraph">
<p>DÃ©veloppÃ© par sonatype, en opensource mais en dehors de la fondation
Apache, Aether encapsule la gestion de dÃ©pendance et la gestion des
dÃ©pÃ´ts dâartefact, indÃ©pendemment de leur implÃ©mentation. Maven propose
ainsi une implÃ©mentation de dÃ©pÃ´t conforme Ã  lâAPI Aether, qui pourrait
aussi bien Ãªtre utilisÃ©e sur des dÃ©pÃ´ts Eclipse P2 ou autre.</p>
</div>
<div class="paragraph">
<p>Archetype</p>
</div>
<div class="paragraph">
<p>Patron de crÃ©ation de projet Maven, un archÃ©type est un excellent moyen
d&#8217;obtenir un squelette fonctionnel de projet, plus ou moins avancÃ© selon
l&#8217;archÃ©type considÃ©rÃ©. Le plugin archetype permet Ã  la fois de crÃ©er un
archÃ©type Ã  partir d&#8217;un projet existant et de crÃ©er un nouveau projet Ã 
partir d&#8217;un archÃ©type.</p>
</div>
<div class="paragraph">
<p>Artefact</p>
</div>
<div class="paragraph">
<p>Traduction un peu trop littÃ©rale de l&#8217;anglais artifact â Vincent nous
signale qu&#8217;au QuÃ©bec il s&#8217;agit bien d&#8217;un mot â il dÃ©finit un Ã©lÃ©ment
tangible produit lors de la phase de rÃ©alisation d&#8217;un logiciel. Il peut
s&#8217;agir tout aussi bien d&#8217;un programme exÃ©cutable que d&#8217;un document ou un
modÃ¨le UML. Dans la grande majoritÃ© des cas, il s&#8217;agit de bibliothÃ¨ques
Java.</p>
</div>
<div class="paragraph">
<p>Assembly</p>
</div>
<div class="paragraph">
<p>Les assembly permettent de construire un livrable selon un format
particulier, typiquement une archive contenant divers artefacts ou
fichiers issus de la construction du projet. Le plugin associÃ© propose
plusieurs descripteurs d&#8217;assembly standards, permettant par exemple de
fournir les sources du projet ou d&#8217;assembler un JAR contenant toutes les
dÃ©pendances.</p>
</div>
<div class="paragraph">
<p>Build</p>
</div>
<div class="paragraph">
<p>Terme trÃ¨s gÃ©nÃ©rique pour englober tout ce qui tourne autour de la
construction du projet, de son outillage et de l&#8217;assurance qualitÃ© qu&#8217;on
se donne le mal de lui associer.</p>
</div>
<div class="paragraph">
<p>DÃ©pendances</p>
</div>
<div class="paragraph">
<p>Peu de bibliothÃ¨ques ou d&#8217;applications Java se contentent de la seule
JRE. Les applications modernes reposent sur des dizaines d&#8217;utilitaires
ou de frameworks. On parle globalement de dÃ©pendances, chaque dÃ©pendance
ayant elle-mÃªme Ã©ventuellement des dÃ©pendances.</p>
</div>
<div class="paragraph">
<p>Cycle de vie</p>
</div>
<div class="paragraph">
<p>Le packaging d&#8217;un projet Maven dÃ©finit un cycle de vie, soit un ensemble
de phases qui seront enchaÃ®nÃ©es. Les plugins Maven viennent se greffer Ã 
une phase donnÃ©e et sont donc exÃ©cutÃ©s selon cet ordre.</p>
</div>
<div class="paragraph">
<p>MAVEN_OPTS</p>
</div>
<div class="paragraph">
<p>La JVM qui exÃ©cute Maven peut Ãªtre ajustÃ©e en dÃ©finissant des options
dans cette variable systÃ¨me. Sur un projet un peu trop gÃ©nÃ©reux, vous
pouvez par exemple rencontrer des OutOfMemoryError : vous pouvez alors
dÃ©finir quelque chose comme "-Xmx512M -XX:PermSize=128M
-XX:MaxPermSize=256M" dans la variable d&#8217;environnement MAVEN_OPTS.</p>
</div>
<div class="paragraph">
<p>M2_HOME</p>
</div>
<div class="paragraph">
<p>Variable d&#8217;environnement pointant vers le rÃ©pertoire d&#8217;installation de
Maven. Elle permet de configurer son environnement sans se baser sur des
chemins en dur et donc de changer plus facilement de version de Maven.</p>
</div>
<div class="paragraph">
<p>Mojo</p>
</div>
<div class="paragraph">
<p>Un plugin Maven est composÃ© de classes Java, et chaque tÃ¢che du plugin
est rÃ©alisÃ© par une classe Mojo, acronyme pour <em>Maven Old Java Object</em>
(par allusion au terme POJO, <em>Plain Old Java Object</em>). Un Mojo est donc
le pendant cÃ´tÃ© code d&#8217;une tÃ¢che Maven invoquÃ©e par <code>mvn plugin:tÃ¢che</code>.
Les Mojos se basent sur une API propre Ã  Maven. Voir sur ce sujet
<a href="http://maven.apache.org/guides/introduction/introduction-to-plugins.html" class="bare">http://maven.apache.org/guides/introduction/introduction-to-plugins.html</a>.</p>
</div>
<div class="paragraph">
<p>Mojo est aussi le nom d&#8217;un projet <sup class="footnote">[<a id="_footnoteref_82" class="footnote" href="#_footnotedef_82" title="View footnote.">82</a>]</sup> offrant une
collection de plugins surveillÃ©s par l&#8217;Ã©quipe du projet Maven mais en
dehors de la communautÃ© Apache, ce qui permet plus de flexibilitÃ© (sur
le processus d&#8217;entrÃ©e des membres, ou sur les licences par exemple).</p>
</div>
<div class="paragraph">
<p>Plexus</p>
</div>
<div class="paragraph">
<p>Conteneur historique de Maven2, implÃ©mentant lâinjection de dÃ©pendance
comme son concurrent Spring, mais nâayant pas connu le succÃ¨s de ce
dernier, sans doute en raison dâune documentation innexistante et dâun
manque de communication. Techniquement dÃ©passÃ©, il est remplacÃ© dans
Maven3 par Google Guice.</p>
</div>
<div class="paragraph">
<p>Plugin</p>
</div>
<div class="paragraph">
<p>De maniÃ¨re gÃ©nÃ©rale, un plugin est un composant logiciel qui vient
s&#8217;ajouter Ã  une souche existante pour en enrichir les fonctionnalitÃ©s.
Dans le cas de Maven, comme pour de nombreux systÃ¨mes fondÃ©s sur ce
mÃ©canisme, le cÅur ne rend que les services principaux du logiciel
(construction du POM, tÃ©lÃ©chargement des dÃ©pendances, lancement des
plugins) pour laisser les traitements aux plugins. Ces derniers
participent Ã  la construction du projet en prenant en charge une tÃ¢che
particuliÃ¨re (produire des rapports lors de la gÃ©nÃ©ration documentaire,
ou encore s&#8217;exÃ©cuter de maniÃ¨re isolÃ©e).</p>
</div>
<div class="paragraph">
<p>POM <sup class="footnote">[<a id="_footnoteref_83" class="footnote" href="#_footnotedef_83" title="View footnote.">83</a>]</sup></p>
</div>
<div class="paragraph">
<p>Acronyme pour <em>Project Object Model</em>, en bon franÃ§ais "modÃ¨le du
projet". Il s&#8217;agit du descripteur d&#8217;un projet tel que Maven le construit
en mÃ©moire <em>via</em> un modÃ¨le objet interne. Ce modÃ¨le est construit Ã 
partir de fichiers XML, qui peuvent s&#8217;enrichir mutuellement _via_un
mÃ©canisme d&#8217;hÃ©ritage et de profils. Autrement dit, le POM n&#8217;est pas
juste l&#8217;Ã©quivalent mÃ©moire du fichier pom.xml. Les versions Ã  venir de
Maven supporteront d&#8217;ailleurs des formats alternatifs -â moins verbeux
par exemple.</p>
</div>
<div class="paragraph">
<p>Profile</p>
</div>
<div class="paragraph">
<p>Un profil permet de regrouper une partie de la configuration Maven, de
l&#8217;activer / dÃ©sactiver Ã  la demande ou en fonction de conditions locales
(version de JDK, systÃ¨me d&#8217;exploitation, propriÃ©tÃ© systÃ¨me, etc.).
L&#8217;utilisation la plus courante est de dÃ©sactiver certaines fonctions
annexes du build qui seraient pÃ©nalisantes (trop lentes, ou basÃ©es sur
des prÃ©-requis).</p>
</div>
<div class="paragraph">
<p>Release</p>
</div>
<div class="paragraph">
<p>Le processus qui permet de passer d&#8217;un projet en cours de dÃ©veloppement
Ã  un livrable qualifiÃ©, tracÃ© et mis Ã  disposition des utilisateurs est
qualifiÃ© de release, ce que nous avons traduit par livraison. De
nombreux Ã©cueils se dressent sur votre parcours pour que toutes les
tÃ¢ches impliquÃ©es soient rÃ©alisÃ©es sans oubli, maladresse ou autre
loupÃ©. Le Chapitre 10 vous explique en quoi Maven peut vous aider sur
cette tÃ¢che Ã  haute valeur ajoutÃ©e lorsqu&#8217;elle est correctement
automatisÃ©e.</p>
</div>
<div class="paragraph">
<p>Repository</p>
</div>
<div class="paragraph">
<p> file://)</p>
</div>
<div class="paragraph">
<p>Sisu</p>
</div>
<div class="paragraph">
<p>DÃ©veloppÃ© par Sonatype pour les besoins du gestionnaire de dÃ©pÃ´t Nexus,
Sisu permet dâutiliser des composants conÃ§us pour Plexus (le conteneur
historique de Maven2) dans un conteneut conforme Ã  la norme JSR330, en
lâoccurrence Google Guice.</p>
</div>
<div class="paragraph">
<p>SCM <sup class="footnote">[<a id="_footnoteref_84" class="footnote" href="#_footnotedef_84" title="View footnote.">84</a>]</sup></p>
</div>
<div class="paragraph">
<p>Acronyme de <em>Source Code Management</em> (gestion du code source). Terme
gÃ©nÃ©rique qui recouvre tous les outils permettant de conserver
l&#8217;historique des modifications dans le code source et de travailler de
maniÃ¨re coopÃ©rative sur un mÃªme projet, en se synchronisant Ã 
intervalles rÃ©guliers. Les outils les plus courants sont CVS,
Subversion, ou Visual SourceSafe, mais il en existe bien d&#8217;autres
(Perforce, Git, Mercurial, Clearcase, etc.). Sous projet de Maven, SCM
est une API standardisÃ©e offrant toutes les fonctions communes aux SCM.</p>
</div>
<div class="paragraph">
<p>Scope</p>
</div>
<div class="paragraph">
<p>Le scope permet de prÃ©ciser dans quel contexte une dÃ©pendance est
nÃ©cessaire au projet. Par dÃ©faut, compile correspond Ã  une dÃ©pendance
utilisÃ©e explicitement dans le code source ; runtime rÃ©duit ce besoin Ã 
l&#8217;exÃ©cution, mais pas Ã  la compilation (par exemple : pilote JDBC) ;
test permet d&#8217;isoler les outils de test et de ne pas risquer de les
rÃ©fÃ©rencer dans le code source ; provided permet de rÃ©fÃ©rencer une
dÃ©pendance qui fait partie de l&#8217;environnement cible (API JavaEE par
exemple) ; enfin, import permet de rÃ©utiliser le &lt;dependencyManagement&gt;
d&#8217;un autre POM sans passer par l&#8217;hÃ©ritage.</p>
</div>
<div class="paragraph">
<p>Settings</p>
</div>
<div class="paragraph">
<p>La configuration locale de Maven est basÃ©e sur un fichier XML placÃ© dans
le rÃ©pertoire $HOME/.m2 de l&#8217;utilisateur (soit C:\Documents and
settings\votre_nom\.m2 pour les utilisateurs de Windows). Ce fichier
permet d&#8217;ajuster le fonctionnement de Maven aux spÃ©cificitÃ©s de votre
poste, de votre connexion rÃ©seau, ainsi qu&#8217;Ã  votre infrastructure. On y
dÃ©clare par exemple des sites miroirs pour les dÃ©pÃ´ts d&#8217;artefacts et les
identifiants/mot de passe (ce dernier peut Ãªtre cryptÃ©) pour accÃ©der aux
serveurs. Un schÃ©ma XML est disponible <sup class="footnote">[<a id="_footnoteref_85" class="footnote" href="#_footnotedef_85" title="View footnote.">85</a>]</sup> pour vous aider
Ã  saisir ce fichier sans erreur.</p>
</div>
<div class="paragraph">
<p>Snapshot</p>
</div>
<div class="paragraph">
<p>DerniÃ¨re version d&#8217;un artefact en cours de dÃ©veloppement. Une version
Snapshot peut donc Ãªtre mise Ã  jour Ã  tout moment. Maven vÃ©rifie une
fois par jour (par dÃ©faut) que ses Snapshots sont Ã  jour, afin d&#8217;Ã©viter
un accÃ¨s systÃ©matique aux dÃ©pÃ´ts. L&#8217;option -U permet de forcer cette
vÃ©rification, par exemple sur le serveur d&#8217;intÃ©gration continue. Maven
propose deux modes de gestion des Snapshots : soit la nouvelle version
Ã©crase simplement la prÃ©cÃ©dente, soit Maven dÃ©ploie une version dÃ©diÃ©e
pour chaque Snapshot en ajoutant une indication de date (Ã  la
milliseconde) plus un numÃ©ro de diffusion, incrÃ©mentÃ© Ã  chaque nouveau
Snapshot. Cette option consomme Ã©videment plus d&#8217;espace disque sur le
dÃ©pÃ´t, mais elle permet de figer l&#8217;utilisation d&#8217;un Snapshot
particulier. Il faut prendre de grandes prÃ©cautions lors que l&#8217;on
utilise des artefacts en version Snapshot car ces derniers ont tout
loisir d&#8217;Ãªtre modifiÃ©s, ce qui peut donc entrainer des rÃ©gressions ou
des incompatibilitÃ©s.</p>
</div>
<div class="paragraph">
<p>Staging</p>
</div>
<div class="paragraph">
<p>Afin d&#8217;assurer la qualitÃ© du livrable d&#8217;un projet, une option
gÃ©nÃ©ralement retenue dans le processus de livraison est de construire ce
dernier dans son Ã©tat final et de le soumettre Ã  des tests de
validation. En cas d&#8217;anomalie, un retour arriÃ¨re (rollback) est rÃ©alisÃ©
et un nouveau livrable pourra Ãªtre produit aprÃ¨s correction. Pour
diffÃ©rencier ce livrable candidat du livrable public, on place le
rÃ©sultat de la construction du projet dans un espace dÃ©diÃ©, appelÃ© stage
dans le vocabulaire anglo-saxon. Cet espace est utilisÃ© par l&#8217;Ã©quipe de
test qui maÃ®trise son environnement. Une fois le livrable validÃ©, il
suffit de le transfÃ©rer de cet espace vers l&#8217;espace public, sans aucune
modification interne â le livrable public est donc bien celui qui a Ã©tÃ©
testÃ©.</p>
</div>
<div class="paragraph">
<p>SureFire <sup class="footnote">[<a id="_footnoteref_86" class="footnote" href="#_footnotedef_86" title="View footnote.">86</a>]</sup></p>
</div>
<div class="paragraph">
<p>Maven supporte plusieurs outils de test unitaire :
jUnit <sup class="footnote">[<a id="_footnoteref_87" class="footnote" href="#_footnotedef_87" title="View footnote.">87</a>]</sup> 3 ou 4 et testNG <sup class="footnote">[<a id="_footnoteref_88" class="footnote" href="#_footnotedef_88" title="View footnote.">88</a>]</sup>. Ce support
est orchestrÃ© par un outil dÃ©diÃ©, SureFire ("infaillible"), sous-projet
de Maven, qui fournit une vision homogÃ¨ne de ces trois outils, et
permettra si besoin d&#8217;en intÃ©grer un nouveau dans le support de Maven.
Le plugin Maven qui exÃ©cute nos tests n&#8217;est donc pas un
maven-junit-plugin, mais maven-surefire-plugin.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ceux_qui_font_tourner_maven">Ceux qui font tourner Maven</h3>
<div class="paragraph">
<p>ClassWorlds <sup class="footnote">[<a id="_footnoteref_89" class="footnote" href="#_footnotedef_89" title="View footnote.">89</a>]</sup></p>
</div>
<div class="paragraph">
<p>Maven permet Ã  chaque plugin de disposer d&#8217;un espace privÃ© d&#8217;exÃ©cution,
depuis lequel il peut s&#8217;exÃ©cuter avec ses dÃ©pendances sans Ãªtre
influencÃ© par les autres plugins. Ce cloisonnement est rÃ©alisÃ© par un
jeu de ClassLoaders, basÃ©s sur l&#8217;outil open-source ClassWorlds. D&#8217;une
certaine faÃ§on, ClassWorlds peut Ãªtre comparÃ© Ã  OSGi, mÃªme si son cadre
est moins large et qu&#8217;il ne fait l&#8217;objet d&#8217;aucune normalisation.</p>
</div>
<div class="paragraph">
<p>Doxia <sup class="footnote">[<a id="_footnoteref_90" class="footnote" href="#_footnotedef_90" title="View footnote.">90</a>]</sup></p>
</div>
<div class="paragraph">
<p>Sous-projet de Maven, Doxia est le moteur de rendu documentaire de
Maven. Il sert de point d&#8217;articulation entre diverses sources (rapports
d&#8217;analyse, format de documents) et le rendu final (site web HTML,
document PDF). Doxia offre une API permettant de manipuler les
diffÃ©rents formats d&#8217;entrÃ©e pour produire diffÃ©rents formats de sortie.</p>
</div>
<div class="paragraph">
<p>Mercury <sup class="footnote">[<a id="_footnoteref_91" class="footnote" href="#_footnotedef_91" title="View footnote.">91</a>]</sup></p>
</div>
<div class="paragraph">
<p>Le dÃ©veloppement de Maven 3 introduit une refonte de la gestion des
artefacts, des dÃ©pendances, de la rÃ©solution des versions, ainsi que de
l&#8217;accÃ¨s aux dÃ©pÃ´ts (voir Wagon). Mercury, sous-projet de Maven, est le
nom de code de cette nouvelle API, conÃ§ue pour plus de clartÃ© et de
flexibilitÃ© â le code actuel de Maven 2 souffrant un peu du poids des
nombreuses annÃ©es de corrections diverses.</p>
</div>
<div class="paragraph">
<p>Modello <sup class="footnote">[<a id="_footnoteref_92" class="footnote" href="#_footnotedef_92" title="View footnote.">92</a>]</sup></p>
</div>
<div class="paragraph">
<p>Les divers fichiers XML manipulÃ©s par Maven sont dÃ©finis Ã  partir d&#8217;un
modÃ¨le (dÃ©crit dans des fichiers *.mdo), que l&#8217;outil open-source Modello
convertit en classes JavaBean, en schÃ©ma XML et en analyseurs XML pour
passer de l&#8217;un Ã  l&#8217;autre. Modello peut potentiellement Ãªtre utilisÃ© dans
un autre cadre mais reste trÃ¨s liÃ© Ã  Maven. Modello peut Ãªtre comparÃ© Ã 
JAXB, l&#8217;API actuelle qui normalise la passerelle entre les mondes Java
et XML.</p>
</div>
<div class="paragraph">
<p>Plexus <sup class="footnote">[<a id="_footnoteref_93" class="footnote" href="#_footnotedef_93" title="View footnote.">93</a>]</sup></p>
</div>
<div class="paragraph">
<p>Plexus est un conteneur IOC (<em>Inversion Of Control</em>) qui gÃ¨re les
composants de Maven. C&#8217;est un projet indÃ©pendant de Maven et qui peut
Ãªtre utilisÃ© dans un cadre trÃ¨s diffÃ©rent. Cependant, son dÃ©veloppement
a toujours Ã©tÃ© fortement liÃ© Ã  Maven (les dÃ©veloppeurs sont d&#8217;ailleurs
en partie les mÃªmes).</p>
</div>
<div class="paragraph">
<p>Wagon <sup class="footnote">[<a id="_footnoteref_94" class="footnote" href="#_footnotedef_94" title="View footnote.">94</a>]</sup></p>
</div>
<div class="paragraph">
<p>Lorsque Maven doit accÃ©der Ã  une ressource rÃ©seau, il passe par une
couche dÃ©diÃ©e qui gÃ¨re divers protocoles (HTTP, HTTPS, SCP, WebDAV,
etc.). Cette abstraction au dessus des protocoles de communication est
dÃ©finie par l&#8217;API Wagon, sous-projet de Maven. Diverses implÃ©mentations
permettent de supporter ces protocoles, voire d&#8217;en ajouter de nouveaux.
Vous pouvez par exemple utiliser le protocole de partage Windows Samba
<em>via</em> un module dÃ©diÃ© <sup class="footnote">[<a id="_footnoteref_95" class="footnote" href="#_footnotedef_95" title="View footnote.">95</a>]</sup>, qui n&#8217;est pas intÃ©grÃ© par
dÃ©faut Ã  Maven pour des questions d&#8217;incompatibilitÃ© de licence.</p>
</div>
</div>
<div class="sect2">
<h3 id="_et_tout_ce_qui_tourne_autour">Et tout ce qui tourne autourâ¦</h3>
<div class="paragraph">
<p>Apt <sup class="footnote">[<a id="_footnoteref_96" class="footnote" href="#_footnotedef_96" title="View footnote.">96</a>]</sup></p>
</div>
<div class="paragraph">
<p>Format de documentation utilisÃ© couramment sur les projets Maven.
Acronyme de <em>Almost Plain Text</em>, il s&#8217;agit d&#8217;un format en texte brut,
comparable Ã  une syntaxe Wiki.</p>
</div>
<div class="paragraph">
<p>FML <sup class="footnote">[<a id="_footnoteref_97" class="footnote" href="#_footnotedef_97" title="View footnote.">97</a>]</sup></p>
</div>
<div class="paragraph">
<p>Acronyme de <em>FAQ Markup Language</em>, il s&#8217;agit d&#8217;un format documentaire
basÃ© sur XML pour produire des Foires Aux Questions sur un site web
produit par Maven.</p>
</div>
<div class="paragraph">
<p>OSGi</p>
</div>
<div class="paragraph">
<p>La norme OSGi dÃ©finit une plateforme de service permettant le
chargement et le remplacement Ã  chaud de services, tout en gÃ©rant leurs
dÃ©pendances et les Ã©ventuels conflits associÃ©s.
Eclipse <sup class="footnote">[<a id="_footnoteref_98" class="footnote" href="#_footnotedef_98" title="View footnote.">98</a>]</sup> est l&#8217;un des utilisateurs d&#8217;OSGi le plus
connu (basÃ© sur l&#8217;implÃ©mentation OSGi Equinox <sup class="footnote">[<a id="_footnoteref_99" class="footnote" href="#_footnotedef_99" title="View footnote.">99</a>]</sup>.
Maven entre en concurrence directe avec OSGi pour la dÃ©claration des
dÃ©pendances et la gestion de leurs conflits. Nexus <sup class="footnote">[<a id="_footnoteref_100" class="footnote" href="#_footnotedef_100" title="View footnote.">100</a>]</sup>
est un des premiers serveurs Ã  gÃ©rer Ã  la fois les rÃ©fÃ©rentiels au
format Maven et au format OSGi.</p>
</div>
<div class="paragraph">
<p>Wiki</p>
</div>
<div class="paragraph">
<p>SystÃ¨me de gestion de contenu web permettant de rendre chaque page
Ã©ditable par des personnes autorisÃ©es. Maven utilise
Confluence <sup class="footnote">[<a id="_footnoteref_101" class="footnote" href="#_footnotedef_101" title="View footnote.">101</a>]</sup> comme Wiki.</p>
</div>
<div class="paragraph">
<p>Xdoc <sup class="footnote">[<a id="_footnoteref_102" class="footnote" href="#_footnotedef_102" title="View footnote.">102</a>]</sup></p>
</div>
<div class="paragraph">
<p>Format de documentation basÃ© sur XML permettant de dÃ©finir la structure
du document, un peu comme le ferait HTML si son usage n&#8217;avait pas Ã©tÃ©
dÃ©formÃ© Ã  des fins de mise en page par des annÃ©es de mauvaises
pratiques.</p>
</div>
</div>
<div class="sect2">
<h3 id="_liens_utiles">Liens utiles</h3>
<div class="paragraph">
<p>Et pour finir, quelques liens indispensables Ã  ajouter dans vos
favoris :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://maven.apache.org/" class="bare">http://maven.apache.org/</a>. Le site officiel de Maven, avec une documentation imparfaite mais tout de mÃªme bien utile.</p>
</li>
<li>
<p><a href="http://www.maestrodev.com/better-build-maven" class="bare">http://www.maestrodev.com/better-build-maven</a>. Premier livre sur Maven disponible en ligne gratuitement.</p>
</li>
<li>
<p><a href="http://www.sonatype.com/products/maven/documentation/book-defguide" class="bare">http://www.sonatype.com/products/maven/documentation/book-defguide</a>. Le fameux definitive guide, en enrichissement permanent par les Ã©quipes de Sonatype.</p>
</li>
<li>
<p><a href="http://www.packtpub.com/apache-maven-2-effective-implementations/book" class="bare">http://www.packtpub.com/apache-maven-2-effective-implementations/book</a>. Encore un livre, Ã©crit lui aussi par des membres de l&#8217;Ã©quipe Maven.</p>
</li>
<li>
<p><a href="http://www.sonatype.com/people/" class="bare">http://www.sonatype.com/people/</a>. Le blog de Sonatype, sur lequel
on peut piocher de nombreuses bonnes idÃ©es autour de Maven.</p>
</li>
<li>
<p><a href="http://mojo.codehaus.org/" class="bare">http://mojo.codehaus.org/</a>. Site communautaire qui hÃ©berge de nombreux plugins Maven. Si vous avez dÃ©veloppÃ© un plugin intÃ©ressant, n&#8217;hÃ©sitez pas Ã  le proposer comme contribution.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sans oublier bien-sÃ»r deux sites absolument indispensables dans la vie d&#8217;un dÃ©veloppeur Java :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://blog.aheritier.net/" class="bare">http://blog.aheritier.net/</a>. Le blog d&#8217;Arnaud.</p>
</li>
<li>
<p><a href="http://blog.loof.fr/" class="bare">http://blog.loof.fr/</a>. Le blog de Nicolas.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Petit rappel de vos lointains cours de physique : S est le symbole utilisÃ© en physique pour lâentropie :)
</div>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. <a href="http://maven.apache.org" class="bare">http://maven.apache.org</a>
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. <a href="http://docs.codehaus.org/display/MAVENUSER" class="bare">http://docs.codehaus.org/display/MAVENUSER</a>
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. MaestroDev (<a href="http://www.maestrodev.com" class="bare">http://www.maestrodev.com</a>)
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. Sonatype, Inc. (<a href="http://www.sonatype.com" class="bare">http://www.sonatype.com</a>)
</div>
<div class="footnote" id="_footnotedef_5">
<a href="#_footnoteref_5">5</a>. Source : <a href="http://fr.wikipedia.org/wiki/Apache_Ant" class="bare">http://fr.wikipedia.org/wiki/Apache_Ant</a>
</div>
<div class="footnote" id="_footnotedef_6">
<a href="#_footnoteref_6">6</a>. <a href="http://java.sun.com/products/javamail/" class="bare">http://java.sun.com/products/javamail/</a>
</div>
<div class="footnote" id="_footnotedef_7">
<a href="#_footnoteref_7">7</a>. Ne riez pas, il s&#8217;agit d&#8217;un cas bien rÃ©el, identifiÃ© lors de la migration du projet sous MavenÂ !
</div>
<div class="footnote" id="_footnotedef_8">
<a href="#_footnoteref_8">8</a>. Je vous laisse chercher la signification de cet acronyme, couramment employÃ© pour dÃ©signer tout ce qui ne marche pas comme prÃ©vu, comme en tÃ©moigne le site <a href="http://thedailywtf.com" class="bare">http://thedailywtf.com</a> - notre Ã©ditrice nous encourage Ã  traduire ce dernier par Â«Â SaperlipopetteÂ Â», Â«Â DiantreÂ Â» ou Â«Â MorbleuÂ Â»
</div>
<div class="footnote" id="_footnotedef_9">
<a href="#_footnoteref_9">9</a>. <a href="http://download.oracle.com/javase/tutorial/java/generics/gentypes.html#diamond" class="bare">http://download.oracle.com/javase/tutorial/java/generics/gentypes.html#diamond</a>
</div>
<div class="footnote" id="_footnotedef_10">
<a href="#_footnoteref_10">10</a>. <a href="http://java.sun.com/j2se/1.4.2/docs/tooldocs/windows/javac.html" class="bare">http://java.sun.com/j2se/1.4.2/docs/tooldocs/windows/javac.html</a>
</div>
<div class="footnote" id="_footnotedef_11">
<a href="#_footnoteref_11">11</a>. <a href="http://java.sun.com/j2se/1.6.0/docs/tooldocs/windows/javac.html" class="bare">http://java.sun.com/j2se/1.6.0/docs/tooldocs/windows/javac.html</a>
</div>
<div class="footnote" id="_footnotedef_12">
<a href="#_footnoteref_12">12</a>. <a href="http://maven.apache.org/plugins/maven-compiler-plugin/" class="bare">http://maven.apache.org/plugins/maven-compiler-plugin/</a>
</div>
<div class="footnote" id="_footnotedef_13">
<a href="#_footnoteref_13">13</a>. <a href="http://groovy.codehaus.org/GMaven" class="bare">http://groovy.codehaus.org/GMaven</a>
</div>
<div class="footnote" id="_footnotedef_14">
<a href="#_footnoteref_14">14</a>. <a href="http://mojo.codehaus.org/gwt-maven-plugin/" class="bare">http://mojo.codehaus.org/gwt-maven-plugin/</a>
</div>
<div class="footnote" id="_footnotedef_15">
<a href="#_footnoteref_15">15</a>. <a href="http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html" class="bare">http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html</a>
</div>
<div class="footnote" id="_footnotedef_16">
<a href="#_footnoteref_16">16</a>. <a href="http://flexmojos.sonatype.org/" class="bare">http://flexmojos.sonatype.org/</a>
</div>
<div class="footnote" id="_footnotedef_17">
<a href="#_footnoteref_17">17</a>. Si l&#8217;utilisation de Flex depuis Maven vous intÃ©resse, retrouvez toutes les informations utiles sur le blog de FranÃ§ois ( <a href="http://jroller.com/francoisledroff/" class="bare">http://jroller.com/francoisledroff/</a> ) et aussi dans le projet Cairngorm ( <a href="http://sourceforge.net/adobe/cairngorm/wiki/Cairngorm/" class="bare">http://sourceforge.net/adobe/cairngorm/wiki/Cairngorm/</a> ) auquel il participe et oÃ¹ vous trouverez de bons exemples de mises en Åuvre de Maven en projet Flex et hybride, Java et Flex.
</div>
<div class="footnote" id="_footnotedef_18">
<a href="#_footnoteref_18">18</a>. <a href="http://maven.apache.org/plugins" class="bare">http://maven.apache.org/plugins</a>
</div>
<div class="footnote" id="_footnotedef_19">
<a href="#_footnoteref_19">19</a>. <a href="http://commons.apache.org/beanutils/" class="bare">http://commons.apache.org/beanutils/</a>
</div>
<div class="footnote" id="_footnotedef_20">
<a href="#_footnoteref_20">20</a>. Il existe deux variantes majeures de jUnit, jUnit3 et jUnit4, la seconde utilisant la syntaxe java5 que nous avons retenue pour notre exemple.
</div>
<div class="footnote" id="_footnotedef_21">
<a href="#_footnoteref_21">21</a>. On appelle Â«Â mÃ©thodes agilesÂ Â» un ensemble de mÃ©thodes de travail qui cassent le mythe du projet bien planifiÃ© pour prÃ©fÃ©rer une approche rÃ©active. Voir <a href="http://fr.wikipedia.org/wiki/MÃ©thode_agile" class="bare">http://fr.wikipedia.org/wiki/MÃ©thode_agile</a>
</div>
<div class="footnote" id="_footnotedef_22">
<a href="#_footnoteref_22">22</a>. <a href="http://www.fitnesse.org" class="bare">http://www.fitnesse.org</a>
</div>
<div class="footnote" id="_footnotedef_23">
<a href="#_footnoteref_23">23</a>. <a href="http://mojo.codehaus.org/fitnesse-maven-plugin" class="bare">http://mojo.codehaus.org/fitnesse-maven-plugin</a>
</div>
<div class="footnote" id="_footnotedef_24">
<a href="#_footnoteref_24">24</a>. <a href="http://jakarta.apache.org/jmeter" class="bare">http://jakarta.apache.org/jmeter</a>
</div>
<div class="footnote" id="_footnotedef_25">
<a href="#_footnoteref_25">25</a>. <a href="http://wiki.apache.org/jakarta-jmeter/JMeterMavenPlugin" class="bare">http://wiki.apache.org/jakarta-jmeter/JMeterMavenPlugin</a>
</div>
<div class="footnote" id="_footnotedef_26">
<a href="#_footnoteref_26">26</a>. Le coÃ»t d&#8217;une licence Oracle est fonction du nombre de cÅurs. Je vous laisse imaginer ce que cela peut donnerâ¦
</div>
<div class="footnote" id="_footnotedef_27">
<a href="#_footnoteref_27">27</a>. <a href="http://repo2.maven.org/maven/" class="bare">http://repo2.maven.org/maven/</a>
</div>
<div class="footnote" id="_footnotedef_28">
<a href="#_footnoteref_28">28</a>. <a href="http://archiva.apache.org" class="bare">http://archiva.apache.org</a>
</div>
<div class="footnote" id="_footnotedef_29">
<a href="#_footnoteref_29">29</a>. <a href="http://nexus.sonatype.org" class="bare">http://nexus.sonatype.org</a>
</div>
<div class="footnote" id="_footnotedef_30">
<a href="#_footnoteref_30">30</a>. <a href="http://artifactory.jfrog.org" class="bare">http://artifactory.jfrog.org</a>
</div>
<div class="footnote" id="_footnotedef_31">
<a href="#_footnoteref_31">31</a>. <a href="http://java.sun.com/developer/technicalArticles/J2EE/Intro/" class="bare">http://java.sun.com/developer/technicalArticles/J2EE/Intro/</a>
</div>
<div class="footnote" id="_footnotedef_32">
<a href="#_footnoteref_32">32</a>. <a href="http://seleniumhq.org/" class="bare">http://seleniumhq.org/</a>
</div>
<div class="footnote" id="_footnotedef_33">
<a href="#_footnoteref_33">33</a>. <a href="http://cargo.codehaus.org/" class="bare">http://cargo.codehaus.org/</a>
</div>
<div class="footnote" id="_footnotedef_34">
<a href="#_footnoteref_34">34</a>. <a href="http://mojo.codehaus.org/sysdeo-tomcat-maven-plugin" class="bare">http://mojo.codehaus.org/sysdeo-tomcat-maven-plugin</a>
</div>
<div class="footnote" id="_footnotedef_35">
<a href="#_footnoteref_35">35</a>. <a href="https://maven-glassfish-plugin.dev.java.net/" class="bare">https://maven-glassfish-plugin.dev.java.net/</a>
</div>
<div class="footnote" id="_footnotedef_36">
<a href="#_footnoteref_36">36</a>. <a href="http://www.eclipse.org/m2e/" class="bare">http://www.eclipse.org/m2e/</a>
</div>
<div class="footnote" id="_footnotedef_37">
<a href="#_footnoteref_37">37</a>. <a href="http://www.eclipse.org/iam/" class="bare">http://www.eclipse.org/iam/</a>
</div>
<div class="footnote" id="_footnotedef_38">
<a href="#_footnoteref_38">38</a>. <em>Plain Old Java Object</em>, soit Â«Â bon vieil objet JavaÂ Â». Les outils modernes ne demandent plus Ã  notre code dâhÃ©riter de telle classe ou dâimplÃ©menter telle interface, ce qui lui permet dâÃªtre neutre et plus souple. Cette appellation cherche avant tout Ã  se diffÃ©rencier des frameworks contraignants qui imposent la hiÃ©rarchie des classes, comme Struts par exemple.
</div>
<div class="footnote" id="_footnotedef_39">
<a href="#_footnoteref_39">39</a>. <a href="http://plexus.codehaus.org/" class="bare">http://plexus.codehaus.org/</a>
</div>
<div class="footnote" id="_footnotedef_40">
<a href="#_footnoteref_40">40</a>. Aussi connu sous le nom dâInversion de ContrÃ´le (<a href="http://fr.wikipedia.org/wiki/Inversion_de_contrÃ´le" class="bare">http://fr.wikipedia.org/wiki/Inversion_de_contrÃ´le</a>)
</div>
<div class="footnote" id="_footnotedef_41">
<a href="#_footnoteref_41">41</a>. <a href="http://classworlds.codehaus.org/" class="bare">http://classworlds.codehaus.org/</a> (voir, en particulier, <a href="http://maven.apache.org/guides/mini/guide-maven-classloading.html" class="bare">http://maven.apache.org/guides/mini/guide-maven-classloading.html</a>)
</div>
<div class="footnote" id="_footnotedef_42">
<a href="#_footnoteref_42">42</a>. <a href="http://maven.apache.org/doxia" class="bare">http://maven.apache.org/doxia</a>
</div>
<div class="footnote" id="_footnotedef_43">
<a href="#_footnoteref_43">43</a>. <a href="http://sonar.codehaus.org/" class="bare">http://sonar.codehaus.org/</a>
</div>
<div class="footnote" id="_footnotedef_44">
<a href="#_footnoteref_44">44</a>. <a href="http://mojo.codehaus.org/buildnumber-maven-plugin/" class="bare">http://mojo.codehaus.org/buildnumber-maven-plugin/</a>
</div>
<div class="footnote" id="_footnotedef_45">
<a href="#_footnoteref_45">45</a>. <a href="http://fr.wikipedia.org/wiki/GPG" class="bare">http://fr.wikipedia.org/wiki/GPG</a>
</div>
<div class="footnote" id="_footnotedef_46">
<a href="#_footnoteref_46">46</a>. <a href="http://maven.apache.org/plugins/maven-assembly-plugin/" class="bare">http://maven.apache.org/plugins/maven-assembly-plugin/</a>
</div>
<div class="footnote" id="_footnotedef_47">
<a href="#_footnoteref_47">47</a>. Vous ne connaissez pas la mÃ©thode agile Scrum (<a href="http://fr.wikipedia.org/wiki/Scrum" class="bare">http://fr.wikipedia.org/wiki/Scrum</a>) ? Renseignez-vous vite auprÃ¨s de votre JUG local pour quâil organise une soirÃ©e dÃ©diÃ©e :)
</div>
<div class="footnote" id="_footnotedef_48">
<a href="#_footnoteref_48">48</a>. <a href="http://opensourcestrategies.blogspot.com/2005/09/how-to-get-support-from-open-source.html" class="bare">http://opensourcestrategies.blogspot.com/2005/09/how-to-get-support-from-open-source.html</a>
</div>
<div class="footnote" id="_footnotedef_49">
<a href="#_footnoteref_49">49</a>. Accessible sans client IRC par l&#8217;interface web <a href="http://irc.codehaus.org/" class="bare">http://irc.codehaus.org/</a>
</div>
<div class="footnote" id="_footnotedef_50">
<a href="#_footnoteref_50">50</a>. <a href="http://www.developpez.net/forums/f319/java/edi-outils-java/maven/" class="bare">http://www.developpez.net/forums/f319/java/edi-outils-java/maven/</a>
</div>
<div class="footnote" id="_footnotedef_51">
<a href="#_footnoteref_51">51</a>. <a href="http://java.developpez.com/faq/maven/" class="bare">http://java.developpez.com/faq/maven/</a>
</div>
<div class="footnote" id="_footnotedef_52">
<a href="#_footnoteref_52">52</a>. <a href="http://www.maestrodev.com/better-build-maven" class="bare">http://www.maestrodev.com/better-build-maven</a>
</div>
<div class="footnote" id="_footnotedef_53">
<a href="#_footnoteref_53">53</a>. <a href="https://src.springframework.org/svn/spring-framework/trunk/build-spring-framework/pom.xml" class="bare">https://src.springframework.org/svn/spring-framework/trunk/build-spring-framework/pom.xml</a>
</div>
<div class="footnote" id="_footnotedef_54">
<a href="#_footnoteref_54">54</a>. <a href="http://www.easyant.org/" class="bare">http://www.easyant.org/</a>
</div>
<div class="footnote" id="_footnotedef_55">
<a href="#_footnoteref_55">55</a>. <a href="http://www.gradle.org/" class="bare">http://www.gradle.org/</a>
</div>
<div class="footnote" id="_footnotedef_56">
<a href="#_footnoteref_56">56</a>. <a href="http://www.gradle.org/userguide.html" class="bare">http://www.gradle.org/userguide.html</a>
</div>
<div class="footnote" id="_footnotedef_57">
<a href="#_footnoteref_57">57</a>. <a href="http://buildr.apache.org/" class="bare">http://buildr.apache.org/</a>
</div>
<div class="footnote" id="_footnotedef_58">
<a href="#_footnoteref_58">58</a>. Si vous ne connaissez pas, regardez au moins une fois : Les MaÃ§ons du cÅur (Extreme Makeover Home Edition en VO), Ã§a vous donnera une idÃ©e des travaux en cours.
</div>
<div class="footnote" id="_footnotedef_59">
<a href="#_footnoteref_59">59</a>. Entre la rÃ©daction de ce chapitre et sa relecture, SpringSource a Ã©tÃ© rachetÃ© par VMWare. Les choses vont tellement vite en informatiqueâ¦
</div>
<div class="footnote" id="_footnotedef_60">
<a href="#_footnoteref_60">60</a>. <a href="http://aether.sonatype.org" class="bare">http://aether.sonatype.org</a>
</div>
<div class="footnote" id="_footnotedef_61">
<a href="#_footnoteref_61">61</a>. <a href="http://sisu.sonatype.org" class="bare">http://sisu.sonatype.org</a>
</div>
<div class="footnote" id="_footnotedef_62">
<a href="#_footnoteref_62">62</a>. <a href="http://maven.apache.org/team-list.html" class="bare">http://maven.apache.org/team-list.html</a>
</div>
<div class="footnote" id="_footnotedef_63">
<a href="#_footnoteref_63">63</a>. Outil crÃ©Ã© par Peter Kriens, <a href="http://www.aqute.biz/Bnd/Bnd" class="bare">http://www.aqute.biz/Bnd/Bnd</a>
</div>
<div class="footnote" id="_footnotedef_64">
<a href="#_footnoteref_64">64</a>. <a href="http://mojo.codehaus.org/pde-maven-plugin/" class="bare">http://mojo.codehaus.org/pde-maven-plugin/</a>
</div>
<div class="footnote" id="_footnotedef_65">
<a href="#_footnoteref_65">65</a>. Mark Reinhold, qui nous a inspirÃ© ce personnage, est Â« principal engineer Â» chez Oracle et responsable du projet OpenJDK. PrÃ©cisons quâil nâa pas Ã©tÃ© consultÃ© pour relire ce chapitre, aussi les propos que nous lui prÃªtons sont totalement fictifs.
</div>
<div class="footnote" id="_footnotedef_66">
<a href="#_footnoteref_66">66</a>. <a href="http://openjdk.java.net/projects/jigsaw/" class="bare">http://openjdk.java.net/projects/jigsaw/</a>
</div>
<div class="footnote" id="_footnotedef_67">
<a href="#_footnoteref_67">67</a>. Tiger est le nom du projet de dÃ©veloppement de Java 5, comme Dolphin est le nom de Java 6 et Mustang celui de Java 7. De nombreuses librairies utilisent ce nom pour dÃ©signer une version adaptÃ©e Ã  Java 5, ce qui sonne mieux que -j5.
</div>
<div class="footnote" id="_footnotedef_68">
<a href="#_footnoteref_68">68</a>. Si vous voulez voir Ã  quoi cela peut ressembler, un vrai projet ingÃ©rable et interminable Ã  construire est SakaÃ¯ (<a href="http://sakaiproject.org/portal" class="bare">http://sakaiproject.org/portal</a>)
</div>
<div class="footnote" id="_footnotedef_69">
<a href="#_footnoteref_69">69</a>. <a href="http://whatisthematrix.warnerbros.com/" class="bare">http://whatisthematrix.warnerbros.com/</a>
</div>
<div class="footnote" id="_footnotedef_70">
<a href="#_footnoteref_70">70</a>. <a href="http://www.sonatype.com/products/maven/documentation/book-defguide" class="bare">http://www.sonatype.com/products/maven/documentation/book-defguide</a>
</div>
<div class="footnote" id="_footnotedef_71">
<a href="#_footnoteref_71">71</a>. <a href="http://xwiki.org" class="bare">http://xwiki.org</a>
</div>
<div class="footnote" id="_footnotedef_72">
<a href="#_footnoteref_72">72</a>. <a href="http://www.apache.org/" class="bare">http://www.apache.org/</a>
</div>
<div class="footnote" id="_footnotedef_73">
<a href="#_footnoteref_73">73</a>. <a href="http://www.apache.org/foundation/how-it-works.html#committers" class="bare">http://www.apache.org/foundation/how-it-works.html#committers</a>
</div>
<div class="footnote" id="_footnotedef_74">
<a href="#_footnoteref_74">74</a>. <a href="http://www.atlassian.com/software/jira/" class="bare">http://www.atlassian.com/software/jira/</a>
</div>
<div class="footnote" id="_footnotedef_75">
<a href="#_footnoteref_75">75</a>. <a href="http://jira.codehaus.org/browse/MNG" class="bare">http://jira.codehaus.org/browse/MNG</a>
</div>
<div class="footnote" id="_footnotedef_76">
<a href="#_footnoteref_76">76</a>. <a href="http://jira.codehaus.org/secure/BrowseProjects.jspa" class="bare">http://jira.codehaus.org/secure/BrowseProjects.jspa</a>
</div>
<div class="footnote" id="_footnotedef_77">
<a href="#_footnoteref_77">77</a>. <a href="http://www.atlassian.com/software/confluence/" class="bare">http://www.atlassian.com/software/confluence/</a>
</div>
<div class="footnote" id="_footnotedef_78">
<a href="#_footnoteref_78">78</a>. <a href="http://maven.apache.org/mail-lists.html" class="bare">http://maven.apache.org/mail-lists.html</a>
</div>
<div class="footnote" id="_footnotedef_79">
<a href="#_footnoteref_79">79</a>. <a href="http://irc.codehaus.org/" class="bare">http://irc.codehaus.org/</a>
</div>
<div class="footnote" id="_footnotedef_80">
<a href="#_footnoteref_80">80</a>. <a href="http://www-01.ibm.com/software/webservers/httpservers/" class="bare">http://www-01.ibm.com/software/webservers/httpservers/</a>
</div>
<div class="footnote" id="_footnotedef_81">
<a href="#_footnoteref_81">81</a>. <a href="http://www.apache.org/foundation/how-it-works.html#pmc-members" class="bare">http://www.apache.org/foundation/how-it-works.html#pmc-members</a>
</div>
<div class="footnote" id="_footnotedef_82">
<a href="#_footnoteref_82">82</a>. <a href="http://mojo.codehaus.org/" class="bare">http://mojo.codehaus.org/</a>
</div>
<div class="footnote" id="_footnotedef_83">
<a href="#_footnoteref_83">83</a>. <a href="http://maven.apache.org/pom.html" class="bare">http://maven.apache.org/pom.html</a>
</div>
<div class="footnote" id="_footnotedef_84">
<a href="#_footnoteref_84">84</a>. <a href="http://maven.apache.org/scm" class="bare">http://maven.apache.org/scm</a>
</div>
<div class="footnote" id="_footnotedef_85">
<a href="#_footnoteref_85">85</a>. <a href="http://maven.apache.org/settings.html" class="bare">http://maven.apache.org/settings.html</a>
</div>
<div class="footnote" id="_footnotedef_86">
<a href="#_footnoteref_86">86</a>. <a href="http://maven.apache.org/surefire" class="bare">http://maven.apache.org/surefire</a>
</div>
<div class="footnote" id="_footnotedef_87">
<a href="#_footnoteref_87">87</a>. <a href="http://www.junit.org" class="bare">http://www.junit.org</a>
</div>
<div class="footnote" id="_footnotedef_88">
<a href="#_footnoteref_88">88</a>. <a href="http://testng.org" class="bare">http://testng.org</a>
</div>
<div class="footnote" id="_footnotedef_89">
<a href="#_footnoteref_89">89</a>. <a href="http://classworlds.codehaus.org" class="bare">http://classworlds.codehaus.org</a>
</div>
<div class="footnote" id="_footnotedef_90">
<a href="#_footnoteref_90">90</a>. <a href="http://maven.apache.org/doxia/" class="bare">http://maven.apache.org/doxia/</a>
</div>
<div class="footnote" id="_footnotedef_91">
<a href="#_footnoteref_91">91</a>. <a href="http://maven.apache.org/mercury/" class="bare">http://maven.apache.org/mercury/</a>
</div>
<div class="footnote" id="_footnotedef_92">
<a href="#_footnoteref_92">92</a>. <a href="http://modello.codehaus.org/" class="bare">http://modello.codehaus.org/</a>
</div>
<div class="footnote" id="_footnotedef_93">
<a href="#_footnoteref_93">93</a>. <a href="http://plexus.codehaus.org/" class="bare">http://plexus.codehaus.org/</a>
</div>
<div class="footnote" id="_footnotedef_94">
<a href="#_footnoteref_94">94</a>. <a href="http://maven.apache.org/wagon" class="bare">http://maven.apache.org/wagon</a>
</div>
<div class="footnote" id="_footnotedef_95">
<a href="#_footnoteref_95">95</a>. <a href="http://svn.codehaus.org/mojo/trunk/mojo/maven-extensions/wagon-cifs" class="bare">http://svn.codehaus.org/mojo/trunk/mojo/maven-extensions/wagon-cifs</a>
</div>
<div class="footnote" id="_footnotedef_96">
<a href="#_footnoteref_96">96</a>. <a href="http://maven.apache.org/doxia/references/apt-format.html" class="bare">http://maven.apache.org/doxia/references/apt-format.html</a>
</div>
<div class="footnote" id="_footnotedef_97">
<a href="#_footnoteref_97">97</a>. <a href="http://maven.apache.org/doxia/references/fml-format.html" class="bare">http://maven.apache.org/doxia/references/fml-format.html</a>
</div>
<div class="footnote" id="_footnotedef_98">
<a href="#_footnoteref_98">98</a>. <a href="http://www.eclipse.org/" class="bare">http://www.eclipse.org/</a>
</div>
<div class="footnote" id="_footnotedef_99">
<a href="#_footnoteref_99">99</a>. <a href="http://www.eclipse.org/equinox/" class="bare">http://www.eclipse.org/equinox/</a>
</div>
<div class="footnote" id="_footnotedef_100">
<a href="#_footnoteref_100">100</a>. <a href="http://nexus.sonatype.org/" class="bare">http://nexus.sonatype.org/</a>
</div>
<div class="footnote" id="_footnotedef_101">
<a href="#_footnoteref_101">101</a>. <a href="http://docs.codehaus.org/display/MAVEN/" class="bare">http://docs.codehaus.org/display/MAVEN/</a>
</div>
<div class="footnote" id="_footnotedef_102">
<a href="#_footnoteref_102">102</a>. <a href="http://maven.apache.org/doxia/references/xdoc-format.html" class="bare">http://maven.apache.org/doxia/references/xdoc-format.html</a>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 3.0<br>
Last updated 2018-07-10 15:05:59 UTC
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>